var iA=r=>{throw TypeError(r)};var J1=(r,l,p)=>l.has(r)||iA("Cannot "+p);var Bt=(r,l,p)=>(J1(r,l,"read from private field"),p?p.call(r):l.get(r)),Xn=(r,l,p)=>l.has(r)?iA("Cannot add the same private member more than once"):l instanceof WeakSet?l.add(r):l.set(r,p),vn=(r,l,p,y)=>(J1(r,l,"write to private field"),y?y.call(r,p):l.set(r,p),p),Po=(r,l,p)=>(J1(r,l,"access private method"),p);var o0=(r,l,p,y)=>({set _(T){vn(r,l,T,p)},get _(){return Bt(r,l,y)}});function G3(r,l){for(var p=0;p<l.length;p++){const y=l[p];if(typeof y!="string"&&!Array.isArray(y)){for(const T in y)if(T!=="default"&&!(T in r)){const I=Object.getOwnPropertyDescriptor(y,T);I&&Object.defineProperty(r,T,I.get?I:{enumerable:!0,get:()=>y[T]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const T of document.querySelectorAll('link[rel="modulepreload"]'))y(T);new MutationObserver(T=>{for(const I of T)if(I.type==="childList")for(const R of I.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&y(R)}).observe(document,{childList:!0,subtree:!0});function p(T){const I={};return T.integrity&&(I.integrity=T.integrity),T.referrerPolicy&&(I.referrerPolicy=T.referrerPolicy),T.crossOrigin==="use-credentials"?I.credentials="include":T.crossOrigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function y(T){if(T.ep)return;T.ep=!0;const I=p(T);fetch(T.href,I)}})();var $3=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var eM={exports:{}},Tv={},tM={exports:{}},zn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qg=Symbol.for("react.element"),H3=Symbol.for("react.portal"),q3=Symbol.for("react.fragment"),W3=Symbol.for("react.strict_mode"),Z3=Symbol.for("react.profiler"),X3=Symbol.for("react.provider"),Y3=Symbol.for("react.context"),K3=Symbol.for("react.forward_ref"),Q3=Symbol.for("react.suspense"),J3=Symbol.for("react.memo"),eO=Symbol.for("react.lazy"),nA=Symbol.iterator;function tO(r){return r===null||typeof r!="object"?null:(r=nA&&r[nA]||r["@@iterator"],typeof r=="function"?r:null)}var iM={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},nM=Object.assign,rM={};function ip(r,l,p){this.props=r,this.context=l,this.refs=rM,this.updater=p||iM}ip.prototype.isReactComponent={};ip.prototype.setState=function(r,l){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,l,"setState")};ip.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function oM(){}oM.prototype=ip.prototype;function Xw(r,l,p){this.props=r,this.context=l,this.refs=rM,this.updater=p||iM}var Yw=Xw.prototype=new oM;Yw.constructor=Xw;nM(Yw,ip.prototype);Yw.isPureReactComponent=!0;var rA=Array.isArray,sM=Object.prototype.hasOwnProperty,Kw={current:null},aM={key:!0,ref:!0,__self:!0,__source:!0};function lM(r,l,p){var y,T={},I=null,R=null;if(l!=null)for(y in l.ref!==void 0&&(R=l.ref),l.key!==void 0&&(I=""+l.key),l)sM.call(l,y)&&!aM.hasOwnProperty(y)&&(T[y]=l[y]);var o=arguments.length-2;if(o===1)T.children=p;else if(1<o){for(var j=Array(o),W=0;W<o;W++)j[W]=arguments[W+2];T.children=j}if(r&&r.defaultProps)for(y in o=r.defaultProps,o)T[y]===void 0&&(T[y]=o[y]);return{$$typeof:Qg,type:r,key:I,ref:R,props:T,_owner:Kw.current}}function iO(r,l){return{$$typeof:Qg,type:r.type,key:l,ref:r.ref,props:r.props,_owner:r._owner}}function Qw(r){return typeof r=="object"&&r!==null&&r.$$typeof===Qg}function nO(r){var l={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(p){return l[p]})}var oA=/\/+/g;function eb(r,l){return typeof r=="object"&&r!==null&&r.key!=null?nO(""+r.key):l.toString(36)}function M0(r,l,p,y,T){var I=typeof r;(I==="undefined"||I==="boolean")&&(r=null);var R=!1;if(r===null)R=!0;else switch(I){case"string":case"number":R=!0;break;case"object":switch(r.$$typeof){case Qg:case H3:R=!0}}if(R)return R=r,T=T(R),r=y===""?"."+eb(R,0):y,rA(T)?(p="",r!=null&&(p=r.replace(oA,"$&/")+"/"),M0(T,l,p,"",function(W){return W})):T!=null&&(Qw(T)&&(T=iO(T,p+(!T.key||R&&R.key===T.key?"":(""+T.key).replace(oA,"$&/")+"/")+r)),l.push(T)),1;if(R=0,y=y===""?".":y+":",rA(r))for(var o=0;o<r.length;o++){I=r[o];var j=y+eb(I,o);R+=M0(I,l,p,j,T)}else if(j=tO(r),typeof j=="function")for(r=j.call(r),o=0;!(I=r.next()).done;)I=I.value,j=y+eb(I,o++),R+=M0(I,l,p,j,T);else if(I==="object")throw l=String(r),Error("Objects are not valid as a React child (found: "+(l==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":l)+"). If you meant to render a collection of children, use an array instead.");return R}function s0(r,l,p){if(r==null)return r;var y=[],T=0;return M0(r,y,"","",function(I){return l.call(p,I,T++)}),y}function rO(r){if(r._status===-1){var l=r._result;l=l(),l.then(function(p){(r._status===0||r._status===-1)&&(r._status=1,r._result=p)},function(p){(r._status===0||r._status===-1)&&(r._status=2,r._result=p)}),r._status===-1&&(r._status=0,r._result=l)}if(r._status===1)return r._result.default;throw r._result}var Ho={current:null},P0={transition:null},oO={ReactCurrentDispatcher:Ho,ReactCurrentBatchConfig:P0,ReactCurrentOwner:Kw};function cM(){throw Error("act(...) is not supported in production builds of React.")}zn.Children={map:s0,forEach:function(r,l,p){s0(r,function(){l.apply(this,arguments)},p)},count:function(r){var l=0;return s0(r,function(){l++}),l},toArray:function(r){return s0(r,function(l){return l})||[]},only:function(r){if(!Qw(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};zn.Component=ip;zn.Fragment=q3;zn.Profiler=Z3;zn.PureComponent=Xw;zn.StrictMode=W3;zn.Suspense=Q3;zn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oO;zn.act=cM;zn.cloneElement=function(r,l,p){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var y=nM({},r.props),T=r.key,I=r.ref,R=r._owner;if(l!=null){if(l.ref!==void 0&&(I=l.ref,R=Kw.current),l.key!==void 0&&(T=""+l.key),r.type&&r.type.defaultProps)var o=r.type.defaultProps;for(j in l)sM.call(l,j)&&!aM.hasOwnProperty(j)&&(y[j]=l[j]===void 0&&o!==void 0?o[j]:l[j])}var j=arguments.length-2;if(j===1)y.children=p;else if(1<j){o=Array(j);for(var W=0;W<j;W++)o[W]=arguments[W+2];y.children=o}return{$$typeof:Qg,type:r.type,key:T,ref:I,props:y,_owner:R}};zn.createContext=function(r){return r={$$typeof:Y3,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:X3,_context:r},r.Consumer=r};zn.createElement=lM;zn.createFactory=function(r){var l=lM.bind(null,r);return l.type=r,l};zn.createRef=function(){return{current:null}};zn.forwardRef=function(r){return{$$typeof:K3,render:r}};zn.isValidElement=Qw;zn.lazy=function(r){return{$$typeof:eO,_payload:{_status:-1,_result:r},_init:rO}};zn.memo=function(r,l){return{$$typeof:J3,type:r,compare:l===void 0?null:l}};zn.startTransition=function(r){var l=P0.transition;P0.transition={};try{r()}finally{P0.transition=l}};zn.unstable_act=cM;zn.useCallback=function(r,l){return Ho.current.useCallback(r,l)};zn.useContext=function(r){return Ho.current.useContext(r)};zn.useDebugValue=function(){};zn.useDeferredValue=function(r){return Ho.current.useDeferredValue(r)};zn.useEffect=function(r,l){return Ho.current.useEffect(r,l)};zn.useId=function(){return Ho.current.useId()};zn.useImperativeHandle=function(r,l,p){return Ho.current.useImperativeHandle(r,l,p)};zn.useInsertionEffect=function(r,l){return Ho.current.useInsertionEffect(r,l)};zn.useLayoutEffect=function(r,l){return Ho.current.useLayoutEffect(r,l)};zn.useMemo=function(r,l){return Ho.current.useMemo(r,l)};zn.useReducer=function(r,l,p){return Ho.current.useReducer(r,l,p)};zn.useRef=function(r){return Ho.current.useRef(r)};zn.useState=function(r){return Ho.current.useState(r)};zn.useSyncExternalStore=function(r,l,p){return Ho.current.useSyncExternalStore(r,l,p)};zn.useTransition=function(){return Ho.current.useTransition()};zn.version="18.3.1";tM.exports=zn;var xe=tM.exports;const ei=Zw(xe),uM=G3({__proto__:null,default:ei},[xe]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sO=xe,aO=Symbol.for("react.element"),lO=Symbol.for("react.fragment"),cO=Object.prototype.hasOwnProperty,uO=sO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hO={key:!0,ref:!0,__self:!0,__source:!0};function hM(r,l,p){var y,T={},I=null,R=null;p!==void 0&&(I=""+p),l.key!==void 0&&(I=""+l.key),l.ref!==void 0&&(R=l.ref);for(y in l)cO.call(l,y)&&!hO.hasOwnProperty(y)&&(T[y]=l[y]);if(r&&r.defaultProps)for(y in l=r.defaultProps,l)T[y]===void 0&&(T[y]=l[y]);return{$$typeof:aO,type:r,key:I,ref:R,props:T,_owner:uO.current}}Tv.Fragment=lO;Tv.jsx=hM;Tv.jsxs=hM;eM.exports=Tv;var ce=eM.exports,dM={exports:{}},ks={},fM={exports:{}},pM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function l(ft,$t){var Gt=ft.length;ft.push($t);e:for(;0<Gt;){var ii=Gt-1>>>1,Li=ft[ii];if(0<T(Li,$t))ft[ii]=$t,ft[Gt]=Li,Gt=ii;else break e}}function p(ft){return ft.length===0?null:ft[0]}function y(ft){if(ft.length===0)return null;var $t=ft[0],Gt=ft.pop();if(Gt!==$t){ft[0]=Gt;e:for(var ii=0,Li=ft.length,Ji=Li>>>1;ii<Ji;){var Vn=2*(ii+1)-1,$i=ft[Vn],Ei=Vn+1,xn=ft[Ei];if(0>T($i,Gt))Ei<Li&&0>T(xn,$i)?(ft[ii]=xn,ft[Ei]=Gt,ii=Ei):(ft[ii]=$i,ft[Vn]=Gt,ii=Vn);else if(Ei<Li&&0>T(xn,Gt))ft[ii]=xn,ft[Ei]=Gt,ii=Ei;else break e}}return $t}function T(ft,$t){var Gt=ft.sortIndex-$t.sortIndex;return Gt!==0?Gt:ft.id-$t.id}if(typeof performance=="object"&&typeof performance.now=="function"){var I=performance;r.unstable_now=function(){return I.now()}}else{var R=Date,o=R.now();r.unstable_now=function(){return R.now()-o}}var j=[],W=[],re=1,te=null,Y=3,Ee=!1,Ie=!1,me=!1,Pe=typeof setTimeout=="function"?setTimeout:null,he=typeof clearTimeout=="function"?clearTimeout:null,pe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function we(ft){for(var $t=p(W);$t!==null;){if($t.callback===null)y(W);else if($t.startTime<=ft)y(W),$t.sortIndex=$t.expirationTime,l(j,$t);else break;$t=p(W)}}function Ue(ft){if(me=!1,we(ft),!Ie)if(p(j)!==null)Ie=!0,ai(tt);else{var $t=p(W);$t!==null&&Vi(Ue,$t.startTime-ft)}}function tt(ft,$t){Ie=!1,me&&(me=!1,he(xt),xt=-1),Ee=!0;var Gt=Y;try{for(we($t),te=p(j);te!==null&&(!(te.expirationTime>$t)||ft&&!ni());){var ii=te.callback;if(typeof ii=="function"){te.callback=null,Y=te.priorityLevel;var Li=ii(te.expirationTime<=$t);$t=r.unstable_now(),typeof Li=="function"?te.callback=Li:te===p(j)&&y(j),we($t)}else y(j);te=p(j)}if(te!==null)var Ji=!0;else{var Vn=p(W);Vn!==null&&Vi(Ue,Vn.startTime-$t),Ji=!1}return Ji}finally{te=null,Y=Gt,Ee=!1}}var _t=!1,wt=null,xt=-1,ci=5,ti=-1;function ni(){return!(r.unstable_now()-ti<ci)}function ui(){if(wt!==null){var ft=r.unstable_now();ti=ft;var $t=!0;try{$t=wt(!0,ft)}finally{$t?Pi():(_t=!1,wt=null)}}else _t=!1}var Pi;if(typeof pe=="function")Pi=function(){pe(ui)};else if(typeof MessageChannel<"u"){var Vt=new MessageChannel,vi=Vt.port2;Vt.port1.onmessage=ui,Pi=function(){vi.postMessage(null)}}else Pi=function(){Pe(ui,0)};function ai(ft){wt=ft,_t||(_t=!0,Pi())}function Vi(ft,$t){xt=Pe(function(){ft(r.unstable_now())},$t)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(ft){ft.callback=null},r.unstable_continueExecution=function(){Ie||Ee||(Ie=!0,ai(tt))},r.unstable_forceFrameRate=function(ft){0>ft||125<ft?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ci=0<ft?Math.floor(1e3/ft):5},r.unstable_getCurrentPriorityLevel=function(){return Y},r.unstable_getFirstCallbackNode=function(){return p(j)},r.unstable_next=function(ft){switch(Y){case 1:case 2:case 3:var $t=3;break;default:$t=Y}var Gt=Y;Y=$t;try{return ft()}finally{Y=Gt}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(ft,$t){switch(ft){case 1:case 2:case 3:case 4:case 5:break;default:ft=3}var Gt=Y;Y=ft;try{return $t()}finally{Y=Gt}},r.unstable_scheduleCallback=function(ft,$t,Gt){var ii=r.unstable_now();switch(typeof Gt=="object"&&Gt!==null?(Gt=Gt.delay,Gt=typeof Gt=="number"&&0<Gt?ii+Gt:ii):Gt=ii,ft){case 1:var Li=-1;break;case 2:Li=250;break;case 5:Li=1073741823;break;case 4:Li=1e4;break;default:Li=5e3}return Li=Gt+Li,ft={id:re++,callback:$t,priorityLevel:ft,startTime:Gt,expirationTime:Li,sortIndex:-1},Gt>ii?(ft.sortIndex=Gt,l(W,ft),p(j)===null&&ft===p(W)&&(me?(he(xt),xt=-1):me=!0,Vi(Ue,Gt-ii))):(ft.sortIndex=Li,l(j,ft),Ie||Ee||(Ie=!0,ai(tt))),ft},r.unstable_shouldYield=ni,r.unstable_wrapCallback=function(ft){var $t=Y;return function(){var Gt=Y;Y=$t;try{return ft.apply(this,arguments)}finally{Y=Gt}}}})(pM);fM.exports=pM;var dO=fM.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fO=xe,Ds=dO;function Ht(r){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+r,p=1;p<arguments.length;p++)l+="&args[]="+encodeURIComponent(arguments[p]);return"Minified React error #"+r+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var mM=new Set,Sg={};function Wh(r,l){Wf(r,l),Wf(r+"Capture",l)}function Wf(r,l){for(Sg[r]=l,r=0;r<l.length;r++)mM.add(l[r])}var Xl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fb=Object.prototype.hasOwnProperty,pO=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,sA={},aA={};function mO(r){return Fb.call(aA,r)?!0:Fb.call(sA,r)?!1:pO.test(r)?aA[r]=!0:(sA[r]=!0,!1)}function gO(r,l,p,y){if(p!==null&&p.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return y?!1:p!==null?!p.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function _O(r,l,p,y){if(l===null||typeof l>"u"||gO(r,l,p,y))return!0;if(y)return!1;if(p!==null)switch(p.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function qo(r,l,p,y,T,I,R){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=y,this.attributeNamespace=T,this.mustUseProperty=p,this.propertyName=r,this.type=l,this.sanitizeURL=I,this.removeEmptyString=R}var bo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){bo[r]=new qo(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var l=r[0];bo[l]=new qo(l,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){bo[r]=new qo(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){bo[r]=new qo(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){bo[r]=new qo(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){bo[r]=new qo(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){bo[r]=new qo(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){bo[r]=new qo(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){bo[r]=new qo(r,5,!1,r.toLowerCase(),null,!1,!1)});var Jw=/[\-:]([a-z])/g;function eT(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var l=r.replace(Jw,eT);bo[l]=new qo(l,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var l=r.replace(Jw,eT);bo[l]=new qo(l,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var l=r.replace(Jw,eT);bo[l]=new qo(l,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){bo[r]=new qo(r,1,!1,r.toLowerCase(),null,!1,!1)});bo.xlinkHref=new qo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){bo[r]=new qo(r,1,!1,r.toLowerCase(),null,!0,!0)});function tT(r,l,p,y){var T=bo.hasOwnProperty(l)?bo[l]:null;(T!==null?T.type!==0:y||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(_O(l,p,T,y)&&(p=null),y||T===null?mO(l)&&(p===null?r.removeAttribute(l):r.setAttribute(l,""+p)):T.mustUseProperty?r[T.propertyName]=p===null?T.type===3?!1:"":p:(l=T.attributeName,y=T.attributeNamespace,p===null?r.removeAttribute(l):(T=T.type,p=T===3||T===4&&p===!0?"":""+p,y?r.setAttributeNS(y,l,p):r.setAttribute(l,p))))}var tc=fO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,a0=Symbol.for("react.element"),yf=Symbol.for("react.portal"),vf=Symbol.for("react.fragment"),iT=Symbol.for("react.strict_mode"),Bb=Symbol.for("react.profiler"),gM=Symbol.for("react.provider"),_M=Symbol.for("react.context"),nT=Symbol.for("react.forward_ref"),Nb=Symbol.for("react.suspense"),jb=Symbol.for("react.suspense_list"),rT=Symbol.for("react.memo"),Kc=Symbol.for("react.lazy"),yM=Symbol.for("react.offscreen"),lA=Symbol.iterator;function Jm(r){return r===null||typeof r!="object"?null:(r=lA&&r[lA]||r["@@iterator"],typeof r=="function"?r:null)}var Sr=Object.assign,tb;function cg(r){if(tb===void 0)try{throw Error()}catch(p){var l=p.stack.trim().match(/\n( *(at )?)/);tb=l&&l[1]||""}return`
`+tb+r}var ib=!1;function nb(r,l){if(!r||ib)return"";ib=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(W){var y=W}Reflect.construct(r,[],l)}else{try{l.call()}catch(W){y=W}r.call(l.prototype)}else{try{throw Error()}catch(W){y=W}r()}}catch(W){if(W&&y&&typeof W.stack=="string"){for(var T=W.stack.split(`
`),I=y.stack.split(`
`),R=T.length-1,o=I.length-1;1<=R&&0<=o&&T[R]!==I[o];)o--;for(;1<=R&&0<=o;R--,o--)if(T[R]!==I[o]){if(R!==1||o!==1)do if(R--,o--,0>o||T[R]!==I[o]){var j=`
`+T[R].replace(" at new "," at ");return r.displayName&&j.includes("<anonymous>")&&(j=j.replace("<anonymous>",r.displayName)),j}while(1<=R&&0<=o);break}}}finally{ib=!1,Error.prepareStackTrace=p}return(r=r?r.displayName||r.name:"")?cg(r):""}function yO(r){switch(r.tag){case 5:return cg(r.type);case 16:return cg("Lazy");case 13:return cg("Suspense");case 19:return cg("SuspenseList");case 0:case 2:case 15:return r=nb(r.type,!1),r;case 11:return r=nb(r.type.render,!1),r;case 1:return r=nb(r.type,!0),r;default:return""}}function Vb(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case vf:return"Fragment";case yf:return"Portal";case Bb:return"Profiler";case iT:return"StrictMode";case Nb:return"Suspense";case jb:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case _M:return(r.displayName||"Context")+".Consumer";case gM:return(r._context.displayName||"Context")+".Provider";case nT:var l=r.render;return r=r.displayName,r||(r=l.displayName||l.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case rT:return l=r.displayName||null,l!==null?l:Vb(r.type)||"Memo";case Kc:l=r._payload,r=r._init;try{return Vb(r(l))}catch{}}return null}function vO(r){var l=r.type;switch(r.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=l.render,r=r.displayName||r.name||"",l.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Vb(l);case 8:return l===iT?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function yu(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function vM(r){var l=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function xO(r){var l=vM(r)?"checked":"value",p=Object.getOwnPropertyDescriptor(r.constructor.prototype,l),y=""+r[l];if(!r.hasOwnProperty(l)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var T=p.get,I=p.set;return Object.defineProperty(r,l,{configurable:!0,get:function(){return T.call(this)},set:function(R){y=""+R,I.call(this,R)}}),Object.defineProperty(r,l,{enumerable:p.enumerable}),{getValue:function(){return y},setValue:function(R){y=""+R},stopTracking:function(){r._valueTracker=null,delete r[l]}}}}function l0(r){r._valueTracker||(r._valueTracker=xO(r))}function xM(r){if(!r)return!1;var l=r._valueTracker;if(!l)return!0;var p=l.getValue(),y="";return r&&(y=vM(r)?r.checked?"true":"false":r.value),r=y,r!==p?(l.setValue(r),!0):!1}function q0(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Ub(r,l){var p=l.checked;return Sr({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:p??r._wrapperState.initialChecked})}function cA(r,l){var p=l.defaultValue==null?"":l.defaultValue,y=l.checked!=null?l.checked:l.defaultChecked;p=yu(l.value!=null?l.value:p),r._wrapperState={initialChecked:y,initialValue:p,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function bM(r,l){l=l.checked,l!=null&&tT(r,"checked",l,!1)}function Gb(r,l){bM(r,l);var p=yu(l.value),y=l.type;if(p!=null)y==="number"?(p===0&&r.value===""||r.value!=p)&&(r.value=""+p):r.value!==""+p&&(r.value=""+p);else if(y==="submit"||y==="reset"){r.removeAttribute("value");return}l.hasOwnProperty("value")?$b(r,l.type,p):l.hasOwnProperty("defaultValue")&&$b(r,l.type,yu(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(r.defaultChecked=!!l.defaultChecked)}function uA(r,l,p){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var y=l.type;if(!(y!=="submit"&&y!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+r._wrapperState.initialValue,p||l===r.value||(r.value=l),r.defaultValue=l}p=r.name,p!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,p!==""&&(r.name=p)}function $b(r,l,p){(l!=="number"||q0(r.ownerDocument)!==r)&&(p==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+p&&(r.defaultValue=""+p))}var ug=Array.isArray;function Pf(r,l,p,y){if(r=r.options,l){l={};for(var T=0;T<p.length;T++)l["$"+p[T]]=!0;for(p=0;p<r.length;p++)T=l.hasOwnProperty("$"+r[p].value),r[p].selected!==T&&(r[p].selected=T),T&&y&&(r[p].defaultSelected=!0)}else{for(p=""+yu(p),l=null,T=0;T<r.length;T++){if(r[T].value===p){r[T].selected=!0,y&&(r[T].defaultSelected=!0);return}l!==null||r[T].disabled||(l=r[T])}l!==null&&(l.selected=!0)}}function Hb(r,l){if(l.dangerouslySetInnerHTML!=null)throw Error(Ht(91));return Sr({},l,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function hA(r,l){var p=l.value;if(p==null){if(p=l.children,l=l.defaultValue,p!=null){if(l!=null)throw Error(Ht(92));if(ug(p)){if(1<p.length)throw Error(Ht(93));p=p[0]}l=p}l==null&&(l=""),p=l}r._wrapperState={initialValue:yu(p)}}function wM(r,l){var p=yu(l.value),y=yu(l.defaultValue);p!=null&&(p=""+p,p!==r.value&&(r.value=p),l.defaultValue==null&&r.defaultValue!==p&&(r.defaultValue=p)),y!=null&&(r.defaultValue=""+y)}function dA(r){var l=r.textContent;l===r._wrapperState.initialValue&&l!==""&&l!==null&&(r.value=l)}function TM(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function qb(r,l){return r==null||r==="http://www.w3.org/1999/xhtml"?TM(l):r==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var c0,SM=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,p,y,T){MSApp.execUnsafeLocalFunction(function(){return r(l,p,y,T)})}:r}(function(r,l){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=l;else{for(c0=c0||document.createElement("div"),c0.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=c0.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;l.firstChild;)r.appendChild(l.firstChild)}});function Eg(r,l){if(l){var p=r.firstChild;if(p&&p===r.lastChild&&p.nodeType===3){p.nodeValue=l;return}}r.textContent=l}var pg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},bO=["Webkit","ms","Moz","O"];Object.keys(pg).forEach(function(r){bO.forEach(function(l){l=l+r.charAt(0).toUpperCase()+r.substring(1),pg[l]=pg[r]})});function EM(r,l,p){return l==null||typeof l=="boolean"||l===""?"":p||typeof l!="number"||l===0||pg.hasOwnProperty(r)&&pg[r]?(""+l).trim():l+"px"}function IM(r,l){r=r.style;for(var p in l)if(l.hasOwnProperty(p)){var y=p.indexOf("--")===0,T=EM(p,l[p],y);p==="float"&&(p="cssFloat"),y?r.setProperty(p,T):r[p]=T}}var wO=Sr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Wb(r,l){if(l){if(wO[r]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(Ht(137,r));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(Ht(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(Ht(61))}if(l.style!=null&&typeof l.style!="object")throw Error(Ht(62))}}function Zb(r,l){if(r.indexOf("-")===-1)return typeof l.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xb=null;function oT(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Yb=null,Rf=null,zf=null;function fA(r){if(r=t_(r)){if(typeof Yb!="function")throw Error(Ht(280));var l=r.stateNode;l&&(l=Cv(l),Yb(r.stateNode,r.type,l))}}function AM(r){Rf?zf?zf.push(r):zf=[r]:Rf=r}function CM(){if(Rf){var r=Rf,l=zf;if(zf=Rf=null,fA(r),l)for(r=0;r<l.length;r++)fA(l[r])}}function MM(r,l){return r(l)}function PM(){}var rb=!1;function RM(r,l,p){if(rb)return r(l,p);rb=!0;try{return MM(r,l,p)}finally{rb=!1,(Rf!==null||zf!==null)&&(PM(),CM())}}function Ig(r,l){var p=r.stateNode;if(p===null)return null;var y=Cv(p);if(y===null)return null;p=y[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(r=r.type,y=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!y;break e;default:r=!1}if(r)return null;if(p&&typeof p!="function")throw Error(Ht(231,l,typeof p));return p}var Kb=!1;if(Xl)try{var eg={};Object.defineProperty(eg,"passive",{get:function(){Kb=!0}}),window.addEventListener("test",eg,eg),window.removeEventListener("test",eg,eg)}catch{Kb=!1}function TO(r,l,p,y,T,I,R,o,j){var W=Array.prototype.slice.call(arguments,3);try{l.apply(p,W)}catch(re){this.onError(re)}}var mg=!1,W0=null,Z0=!1,Qb=null,SO={onError:function(r){mg=!0,W0=r}};function EO(r,l,p,y,T,I,R,o,j){mg=!1,W0=null,TO.apply(SO,arguments)}function IO(r,l,p,y,T,I,R,o,j){if(EO.apply(this,arguments),mg){if(mg){var W=W0;mg=!1,W0=null}else throw Error(Ht(198));Z0||(Z0=!0,Qb=W)}}function Zh(r){var l=r,p=r;if(r.alternate)for(;l.return;)l=l.return;else{r=l;do l=r,l.flags&4098&&(p=l.return),r=l.return;while(r)}return l.tag===3?p:null}function zM(r){if(r.tag===13){var l=r.memoizedState;if(l===null&&(r=r.alternate,r!==null&&(l=r.memoizedState)),l!==null)return l.dehydrated}return null}function pA(r){if(Zh(r)!==r)throw Error(Ht(188))}function AO(r){var l=r.alternate;if(!l){if(l=Zh(r),l===null)throw Error(Ht(188));return l!==r?null:r}for(var p=r,y=l;;){var T=p.return;if(T===null)break;var I=T.alternate;if(I===null){if(y=T.return,y!==null){p=y;continue}break}if(T.child===I.child){for(I=T.child;I;){if(I===p)return pA(T),r;if(I===y)return pA(T),l;I=I.sibling}throw Error(Ht(188))}if(p.return!==y.return)p=T,y=I;else{for(var R=!1,o=T.child;o;){if(o===p){R=!0,p=T,y=I;break}if(o===y){R=!0,y=T,p=I;break}o=o.sibling}if(!R){for(o=I.child;o;){if(o===p){R=!0,p=I,y=T;break}if(o===y){R=!0,y=I,p=T;break}o=o.sibling}if(!R)throw Error(Ht(189))}}if(p.alternate!==y)throw Error(Ht(190))}if(p.tag!==3)throw Error(Ht(188));return p.stateNode.current===p?r:l}function DM(r){return r=AO(r),r!==null?LM(r):null}function LM(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var l=LM(r);if(l!==null)return l;r=r.sibling}return null}var kM=Ds.unstable_scheduleCallback,mA=Ds.unstable_cancelCallback,CO=Ds.unstable_shouldYield,MO=Ds.unstable_requestPaint,kr=Ds.unstable_now,PO=Ds.unstable_getCurrentPriorityLevel,sT=Ds.unstable_ImmediatePriority,OM=Ds.unstable_UserBlockingPriority,X0=Ds.unstable_NormalPriority,RO=Ds.unstable_LowPriority,FM=Ds.unstable_IdlePriority,Sv=null,sl=null;function zO(r){if(sl&&typeof sl.onCommitFiberRoot=="function")try{sl.onCommitFiberRoot(Sv,r,void 0,(r.current.flags&128)===128)}catch{}}var Ia=Math.clz32?Math.clz32:kO,DO=Math.log,LO=Math.LN2;function kO(r){return r>>>=0,r===0?32:31-(DO(r)/LO|0)|0}var u0=64,h0=4194304;function hg(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Y0(r,l){var p=r.pendingLanes;if(p===0)return 0;var y=0,T=r.suspendedLanes,I=r.pingedLanes,R=p&268435455;if(R!==0){var o=R&~T;o!==0?y=hg(o):(I&=R,I!==0&&(y=hg(I)))}else R=p&~T,R!==0?y=hg(R):I!==0&&(y=hg(I));if(y===0)return 0;if(l!==0&&l!==y&&!(l&T)&&(T=y&-y,I=l&-l,T>=I||T===16&&(I&4194240)!==0))return l;if(y&4&&(y|=p&16),l=r.entangledLanes,l!==0)for(r=r.entanglements,l&=y;0<l;)p=31-Ia(l),T=1<<p,y|=r[p],l&=~T;return y}function OO(r,l){switch(r){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function FO(r,l){for(var p=r.suspendedLanes,y=r.pingedLanes,T=r.expirationTimes,I=r.pendingLanes;0<I;){var R=31-Ia(I),o=1<<R,j=T[R];j===-1?(!(o&p)||o&y)&&(T[R]=OO(o,l)):j<=l&&(r.expiredLanes|=o),I&=~o}}function Jb(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function BM(){var r=u0;return u0<<=1,!(u0&4194240)&&(u0=64),r}function ob(r){for(var l=[],p=0;31>p;p++)l.push(r);return l}function Jg(r,l,p){r.pendingLanes|=l,l!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,l=31-Ia(l),r[l]=p}function BO(r,l){var p=r.pendingLanes&~l;r.pendingLanes=l,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=l,r.mutableReadLanes&=l,r.entangledLanes&=l,l=r.entanglements;var y=r.eventTimes;for(r=r.expirationTimes;0<p;){var T=31-Ia(p),I=1<<T;l[T]=0,y[T]=-1,r[T]=-1,p&=~I}}function aT(r,l){var p=r.entangledLanes|=l;for(r=r.entanglements;p;){var y=31-Ia(p),T=1<<y;T&l|r[y]&l&&(r[y]|=l),p&=~T}}var Qn=0;function NM(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var jM,lT,VM,UM,GM,ew=!1,d0=[],cu=null,uu=null,hu=null,Ag=new Map,Cg=new Map,Jc=[],NO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gA(r,l){switch(r){case"focusin":case"focusout":cu=null;break;case"dragenter":case"dragleave":uu=null;break;case"mouseover":case"mouseout":hu=null;break;case"pointerover":case"pointerout":Ag.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":Cg.delete(l.pointerId)}}function tg(r,l,p,y,T,I){return r===null||r.nativeEvent!==I?(r={blockedOn:l,domEventName:p,eventSystemFlags:y,nativeEvent:I,targetContainers:[T]},l!==null&&(l=t_(l),l!==null&&lT(l)),r):(r.eventSystemFlags|=y,l=r.targetContainers,T!==null&&l.indexOf(T)===-1&&l.push(T),r)}function jO(r,l,p,y,T){switch(l){case"focusin":return cu=tg(cu,r,l,p,y,T),!0;case"dragenter":return uu=tg(uu,r,l,p,y,T),!0;case"mouseover":return hu=tg(hu,r,l,p,y,T),!0;case"pointerover":var I=T.pointerId;return Ag.set(I,tg(Ag.get(I)||null,r,l,p,y,T)),!0;case"gotpointercapture":return I=T.pointerId,Cg.set(I,tg(Cg.get(I)||null,r,l,p,y,T)),!0}return!1}function $M(r){var l=Ah(r.target);if(l!==null){var p=Zh(l);if(p!==null){if(l=p.tag,l===13){if(l=zM(p),l!==null){r.blockedOn=l,GM(r.priority,function(){VM(p)});return}}else if(l===3&&p.stateNode.current.memoizedState.isDehydrated){r.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}r.blockedOn=null}function R0(r){if(r.blockedOn!==null)return!1;for(var l=r.targetContainers;0<l.length;){var p=tw(r.domEventName,r.eventSystemFlags,l[0],r.nativeEvent);if(p===null){p=r.nativeEvent;var y=new p.constructor(p.type,p);Xb=y,p.target.dispatchEvent(y),Xb=null}else return l=t_(p),l!==null&&lT(l),r.blockedOn=p,!1;l.shift()}return!0}function _A(r,l,p){R0(r)&&p.delete(l)}function VO(){ew=!1,cu!==null&&R0(cu)&&(cu=null),uu!==null&&R0(uu)&&(uu=null),hu!==null&&R0(hu)&&(hu=null),Ag.forEach(_A),Cg.forEach(_A)}function ig(r,l){r.blockedOn===l&&(r.blockedOn=null,ew||(ew=!0,Ds.unstable_scheduleCallback(Ds.unstable_NormalPriority,VO)))}function Mg(r){function l(T){return ig(T,r)}if(0<d0.length){ig(d0[0],r);for(var p=1;p<d0.length;p++){var y=d0[p];y.blockedOn===r&&(y.blockedOn=null)}}for(cu!==null&&ig(cu,r),uu!==null&&ig(uu,r),hu!==null&&ig(hu,r),Ag.forEach(l),Cg.forEach(l),p=0;p<Jc.length;p++)y=Jc[p],y.blockedOn===r&&(y.blockedOn=null);for(;0<Jc.length&&(p=Jc[0],p.blockedOn===null);)$M(p),p.blockedOn===null&&Jc.shift()}var Df=tc.ReactCurrentBatchConfig,K0=!0;function UO(r,l,p,y){var T=Qn,I=Df.transition;Df.transition=null;try{Qn=1,cT(r,l,p,y)}finally{Qn=T,Df.transition=I}}function GO(r,l,p,y){var T=Qn,I=Df.transition;Df.transition=null;try{Qn=4,cT(r,l,p,y)}finally{Qn=T,Df.transition=I}}function cT(r,l,p,y){if(K0){var T=tw(r,l,p,y);if(T===null)mb(r,l,y,Q0,p),gA(r,y);else if(jO(T,r,l,p,y))y.stopPropagation();else if(gA(r,y),l&4&&-1<NO.indexOf(r)){for(;T!==null;){var I=t_(T);if(I!==null&&jM(I),I=tw(r,l,p,y),I===null&&mb(r,l,y,Q0,p),I===T)break;T=I}T!==null&&y.stopPropagation()}else mb(r,l,y,null,p)}}var Q0=null;function tw(r,l,p,y){if(Q0=null,r=oT(y),r=Ah(r),r!==null)if(l=Zh(r),l===null)r=null;else if(p=l.tag,p===13){if(r=zM(l),r!==null)return r;r=null}else if(p===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;r=null}else l!==r&&(r=null);return Q0=r,null}function HM(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(PO()){case sT:return 1;case OM:return 4;case X0:case RO:return 16;case FM:return 536870912;default:return 16}default:return 16}}var su=null,uT=null,z0=null;function qM(){if(z0)return z0;var r,l=uT,p=l.length,y,T="value"in su?su.value:su.textContent,I=T.length;for(r=0;r<p&&l[r]===T[r];r++);var R=p-r;for(y=1;y<=R&&l[p-y]===T[I-y];y++);return z0=T.slice(r,1<y?1-y:void 0)}function D0(r){var l=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&l===13&&(r=13)):r=l,r===10&&(r=13),32<=r||r===13?r:0}function f0(){return!0}function yA(){return!1}function Os(r){function l(p,y,T,I,R){this._reactName=p,this._targetInst=T,this.type=y,this.nativeEvent=I,this.target=R,this.currentTarget=null;for(var o in r)r.hasOwnProperty(o)&&(p=r[o],this[o]=p?p(I):I[o]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?f0:yA,this.isPropagationStopped=yA,this}return Sr(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=f0)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=f0)},persist:function(){},isPersistent:f0}),l}var np={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hT=Os(np),e_=Sr({},np,{view:0,detail:0}),$O=Os(e_),sb,ab,ng,Ev=Sr({},e_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dT,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==ng&&(ng&&r.type==="mousemove"?(sb=r.screenX-ng.screenX,ab=r.screenY-ng.screenY):ab=sb=0,ng=r),sb)},movementY:function(r){return"movementY"in r?r.movementY:ab}}),vA=Os(Ev),HO=Sr({},Ev,{dataTransfer:0}),qO=Os(HO),WO=Sr({},e_,{relatedTarget:0}),lb=Os(WO),ZO=Sr({},np,{animationName:0,elapsedTime:0,pseudoElement:0}),XO=Os(ZO),YO=Sr({},np,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),KO=Os(YO),QO=Sr({},np,{data:0}),xA=Os(QO),JO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eF={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tF={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function iF(r){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(r):(r=tF[r])?!!l[r]:!1}function dT(){return iF}var nF=Sr({},e_,{key:function(r){if(r.key){var l=JO[r.key]||r.key;if(l!=="Unidentified")return l}return r.type==="keypress"?(r=D0(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?eF[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dT,charCode:function(r){return r.type==="keypress"?D0(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?D0(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),rF=Os(nF),oF=Sr({},Ev,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bA=Os(oF),sF=Sr({},e_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dT}),aF=Os(sF),lF=Sr({},np,{propertyName:0,elapsedTime:0,pseudoElement:0}),cF=Os(lF),uF=Sr({},Ev,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),hF=Os(uF),dF=[9,13,27,32],fT=Xl&&"CompositionEvent"in window,gg=null;Xl&&"documentMode"in document&&(gg=document.documentMode);var fF=Xl&&"TextEvent"in window&&!gg,WM=Xl&&(!fT||gg&&8<gg&&11>=gg),wA=" ",TA=!1;function ZM(r,l){switch(r){case"keyup":return dF.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function XM(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var xf=!1;function pF(r,l){switch(r){case"compositionend":return XM(l);case"keypress":return l.which!==32?null:(TA=!0,wA);case"textInput":return r=l.data,r===wA&&TA?null:r;default:return null}}function mF(r,l){if(xf)return r==="compositionend"||!fT&&ZM(r,l)?(r=qM(),z0=uT=su=null,xf=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return WM&&l.locale!=="ko"?null:l.data;default:return null}}var gF={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function SA(r){var l=r&&r.nodeName&&r.nodeName.toLowerCase();return l==="input"?!!gF[r.type]:l==="textarea"}function YM(r,l,p,y){AM(y),l=J0(l,"onChange"),0<l.length&&(p=new hT("onChange","change",null,p,y),r.push({event:p,listeners:l}))}var _g=null,Pg=null;function _F(r){aP(r,0)}function Iv(r){var l=Tf(r);if(xM(l))return r}function yF(r,l){if(r==="change")return l}var KM=!1;if(Xl){var cb;if(Xl){var ub="oninput"in document;if(!ub){var EA=document.createElement("div");EA.setAttribute("oninput","return;"),ub=typeof EA.oninput=="function"}cb=ub}else cb=!1;KM=cb&&(!document.documentMode||9<document.documentMode)}function IA(){_g&&(_g.detachEvent("onpropertychange",QM),Pg=_g=null)}function QM(r){if(r.propertyName==="value"&&Iv(Pg)){var l=[];YM(l,Pg,r,oT(r)),RM(_F,l)}}function vF(r,l,p){r==="focusin"?(IA(),_g=l,Pg=p,_g.attachEvent("onpropertychange",QM)):r==="focusout"&&IA()}function xF(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Iv(Pg)}function bF(r,l){if(r==="click")return Iv(l)}function wF(r,l){if(r==="input"||r==="change")return Iv(l)}function TF(r,l){return r===l&&(r!==0||1/r===1/l)||r!==r&&l!==l}var Ca=typeof Object.is=="function"?Object.is:TF;function Rg(r,l){if(Ca(r,l))return!0;if(typeof r!="object"||r===null||typeof l!="object"||l===null)return!1;var p=Object.keys(r),y=Object.keys(l);if(p.length!==y.length)return!1;for(y=0;y<p.length;y++){var T=p[y];if(!Fb.call(l,T)||!Ca(r[T],l[T]))return!1}return!0}function AA(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function CA(r,l){var p=AA(r);r=0;for(var y;p;){if(p.nodeType===3){if(y=r+p.textContent.length,r<=l&&y>=l)return{node:p,offset:l-r};r=y}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=AA(p)}}function JM(r,l){return r&&l?r===l?!0:r&&r.nodeType===3?!1:l&&l.nodeType===3?JM(r,l.parentNode):"contains"in r?r.contains(l):r.compareDocumentPosition?!!(r.compareDocumentPosition(l)&16):!1:!1}function eP(){for(var r=window,l=q0();l instanceof r.HTMLIFrameElement;){try{var p=typeof l.contentWindow.location.href=="string"}catch{p=!1}if(p)r=l.contentWindow;else break;l=q0(r.document)}return l}function pT(r){var l=r&&r.nodeName&&r.nodeName.toLowerCase();return l&&(l==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||l==="textarea"||r.contentEditable==="true")}function SF(r){var l=eP(),p=r.focusedElem,y=r.selectionRange;if(l!==p&&p&&p.ownerDocument&&JM(p.ownerDocument.documentElement,p)){if(y!==null&&pT(p)){if(l=y.start,r=y.end,r===void 0&&(r=l),"selectionStart"in p)p.selectionStart=l,p.selectionEnd=Math.min(r,p.value.length);else if(r=(l=p.ownerDocument||document)&&l.defaultView||window,r.getSelection){r=r.getSelection();var T=p.textContent.length,I=Math.min(y.start,T);y=y.end===void 0?I:Math.min(y.end,T),!r.extend&&I>y&&(T=y,y=I,I=T),T=CA(p,I);var R=CA(p,y);T&&R&&(r.rangeCount!==1||r.anchorNode!==T.node||r.anchorOffset!==T.offset||r.focusNode!==R.node||r.focusOffset!==R.offset)&&(l=l.createRange(),l.setStart(T.node,T.offset),r.removeAllRanges(),I>y?(r.addRange(l),r.extend(R.node,R.offset)):(l.setEnd(R.node,R.offset),r.addRange(l)))}}for(l=[],r=p;r=r.parentNode;)r.nodeType===1&&l.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof p.focus=="function"&&p.focus(),p=0;p<l.length;p++)r=l[p],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var EF=Xl&&"documentMode"in document&&11>=document.documentMode,bf=null,iw=null,yg=null,nw=!1;function MA(r,l,p){var y=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;nw||bf==null||bf!==q0(y)||(y=bf,"selectionStart"in y&&pT(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),yg&&Rg(yg,y)||(yg=y,y=J0(iw,"onSelect"),0<y.length&&(l=new hT("onSelect","select",null,l,p),r.push({event:l,listeners:y}),l.target=bf)))}function p0(r,l){var p={};return p[r.toLowerCase()]=l.toLowerCase(),p["Webkit"+r]="webkit"+l,p["Moz"+r]="moz"+l,p}var wf={animationend:p0("Animation","AnimationEnd"),animationiteration:p0("Animation","AnimationIteration"),animationstart:p0("Animation","AnimationStart"),transitionend:p0("Transition","TransitionEnd")},hb={},tP={};Xl&&(tP=document.createElement("div").style,"AnimationEvent"in window||(delete wf.animationend.animation,delete wf.animationiteration.animation,delete wf.animationstart.animation),"TransitionEvent"in window||delete wf.transitionend.transition);function Av(r){if(hb[r])return hb[r];if(!wf[r])return r;var l=wf[r],p;for(p in l)if(l.hasOwnProperty(p)&&p in tP)return hb[r]=l[p];return r}var iP=Av("animationend"),nP=Av("animationiteration"),rP=Av("animationstart"),oP=Av("transitionend"),sP=new Map,PA="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Eu(r,l){sP.set(r,l),Wh(l,[r])}for(var db=0;db<PA.length;db++){var fb=PA[db],IF=fb.toLowerCase(),AF=fb[0].toUpperCase()+fb.slice(1);Eu(IF,"on"+AF)}Eu(iP,"onAnimationEnd");Eu(nP,"onAnimationIteration");Eu(rP,"onAnimationStart");Eu("dblclick","onDoubleClick");Eu("focusin","onFocus");Eu("focusout","onBlur");Eu(oP,"onTransitionEnd");Wf("onMouseEnter",["mouseout","mouseover"]);Wf("onMouseLeave",["mouseout","mouseover"]);Wf("onPointerEnter",["pointerout","pointerover"]);Wf("onPointerLeave",["pointerout","pointerover"]);Wh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var dg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),CF=new Set("cancel close invalid load scroll toggle".split(" ").concat(dg));function RA(r,l,p){var y=r.type||"unknown-event";r.currentTarget=p,IO(y,l,void 0,r),r.currentTarget=null}function aP(r,l){l=(l&4)!==0;for(var p=0;p<r.length;p++){var y=r[p],T=y.event;y=y.listeners;e:{var I=void 0;if(l)for(var R=y.length-1;0<=R;R--){var o=y[R],j=o.instance,W=o.currentTarget;if(o=o.listener,j!==I&&T.isPropagationStopped())break e;RA(T,o,W),I=j}else for(R=0;R<y.length;R++){if(o=y[R],j=o.instance,W=o.currentTarget,o=o.listener,j!==I&&T.isPropagationStopped())break e;RA(T,o,W),I=j}}}if(Z0)throw r=Qb,Z0=!1,Qb=null,r}function fr(r,l){var p=l[lw];p===void 0&&(p=l[lw]=new Set);var y=r+"__bubble";p.has(y)||(lP(l,r,2,!1),p.add(y))}function pb(r,l,p){var y=0;l&&(y|=4),lP(p,r,y,l)}var m0="_reactListening"+Math.random().toString(36).slice(2);function zg(r){if(!r[m0]){r[m0]=!0,mM.forEach(function(p){p!=="selectionchange"&&(CF.has(p)||pb(p,!1,r),pb(p,!0,r))});var l=r.nodeType===9?r:r.ownerDocument;l===null||l[m0]||(l[m0]=!0,pb("selectionchange",!1,l))}}function lP(r,l,p,y){switch(HM(l)){case 1:var T=UO;break;case 4:T=GO;break;default:T=cT}p=T.bind(null,l,p,r),T=void 0,!Kb||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(T=!0),y?T!==void 0?r.addEventListener(l,p,{capture:!0,passive:T}):r.addEventListener(l,p,!0):T!==void 0?r.addEventListener(l,p,{passive:T}):r.addEventListener(l,p,!1)}function mb(r,l,p,y,T){var I=y;if(!(l&1)&&!(l&2)&&y!==null)e:for(;;){if(y===null)return;var R=y.tag;if(R===3||R===4){var o=y.stateNode.containerInfo;if(o===T||o.nodeType===8&&o.parentNode===T)break;if(R===4)for(R=y.return;R!==null;){var j=R.tag;if((j===3||j===4)&&(j=R.stateNode.containerInfo,j===T||j.nodeType===8&&j.parentNode===T))return;R=R.return}for(;o!==null;){if(R=Ah(o),R===null)return;if(j=R.tag,j===5||j===6){y=I=R;continue e}o=o.parentNode}}y=y.return}RM(function(){var W=I,re=oT(p),te=[];e:{var Y=sP.get(r);if(Y!==void 0){var Ee=hT,Ie=r;switch(r){case"keypress":if(D0(p)===0)break e;case"keydown":case"keyup":Ee=rF;break;case"focusin":Ie="focus",Ee=lb;break;case"focusout":Ie="blur",Ee=lb;break;case"beforeblur":case"afterblur":Ee=lb;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ee=vA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ee=qO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ee=aF;break;case iP:case nP:case rP:Ee=XO;break;case oP:Ee=cF;break;case"scroll":Ee=$O;break;case"wheel":Ee=hF;break;case"copy":case"cut":case"paste":Ee=KO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ee=bA}var me=(l&4)!==0,Pe=!me&&r==="scroll",he=me?Y!==null?Y+"Capture":null:Y;me=[];for(var pe=W,we;pe!==null;){we=pe;var Ue=we.stateNode;if(we.tag===5&&Ue!==null&&(we=Ue,he!==null&&(Ue=Ig(pe,he),Ue!=null&&me.push(Dg(pe,Ue,we)))),Pe)break;pe=pe.return}0<me.length&&(Y=new Ee(Y,Ie,null,p,re),te.push({event:Y,listeners:me}))}}if(!(l&7)){e:{if(Y=r==="mouseover"||r==="pointerover",Ee=r==="mouseout"||r==="pointerout",Y&&p!==Xb&&(Ie=p.relatedTarget||p.fromElement)&&(Ah(Ie)||Ie[Yl]))break e;if((Ee||Y)&&(Y=re.window===re?re:(Y=re.ownerDocument)?Y.defaultView||Y.parentWindow:window,Ee?(Ie=p.relatedTarget||p.toElement,Ee=W,Ie=Ie?Ah(Ie):null,Ie!==null&&(Pe=Zh(Ie),Ie!==Pe||Ie.tag!==5&&Ie.tag!==6)&&(Ie=null)):(Ee=null,Ie=W),Ee!==Ie)){if(me=vA,Ue="onMouseLeave",he="onMouseEnter",pe="mouse",(r==="pointerout"||r==="pointerover")&&(me=bA,Ue="onPointerLeave",he="onPointerEnter",pe="pointer"),Pe=Ee==null?Y:Tf(Ee),we=Ie==null?Y:Tf(Ie),Y=new me(Ue,pe+"leave",Ee,p,re),Y.target=Pe,Y.relatedTarget=we,Ue=null,Ah(re)===W&&(me=new me(he,pe+"enter",Ie,p,re),me.target=we,me.relatedTarget=Pe,Ue=me),Pe=Ue,Ee&&Ie)t:{for(me=Ee,he=Ie,pe=0,we=me;we;we=mf(we))pe++;for(we=0,Ue=he;Ue;Ue=mf(Ue))we++;for(;0<pe-we;)me=mf(me),pe--;for(;0<we-pe;)he=mf(he),we--;for(;pe--;){if(me===he||he!==null&&me===he.alternate)break t;me=mf(me),he=mf(he)}me=null}else me=null;Ee!==null&&zA(te,Y,Ee,me,!1),Ie!==null&&Pe!==null&&zA(te,Pe,Ie,me,!0)}}e:{if(Y=W?Tf(W):window,Ee=Y.nodeName&&Y.nodeName.toLowerCase(),Ee==="select"||Ee==="input"&&Y.type==="file")var tt=yF;else if(SA(Y))if(KM)tt=wF;else{tt=xF;var _t=vF}else(Ee=Y.nodeName)&&Ee.toLowerCase()==="input"&&(Y.type==="checkbox"||Y.type==="radio")&&(tt=bF);if(tt&&(tt=tt(r,W))){YM(te,tt,p,re);break e}_t&&_t(r,Y,W),r==="focusout"&&(_t=Y._wrapperState)&&_t.controlled&&Y.type==="number"&&$b(Y,"number",Y.value)}switch(_t=W?Tf(W):window,r){case"focusin":(SA(_t)||_t.contentEditable==="true")&&(bf=_t,iw=W,yg=null);break;case"focusout":yg=iw=bf=null;break;case"mousedown":nw=!0;break;case"contextmenu":case"mouseup":case"dragend":nw=!1,MA(te,p,re);break;case"selectionchange":if(EF)break;case"keydown":case"keyup":MA(te,p,re)}var wt;if(fT)e:{switch(r){case"compositionstart":var xt="onCompositionStart";break e;case"compositionend":xt="onCompositionEnd";break e;case"compositionupdate":xt="onCompositionUpdate";break e}xt=void 0}else xf?ZM(r,p)&&(xt="onCompositionEnd"):r==="keydown"&&p.keyCode===229&&(xt="onCompositionStart");xt&&(WM&&p.locale!=="ko"&&(xf||xt!=="onCompositionStart"?xt==="onCompositionEnd"&&xf&&(wt=qM()):(su=re,uT="value"in su?su.value:su.textContent,xf=!0)),_t=J0(W,xt),0<_t.length&&(xt=new xA(xt,r,null,p,re),te.push({event:xt,listeners:_t}),wt?xt.data=wt:(wt=XM(p),wt!==null&&(xt.data=wt)))),(wt=fF?pF(r,p):mF(r,p))&&(W=J0(W,"onBeforeInput"),0<W.length&&(re=new xA("onBeforeInput","beforeinput",null,p,re),te.push({event:re,listeners:W}),re.data=wt))}aP(te,l)})}function Dg(r,l,p){return{instance:r,listener:l,currentTarget:p}}function J0(r,l){for(var p=l+"Capture",y=[];r!==null;){var T=r,I=T.stateNode;T.tag===5&&I!==null&&(T=I,I=Ig(r,p),I!=null&&y.unshift(Dg(r,I,T)),I=Ig(r,l),I!=null&&y.push(Dg(r,I,T))),r=r.return}return y}function mf(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function zA(r,l,p,y,T){for(var I=l._reactName,R=[];p!==null&&p!==y;){var o=p,j=o.alternate,W=o.stateNode;if(j!==null&&j===y)break;o.tag===5&&W!==null&&(o=W,T?(j=Ig(p,I),j!=null&&R.unshift(Dg(p,j,o))):T||(j=Ig(p,I),j!=null&&R.push(Dg(p,j,o)))),p=p.return}R.length!==0&&r.push({event:l,listeners:R})}var MF=/\r\n?/g,PF=/\u0000|\uFFFD/g;function DA(r){return(typeof r=="string"?r:""+r).replace(MF,`
`).replace(PF,"")}function g0(r,l,p){if(l=DA(l),DA(r)!==l&&p)throw Error(Ht(425))}function ev(){}var rw=null,ow=null;function sw(r,l){return r==="textarea"||r==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var aw=typeof setTimeout=="function"?setTimeout:void 0,RF=typeof clearTimeout=="function"?clearTimeout:void 0,LA=typeof Promise=="function"?Promise:void 0,zF=typeof queueMicrotask=="function"?queueMicrotask:typeof LA<"u"?function(r){return LA.resolve(null).then(r).catch(DF)}:aw;function DF(r){setTimeout(function(){throw r})}function gb(r,l){var p=l,y=0;do{var T=p.nextSibling;if(r.removeChild(p),T&&T.nodeType===8)if(p=T.data,p==="/$"){if(y===0){r.removeChild(T),Mg(l);return}y--}else p!=="$"&&p!=="$?"&&p!=="$!"||y++;p=T}while(p);Mg(l)}function du(r){for(;r!=null;r=r.nextSibling){var l=r.nodeType;if(l===1||l===3)break;if(l===8){if(l=r.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return r}function kA(r){r=r.previousSibling;for(var l=0;r;){if(r.nodeType===8){var p=r.data;if(p==="$"||p==="$!"||p==="$?"){if(l===0)return r;l--}else p==="/$"&&l++}r=r.previousSibling}return null}var rp=Math.random().toString(36).slice(2),ol="__reactFiber$"+rp,Lg="__reactProps$"+rp,Yl="__reactContainer$"+rp,lw="__reactEvents$"+rp,LF="__reactListeners$"+rp,kF="__reactHandles$"+rp;function Ah(r){var l=r[ol];if(l)return l;for(var p=r.parentNode;p;){if(l=p[Yl]||p[ol]){if(p=l.alternate,l.child!==null||p!==null&&p.child!==null)for(r=kA(r);r!==null;){if(p=r[ol])return p;r=kA(r)}return l}r=p,p=r.parentNode}return null}function t_(r){return r=r[ol]||r[Yl],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Tf(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Ht(33))}function Cv(r){return r[Lg]||null}var cw=[],Sf=-1;function Iu(r){return{current:r}}function pr(r){0>Sf||(r.current=cw[Sf],cw[Sf]=null,Sf--)}function cr(r,l){Sf++,cw[Sf]=r.current,r.current=l}var vu={},ko=Iu(vu),ls=Iu(!1),Vh=vu;function Zf(r,l){var p=r.type.contextTypes;if(!p)return vu;var y=r.stateNode;if(y&&y.__reactInternalMemoizedUnmaskedChildContext===l)return y.__reactInternalMemoizedMaskedChildContext;var T={},I;for(I in p)T[I]=l[I];return y&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=l,r.__reactInternalMemoizedMaskedChildContext=T),T}function cs(r){return r=r.childContextTypes,r!=null}function tv(){pr(ls),pr(ko)}function OA(r,l,p){if(ko.current!==vu)throw Error(Ht(168));cr(ko,l),cr(ls,p)}function cP(r,l,p){var y=r.stateNode;if(l=l.childContextTypes,typeof y.getChildContext!="function")return p;y=y.getChildContext();for(var T in y)if(!(T in l))throw Error(Ht(108,vO(r)||"Unknown",T));return Sr({},p,y)}function iv(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||vu,Vh=ko.current,cr(ko,r),cr(ls,ls.current),!0}function FA(r,l,p){var y=r.stateNode;if(!y)throw Error(Ht(169));p?(r=cP(r,l,Vh),y.__reactInternalMemoizedMergedChildContext=r,pr(ls),pr(ko),cr(ko,r)):pr(ls),cr(ls,p)}var Hl=null,Mv=!1,_b=!1;function uP(r){Hl===null?Hl=[r]:Hl.push(r)}function OF(r){Mv=!0,uP(r)}function Au(){if(!_b&&Hl!==null){_b=!0;var r=0,l=Qn;try{var p=Hl;for(Qn=1;r<p.length;r++){var y=p[r];do y=y(!0);while(y!==null)}Hl=null,Mv=!1}catch(T){throw Hl!==null&&(Hl=Hl.slice(r+1)),kM(sT,Au),T}finally{Qn=l,_b=!1}}return null}var Ef=[],If=0,nv=null,rv=0,Zs=[],Xs=0,Uh=null,ql=1,Wl="";function Eh(r,l){Ef[If++]=rv,Ef[If++]=nv,nv=r,rv=l}function hP(r,l,p){Zs[Xs++]=ql,Zs[Xs++]=Wl,Zs[Xs++]=Uh,Uh=r;var y=ql;r=Wl;var T=32-Ia(y)-1;y&=~(1<<T),p+=1;var I=32-Ia(l)+T;if(30<I){var R=T-T%5;I=(y&(1<<R)-1).toString(32),y>>=R,T-=R,ql=1<<32-Ia(l)+T|p<<T|y,Wl=I+r}else ql=1<<I|p<<T|y,Wl=r}function mT(r){r.return!==null&&(Eh(r,1),hP(r,1,0))}function gT(r){for(;r===nv;)nv=Ef[--If],Ef[If]=null,rv=Ef[--If],Ef[If]=null;for(;r===Uh;)Uh=Zs[--Xs],Zs[Xs]=null,Wl=Zs[--Xs],Zs[Xs]=null,ql=Zs[--Xs],Zs[Xs]=null}var Rs=null,Ps=null,_r=!1,Ea=null;function dP(r,l){var p=Ys(5,null,null,0);p.elementType="DELETED",p.stateNode=l,p.return=r,l=r.deletions,l===null?(r.deletions=[p],r.flags|=16):l.push(p)}function BA(r,l){switch(r.tag){case 5:var p=r.type;return l=l.nodeType!==1||p.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(r.stateNode=l,Rs=r,Ps=du(l.firstChild),!0):!1;case 6:return l=r.pendingProps===""||l.nodeType!==3?null:l,l!==null?(r.stateNode=l,Rs=r,Ps=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(p=Uh!==null?{id:ql,overflow:Wl}:null,r.memoizedState={dehydrated:l,treeContext:p,retryLane:1073741824},p=Ys(18,null,null,0),p.stateNode=l,p.return=r,r.child=p,Rs=r,Ps=null,!0):!1;default:return!1}}function uw(r){return(r.mode&1)!==0&&(r.flags&128)===0}function hw(r){if(_r){var l=Ps;if(l){var p=l;if(!BA(r,l)){if(uw(r))throw Error(Ht(418));l=du(p.nextSibling);var y=Rs;l&&BA(r,l)?dP(y,p):(r.flags=r.flags&-4097|2,_r=!1,Rs=r)}}else{if(uw(r))throw Error(Ht(418));r.flags=r.flags&-4097|2,_r=!1,Rs=r}}}function NA(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Rs=r}function _0(r){if(r!==Rs)return!1;if(!_r)return NA(r),_r=!0,!1;var l;if((l=r.tag!==3)&&!(l=r.tag!==5)&&(l=r.type,l=l!=="head"&&l!=="body"&&!sw(r.type,r.memoizedProps)),l&&(l=Ps)){if(uw(r))throw fP(),Error(Ht(418));for(;l;)dP(r,l),l=du(l.nextSibling)}if(NA(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Ht(317));e:{for(r=r.nextSibling,l=0;r;){if(r.nodeType===8){var p=r.data;if(p==="/$"){if(l===0){Ps=du(r.nextSibling);break e}l--}else p!=="$"&&p!=="$!"&&p!=="$?"||l++}r=r.nextSibling}Ps=null}}else Ps=Rs?du(r.stateNode.nextSibling):null;return!0}function fP(){for(var r=Ps;r;)r=du(r.nextSibling)}function Xf(){Ps=Rs=null,_r=!1}function _T(r){Ea===null?Ea=[r]:Ea.push(r)}var FF=tc.ReactCurrentBatchConfig;function rg(r,l,p){if(r=p.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(p._owner){if(p=p._owner,p){if(p.tag!==1)throw Error(Ht(309));var y=p.stateNode}if(!y)throw Error(Ht(147,r));var T=y,I=""+r;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===I?l.ref:(l=function(R){var o=T.refs;R===null?delete o[I]:o[I]=R},l._stringRef=I,l)}if(typeof r!="string")throw Error(Ht(284));if(!p._owner)throw Error(Ht(290,r))}return r}function y0(r,l){throw r=Object.prototype.toString.call(l),Error(Ht(31,r==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":r))}function jA(r){var l=r._init;return l(r._payload)}function pP(r){function l(he,pe){if(r){var we=he.deletions;we===null?(he.deletions=[pe],he.flags|=16):we.push(pe)}}function p(he,pe){if(!r)return null;for(;pe!==null;)l(he,pe),pe=pe.sibling;return null}function y(he,pe){for(he=new Map;pe!==null;)pe.key!==null?he.set(pe.key,pe):he.set(pe.index,pe),pe=pe.sibling;return he}function T(he,pe){return he=gu(he,pe),he.index=0,he.sibling=null,he}function I(he,pe,we){return he.index=we,r?(we=he.alternate,we!==null?(we=we.index,we<pe?(he.flags|=2,pe):we):(he.flags|=2,pe)):(he.flags|=1048576,pe)}function R(he){return r&&he.alternate===null&&(he.flags|=2),he}function o(he,pe,we,Ue){return pe===null||pe.tag!==6?(pe=Sb(we,he.mode,Ue),pe.return=he,pe):(pe=T(pe,we),pe.return=he,pe)}function j(he,pe,we,Ue){var tt=we.type;return tt===vf?re(he,pe,we.props.children,Ue,we.key):pe!==null&&(pe.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===Kc&&jA(tt)===pe.type)?(Ue=T(pe,we.props),Ue.ref=rg(he,pe,we),Ue.return=he,Ue):(Ue=j0(we.type,we.key,we.props,null,he.mode,Ue),Ue.ref=rg(he,pe,we),Ue.return=he,Ue)}function W(he,pe,we,Ue){return pe===null||pe.tag!==4||pe.stateNode.containerInfo!==we.containerInfo||pe.stateNode.implementation!==we.implementation?(pe=Eb(we,he.mode,Ue),pe.return=he,pe):(pe=T(pe,we.children||[]),pe.return=he,pe)}function re(he,pe,we,Ue,tt){return pe===null||pe.tag!==7?(pe=kh(we,he.mode,Ue,tt),pe.return=he,pe):(pe=T(pe,we),pe.return=he,pe)}function te(he,pe,we){if(typeof pe=="string"&&pe!==""||typeof pe=="number")return pe=Sb(""+pe,he.mode,we),pe.return=he,pe;if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case a0:return we=j0(pe.type,pe.key,pe.props,null,he.mode,we),we.ref=rg(he,null,pe),we.return=he,we;case yf:return pe=Eb(pe,he.mode,we),pe.return=he,pe;case Kc:var Ue=pe._init;return te(he,Ue(pe._payload),we)}if(ug(pe)||Jm(pe))return pe=kh(pe,he.mode,we,null),pe.return=he,pe;y0(he,pe)}return null}function Y(he,pe,we,Ue){var tt=pe!==null?pe.key:null;if(typeof we=="string"&&we!==""||typeof we=="number")return tt!==null?null:o(he,pe,""+we,Ue);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case a0:return we.key===tt?j(he,pe,we,Ue):null;case yf:return we.key===tt?W(he,pe,we,Ue):null;case Kc:return tt=we._init,Y(he,pe,tt(we._payload),Ue)}if(ug(we)||Jm(we))return tt!==null?null:re(he,pe,we,Ue,null);y0(he,we)}return null}function Ee(he,pe,we,Ue,tt){if(typeof Ue=="string"&&Ue!==""||typeof Ue=="number")return he=he.get(we)||null,o(pe,he,""+Ue,tt);if(typeof Ue=="object"&&Ue!==null){switch(Ue.$$typeof){case a0:return he=he.get(Ue.key===null?we:Ue.key)||null,j(pe,he,Ue,tt);case yf:return he=he.get(Ue.key===null?we:Ue.key)||null,W(pe,he,Ue,tt);case Kc:var _t=Ue._init;return Ee(he,pe,we,_t(Ue._payload),tt)}if(ug(Ue)||Jm(Ue))return he=he.get(we)||null,re(pe,he,Ue,tt,null);y0(pe,Ue)}return null}function Ie(he,pe,we,Ue){for(var tt=null,_t=null,wt=pe,xt=pe=0,ci=null;wt!==null&&xt<we.length;xt++){wt.index>xt?(ci=wt,wt=null):ci=wt.sibling;var ti=Y(he,wt,we[xt],Ue);if(ti===null){wt===null&&(wt=ci);break}r&&wt&&ti.alternate===null&&l(he,wt),pe=I(ti,pe,xt),_t===null?tt=ti:_t.sibling=ti,_t=ti,wt=ci}if(xt===we.length)return p(he,wt),_r&&Eh(he,xt),tt;if(wt===null){for(;xt<we.length;xt++)wt=te(he,we[xt],Ue),wt!==null&&(pe=I(wt,pe,xt),_t===null?tt=wt:_t.sibling=wt,_t=wt);return _r&&Eh(he,xt),tt}for(wt=y(he,wt);xt<we.length;xt++)ci=Ee(wt,he,xt,we[xt],Ue),ci!==null&&(r&&ci.alternate!==null&&wt.delete(ci.key===null?xt:ci.key),pe=I(ci,pe,xt),_t===null?tt=ci:_t.sibling=ci,_t=ci);return r&&wt.forEach(function(ni){return l(he,ni)}),_r&&Eh(he,xt),tt}function me(he,pe,we,Ue){var tt=Jm(we);if(typeof tt!="function")throw Error(Ht(150));if(we=tt.call(we),we==null)throw Error(Ht(151));for(var _t=tt=null,wt=pe,xt=pe=0,ci=null,ti=we.next();wt!==null&&!ti.done;xt++,ti=we.next()){wt.index>xt?(ci=wt,wt=null):ci=wt.sibling;var ni=Y(he,wt,ti.value,Ue);if(ni===null){wt===null&&(wt=ci);break}r&&wt&&ni.alternate===null&&l(he,wt),pe=I(ni,pe,xt),_t===null?tt=ni:_t.sibling=ni,_t=ni,wt=ci}if(ti.done)return p(he,wt),_r&&Eh(he,xt),tt;if(wt===null){for(;!ti.done;xt++,ti=we.next())ti=te(he,ti.value,Ue),ti!==null&&(pe=I(ti,pe,xt),_t===null?tt=ti:_t.sibling=ti,_t=ti);return _r&&Eh(he,xt),tt}for(wt=y(he,wt);!ti.done;xt++,ti=we.next())ti=Ee(wt,he,xt,ti.value,Ue),ti!==null&&(r&&ti.alternate!==null&&wt.delete(ti.key===null?xt:ti.key),pe=I(ti,pe,xt),_t===null?tt=ti:_t.sibling=ti,_t=ti);return r&&wt.forEach(function(ui){return l(he,ui)}),_r&&Eh(he,xt),tt}function Pe(he,pe,we,Ue){if(typeof we=="object"&&we!==null&&we.type===vf&&we.key===null&&(we=we.props.children),typeof we=="object"&&we!==null){switch(we.$$typeof){case a0:e:{for(var tt=we.key,_t=pe;_t!==null;){if(_t.key===tt){if(tt=we.type,tt===vf){if(_t.tag===7){p(he,_t.sibling),pe=T(_t,we.props.children),pe.return=he,he=pe;break e}}else if(_t.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===Kc&&jA(tt)===_t.type){p(he,_t.sibling),pe=T(_t,we.props),pe.ref=rg(he,_t,we),pe.return=he,he=pe;break e}p(he,_t);break}else l(he,_t);_t=_t.sibling}we.type===vf?(pe=kh(we.props.children,he.mode,Ue,we.key),pe.return=he,he=pe):(Ue=j0(we.type,we.key,we.props,null,he.mode,Ue),Ue.ref=rg(he,pe,we),Ue.return=he,he=Ue)}return R(he);case yf:e:{for(_t=we.key;pe!==null;){if(pe.key===_t)if(pe.tag===4&&pe.stateNode.containerInfo===we.containerInfo&&pe.stateNode.implementation===we.implementation){p(he,pe.sibling),pe=T(pe,we.children||[]),pe.return=he,he=pe;break e}else{p(he,pe);break}else l(he,pe);pe=pe.sibling}pe=Eb(we,he.mode,Ue),pe.return=he,he=pe}return R(he);case Kc:return _t=we._init,Pe(he,pe,_t(we._payload),Ue)}if(ug(we))return Ie(he,pe,we,Ue);if(Jm(we))return me(he,pe,we,Ue);y0(he,we)}return typeof we=="string"&&we!==""||typeof we=="number"?(we=""+we,pe!==null&&pe.tag===6?(p(he,pe.sibling),pe=T(pe,we),pe.return=he,he=pe):(p(he,pe),pe=Sb(we,he.mode,Ue),pe.return=he,he=pe),R(he)):p(he,pe)}return Pe}var Yf=pP(!0),mP=pP(!1),ov=Iu(null),sv=null,Af=null,yT=null;function vT(){yT=Af=sv=null}function xT(r){var l=ov.current;pr(ov),r._currentValue=l}function dw(r,l,p){for(;r!==null;){var y=r.alternate;if((r.childLanes&l)!==l?(r.childLanes|=l,y!==null&&(y.childLanes|=l)):y!==null&&(y.childLanes&l)!==l&&(y.childLanes|=l),r===p)break;r=r.return}}function Lf(r,l){sv=r,yT=Af=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&l&&(as=!0),r.firstContext=null)}function Qs(r){var l=r._currentValue;if(yT!==r)if(r={context:r,memoizedValue:l,next:null},Af===null){if(sv===null)throw Error(Ht(308));Af=r,sv.dependencies={lanes:0,firstContext:r}}else Af=Af.next=r;return l}var Ch=null;function bT(r){Ch===null?Ch=[r]:Ch.push(r)}function gP(r,l,p,y){var T=l.interleaved;return T===null?(p.next=p,bT(l)):(p.next=T.next,T.next=p),l.interleaved=p,Kl(r,y)}function Kl(r,l){r.lanes|=l;var p=r.alternate;for(p!==null&&(p.lanes|=l),p=r,r=r.return;r!==null;)r.childLanes|=l,p=r.alternate,p!==null&&(p.childLanes|=l),p=r,r=r.return;return p.tag===3?p.stateNode:null}var Qc=!1;function wT(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _P(r,l){r=r.updateQueue,l.updateQueue===r&&(l.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Zl(r,l){return{eventTime:r,lane:l,tag:0,payload:null,callback:null,next:null}}function fu(r,l,p){var y=r.updateQueue;if(y===null)return null;if(y=y.shared,$n&2){var T=y.pending;return T===null?l.next=l:(l.next=T.next,T.next=l),y.pending=l,Kl(r,p)}return T=y.interleaved,T===null?(l.next=l,bT(y)):(l.next=T.next,T.next=l),y.interleaved=l,Kl(r,p)}function L0(r,l,p){if(l=l.updateQueue,l!==null&&(l=l.shared,(p&4194240)!==0)){var y=l.lanes;y&=r.pendingLanes,p|=y,l.lanes=p,aT(r,p)}}function VA(r,l){var p=r.updateQueue,y=r.alternate;if(y!==null&&(y=y.updateQueue,p===y)){var T=null,I=null;if(p=p.firstBaseUpdate,p!==null){do{var R={eventTime:p.eventTime,lane:p.lane,tag:p.tag,payload:p.payload,callback:p.callback,next:null};I===null?T=I=R:I=I.next=R,p=p.next}while(p!==null);I===null?T=I=l:I=I.next=l}else T=I=l;p={baseState:y.baseState,firstBaseUpdate:T,lastBaseUpdate:I,shared:y.shared,effects:y.effects},r.updateQueue=p;return}r=p.lastBaseUpdate,r===null?p.firstBaseUpdate=l:r.next=l,p.lastBaseUpdate=l}function av(r,l,p,y){var T=r.updateQueue;Qc=!1;var I=T.firstBaseUpdate,R=T.lastBaseUpdate,o=T.shared.pending;if(o!==null){T.shared.pending=null;var j=o,W=j.next;j.next=null,R===null?I=W:R.next=W,R=j;var re=r.alternate;re!==null&&(re=re.updateQueue,o=re.lastBaseUpdate,o!==R&&(o===null?re.firstBaseUpdate=W:o.next=W,re.lastBaseUpdate=j))}if(I!==null){var te=T.baseState;R=0,re=W=j=null,o=I;do{var Y=o.lane,Ee=o.eventTime;if((y&Y)===Y){re!==null&&(re=re.next={eventTime:Ee,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var Ie=r,me=o;switch(Y=l,Ee=p,me.tag){case 1:if(Ie=me.payload,typeof Ie=="function"){te=Ie.call(Ee,te,Y);break e}te=Ie;break e;case 3:Ie.flags=Ie.flags&-65537|128;case 0:if(Ie=me.payload,Y=typeof Ie=="function"?Ie.call(Ee,te,Y):Ie,Y==null)break e;te=Sr({},te,Y);break e;case 2:Qc=!0}}o.callback!==null&&o.lane!==0&&(r.flags|=64,Y=T.effects,Y===null?T.effects=[o]:Y.push(o))}else Ee={eventTime:Ee,lane:Y,tag:o.tag,payload:o.payload,callback:o.callback,next:null},re===null?(W=re=Ee,j=te):re=re.next=Ee,R|=Y;if(o=o.next,o===null){if(o=T.shared.pending,o===null)break;Y=o,o=Y.next,Y.next=null,T.lastBaseUpdate=Y,T.shared.pending=null}}while(!0);if(re===null&&(j=te),T.baseState=j,T.firstBaseUpdate=W,T.lastBaseUpdate=re,l=T.shared.interleaved,l!==null){T=l;do R|=T.lane,T=T.next;while(T!==l)}else I===null&&(T.shared.lanes=0);$h|=R,r.lanes=R,r.memoizedState=te}}function UA(r,l,p){if(r=l.effects,l.effects=null,r!==null)for(l=0;l<r.length;l++){var y=r[l],T=y.callback;if(T!==null){if(y.callback=null,y=p,typeof T!="function")throw Error(Ht(191,T));T.call(y)}}}var i_={},al=Iu(i_),kg=Iu(i_),Og=Iu(i_);function Mh(r){if(r===i_)throw Error(Ht(174));return r}function TT(r,l){switch(cr(Og,l),cr(kg,r),cr(al,i_),r=l.nodeType,r){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:qb(null,"");break;default:r=r===8?l.parentNode:l,l=r.namespaceURI||null,r=r.tagName,l=qb(l,r)}pr(al),cr(al,l)}function Kf(){pr(al),pr(kg),pr(Og)}function yP(r){Mh(Og.current);var l=Mh(al.current),p=qb(l,r.type);l!==p&&(cr(kg,r),cr(al,p))}function ST(r){kg.current===r&&(pr(al),pr(kg))}var wr=Iu(0);function lv(r){for(var l=r;l!==null;){if(l.tag===13){var p=l.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data==="$?"||p.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if(l.flags&128)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===r)break;for(;l.sibling===null;){if(l.return===null||l.return===r)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var yb=[];function ET(){for(var r=0;r<yb.length;r++)yb[r]._workInProgressVersionPrimary=null;yb.length=0}var k0=tc.ReactCurrentDispatcher,vb=tc.ReactCurrentBatchConfig,Gh=0,Tr=null,Kr=null,uo=null,cv=!1,vg=!1,Fg=0,BF=0;function Ro(){throw Error(Ht(321))}function IT(r,l){if(l===null)return!1;for(var p=0;p<l.length&&p<r.length;p++)if(!Ca(r[p],l[p]))return!1;return!0}function AT(r,l,p,y,T,I){if(Gh=I,Tr=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,k0.current=r===null||r.memoizedState===null?UF:GF,r=p(y,T),vg){I=0;do{if(vg=!1,Fg=0,25<=I)throw Error(Ht(301));I+=1,uo=Kr=null,l.updateQueue=null,k0.current=$F,r=p(y,T)}while(vg)}if(k0.current=uv,l=Kr!==null&&Kr.next!==null,Gh=0,uo=Kr=Tr=null,cv=!1,l)throw Error(Ht(300));return r}function CT(){var r=Fg!==0;return Fg=0,r}function tl(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return uo===null?Tr.memoizedState=uo=r:uo=uo.next=r,uo}function Js(){if(Kr===null){var r=Tr.alternate;r=r!==null?r.memoizedState:null}else r=Kr.next;var l=uo===null?Tr.memoizedState:uo.next;if(l!==null)uo=l,Kr=r;else{if(r===null)throw Error(Ht(310));Kr=r,r={memoizedState:Kr.memoizedState,baseState:Kr.baseState,baseQueue:Kr.baseQueue,queue:Kr.queue,next:null},uo===null?Tr.memoizedState=uo=r:uo=uo.next=r}return uo}function Bg(r,l){return typeof l=="function"?l(r):l}function xb(r){var l=Js(),p=l.queue;if(p===null)throw Error(Ht(311));p.lastRenderedReducer=r;var y=Kr,T=y.baseQueue,I=p.pending;if(I!==null){if(T!==null){var R=T.next;T.next=I.next,I.next=R}y.baseQueue=T=I,p.pending=null}if(T!==null){I=T.next,y=y.baseState;var o=R=null,j=null,W=I;do{var re=W.lane;if((Gh&re)===re)j!==null&&(j=j.next={lane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),y=W.hasEagerState?W.eagerState:r(y,W.action);else{var te={lane:re,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null};j===null?(o=j=te,R=y):j=j.next=te,Tr.lanes|=re,$h|=re}W=W.next}while(W!==null&&W!==I);j===null?R=y:j.next=o,Ca(y,l.memoizedState)||(as=!0),l.memoizedState=y,l.baseState=R,l.baseQueue=j,p.lastRenderedState=y}if(r=p.interleaved,r!==null){T=r;do I=T.lane,Tr.lanes|=I,$h|=I,T=T.next;while(T!==r)}else T===null&&(p.lanes=0);return[l.memoizedState,p.dispatch]}function bb(r){var l=Js(),p=l.queue;if(p===null)throw Error(Ht(311));p.lastRenderedReducer=r;var y=p.dispatch,T=p.pending,I=l.memoizedState;if(T!==null){p.pending=null;var R=T=T.next;do I=r(I,R.action),R=R.next;while(R!==T);Ca(I,l.memoizedState)||(as=!0),l.memoizedState=I,l.baseQueue===null&&(l.baseState=I),p.lastRenderedState=I}return[I,y]}function vP(){}function xP(r,l){var p=Tr,y=Js(),T=l(),I=!Ca(y.memoizedState,T);if(I&&(y.memoizedState=T,as=!0),y=y.queue,MT(TP.bind(null,p,y,r),[r]),y.getSnapshot!==l||I||uo!==null&&uo.memoizedState.tag&1){if(p.flags|=2048,Ng(9,wP.bind(null,p,y,T,l),void 0,null),ho===null)throw Error(Ht(349));Gh&30||bP(p,l,T)}return T}function bP(r,l,p){r.flags|=16384,r={getSnapshot:l,value:p},l=Tr.updateQueue,l===null?(l={lastEffect:null,stores:null},Tr.updateQueue=l,l.stores=[r]):(p=l.stores,p===null?l.stores=[r]:p.push(r))}function wP(r,l,p,y){l.value=p,l.getSnapshot=y,SP(l)&&EP(r)}function TP(r,l,p){return p(function(){SP(l)&&EP(r)})}function SP(r){var l=r.getSnapshot;r=r.value;try{var p=l();return!Ca(r,p)}catch{return!0}}function EP(r){var l=Kl(r,1);l!==null&&Aa(l,r,1,-1)}function GA(r){var l=tl();return typeof r=="function"&&(r=r()),l.memoizedState=l.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Bg,lastRenderedState:r},l.queue=r,r=r.dispatch=VF.bind(null,Tr,r),[l.memoizedState,r]}function Ng(r,l,p,y){return r={tag:r,create:l,destroy:p,deps:y,next:null},l=Tr.updateQueue,l===null?(l={lastEffect:null,stores:null},Tr.updateQueue=l,l.lastEffect=r.next=r):(p=l.lastEffect,p===null?l.lastEffect=r.next=r:(y=p.next,p.next=r,r.next=y,l.lastEffect=r)),r}function IP(){return Js().memoizedState}function O0(r,l,p,y){var T=tl();Tr.flags|=r,T.memoizedState=Ng(1|l,p,void 0,y===void 0?null:y)}function Pv(r,l,p,y){var T=Js();y=y===void 0?null:y;var I=void 0;if(Kr!==null){var R=Kr.memoizedState;if(I=R.destroy,y!==null&&IT(y,R.deps)){T.memoizedState=Ng(l,p,I,y);return}}Tr.flags|=r,T.memoizedState=Ng(1|l,p,I,y)}function $A(r,l){return O0(8390656,8,r,l)}function MT(r,l){return Pv(2048,8,r,l)}function AP(r,l){return Pv(4,2,r,l)}function CP(r,l){return Pv(4,4,r,l)}function MP(r,l){if(typeof l=="function")return r=r(),l(r),function(){l(null)};if(l!=null)return r=r(),l.current=r,function(){l.current=null}}function PP(r,l,p){return p=p!=null?p.concat([r]):null,Pv(4,4,MP.bind(null,l,r),p)}function PT(){}function RP(r,l){var p=Js();l=l===void 0?null:l;var y=p.memoizedState;return y!==null&&l!==null&&IT(l,y[1])?y[0]:(p.memoizedState=[r,l],r)}function zP(r,l){var p=Js();l=l===void 0?null:l;var y=p.memoizedState;return y!==null&&l!==null&&IT(l,y[1])?y[0]:(r=r(),p.memoizedState=[r,l],r)}function DP(r,l,p){return Gh&21?(Ca(p,l)||(p=BM(),Tr.lanes|=p,$h|=p,r.baseState=!0),l):(r.baseState&&(r.baseState=!1,as=!0),r.memoizedState=p)}function NF(r,l){var p=Qn;Qn=p!==0&&4>p?p:4,r(!0);var y=vb.transition;vb.transition={};try{r(!1),l()}finally{Qn=p,vb.transition=y}}function LP(){return Js().memoizedState}function jF(r,l,p){var y=mu(r);if(p={lane:y,action:p,hasEagerState:!1,eagerState:null,next:null},kP(r))OP(l,p);else if(p=gP(r,l,p,y),p!==null){var T=$o();Aa(p,r,y,T),FP(p,l,y)}}function VF(r,l,p){var y=mu(r),T={lane:y,action:p,hasEagerState:!1,eagerState:null,next:null};if(kP(r))OP(l,T);else{var I=r.alternate;if(r.lanes===0&&(I===null||I.lanes===0)&&(I=l.lastRenderedReducer,I!==null))try{var R=l.lastRenderedState,o=I(R,p);if(T.hasEagerState=!0,T.eagerState=o,Ca(o,R)){var j=l.interleaved;j===null?(T.next=T,bT(l)):(T.next=j.next,j.next=T),l.interleaved=T;return}}catch{}finally{}p=gP(r,l,T,y),p!==null&&(T=$o(),Aa(p,r,y,T),FP(p,l,y))}}function kP(r){var l=r.alternate;return r===Tr||l!==null&&l===Tr}function OP(r,l){vg=cv=!0;var p=r.pending;p===null?l.next=l:(l.next=p.next,p.next=l),r.pending=l}function FP(r,l,p){if(p&4194240){var y=l.lanes;y&=r.pendingLanes,p|=y,l.lanes=p,aT(r,p)}}var uv={readContext:Qs,useCallback:Ro,useContext:Ro,useEffect:Ro,useImperativeHandle:Ro,useInsertionEffect:Ro,useLayoutEffect:Ro,useMemo:Ro,useReducer:Ro,useRef:Ro,useState:Ro,useDebugValue:Ro,useDeferredValue:Ro,useTransition:Ro,useMutableSource:Ro,useSyncExternalStore:Ro,useId:Ro,unstable_isNewReconciler:!1},UF={readContext:Qs,useCallback:function(r,l){return tl().memoizedState=[r,l===void 0?null:l],r},useContext:Qs,useEffect:$A,useImperativeHandle:function(r,l,p){return p=p!=null?p.concat([r]):null,O0(4194308,4,MP.bind(null,l,r),p)},useLayoutEffect:function(r,l){return O0(4194308,4,r,l)},useInsertionEffect:function(r,l){return O0(4,2,r,l)},useMemo:function(r,l){var p=tl();return l=l===void 0?null:l,r=r(),p.memoizedState=[r,l],r},useReducer:function(r,l,p){var y=tl();return l=p!==void 0?p(l):l,y.memoizedState=y.baseState=l,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:l},y.queue=r,r=r.dispatch=jF.bind(null,Tr,r),[y.memoizedState,r]},useRef:function(r){var l=tl();return r={current:r},l.memoizedState=r},useState:GA,useDebugValue:PT,useDeferredValue:function(r){return tl().memoizedState=r},useTransition:function(){var r=GA(!1),l=r[0];return r=NF.bind(null,r[1]),tl().memoizedState=r,[l,r]},useMutableSource:function(){},useSyncExternalStore:function(r,l,p){var y=Tr,T=tl();if(_r){if(p===void 0)throw Error(Ht(407));p=p()}else{if(p=l(),ho===null)throw Error(Ht(349));Gh&30||bP(y,l,p)}T.memoizedState=p;var I={value:p,getSnapshot:l};return T.queue=I,$A(TP.bind(null,y,I,r),[r]),y.flags|=2048,Ng(9,wP.bind(null,y,I,p,l),void 0,null),p},useId:function(){var r=tl(),l=ho.identifierPrefix;if(_r){var p=Wl,y=ql;p=(y&~(1<<32-Ia(y)-1)).toString(32)+p,l=":"+l+"R"+p,p=Fg++,0<p&&(l+="H"+p.toString(32)),l+=":"}else p=BF++,l=":"+l+"r"+p.toString(32)+":";return r.memoizedState=l},unstable_isNewReconciler:!1},GF={readContext:Qs,useCallback:RP,useContext:Qs,useEffect:MT,useImperativeHandle:PP,useInsertionEffect:AP,useLayoutEffect:CP,useMemo:zP,useReducer:xb,useRef:IP,useState:function(){return xb(Bg)},useDebugValue:PT,useDeferredValue:function(r){var l=Js();return DP(l,Kr.memoizedState,r)},useTransition:function(){var r=xb(Bg)[0],l=Js().memoizedState;return[r,l]},useMutableSource:vP,useSyncExternalStore:xP,useId:LP,unstable_isNewReconciler:!1},$F={readContext:Qs,useCallback:RP,useContext:Qs,useEffect:MT,useImperativeHandle:PP,useInsertionEffect:AP,useLayoutEffect:CP,useMemo:zP,useReducer:bb,useRef:IP,useState:function(){return bb(Bg)},useDebugValue:PT,useDeferredValue:function(r){var l=Js();return Kr===null?l.memoizedState=r:DP(l,Kr.memoizedState,r)},useTransition:function(){var r=bb(Bg)[0],l=Js().memoizedState;return[r,l]},useMutableSource:vP,useSyncExternalStore:xP,useId:LP,unstable_isNewReconciler:!1};function ba(r,l){if(r&&r.defaultProps){l=Sr({},l),r=r.defaultProps;for(var p in r)l[p]===void 0&&(l[p]=r[p]);return l}return l}function fw(r,l,p,y){l=r.memoizedState,p=p(y,l),p=p==null?l:Sr({},l,p),r.memoizedState=p,r.lanes===0&&(r.updateQueue.baseState=p)}var Rv={isMounted:function(r){return(r=r._reactInternals)?Zh(r)===r:!1},enqueueSetState:function(r,l,p){r=r._reactInternals;var y=$o(),T=mu(r),I=Zl(y,T);I.payload=l,p!=null&&(I.callback=p),l=fu(r,I,T),l!==null&&(Aa(l,r,T,y),L0(l,r,T))},enqueueReplaceState:function(r,l,p){r=r._reactInternals;var y=$o(),T=mu(r),I=Zl(y,T);I.tag=1,I.payload=l,p!=null&&(I.callback=p),l=fu(r,I,T),l!==null&&(Aa(l,r,T,y),L0(l,r,T))},enqueueForceUpdate:function(r,l){r=r._reactInternals;var p=$o(),y=mu(r),T=Zl(p,y);T.tag=2,l!=null&&(T.callback=l),l=fu(r,T,y),l!==null&&(Aa(l,r,y,p),L0(l,r,y))}};function HA(r,l,p,y,T,I,R){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(y,I,R):l.prototype&&l.prototype.isPureReactComponent?!Rg(p,y)||!Rg(T,I):!0}function BP(r,l,p){var y=!1,T=vu,I=l.contextType;return typeof I=="object"&&I!==null?I=Qs(I):(T=cs(l)?Vh:ko.current,y=l.contextTypes,I=(y=y!=null)?Zf(r,T):vu),l=new l(p,I),r.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=Rv,r.stateNode=l,l._reactInternals=r,y&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=T,r.__reactInternalMemoizedMaskedChildContext=I),l}function qA(r,l,p,y){r=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(p,y),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(p,y),l.state!==r&&Rv.enqueueReplaceState(l,l.state,null)}function pw(r,l,p,y){var T=r.stateNode;T.props=p,T.state=r.memoizedState,T.refs={},wT(r);var I=l.contextType;typeof I=="object"&&I!==null?T.context=Qs(I):(I=cs(l)?Vh:ko.current,T.context=Zf(r,I)),T.state=r.memoizedState,I=l.getDerivedStateFromProps,typeof I=="function"&&(fw(r,l,I,p),T.state=r.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(l=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),l!==T.state&&Rv.enqueueReplaceState(T,T.state,null),av(r,p,T,y),T.state=r.memoizedState),typeof T.componentDidMount=="function"&&(r.flags|=4194308)}function Qf(r,l){try{var p="",y=l;do p+=yO(y),y=y.return;while(y);var T=p}catch(I){T=`
Error generating stack: `+I.message+`
`+I.stack}return{value:r,source:l,stack:T,digest:null}}function wb(r,l,p){return{value:r,source:null,stack:p??null,digest:l??null}}function mw(r,l){try{console.error(l.value)}catch(p){setTimeout(function(){throw p})}}var HF=typeof WeakMap=="function"?WeakMap:Map;function NP(r,l,p){p=Zl(-1,p),p.tag=3,p.payload={element:null};var y=l.value;return p.callback=function(){dv||(dv=!0,Ew=y),mw(r,l)},p}function jP(r,l,p){p=Zl(-1,p),p.tag=3;var y=r.type.getDerivedStateFromError;if(typeof y=="function"){var T=l.value;p.payload=function(){return y(T)},p.callback=function(){mw(r,l)}}var I=r.stateNode;return I!==null&&typeof I.componentDidCatch=="function"&&(p.callback=function(){mw(r,l),typeof y!="function"&&(pu===null?pu=new Set([this]):pu.add(this));var R=l.stack;this.componentDidCatch(l.value,{componentStack:R!==null?R:""})}),p}function WA(r,l,p){var y=r.pingCache;if(y===null){y=r.pingCache=new HF;var T=new Set;y.set(l,T)}else T=y.get(l),T===void 0&&(T=new Set,y.set(l,T));T.has(p)||(T.add(p),r=oB.bind(null,r,l,p),l.then(r,r))}function ZA(r){do{var l;if((l=r.tag===13)&&(l=r.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return r;r=r.return}while(r!==null);return null}function XA(r,l,p,y,T){return r.mode&1?(r.flags|=65536,r.lanes=T,r):(r===l?r.flags|=65536:(r.flags|=128,p.flags|=131072,p.flags&=-52805,p.tag===1&&(p.alternate===null?p.tag=17:(l=Zl(-1,1),l.tag=2,fu(p,l,1))),p.lanes|=1),r)}var qF=tc.ReactCurrentOwner,as=!1;function Uo(r,l,p,y){l.child=r===null?mP(l,null,p,y):Yf(l,r.child,p,y)}function YA(r,l,p,y,T){p=p.render;var I=l.ref;return Lf(l,T),y=AT(r,l,p,y,I,T),p=CT(),r!==null&&!as?(l.updateQueue=r.updateQueue,l.flags&=-2053,r.lanes&=~T,Ql(r,l,T)):(_r&&p&&mT(l),l.flags|=1,Uo(r,l,y,T),l.child)}function KA(r,l,p,y,T){if(r===null){var I=p.type;return typeof I=="function"&&!BT(I)&&I.defaultProps===void 0&&p.compare===null&&p.defaultProps===void 0?(l.tag=15,l.type=I,VP(r,l,I,y,T)):(r=j0(p.type,null,y,l,l.mode,T),r.ref=l.ref,r.return=l,l.child=r)}if(I=r.child,!(r.lanes&T)){var R=I.memoizedProps;if(p=p.compare,p=p!==null?p:Rg,p(R,y)&&r.ref===l.ref)return Ql(r,l,T)}return l.flags|=1,r=gu(I,y),r.ref=l.ref,r.return=l,l.child=r}function VP(r,l,p,y,T){if(r!==null){var I=r.memoizedProps;if(Rg(I,y)&&r.ref===l.ref)if(as=!1,l.pendingProps=y=I,(r.lanes&T)!==0)r.flags&131072&&(as=!0);else return l.lanes=r.lanes,Ql(r,l,T)}return gw(r,l,p,y,T)}function UP(r,l,p){var y=l.pendingProps,T=y.children,I=r!==null?r.memoizedState:null;if(y.mode==="hidden")if(!(l.mode&1))l.memoizedState={baseLanes:0,cachePool:null,transitions:null},cr(Mf,Cs),Cs|=p;else{if(!(p&1073741824))return r=I!==null?I.baseLanes|p:p,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:r,cachePool:null,transitions:null},l.updateQueue=null,cr(Mf,Cs),Cs|=r,null;l.memoizedState={baseLanes:0,cachePool:null,transitions:null},y=I!==null?I.baseLanes:p,cr(Mf,Cs),Cs|=y}else I!==null?(y=I.baseLanes|p,l.memoizedState=null):y=p,cr(Mf,Cs),Cs|=y;return Uo(r,l,T,p),l.child}function GP(r,l){var p=l.ref;(r===null&&p!==null||r!==null&&r.ref!==p)&&(l.flags|=512,l.flags|=2097152)}function gw(r,l,p,y,T){var I=cs(p)?Vh:ko.current;return I=Zf(l,I),Lf(l,T),p=AT(r,l,p,y,I,T),y=CT(),r!==null&&!as?(l.updateQueue=r.updateQueue,l.flags&=-2053,r.lanes&=~T,Ql(r,l,T)):(_r&&y&&mT(l),l.flags|=1,Uo(r,l,p,T),l.child)}function QA(r,l,p,y,T){if(cs(p)){var I=!0;iv(l)}else I=!1;if(Lf(l,T),l.stateNode===null)F0(r,l),BP(l,p,y),pw(l,p,y,T),y=!0;else if(r===null){var R=l.stateNode,o=l.memoizedProps;R.props=o;var j=R.context,W=p.contextType;typeof W=="object"&&W!==null?W=Qs(W):(W=cs(p)?Vh:ko.current,W=Zf(l,W));var re=p.getDerivedStateFromProps,te=typeof re=="function"||typeof R.getSnapshotBeforeUpdate=="function";te||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(o!==y||j!==W)&&qA(l,R,y,W),Qc=!1;var Y=l.memoizedState;R.state=Y,av(l,y,R,T),j=l.memoizedState,o!==y||Y!==j||ls.current||Qc?(typeof re=="function"&&(fw(l,p,re,y),j=l.memoizedState),(o=Qc||HA(l,p,o,y,Y,j,W))?(te||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(l.flags|=4194308)):(typeof R.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=y,l.memoizedState=j),R.props=y,R.state=j,R.context=W,y=o):(typeof R.componentDidMount=="function"&&(l.flags|=4194308),y=!1)}else{R=l.stateNode,_P(r,l),o=l.memoizedProps,W=l.type===l.elementType?o:ba(l.type,o),R.props=W,te=l.pendingProps,Y=R.context,j=p.contextType,typeof j=="object"&&j!==null?j=Qs(j):(j=cs(p)?Vh:ko.current,j=Zf(l,j));var Ee=p.getDerivedStateFromProps;(re=typeof Ee=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(o!==te||Y!==j)&&qA(l,R,y,j),Qc=!1,Y=l.memoizedState,R.state=Y,av(l,y,R,T);var Ie=l.memoizedState;o!==te||Y!==Ie||ls.current||Qc?(typeof Ee=="function"&&(fw(l,p,Ee,y),Ie=l.memoizedState),(W=Qc||HA(l,p,W,y,Y,Ie,j)||!1)?(re||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(y,Ie,j),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(y,Ie,j)),typeof R.componentDidUpdate=="function"&&(l.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof R.componentDidUpdate!="function"||o===r.memoizedProps&&Y===r.memoizedState||(l.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||o===r.memoizedProps&&Y===r.memoizedState||(l.flags|=1024),l.memoizedProps=y,l.memoizedState=Ie),R.props=y,R.state=Ie,R.context=j,y=W):(typeof R.componentDidUpdate!="function"||o===r.memoizedProps&&Y===r.memoizedState||(l.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||o===r.memoizedProps&&Y===r.memoizedState||(l.flags|=1024),y=!1)}return _w(r,l,p,y,I,T)}function _w(r,l,p,y,T,I){GP(r,l);var R=(l.flags&128)!==0;if(!y&&!R)return T&&FA(l,p,!1),Ql(r,l,I);y=l.stateNode,qF.current=l;var o=R&&typeof p.getDerivedStateFromError!="function"?null:y.render();return l.flags|=1,r!==null&&R?(l.child=Yf(l,r.child,null,I),l.child=Yf(l,null,o,I)):Uo(r,l,o,I),l.memoizedState=y.state,T&&FA(l,p,!0),l.child}function $P(r){var l=r.stateNode;l.pendingContext?OA(r,l.pendingContext,l.pendingContext!==l.context):l.context&&OA(r,l.context,!1),TT(r,l.containerInfo)}function JA(r,l,p,y,T){return Xf(),_T(T),l.flags|=256,Uo(r,l,p,y),l.child}var yw={dehydrated:null,treeContext:null,retryLane:0};function vw(r){return{baseLanes:r,cachePool:null,transitions:null}}function HP(r,l,p){var y=l.pendingProps,T=wr.current,I=!1,R=(l.flags&128)!==0,o;if((o=R)||(o=r!==null&&r.memoizedState===null?!1:(T&2)!==0),o?(I=!0,l.flags&=-129):(r===null||r.memoizedState!==null)&&(T|=1),cr(wr,T&1),r===null)return hw(l),r=l.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(l.mode&1?r.data==="$!"?l.lanes=8:l.lanes=1073741824:l.lanes=1,null):(R=y.children,r=y.fallback,I?(y=l.mode,I=l.child,R={mode:"hidden",children:R},!(y&1)&&I!==null?(I.childLanes=0,I.pendingProps=R):I=Lv(R,y,0,null),r=kh(r,y,p,null),I.return=l,r.return=l,I.sibling=r,l.child=I,l.child.memoizedState=vw(p),l.memoizedState=yw,r):RT(l,R));if(T=r.memoizedState,T!==null&&(o=T.dehydrated,o!==null))return WF(r,l,R,y,o,T,p);if(I){I=y.fallback,R=l.mode,T=r.child,o=T.sibling;var j={mode:"hidden",children:y.children};return!(R&1)&&l.child!==T?(y=l.child,y.childLanes=0,y.pendingProps=j,l.deletions=null):(y=gu(T,j),y.subtreeFlags=T.subtreeFlags&14680064),o!==null?I=gu(o,I):(I=kh(I,R,p,null),I.flags|=2),I.return=l,y.return=l,y.sibling=I,l.child=y,y=I,I=l.child,R=r.child.memoizedState,R=R===null?vw(p):{baseLanes:R.baseLanes|p,cachePool:null,transitions:R.transitions},I.memoizedState=R,I.childLanes=r.childLanes&~p,l.memoizedState=yw,y}return I=r.child,r=I.sibling,y=gu(I,{mode:"visible",children:y.children}),!(l.mode&1)&&(y.lanes=p),y.return=l,y.sibling=null,r!==null&&(p=l.deletions,p===null?(l.deletions=[r],l.flags|=16):p.push(r)),l.child=y,l.memoizedState=null,y}function RT(r,l){return l=Lv({mode:"visible",children:l},r.mode,0,null),l.return=r,r.child=l}function v0(r,l,p,y){return y!==null&&_T(y),Yf(l,r.child,null,p),r=RT(l,l.pendingProps.children),r.flags|=2,l.memoizedState=null,r}function WF(r,l,p,y,T,I,R){if(p)return l.flags&256?(l.flags&=-257,y=wb(Error(Ht(422))),v0(r,l,R,y)):l.memoizedState!==null?(l.child=r.child,l.flags|=128,null):(I=y.fallback,T=l.mode,y=Lv({mode:"visible",children:y.children},T,0,null),I=kh(I,T,R,null),I.flags|=2,y.return=l,I.return=l,y.sibling=I,l.child=y,l.mode&1&&Yf(l,r.child,null,R),l.child.memoizedState=vw(R),l.memoizedState=yw,I);if(!(l.mode&1))return v0(r,l,R,null);if(T.data==="$!"){if(y=T.nextSibling&&T.nextSibling.dataset,y)var o=y.dgst;return y=o,I=Error(Ht(419)),y=wb(I,y,void 0),v0(r,l,R,y)}if(o=(R&r.childLanes)!==0,as||o){if(y=ho,y!==null){switch(R&-R){case 4:T=2;break;case 16:T=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:T=32;break;case 536870912:T=268435456;break;default:T=0}T=T&(y.suspendedLanes|R)?0:T,T!==0&&T!==I.retryLane&&(I.retryLane=T,Kl(r,T),Aa(y,r,T,-1))}return FT(),y=wb(Error(Ht(421))),v0(r,l,R,y)}return T.data==="$?"?(l.flags|=128,l.child=r.child,l=sB.bind(null,r),T._reactRetry=l,null):(r=I.treeContext,Ps=du(T.nextSibling),Rs=l,_r=!0,Ea=null,r!==null&&(Zs[Xs++]=ql,Zs[Xs++]=Wl,Zs[Xs++]=Uh,ql=r.id,Wl=r.overflow,Uh=l),l=RT(l,y.children),l.flags|=4096,l)}function eC(r,l,p){r.lanes|=l;var y=r.alternate;y!==null&&(y.lanes|=l),dw(r.return,l,p)}function Tb(r,l,p,y,T){var I=r.memoizedState;I===null?r.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:y,tail:p,tailMode:T}:(I.isBackwards=l,I.rendering=null,I.renderingStartTime=0,I.last=y,I.tail=p,I.tailMode=T)}function qP(r,l,p){var y=l.pendingProps,T=y.revealOrder,I=y.tail;if(Uo(r,l,y.children,p),y=wr.current,y&2)y=y&1|2,l.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=l.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&eC(r,p,l);else if(r.tag===19)eC(r,p,l);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===l)break e;for(;r.sibling===null;){if(r.return===null||r.return===l)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}y&=1}if(cr(wr,y),!(l.mode&1))l.memoizedState=null;else switch(T){case"forwards":for(p=l.child,T=null;p!==null;)r=p.alternate,r!==null&&lv(r)===null&&(T=p),p=p.sibling;p=T,p===null?(T=l.child,l.child=null):(T=p.sibling,p.sibling=null),Tb(l,!1,T,p,I);break;case"backwards":for(p=null,T=l.child,l.child=null;T!==null;){if(r=T.alternate,r!==null&&lv(r)===null){l.child=T;break}r=T.sibling,T.sibling=p,p=T,T=r}Tb(l,!0,p,null,I);break;case"together":Tb(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function F0(r,l){!(l.mode&1)&&r!==null&&(r.alternate=null,l.alternate=null,l.flags|=2)}function Ql(r,l,p){if(r!==null&&(l.dependencies=r.dependencies),$h|=l.lanes,!(p&l.childLanes))return null;if(r!==null&&l.child!==r.child)throw Error(Ht(153));if(l.child!==null){for(r=l.child,p=gu(r,r.pendingProps),l.child=p,p.return=l;r.sibling!==null;)r=r.sibling,p=p.sibling=gu(r,r.pendingProps),p.return=l;p.sibling=null}return l.child}function ZF(r,l,p){switch(l.tag){case 3:$P(l),Xf();break;case 5:yP(l);break;case 1:cs(l.type)&&iv(l);break;case 4:TT(l,l.stateNode.containerInfo);break;case 10:var y=l.type._context,T=l.memoizedProps.value;cr(ov,y._currentValue),y._currentValue=T;break;case 13:if(y=l.memoizedState,y!==null)return y.dehydrated!==null?(cr(wr,wr.current&1),l.flags|=128,null):p&l.child.childLanes?HP(r,l,p):(cr(wr,wr.current&1),r=Ql(r,l,p),r!==null?r.sibling:null);cr(wr,wr.current&1);break;case 19:if(y=(p&l.childLanes)!==0,r.flags&128){if(y)return qP(r,l,p);l.flags|=128}if(T=l.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),cr(wr,wr.current),y)break;return null;case 22:case 23:return l.lanes=0,UP(r,l,p)}return Ql(r,l,p)}var WP,xw,ZP,XP;WP=function(r,l){for(var p=l.child;p!==null;){if(p.tag===5||p.tag===6)r.appendChild(p.stateNode);else if(p.tag!==4&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===l)break;for(;p.sibling===null;){if(p.return===null||p.return===l)return;p=p.return}p.sibling.return=p.return,p=p.sibling}};xw=function(){};ZP=function(r,l,p,y){var T=r.memoizedProps;if(T!==y){r=l.stateNode,Mh(al.current);var I=null;switch(p){case"input":T=Ub(r,T),y=Ub(r,y),I=[];break;case"select":T=Sr({},T,{value:void 0}),y=Sr({},y,{value:void 0}),I=[];break;case"textarea":T=Hb(r,T),y=Hb(r,y),I=[];break;default:typeof T.onClick!="function"&&typeof y.onClick=="function"&&(r.onclick=ev)}Wb(p,y);var R;p=null;for(W in T)if(!y.hasOwnProperty(W)&&T.hasOwnProperty(W)&&T[W]!=null)if(W==="style"){var o=T[W];for(R in o)o.hasOwnProperty(R)&&(p||(p={}),p[R]="")}else W!=="dangerouslySetInnerHTML"&&W!=="children"&&W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(Sg.hasOwnProperty(W)?I||(I=[]):(I=I||[]).push(W,null));for(W in y){var j=y[W];if(o=T!=null?T[W]:void 0,y.hasOwnProperty(W)&&j!==o&&(j!=null||o!=null))if(W==="style")if(o){for(R in o)!o.hasOwnProperty(R)||j&&j.hasOwnProperty(R)||(p||(p={}),p[R]="");for(R in j)j.hasOwnProperty(R)&&o[R]!==j[R]&&(p||(p={}),p[R]=j[R])}else p||(I||(I=[]),I.push(W,p)),p=j;else W==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,o=o?o.__html:void 0,j!=null&&o!==j&&(I=I||[]).push(W,j)):W==="children"?typeof j!="string"&&typeof j!="number"||(I=I||[]).push(W,""+j):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&(Sg.hasOwnProperty(W)?(j!=null&&W==="onScroll"&&fr("scroll",r),I||o===j||(I=[])):(I=I||[]).push(W,j))}p&&(I=I||[]).push("style",p);var W=I;(l.updateQueue=W)&&(l.flags|=4)}};XP=function(r,l,p,y){p!==y&&(l.flags|=4)};function og(r,l){if(!_r)switch(r.tailMode){case"hidden":l=r.tail;for(var p=null;l!==null;)l.alternate!==null&&(p=l),l=l.sibling;p===null?r.tail=null:p.sibling=null;break;case"collapsed":p=r.tail;for(var y=null;p!==null;)p.alternate!==null&&(y=p),p=p.sibling;y===null?l||r.tail===null?r.tail=null:r.tail.sibling=null:y.sibling=null}}function zo(r){var l=r.alternate!==null&&r.alternate.child===r.child,p=0,y=0;if(l)for(var T=r.child;T!==null;)p|=T.lanes|T.childLanes,y|=T.subtreeFlags&14680064,y|=T.flags&14680064,T.return=r,T=T.sibling;else for(T=r.child;T!==null;)p|=T.lanes|T.childLanes,y|=T.subtreeFlags,y|=T.flags,T.return=r,T=T.sibling;return r.subtreeFlags|=y,r.childLanes=p,l}function XF(r,l,p){var y=l.pendingProps;switch(gT(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zo(l),null;case 1:return cs(l.type)&&tv(),zo(l),null;case 3:return y=l.stateNode,Kf(),pr(ls),pr(ko),ET(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(r===null||r.child===null)&&(_0(l)?l.flags|=4:r===null||r.memoizedState.isDehydrated&&!(l.flags&256)||(l.flags|=1024,Ea!==null&&(Cw(Ea),Ea=null))),xw(r,l),zo(l),null;case 5:ST(l);var T=Mh(Og.current);if(p=l.type,r!==null&&l.stateNode!=null)ZP(r,l,p,y,T),r.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!y){if(l.stateNode===null)throw Error(Ht(166));return zo(l),null}if(r=Mh(al.current),_0(l)){y=l.stateNode,p=l.type;var I=l.memoizedProps;switch(y[ol]=l,y[Lg]=I,r=(l.mode&1)!==0,p){case"dialog":fr("cancel",y),fr("close",y);break;case"iframe":case"object":case"embed":fr("load",y);break;case"video":case"audio":for(T=0;T<dg.length;T++)fr(dg[T],y);break;case"source":fr("error",y);break;case"img":case"image":case"link":fr("error",y),fr("load",y);break;case"details":fr("toggle",y);break;case"input":cA(y,I),fr("invalid",y);break;case"select":y._wrapperState={wasMultiple:!!I.multiple},fr("invalid",y);break;case"textarea":hA(y,I),fr("invalid",y)}Wb(p,I),T=null;for(var R in I)if(I.hasOwnProperty(R)){var o=I[R];R==="children"?typeof o=="string"?y.textContent!==o&&(I.suppressHydrationWarning!==!0&&g0(y.textContent,o,r),T=["children",o]):typeof o=="number"&&y.textContent!==""+o&&(I.suppressHydrationWarning!==!0&&g0(y.textContent,o,r),T=["children",""+o]):Sg.hasOwnProperty(R)&&o!=null&&R==="onScroll"&&fr("scroll",y)}switch(p){case"input":l0(y),uA(y,I,!0);break;case"textarea":l0(y),dA(y);break;case"select":case"option":break;default:typeof I.onClick=="function"&&(y.onclick=ev)}y=T,l.updateQueue=y,y!==null&&(l.flags|=4)}else{R=T.nodeType===9?T:T.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=TM(p)),r==="http://www.w3.org/1999/xhtml"?p==="script"?(r=R.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof y.is=="string"?r=R.createElement(p,{is:y.is}):(r=R.createElement(p),p==="select"&&(R=r,y.multiple?R.multiple=!0:y.size&&(R.size=y.size))):r=R.createElementNS(r,p),r[ol]=l,r[Lg]=y,WP(r,l,!1,!1),l.stateNode=r;e:{switch(R=Zb(p,y),p){case"dialog":fr("cancel",r),fr("close",r),T=y;break;case"iframe":case"object":case"embed":fr("load",r),T=y;break;case"video":case"audio":for(T=0;T<dg.length;T++)fr(dg[T],r);T=y;break;case"source":fr("error",r),T=y;break;case"img":case"image":case"link":fr("error",r),fr("load",r),T=y;break;case"details":fr("toggle",r),T=y;break;case"input":cA(r,y),T=Ub(r,y),fr("invalid",r);break;case"option":T=y;break;case"select":r._wrapperState={wasMultiple:!!y.multiple},T=Sr({},y,{value:void 0}),fr("invalid",r);break;case"textarea":hA(r,y),T=Hb(r,y),fr("invalid",r);break;default:T=y}Wb(p,T),o=T;for(I in o)if(o.hasOwnProperty(I)){var j=o[I];I==="style"?IM(r,j):I==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,j!=null&&SM(r,j)):I==="children"?typeof j=="string"?(p!=="textarea"||j!=="")&&Eg(r,j):typeof j=="number"&&Eg(r,""+j):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(Sg.hasOwnProperty(I)?j!=null&&I==="onScroll"&&fr("scroll",r):j!=null&&tT(r,I,j,R))}switch(p){case"input":l0(r),uA(r,y,!1);break;case"textarea":l0(r),dA(r);break;case"option":y.value!=null&&r.setAttribute("value",""+yu(y.value));break;case"select":r.multiple=!!y.multiple,I=y.value,I!=null?Pf(r,!!y.multiple,I,!1):y.defaultValue!=null&&Pf(r,!!y.multiple,y.defaultValue,!0);break;default:typeof T.onClick=="function"&&(r.onclick=ev)}switch(p){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}}y&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return zo(l),null;case 6:if(r&&l.stateNode!=null)XP(r,l,r.memoizedProps,y);else{if(typeof y!="string"&&l.stateNode===null)throw Error(Ht(166));if(p=Mh(Og.current),Mh(al.current),_0(l)){if(y=l.stateNode,p=l.memoizedProps,y[ol]=l,(I=y.nodeValue!==p)&&(r=Rs,r!==null))switch(r.tag){case 3:g0(y.nodeValue,p,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&g0(y.nodeValue,p,(r.mode&1)!==0)}I&&(l.flags|=4)}else y=(p.nodeType===9?p:p.ownerDocument).createTextNode(y),y[ol]=l,l.stateNode=y}return zo(l),null;case 13:if(pr(wr),y=l.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(_r&&Ps!==null&&l.mode&1&&!(l.flags&128))fP(),Xf(),l.flags|=98560,I=!1;else if(I=_0(l),y!==null&&y.dehydrated!==null){if(r===null){if(!I)throw Error(Ht(318));if(I=l.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(Ht(317));I[ol]=l}else Xf(),!(l.flags&128)&&(l.memoizedState=null),l.flags|=4;zo(l),I=!1}else Ea!==null&&(Cw(Ea),Ea=null),I=!0;if(!I)return l.flags&65536?l:null}return l.flags&128?(l.lanes=p,l):(y=y!==null,y!==(r!==null&&r.memoizedState!==null)&&y&&(l.child.flags|=8192,l.mode&1&&(r===null||wr.current&1?Qr===0&&(Qr=3):FT())),l.updateQueue!==null&&(l.flags|=4),zo(l),null);case 4:return Kf(),xw(r,l),r===null&&zg(l.stateNode.containerInfo),zo(l),null;case 10:return xT(l.type._context),zo(l),null;case 17:return cs(l.type)&&tv(),zo(l),null;case 19:if(pr(wr),I=l.memoizedState,I===null)return zo(l),null;if(y=(l.flags&128)!==0,R=I.rendering,R===null)if(y)og(I,!1);else{if(Qr!==0||r!==null&&r.flags&128)for(r=l.child;r!==null;){if(R=lv(r),R!==null){for(l.flags|=128,og(I,!1),y=R.updateQueue,y!==null&&(l.updateQueue=y,l.flags|=4),l.subtreeFlags=0,y=p,p=l.child;p!==null;)I=p,r=y,I.flags&=14680066,R=I.alternate,R===null?(I.childLanes=0,I.lanes=r,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=R.childLanes,I.lanes=R.lanes,I.child=R.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=R.memoizedProps,I.memoizedState=R.memoizedState,I.updateQueue=R.updateQueue,I.type=R.type,r=R.dependencies,I.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),p=p.sibling;return cr(wr,wr.current&1|2),l.child}r=r.sibling}I.tail!==null&&kr()>Jf&&(l.flags|=128,y=!0,og(I,!1),l.lanes=4194304)}else{if(!y)if(r=lv(R),r!==null){if(l.flags|=128,y=!0,p=r.updateQueue,p!==null&&(l.updateQueue=p,l.flags|=4),og(I,!0),I.tail===null&&I.tailMode==="hidden"&&!R.alternate&&!_r)return zo(l),null}else 2*kr()-I.renderingStartTime>Jf&&p!==1073741824&&(l.flags|=128,y=!0,og(I,!1),l.lanes=4194304);I.isBackwards?(R.sibling=l.child,l.child=R):(p=I.last,p!==null?p.sibling=R:l.child=R,I.last=R)}return I.tail!==null?(l=I.tail,I.rendering=l,I.tail=l.sibling,I.renderingStartTime=kr(),l.sibling=null,p=wr.current,cr(wr,y?p&1|2:p&1),l):(zo(l),null);case 22:case 23:return OT(),y=l.memoizedState!==null,r!==null&&r.memoizedState!==null!==y&&(l.flags|=8192),y&&l.mode&1?Cs&1073741824&&(zo(l),l.subtreeFlags&6&&(l.flags|=8192)):zo(l),null;case 24:return null;case 25:return null}throw Error(Ht(156,l.tag))}function YF(r,l){switch(gT(l),l.tag){case 1:return cs(l.type)&&tv(),r=l.flags,r&65536?(l.flags=r&-65537|128,l):null;case 3:return Kf(),pr(ls),pr(ko),ET(),r=l.flags,r&65536&&!(r&128)?(l.flags=r&-65537|128,l):null;case 5:return ST(l),null;case 13:if(pr(wr),r=l.memoizedState,r!==null&&r.dehydrated!==null){if(l.alternate===null)throw Error(Ht(340));Xf()}return r=l.flags,r&65536?(l.flags=r&-65537|128,l):null;case 19:return pr(wr),null;case 4:return Kf(),null;case 10:return xT(l.type._context),null;case 22:case 23:return OT(),null;case 24:return null;default:return null}}var x0=!1,Lo=!1,KF=typeof WeakSet=="function"?WeakSet:Set,Ti=null;function Cf(r,l){var p=r.ref;if(p!==null)if(typeof p=="function")try{p(null)}catch(y){Rr(r,l,y)}else p.current=null}function bw(r,l,p){try{p()}catch(y){Rr(r,l,y)}}var tC=!1;function QF(r,l){if(rw=K0,r=eP(),pT(r)){if("selectionStart"in r)var p={start:r.selectionStart,end:r.selectionEnd};else e:{p=(p=r.ownerDocument)&&p.defaultView||window;var y=p.getSelection&&p.getSelection();if(y&&y.rangeCount!==0){p=y.anchorNode;var T=y.anchorOffset,I=y.focusNode;y=y.focusOffset;try{p.nodeType,I.nodeType}catch{p=null;break e}var R=0,o=-1,j=-1,W=0,re=0,te=r,Y=null;t:for(;;){for(var Ee;te!==p||T!==0&&te.nodeType!==3||(o=R+T),te!==I||y!==0&&te.nodeType!==3||(j=R+y),te.nodeType===3&&(R+=te.nodeValue.length),(Ee=te.firstChild)!==null;)Y=te,te=Ee;for(;;){if(te===r)break t;if(Y===p&&++W===T&&(o=R),Y===I&&++re===y&&(j=R),(Ee=te.nextSibling)!==null)break;te=Y,Y=te.parentNode}te=Ee}p=o===-1||j===-1?null:{start:o,end:j}}else p=null}p=p||{start:0,end:0}}else p=null;for(ow={focusedElem:r,selectionRange:p},K0=!1,Ti=l;Ti!==null;)if(l=Ti,r=l.child,(l.subtreeFlags&1028)!==0&&r!==null)r.return=l,Ti=r;else for(;Ti!==null;){l=Ti;try{var Ie=l.alternate;if(l.flags&1024)switch(l.tag){case 0:case 11:case 15:break;case 1:if(Ie!==null){var me=Ie.memoizedProps,Pe=Ie.memoizedState,he=l.stateNode,pe=he.getSnapshotBeforeUpdate(l.elementType===l.type?me:ba(l.type,me),Pe);he.__reactInternalSnapshotBeforeUpdate=pe}break;case 3:var we=l.stateNode.containerInfo;we.nodeType===1?we.textContent="":we.nodeType===9&&we.documentElement&&we.removeChild(we.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ht(163))}}catch(Ue){Rr(l,l.return,Ue)}if(r=l.sibling,r!==null){r.return=l.return,Ti=r;break}Ti=l.return}return Ie=tC,tC=!1,Ie}function xg(r,l,p){var y=l.updateQueue;if(y=y!==null?y.lastEffect:null,y!==null){var T=y=y.next;do{if((T.tag&r)===r){var I=T.destroy;T.destroy=void 0,I!==void 0&&bw(l,p,I)}T=T.next}while(T!==y)}}function zv(r,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var p=l=l.next;do{if((p.tag&r)===r){var y=p.create;p.destroy=y()}p=p.next}while(p!==l)}}function ww(r){var l=r.ref;if(l!==null){var p=r.stateNode;switch(r.tag){case 5:r=p;break;default:r=p}typeof l=="function"?l(r):l.current=r}}function YP(r){var l=r.alternate;l!==null&&(r.alternate=null,YP(l)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(l=r.stateNode,l!==null&&(delete l[ol],delete l[Lg],delete l[lw],delete l[LF],delete l[kF])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function KP(r){return r.tag===5||r.tag===3||r.tag===4}function iC(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||KP(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Tw(r,l,p){var y=r.tag;if(y===5||y===6)r=r.stateNode,l?p.nodeType===8?p.parentNode.insertBefore(r,l):p.insertBefore(r,l):(p.nodeType===8?(l=p.parentNode,l.insertBefore(r,p)):(l=p,l.appendChild(r)),p=p._reactRootContainer,p!=null||l.onclick!==null||(l.onclick=ev));else if(y!==4&&(r=r.child,r!==null))for(Tw(r,l,p),r=r.sibling;r!==null;)Tw(r,l,p),r=r.sibling}function Sw(r,l,p){var y=r.tag;if(y===5||y===6)r=r.stateNode,l?p.insertBefore(r,l):p.appendChild(r);else if(y!==4&&(r=r.child,r!==null))for(Sw(r,l,p),r=r.sibling;r!==null;)Sw(r,l,p),r=r.sibling}var vo=null,Sa=!1;function Wc(r,l,p){for(p=p.child;p!==null;)QP(r,l,p),p=p.sibling}function QP(r,l,p){if(sl&&typeof sl.onCommitFiberUnmount=="function")try{sl.onCommitFiberUnmount(Sv,p)}catch{}switch(p.tag){case 5:Lo||Cf(p,l);case 6:var y=vo,T=Sa;vo=null,Wc(r,l,p),vo=y,Sa=T,vo!==null&&(Sa?(r=vo,p=p.stateNode,r.nodeType===8?r.parentNode.removeChild(p):r.removeChild(p)):vo.removeChild(p.stateNode));break;case 18:vo!==null&&(Sa?(r=vo,p=p.stateNode,r.nodeType===8?gb(r.parentNode,p):r.nodeType===1&&gb(r,p),Mg(r)):gb(vo,p.stateNode));break;case 4:y=vo,T=Sa,vo=p.stateNode.containerInfo,Sa=!0,Wc(r,l,p),vo=y,Sa=T;break;case 0:case 11:case 14:case 15:if(!Lo&&(y=p.updateQueue,y!==null&&(y=y.lastEffect,y!==null))){T=y=y.next;do{var I=T,R=I.destroy;I=I.tag,R!==void 0&&(I&2||I&4)&&bw(p,l,R),T=T.next}while(T!==y)}Wc(r,l,p);break;case 1:if(!Lo&&(Cf(p,l),y=p.stateNode,typeof y.componentWillUnmount=="function"))try{y.props=p.memoizedProps,y.state=p.memoizedState,y.componentWillUnmount()}catch(o){Rr(p,l,o)}Wc(r,l,p);break;case 21:Wc(r,l,p);break;case 22:p.mode&1?(Lo=(y=Lo)||p.memoizedState!==null,Wc(r,l,p),Lo=y):Wc(r,l,p);break;default:Wc(r,l,p)}}function nC(r){var l=r.updateQueue;if(l!==null){r.updateQueue=null;var p=r.stateNode;p===null&&(p=r.stateNode=new KF),l.forEach(function(y){var T=aB.bind(null,r,y);p.has(y)||(p.add(y),y.then(T,T))})}}function xa(r,l){var p=l.deletions;if(p!==null)for(var y=0;y<p.length;y++){var T=p[y];try{var I=r,R=l,o=R;e:for(;o!==null;){switch(o.tag){case 5:vo=o.stateNode,Sa=!1;break e;case 3:vo=o.stateNode.containerInfo,Sa=!0;break e;case 4:vo=o.stateNode.containerInfo,Sa=!0;break e}o=o.return}if(vo===null)throw Error(Ht(160));QP(I,R,T),vo=null,Sa=!1;var j=T.alternate;j!==null&&(j.return=null),T.return=null}catch(W){Rr(T,l,W)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)JP(l,r),l=l.sibling}function JP(r,l){var p=r.alternate,y=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(xa(l,r),el(r),y&4){try{xg(3,r,r.return),zv(3,r)}catch(me){Rr(r,r.return,me)}try{xg(5,r,r.return)}catch(me){Rr(r,r.return,me)}}break;case 1:xa(l,r),el(r),y&512&&p!==null&&Cf(p,p.return);break;case 5:if(xa(l,r),el(r),y&512&&p!==null&&Cf(p,p.return),r.flags&32){var T=r.stateNode;try{Eg(T,"")}catch(me){Rr(r,r.return,me)}}if(y&4&&(T=r.stateNode,T!=null)){var I=r.memoizedProps,R=p!==null?p.memoizedProps:I,o=r.type,j=r.updateQueue;if(r.updateQueue=null,j!==null)try{o==="input"&&I.type==="radio"&&I.name!=null&&bM(T,I),Zb(o,R);var W=Zb(o,I);for(R=0;R<j.length;R+=2){var re=j[R],te=j[R+1];re==="style"?IM(T,te):re==="dangerouslySetInnerHTML"?SM(T,te):re==="children"?Eg(T,te):tT(T,re,te,W)}switch(o){case"input":Gb(T,I);break;case"textarea":wM(T,I);break;case"select":var Y=T._wrapperState.wasMultiple;T._wrapperState.wasMultiple=!!I.multiple;var Ee=I.value;Ee!=null?Pf(T,!!I.multiple,Ee,!1):Y!==!!I.multiple&&(I.defaultValue!=null?Pf(T,!!I.multiple,I.defaultValue,!0):Pf(T,!!I.multiple,I.multiple?[]:"",!1))}T[Lg]=I}catch(me){Rr(r,r.return,me)}}break;case 6:if(xa(l,r),el(r),y&4){if(r.stateNode===null)throw Error(Ht(162));T=r.stateNode,I=r.memoizedProps;try{T.nodeValue=I}catch(me){Rr(r,r.return,me)}}break;case 3:if(xa(l,r),el(r),y&4&&p!==null&&p.memoizedState.isDehydrated)try{Mg(l.containerInfo)}catch(me){Rr(r,r.return,me)}break;case 4:xa(l,r),el(r);break;case 13:xa(l,r),el(r),T=r.child,T.flags&8192&&(I=T.memoizedState!==null,T.stateNode.isHidden=I,!I||T.alternate!==null&&T.alternate.memoizedState!==null||(LT=kr())),y&4&&nC(r);break;case 22:if(re=p!==null&&p.memoizedState!==null,r.mode&1?(Lo=(W=Lo)||re,xa(l,r),Lo=W):xa(l,r),el(r),y&8192){if(W=r.memoizedState!==null,(r.stateNode.isHidden=W)&&!re&&r.mode&1)for(Ti=r,re=r.child;re!==null;){for(te=Ti=re;Ti!==null;){switch(Y=Ti,Ee=Y.child,Y.tag){case 0:case 11:case 14:case 15:xg(4,Y,Y.return);break;case 1:Cf(Y,Y.return);var Ie=Y.stateNode;if(typeof Ie.componentWillUnmount=="function"){y=Y,p=Y.return;try{l=y,Ie.props=l.memoizedProps,Ie.state=l.memoizedState,Ie.componentWillUnmount()}catch(me){Rr(y,p,me)}}break;case 5:Cf(Y,Y.return);break;case 22:if(Y.memoizedState!==null){oC(te);continue}}Ee!==null?(Ee.return=Y,Ti=Ee):oC(te)}re=re.sibling}e:for(re=null,te=r;;){if(te.tag===5){if(re===null){re=te;try{T=te.stateNode,W?(I=T.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none"):(o=te.stateNode,j=te.memoizedProps.style,R=j!=null&&j.hasOwnProperty("display")?j.display:null,o.style.display=EM("display",R))}catch(me){Rr(r,r.return,me)}}}else if(te.tag===6){if(re===null)try{te.stateNode.nodeValue=W?"":te.memoizedProps}catch(me){Rr(r,r.return,me)}}else if((te.tag!==22&&te.tag!==23||te.memoizedState===null||te===r)&&te.child!==null){te.child.return=te,te=te.child;continue}if(te===r)break e;for(;te.sibling===null;){if(te.return===null||te.return===r)break e;re===te&&(re=null),te=te.return}re===te&&(re=null),te.sibling.return=te.return,te=te.sibling}}break;case 19:xa(l,r),el(r),y&4&&nC(r);break;case 21:break;default:xa(l,r),el(r)}}function el(r){var l=r.flags;if(l&2){try{e:{for(var p=r.return;p!==null;){if(KP(p)){var y=p;break e}p=p.return}throw Error(Ht(160))}switch(y.tag){case 5:var T=y.stateNode;y.flags&32&&(Eg(T,""),y.flags&=-33);var I=iC(r);Sw(r,I,T);break;case 3:case 4:var R=y.stateNode.containerInfo,o=iC(r);Tw(r,o,R);break;default:throw Error(Ht(161))}}catch(j){Rr(r,r.return,j)}r.flags&=-3}l&4096&&(r.flags&=-4097)}function JF(r,l,p){Ti=r,eR(r)}function eR(r,l,p){for(var y=(r.mode&1)!==0;Ti!==null;){var T=Ti,I=T.child;if(T.tag===22&&y){var R=T.memoizedState!==null||x0;if(!R){var o=T.alternate,j=o!==null&&o.memoizedState!==null||Lo;o=x0;var W=Lo;if(x0=R,(Lo=j)&&!W)for(Ti=T;Ti!==null;)R=Ti,j=R.child,R.tag===22&&R.memoizedState!==null?sC(T):j!==null?(j.return=R,Ti=j):sC(T);for(;I!==null;)Ti=I,eR(I),I=I.sibling;Ti=T,x0=o,Lo=W}rC(r)}else T.subtreeFlags&8772&&I!==null?(I.return=T,Ti=I):rC(r)}}function rC(r){for(;Ti!==null;){var l=Ti;if(l.flags&8772){var p=l.alternate;try{if(l.flags&8772)switch(l.tag){case 0:case 11:case 15:Lo||zv(5,l);break;case 1:var y=l.stateNode;if(l.flags&4&&!Lo)if(p===null)y.componentDidMount();else{var T=l.elementType===l.type?p.memoizedProps:ba(l.type,p.memoizedProps);y.componentDidUpdate(T,p.memoizedState,y.__reactInternalSnapshotBeforeUpdate)}var I=l.updateQueue;I!==null&&UA(l,I,y);break;case 3:var R=l.updateQueue;if(R!==null){if(p=null,l.child!==null)switch(l.child.tag){case 5:p=l.child.stateNode;break;case 1:p=l.child.stateNode}UA(l,R,p)}break;case 5:var o=l.stateNode;if(p===null&&l.flags&4){p=o;var j=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":j.autoFocus&&p.focus();break;case"img":j.src&&(p.src=j.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var W=l.alternate;if(W!==null){var re=W.memoizedState;if(re!==null){var te=re.dehydrated;te!==null&&Mg(te)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ht(163))}Lo||l.flags&512&&ww(l)}catch(Y){Rr(l,l.return,Y)}}if(l===r){Ti=null;break}if(p=l.sibling,p!==null){p.return=l.return,Ti=p;break}Ti=l.return}}function oC(r){for(;Ti!==null;){var l=Ti;if(l===r){Ti=null;break}var p=l.sibling;if(p!==null){p.return=l.return,Ti=p;break}Ti=l.return}}function sC(r){for(;Ti!==null;){var l=Ti;try{switch(l.tag){case 0:case 11:case 15:var p=l.return;try{zv(4,l)}catch(j){Rr(l,p,j)}break;case 1:var y=l.stateNode;if(typeof y.componentDidMount=="function"){var T=l.return;try{y.componentDidMount()}catch(j){Rr(l,T,j)}}var I=l.return;try{ww(l)}catch(j){Rr(l,I,j)}break;case 5:var R=l.return;try{ww(l)}catch(j){Rr(l,R,j)}}}catch(j){Rr(l,l.return,j)}if(l===r){Ti=null;break}var o=l.sibling;if(o!==null){o.return=l.return,Ti=o;break}Ti=l.return}}var eB=Math.ceil,hv=tc.ReactCurrentDispatcher,zT=tc.ReactCurrentOwner,Ks=tc.ReactCurrentBatchConfig,$n=0,ho=null,Ur=null,xo=0,Cs=0,Mf=Iu(0),Qr=0,jg=null,$h=0,Dv=0,DT=0,bg=null,ss=null,LT=0,Jf=1/0,$l=null,dv=!1,Ew=null,pu=null,b0=!1,au=null,fv=0,wg=0,Iw=null,B0=-1,N0=0;function $o(){return $n&6?kr():B0!==-1?B0:B0=kr()}function mu(r){return r.mode&1?$n&2&&xo!==0?xo&-xo:FF.transition!==null?(N0===0&&(N0=BM()),N0):(r=Qn,r!==0||(r=window.event,r=r===void 0?16:HM(r.type)),r):1}function Aa(r,l,p,y){if(50<wg)throw wg=0,Iw=null,Error(Ht(185));Jg(r,p,y),(!($n&2)||r!==ho)&&(r===ho&&(!($n&2)&&(Dv|=p),Qr===4&&eu(r,xo)),us(r,y),p===1&&$n===0&&!(l.mode&1)&&(Jf=kr()+500,Mv&&Au()))}function us(r,l){var p=r.callbackNode;FO(r,l);var y=Y0(r,r===ho?xo:0);if(y===0)p!==null&&mA(p),r.callbackNode=null,r.callbackPriority=0;else if(l=y&-y,r.callbackPriority!==l){if(p!=null&&mA(p),l===1)r.tag===0?OF(aC.bind(null,r)):uP(aC.bind(null,r)),zF(function(){!($n&6)&&Au()}),p=null;else{switch(NM(y)){case 1:p=sT;break;case 4:p=OM;break;case 16:p=X0;break;case 536870912:p=FM;break;default:p=X0}p=lR(p,tR.bind(null,r))}r.callbackPriority=l,r.callbackNode=p}}function tR(r,l){if(B0=-1,N0=0,$n&6)throw Error(Ht(327));var p=r.callbackNode;if(kf()&&r.callbackNode!==p)return null;var y=Y0(r,r===ho?xo:0);if(y===0)return null;if(y&30||y&r.expiredLanes||l)l=pv(r,y);else{l=y;var T=$n;$n|=2;var I=nR();(ho!==r||xo!==l)&&($l=null,Jf=kr()+500,Lh(r,l));do try{nB();break}catch(o){iR(r,o)}while(!0);vT(),hv.current=I,$n=T,Ur!==null?l=0:(ho=null,xo=0,l=Qr)}if(l!==0){if(l===2&&(T=Jb(r),T!==0&&(y=T,l=Aw(r,T))),l===1)throw p=jg,Lh(r,0),eu(r,y),us(r,kr()),p;if(l===6)eu(r,y);else{if(T=r.current.alternate,!(y&30)&&!tB(T)&&(l=pv(r,y),l===2&&(I=Jb(r),I!==0&&(y=I,l=Aw(r,I))),l===1))throw p=jg,Lh(r,0),eu(r,y),us(r,kr()),p;switch(r.finishedWork=T,r.finishedLanes=y,l){case 0:case 1:throw Error(Ht(345));case 2:Ih(r,ss,$l);break;case 3:if(eu(r,y),(y&130023424)===y&&(l=LT+500-kr(),10<l)){if(Y0(r,0)!==0)break;if(T=r.suspendedLanes,(T&y)!==y){$o(),r.pingedLanes|=r.suspendedLanes&T;break}r.timeoutHandle=aw(Ih.bind(null,r,ss,$l),l);break}Ih(r,ss,$l);break;case 4:if(eu(r,y),(y&4194240)===y)break;for(l=r.eventTimes,T=-1;0<y;){var R=31-Ia(y);I=1<<R,R=l[R],R>T&&(T=R),y&=~I}if(y=T,y=kr()-y,y=(120>y?120:480>y?480:1080>y?1080:1920>y?1920:3e3>y?3e3:4320>y?4320:1960*eB(y/1960))-y,10<y){r.timeoutHandle=aw(Ih.bind(null,r,ss,$l),y);break}Ih(r,ss,$l);break;case 5:Ih(r,ss,$l);break;default:throw Error(Ht(329))}}}return us(r,kr()),r.callbackNode===p?tR.bind(null,r):null}function Aw(r,l){var p=bg;return r.current.memoizedState.isDehydrated&&(Lh(r,l).flags|=256),r=pv(r,l),r!==2&&(l=ss,ss=p,l!==null&&Cw(l)),r}function Cw(r){ss===null?ss=r:ss.push.apply(ss,r)}function tB(r){for(var l=r;;){if(l.flags&16384){var p=l.updateQueue;if(p!==null&&(p=p.stores,p!==null))for(var y=0;y<p.length;y++){var T=p[y],I=T.getSnapshot;T=T.value;try{if(!Ca(I(),T))return!1}catch{return!1}}}if(p=l.child,l.subtreeFlags&16384&&p!==null)p.return=l,l=p;else{if(l===r)break;for(;l.sibling===null;){if(l.return===null||l.return===r)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function eu(r,l){for(l&=~DT,l&=~Dv,r.suspendedLanes|=l,r.pingedLanes&=~l,r=r.expirationTimes;0<l;){var p=31-Ia(l),y=1<<p;r[p]=-1,l&=~y}}function aC(r){if($n&6)throw Error(Ht(327));kf();var l=Y0(r,0);if(!(l&1))return us(r,kr()),null;var p=pv(r,l);if(r.tag!==0&&p===2){var y=Jb(r);y!==0&&(l=y,p=Aw(r,y))}if(p===1)throw p=jg,Lh(r,0),eu(r,l),us(r,kr()),p;if(p===6)throw Error(Ht(345));return r.finishedWork=r.current.alternate,r.finishedLanes=l,Ih(r,ss,$l),us(r,kr()),null}function kT(r,l){var p=$n;$n|=1;try{return r(l)}finally{$n=p,$n===0&&(Jf=kr()+500,Mv&&Au())}}function Hh(r){au!==null&&au.tag===0&&!($n&6)&&kf();var l=$n;$n|=1;var p=Ks.transition,y=Qn;try{if(Ks.transition=null,Qn=1,r)return r()}finally{Qn=y,Ks.transition=p,$n=l,!($n&6)&&Au()}}function OT(){Cs=Mf.current,pr(Mf)}function Lh(r,l){r.finishedWork=null,r.finishedLanes=0;var p=r.timeoutHandle;if(p!==-1&&(r.timeoutHandle=-1,RF(p)),Ur!==null)for(p=Ur.return;p!==null;){var y=p;switch(gT(y),y.tag){case 1:y=y.type.childContextTypes,y!=null&&tv();break;case 3:Kf(),pr(ls),pr(ko),ET();break;case 5:ST(y);break;case 4:Kf();break;case 13:pr(wr);break;case 19:pr(wr);break;case 10:xT(y.type._context);break;case 22:case 23:OT()}p=p.return}if(ho=r,Ur=r=gu(r.current,null),xo=Cs=l,Qr=0,jg=null,DT=Dv=$h=0,ss=bg=null,Ch!==null){for(l=0;l<Ch.length;l++)if(p=Ch[l],y=p.interleaved,y!==null){p.interleaved=null;var T=y.next,I=p.pending;if(I!==null){var R=I.next;I.next=T,y.next=R}p.pending=y}Ch=null}return r}function iR(r,l){do{var p=Ur;try{if(vT(),k0.current=uv,cv){for(var y=Tr.memoizedState;y!==null;){var T=y.queue;T!==null&&(T.pending=null),y=y.next}cv=!1}if(Gh=0,uo=Kr=Tr=null,vg=!1,Fg=0,zT.current=null,p===null||p.return===null){Qr=1,jg=l,Ur=null;break}e:{var I=r,R=p.return,o=p,j=l;if(l=xo,o.flags|=32768,j!==null&&typeof j=="object"&&typeof j.then=="function"){var W=j,re=o,te=re.tag;if(!(re.mode&1)&&(te===0||te===11||te===15)){var Y=re.alternate;Y?(re.updateQueue=Y.updateQueue,re.memoizedState=Y.memoizedState,re.lanes=Y.lanes):(re.updateQueue=null,re.memoizedState=null)}var Ee=ZA(R);if(Ee!==null){Ee.flags&=-257,XA(Ee,R,o,I,l),Ee.mode&1&&WA(I,W,l),l=Ee,j=W;var Ie=l.updateQueue;if(Ie===null){var me=new Set;me.add(j),l.updateQueue=me}else Ie.add(j);break e}else{if(!(l&1)){WA(I,W,l),FT();break e}j=Error(Ht(426))}}else if(_r&&o.mode&1){var Pe=ZA(R);if(Pe!==null){!(Pe.flags&65536)&&(Pe.flags|=256),XA(Pe,R,o,I,l),_T(Qf(j,o));break e}}I=j=Qf(j,o),Qr!==4&&(Qr=2),bg===null?bg=[I]:bg.push(I),I=R;do{switch(I.tag){case 3:I.flags|=65536,l&=-l,I.lanes|=l;var he=NP(I,j,l);VA(I,he);break e;case 1:o=j;var pe=I.type,we=I.stateNode;if(!(I.flags&128)&&(typeof pe.getDerivedStateFromError=="function"||we!==null&&typeof we.componentDidCatch=="function"&&(pu===null||!pu.has(we)))){I.flags|=65536,l&=-l,I.lanes|=l;var Ue=jP(I,o,l);VA(I,Ue);break e}}I=I.return}while(I!==null)}oR(p)}catch(tt){l=tt,Ur===p&&p!==null&&(Ur=p=p.return);continue}break}while(!0)}function nR(){var r=hv.current;return hv.current=uv,r===null?uv:r}function FT(){(Qr===0||Qr===3||Qr===2)&&(Qr=4),ho===null||!($h&268435455)&&!(Dv&268435455)||eu(ho,xo)}function pv(r,l){var p=$n;$n|=2;var y=nR();(ho!==r||xo!==l)&&($l=null,Lh(r,l));do try{iB();break}catch(T){iR(r,T)}while(!0);if(vT(),$n=p,hv.current=y,Ur!==null)throw Error(Ht(261));return ho=null,xo=0,Qr}function iB(){for(;Ur!==null;)rR(Ur)}function nB(){for(;Ur!==null&&!CO();)rR(Ur)}function rR(r){var l=aR(r.alternate,r,Cs);r.memoizedProps=r.pendingProps,l===null?oR(r):Ur=l,zT.current=null}function oR(r){var l=r;do{var p=l.alternate;if(r=l.return,l.flags&32768){if(p=YF(p,l),p!==null){p.flags&=32767,Ur=p;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Qr=6,Ur=null;return}}else if(p=XF(p,l,Cs),p!==null){Ur=p;return}if(l=l.sibling,l!==null){Ur=l;return}Ur=l=r}while(l!==null);Qr===0&&(Qr=5)}function Ih(r,l,p){var y=Qn,T=Ks.transition;try{Ks.transition=null,Qn=1,rB(r,l,p,y)}finally{Ks.transition=T,Qn=y}return null}function rB(r,l,p,y){do kf();while(au!==null);if($n&6)throw Error(Ht(327));p=r.finishedWork;var T=r.finishedLanes;if(p===null)return null;if(r.finishedWork=null,r.finishedLanes=0,p===r.current)throw Error(Ht(177));r.callbackNode=null,r.callbackPriority=0;var I=p.lanes|p.childLanes;if(BO(r,I),r===ho&&(Ur=ho=null,xo=0),!(p.subtreeFlags&2064)&&!(p.flags&2064)||b0||(b0=!0,lR(X0,function(){return kf(),null})),I=(p.flags&15990)!==0,p.subtreeFlags&15990||I){I=Ks.transition,Ks.transition=null;var R=Qn;Qn=1;var o=$n;$n|=4,zT.current=null,QF(r,p),JP(p,r),SF(ow),K0=!!rw,ow=rw=null,r.current=p,JF(p),MO(),$n=o,Qn=R,Ks.transition=I}else r.current=p;if(b0&&(b0=!1,au=r,fv=T),I=r.pendingLanes,I===0&&(pu=null),zO(p.stateNode),us(r,kr()),l!==null)for(y=r.onRecoverableError,p=0;p<l.length;p++)T=l[p],y(T.value,{componentStack:T.stack,digest:T.digest});if(dv)throw dv=!1,r=Ew,Ew=null,r;return fv&1&&r.tag!==0&&kf(),I=r.pendingLanes,I&1?r===Iw?wg++:(wg=0,Iw=r):wg=0,Au(),null}function kf(){if(au!==null){var r=NM(fv),l=Ks.transition,p=Qn;try{if(Ks.transition=null,Qn=16>r?16:r,au===null)var y=!1;else{if(r=au,au=null,fv=0,$n&6)throw Error(Ht(331));var T=$n;for($n|=4,Ti=r.current;Ti!==null;){var I=Ti,R=I.child;if(Ti.flags&16){var o=I.deletions;if(o!==null){for(var j=0;j<o.length;j++){var W=o[j];for(Ti=W;Ti!==null;){var re=Ti;switch(re.tag){case 0:case 11:case 15:xg(8,re,I)}var te=re.child;if(te!==null)te.return=re,Ti=te;else for(;Ti!==null;){re=Ti;var Y=re.sibling,Ee=re.return;if(YP(re),re===W){Ti=null;break}if(Y!==null){Y.return=Ee,Ti=Y;break}Ti=Ee}}}var Ie=I.alternate;if(Ie!==null){var me=Ie.child;if(me!==null){Ie.child=null;do{var Pe=me.sibling;me.sibling=null,me=Pe}while(me!==null)}}Ti=I}}if(I.subtreeFlags&2064&&R!==null)R.return=I,Ti=R;else e:for(;Ti!==null;){if(I=Ti,I.flags&2048)switch(I.tag){case 0:case 11:case 15:xg(9,I,I.return)}var he=I.sibling;if(he!==null){he.return=I.return,Ti=he;break e}Ti=I.return}}var pe=r.current;for(Ti=pe;Ti!==null;){R=Ti;var we=R.child;if(R.subtreeFlags&2064&&we!==null)we.return=R,Ti=we;else e:for(R=pe;Ti!==null;){if(o=Ti,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:zv(9,o)}}catch(tt){Rr(o,o.return,tt)}if(o===R){Ti=null;break e}var Ue=o.sibling;if(Ue!==null){Ue.return=o.return,Ti=Ue;break e}Ti=o.return}}if($n=T,Au(),sl&&typeof sl.onPostCommitFiberRoot=="function")try{sl.onPostCommitFiberRoot(Sv,r)}catch{}y=!0}return y}finally{Qn=p,Ks.transition=l}}return!1}function lC(r,l,p){l=Qf(p,l),l=NP(r,l,1),r=fu(r,l,1),l=$o(),r!==null&&(Jg(r,1,l),us(r,l))}function Rr(r,l,p){if(r.tag===3)lC(r,r,p);else for(;l!==null;){if(l.tag===3){lC(l,r,p);break}else if(l.tag===1){var y=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(pu===null||!pu.has(y))){r=Qf(p,r),r=jP(l,r,1),l=fu(l,r,1),r=$o(),l!==null&&(Jg(l,1,r),us(l,r));break}}l=l.return}}function oB(r,l,p){var y=r.pingCache;y!==null&&y.delete(l),l=$o(),r.pingedLanes|=r.suspendedLanes&p,ho===r&&(xo&p)===p&&(Qr===4||Qr===3&&(xo&130023424)===xo&&500>kr()-LT?Lh(r,0):DT|=p),us(r,l)}function sR(r,l){l===0&&(r.mode&1?(l=h0,h0<<=1,!(h0&130023424)&&(h0=4194304)):l=1);var p=$o();r=Kl(r,l),r!==null&&(Jg(r,l,p),us(r,p))}function sB(r){var l=r.memoizedState,p=0;l!==null&&(p=l.retryLane),sR(r,p)}function aB(r,l){var p=0;switch(r.tag){case 13:var y=r.stateNode,T=r.memoizedState;T!==null&&(p=T.retryLane);break;case 19:y=r.stateNode;break;default:throw Error(Ht(314))}y!==null&&y.delete(l),sR(r,p)}var aR;aR=function(r,l,p){if(r!==null)if(r.memoizedProps!==l.pendingProps||ls.current)as=!0;else{if(!(r.lanes&p)&&!(l.flags&128))return as=!1,ZF(r,l,p);as=!!(r.flags&131072)}else as=!1,_r&&l.flags&1048576&&hP(l,rv,l.index);switch(l.lanes=0,l.tag){case 2:var y=l.type;F0(r,l),r=l.pendingProps;var T=Zf(l,ko.current);Lf(l,p),T=AT(null,l,y,r,T,p);var I=CT();return l.flags|=1,typeof T=="object"&&T!==null&&typeof T.render=="function"&&T.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,cs(y)?(I=!0,iv(l)):I=!1,l.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,wT(l),T.updater=Rv,l.stateNode=T,T._reactInternals=l,pw(l,y,r,p),l=_w(null,l,y,!0,I,p)):(l.tag=0,_r&&I&&mT(l),Uo(null,l,T,p),l=l.child),l;case 16:y=l.elementType;e:{switch(F0(r,l),r=l.pendingProps,T=y._init,y=T(y._payload),l.type=y,T=l.tag=cB(y),r=ba(y,r),T){case 0:l=gw(null,l,y,r,p);break e;case 1:l=QA(null,l,y,r,p);break e;case 11:l=YA(null,l,y,r,p);break e;case 14:l=KA(null,l,y,ba(y.type,r),p);break e}throw Error(Ht(306,y,""))}return l;case 0:return y=l.type,T=l.pendingProps,T=l.elementType===y?T:ba(y,T),gw(r,l,y,T,p);case 1:return y=l.type,T=l.pendingProps,T=l.elementType===y?T:ba(y,T),QA(r,l,y,T,p);case 3:e:{if($P(l),r===null)throw Error(Ht(387));y=l.pendingProps,I=l.memoizedState,T=I.element,_P(r,l),av(l,y,null,p);var R=l.memoizedState;if(y=R.element,I.isDehydrated)if(I={element:y,isDehydrated:!1,cache:R.cache,pendingSuspenseBoundaries:R.pendingSuspenseBoundaries,transitions:R.transitions},l.updateQueue.baseState=I,l.memoizedState=I,l.flags&256){T=Qf(Error(Ht(423)),l),l=JA(r,l,y,p,T);break e}else if(y!==T){T=Qf(Error(Ht(424)),l),l=JA(r,l,y,p,T);break e}else for(Ps=du(l.stateNode.containerInfo.firstChild),Rs=l,_r=!0,Ea=null,p=mP(l,null,y,p),l.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling;else{if(Xf(),y===T){l=Ql(r,l,p);break e}Uo(r,l,y,p)}l=l.child}return l;case 5:return yP(l),r===null&&hw(l),y=l.type,T=l.pendingProps,I=r!==null?r.memoizedProps:null,R=T.children,sw(y,T)?R=null:I!==null&&sw(y,I)&&(l.flags|=32),GP(r,l),Uo(r,l,R,p),l.child;case 6:return r===null&&hw(l),null;case 13:return HP(r,l,p);case 4:return TT(l,l.stateNode.containerInfo),y=l.pendingProps,r===null?l.child=Yf(l,null,y,p):Uo(r,l,y,p),l.child;case 11:return y=l.type,T=l.pendingProps,T=l.elementType===y?T:ba(y,T),YA(r,l,y,T,p);case 7:return Uo(r,l,l.pendingProps,p),l.child;case 8:return Uo(r,l,l.pendingProps.children,p),l.child;case 12:return Uo(r,l,l.pendingProps.children,p),l.child;case 10:e:{if(y=l.type._context,T=l.pendingProps,I=l.memoizedProps,R=T.value,cr(ov,y._currentValue),y._currentValue=R,I!==null)if(Ca(I.value,R)){if(I.children===T.children&&!ls.current){l=Ql(r,l,p);break e}}else for(I=l.child,I!==null&&(I.return=l);I!==null;){var o=I.dependencies;if(o!==null){R=I.child;for(var j=o.firstContext;j!==null;){if(j.context===y){if(I.tag===1){j=Zl(-1,p&-p),j.tag=2;var W=I.updateQueue;if(W!==null){W=W.shared;var re=W.pending;re===null?j.next=j:(j.next=re.next,re.next=j),W.pending=j}}I.lanes|=p,j=I.alternate,j!==null&&(j.lanes|=p),dw(I.return,p,l),o.lanes|=p;break}j=j.next}}else if(I.tag===10)R=I.type===l.type?null:I.child;else if(I.tag===18){if(R=I.return,R===null)throw Error(Ht(341));R.lanes|=p,o=R.alternate,o!==null&&(o.lanes|=p),dw(R,p,l),R=I.sibling}else R=I.child;if(R!==null)R.return=I;else for(R=I;R!==null;){if(R===l){R=null;break}if(I=R.sibling,I!==null){I.return=R.return,R=I;break}R=R.return}I=R}Uo(r,l,T.children,p),l=l.child}return l;case 9:return T=l.type,y=l.pendingProps.children,Lf(l,p),T=Qs(T),y=y(T),l.flags|=1,Uo(r,l,y,p),l.child;case 14:return y=l.type,T=ba(y,l.pendingProps),T=ba(y.type,T),KA(r,l,y,T,p);case 15:return VP(r,l,l.type,l.pendingProps,p);case 17:return y=l.type,T=l.pendingProps,T=l.elementType===y?T:ba(y,T),F0(r,l),l.tag=1,cs(y)?(r=!0,iv(l)):r=!1,Lf(l,p),BP(l,y,T),pw(l,y,T,p),_w(null,l,y,!0,r,p);case 19:return qP(r,l,p);case 22:return UP(r,l,p)}throw Error(Ht(156,l.tag))};function lR(r,l){return kM(r,l)}function lB(r,l,p,y){this.tag=r,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ys(r,l,p,y){return new lB(r,l,p,y)}function BT(r){return r=r.prototype,!(!r||!r.isReactComponent)}function cB(r){if(typeof r=="function")return BT(r)?1:0;if(r!=null){if(r=r.$$typeof,r===nT)return 11;if(r===rT)return 14}return 2}function gu(r,l){var p=r.alternate;return p===null?(p=Ys(r.tag,l,r.key,r.mode),p.elementType=r.elementType,p.type=r.type,p.stateNode=r.stateNode,p.alternate=r,r.alternate=p):(p.pendingProps=l,p.type=r.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=r.flags&14680064,p.childLanes=r.childLanes,p.lanes=r.lanes,p.child=r.child,p.memoizedProps=r.memoizedProps,p.memoizedState=r.memoizedState,p.updateQueue=r.updateQueue,l=r.dependencies,p.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},p.sibling=r.sibling,p.index=r.index,p.ref=r.ref,p}function j0(r,l,p,y,T,I){var R=2;if(y=r,typeof r=="function")BT(r)&&(R=1);else if(typeof r=="string")R=5;else e:switch(r){case vf:return kh(p.children,T,I,l);case iT:R=8,T|=8;break;case Bb:return r=Ys(12,p,l,T|2),r.elementType=Bb,r.lanes=I,r;case Nb:return r=Ys(13,p,l,T),r.elementType=Nb,r.lanes=I,r;case jb:return r=Ys(19,p,l,T),r.elementType=jb,r.lanes=I,r;case yM:return Lv(p,T,I,l);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case gM:R=10;break e;case _M:R=9;break e;case nT:R=11;break e;case rT:R=14;break e;case Kc:R=16,y=null;break e}throw Error(Ht(130,r==null?r:typeof r,""))}return l=Ys(R,p,l,T),l.elementType=r,l.type=y,l.lanes=I,l}function kh(r,l,p,y){return r=Ys(7,r,y,l),r.lanes=p,r}function Lv(r,l,p,y){return r=Ys(22,r,y,l),r.elementType=yM,r.lanes=p,r.stateNode={isHidden:!1},r}function Sb(r,l,p){return r=Ys(6,r,null,l),r.lanes=p,r}function Eb(r,l,p){return l=Ys(4,r.children!==null?r.children:[],r.key,l),l.lanes=p,l.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},l}function uB(r,l,p,y,T){this.tag=l,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ob(0),this.expirationTimes=ob(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ob(0),this.identifierPrefix=y,this.onRecoverableError=T,this.mutableSourceEagerHydrationData=null}function NT(r,l,p,y,T,I,R,o,j){return r=new uB(r,l,p,o,j),l===1?(l=1,I===!0&&(l|=8)):l=0,I=Ys(3,null,null,l),r.current=I,I.stateNode=r,I.memoizedState={element:y,isDehydrated:p,cache:null,transitions:null,pendingSuspenseBoundaries:null},wT(I),r}function hB(r,l,p){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yf,key:y==null?null:""+y,children:r,containerInfo:l,implementation:p}}function cR(r){if(!r)return vu;r=r._reactInternals;e:{if(Zh(r)!==r||r.tag!==1)throw Error(Ht(170));var l=r;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(cs(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(Ht(171))}if(r.tag===1){var p=r.type;if(cs(p))return cP(r,p,l)}return l}function uR(r,l,p,y,T,I,R,o,j){return r=NT(p,y,!0,r,T,I,R,o,j),r.context=cR(null),p=r.current,y=$o(),T=mu(p),I=Zl(y,T),I.callback=l??null,fu(p,I,T),r.current.lanes=T,Jg(r,T,y),us(r,y),r}function kv(r,l,p,y){var T=l.current,I=$o(),R=mu(T);return p=cR(p),l.context===null?l.context=p:l.pendingContext=p,l=Zl(I,R),l.payload={element:r},y=y===void 0?null:y,y!==null&&(l.callback=y),r=fu(T,l,R),r!==null&&(Aa(r,T,R,I),L0(r,T,R)),R}function mv(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function cC(r,l){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var p=r.retryLane;r.retryLane=p!==0&&p<l?p:l}}function jT(r,l){cC(r,l),(r=r.alternate)&&cC(r,l)}function dB(){return null}var hR=typeof reportError=="function"?reportError:function(r){console.error(r)};function VT(r){this._internalRoot=r}Ov.prototype.render=VT.prototype.render=function(r){var l=this._internalRoot;if(l===null)throw Error(Ht(409));kv(r,l,null,null)};Ov.prototype.unmount=VT.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var l=r.containerInfo;Hh(function(){kv(null,r,null,null)}),l[Yl]=null}};function Ov(r){this._internalRoot=r}Ov.prototype.unstable_scheduleHydration=function(r){if(r){var l=UM();r={blockedOn:null,target:r,priority:l};for(var p=0;p<Jc.length&&l!==0&&l<Jc[p].priority;p++);Jc.splice(p,0,r),p===0&&$M(r)}};function UT(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Fv(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function uC(){}function fB(r,l,p,y,T){if(T){if(typeof y=="function"){var I=y;y=function(){var W=mv(R);I.call(W)}}var R=uR(l,y,r,0,null,!1,!1,"",uC);return r._reactRootContainer=R,r[Yl]=R.current,zg(r.nodeType===8?r.parentNode:r),Hh(),R}for(;T=r.lastChild;)r.removeChild(T);if(typeof y=="function"){var o=y;y=function(){var W=mv(j);o.call(W)}}var j=NT(r,0,!1,null,null,!1,!1,"",uC);return r._reactRootContainer=j,r[Yl]=j.current,zg(r.nodeType===8?r.parentNode:r),Hh(function(){kv(l,j,p,y)}),j}function Bv(r,l,p,y,T){var I=p._reactRootContainer;if(I){var R=I;if(typeof T=="function"){var o=T;T=function(){var j=mv(R);o.call(j)}}kv(l,R,r,T)}else R=fB(p,l,r,T,y);return mv(R)}jM=function(r){switch(r.tag){case 3:var l=r.stateNode;if(l.current.memoizedState.isDehydrated){var p=hg(l.pendingLanes);p!==0&&(aT(l,p|1),us(l,kr()),!($n&6)&&(Jf=kr()+500,Au()))}break;case 13:Hh(function(){var y=Kl(r,1);if(y!==null){var T=$o();Aa(y,r,1,T)}}),jT(r,1)}};lT=function(r){if(r.tag===13){var l=Kl(r,134217728);if(l!==null){var p=$o();Aa(l,r,134217728,p)}jT(r,134217728)}};VM=function(r){if(r.tag===13){var l=mu(r),p=Kl(r,l);if(p!==null){var y=$o();Aa(p,r,l,y)}jT(r,l)}};UM=function(){return Qn};GM=function(r,l){var p=Qn;try{return Qn=r,l()}finally{Qn=p}};Yb=function(r,l,p){switch(l){case"input":if(Gb(r,p),l=p.name,p.type==="radio"&&l!=null){for(p=r;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<p.length;l++){var y=p[l];if(y!==r&&y.form===r.form){var T=Cv(y);if(!T)throw Error(Ht(90));xM(y),Gb(y,T)}}}break;case"textarea":wM(r,p);break;case"select":l=p.value,l!=null&&Pf(r,!!p.multiple,l,!1)}};MM=kT;PM=Hh;var pB={usingClientEntryPoint:!1,Events:[t_,Tf,Cv,AM,CM,kT]},sg={findFiberByHostInstance:Ah,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},mB={bundleType:sg.bundleType,version:sg.version,rendererPackageName:sg.rendererPackageName,rendererConfig:sg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:tc.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=DM(r),r===null?null:r.stateNode},findFiberByHostInstance:sg.findFiberByHostInstance||dB,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var w0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!w0.isDisabled&&w0.supportsFiber)try{Sv=w0.inject(mB),sl=w0}catch{}}ks.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pB;ks.createPortal=function(r,l){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!UT(l))throw Error(Ht(200));return hB(r,l,null,p)};ks.createRoot=function(r,l){if(!UT(r))throw Error(Ht(299));var p=!1,y="",T=hR;return l!=null&&(l.unstable_strictMode===!0&&(p=!0),l.identifierPrefix!==void 0&&(y=l.identifierPrefix),l.onRecoverableError!==void 0&&(T=l.onRecoverableError)),l=NT(r,1,!1,null,null,p,!1,y,T),r[Yl]=l.current,zg(r.nodeType===8?r.parentNode:r),new VT(l)};ks.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var l=r._reactInternals;if(l===void 0)throw typeof r.render=="function"?Error(Ht(188)):(r=Object.keys(r).join(","),Error(Ht(268,r)));return r=DM(l),r=r===null?null:r.stateNode,r};ks.flushSync=function(r){return Hh(r)};ks.hydrate=function(r,l,p){if(!Fv(l))throw Error(Ht(200));return Bv(null,r,l,!0,p)};ks.hydrateRoot=function(r,l,p){if(!UT(r))throw Error(Ht(405));var y=p!=null&&p.hydratedSources||null,T=!1,I="",R=hR;if(p!=null&&(p.unstable_strictMode===!0&&(T=!0),p.identifierPrefix!==void 0&&(I=p.identifierPrefix),p.onRecoverableError!==void 0&&(R=p.onRecoverableError)),l=uR(l,null,r,1,p??null,T,!1,I,R),r[Yl]=l.current,zg(r),y)for(r=0;r<y.length;r++)p=y[r],T=p._getVersion,T=T(p._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[p,T]:l.mutableSourceEagerHydrationData.push(p,T);return new Ov(l)};ks.render=function(r,l,p){if(!Fv(l))throw Error(Ht(200));return Bv(null,r,l,!1,p)};ks.unmountComponentAtNode=function(r){if(!Fv(r))throw Error(Ht(40));return r._reactRootContainer?(Hh(function(){Bv(null,null,r,!1,function(){r._reactRootContainer=null,r[Yl]=null})}),!0):!1};ks.unstable_batchedUpdates=kT;ks.unstable_renderSubtreeIntoContainer=function(r,l,p,y){if(!Fv(p))throw Error(Ht(200));if(r==null||r._reactInternals===void 0)throw Error(Ht(38));return Bv(r,l,p,!1,y)};ks.version="18.3.1-next-f1338f8080-20240426";function dR(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(dR)}catch(r){console.error(r)}}dR(),dM.exports=ks;var n_=dM.exports;const fR=Zw(n_);var pR,hC=n_;pR=hC.createRoot,hC.hydrateRoot;const gB=1,_B=1e6;let Ib=0;function yB(){return Ib=(Ib+1)%Number.MAX_SAFE_INTEGER,Ib.toString()}const Ab=new Map,dC=r=>{if(Ab.has(r))return;const l=setTimeout(()=>{Ab.delete(r),Tg({type:"REMOVE_TOAST",toastId:r})},_B);Ab.set(r,l)},vB=(r,l)=>{switch(l.type){case"ADD_TOAST":return{...r,toasts:[l.toast,...r.toasts].slice(0,gB)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(p=>p.id===l.toast.id?{...p,...l.toast}:p)};case"DISMISS_TOAST":{const{toastId:p}=l;return p?dC(p):r.toasts.forEach(y=>{dC(y.id)}),{...r,toasts:r.toasts.map(y=>y.id===p||p===void 0?{...y,open:!1}:y)}}case"REMOVE_TOAST":return l.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(p=>p.id!==l.toastId)}}},V0=[];let U0={toasts:[]};function Tg(r){U0=vB(U0,r),V0.forEach(l=>{l(U0)})}function xB({...r}){const l=yB(),p=T=>Tg({type:"UPDATE_TOAST",toast:{...T,id:l}}),y=()=>Tg({type:"DISMISS_TOAST",toastId:l});return Tg({type:"ADD_TOAST",toast:{...r,id:l,open:!0,onOpenChange:T=>{T||y()}}}),{id:l,dismiss:y,update:p}}function bB(){const[r,l]=xe.useState(U0);return xe.useEffect(()=>(V0.push(l),()=>{const p=V0.indexOf(l);p>-1&&V0.splice(p,1)}),[r]),{...r,toast:xB,dismiss:p=>Tg({type:"DISMISS_TOAST",toastId:p})}}function Kn(r,l,{checkForDefaultPrevented:p=!0}={}){return function(T){if(r==null||r(T),p===!1||!T.defaultPrevented)return l==null?void 0:l(T)}}function wB(r,l){typeof r=="function"?r(l):r!=null&&(r.current=l)}function mR(...r){return l=>r.forEach(p=>wB(p,l))}function Ls(...r){return xe.useCallback(mR(...r),r)}function TB(r,l=[]){let p=[];function y(I,R){const o=xe.createContext(R),j=p.length;p=[...p,R];function W(te){const{scope:Y,children:Ee,...Ie}=te,me=(Y==null?void 0:Y[r][j])||o,Pe=xe.useMemo(()=>Ie,Object.values(Ie));return ce.jsx(me.Provider,{value:Pe,children:Ee})}function re(te,Y){const Ee=(Y==null?void 0:Y[r][j])||o,Ie=xe.useContext(Ee);if(Ie)return Ie;if(R!==void 0)return R;throw new Error(`\`${te}\` must be used within \`${I}\``)}return W.displayName=I+"Provider",[W,re]}const T=()=>{const I=p.map(R=>xe.createContext(R));return function(o){const j=(o==null?void 0:o[r])||I;return xe.useMemo(()=>({[`__scope${r}`]:{...o,[r]:j}}),[o,j])}};return T.scopeName=r,[y,SB(T,...l)]}function SB(...r){const l=r[0];if(r.length===1)return l;const p=()=>{const y=r.map(T=>({useScope:T(),scopeName:T.scopeName}));return function(I){const R=y.reduce((o,{useScope:j,scopeName:W})=>{const te=j(I)[`__scope${W}`];return{...o,...te}},{});return xe.useMemo(()=>({[`__scope${l.scopeName}`]:R}),[R])}};return p.scopeName=l.scopeName,p}var Vg=xe.forwardRef((r,l)=>{const{children:p,...y}=r,T=xe.Children.toArray(p),I=T.find(EB);if(I){const R=I.props.children,o=T.map(j=>j===I?xe.Children.count(R)>1?xe.Children.only(null):xe.isValidElement(R)?R.props.children:null:j);return ce.jsx(Mw,{...y,ref:l,children:xe.isValidElement(R)?xe.cloneElement(R,void 0,o):null})}return ce.jsx(Mw,{...y,ref:l,children:p})});Vg.displayName="Slot";var Mw=xe.forwardRef((r,l)=>{const{children:p,...y}=r;if(xe.isValidElement(p)){const T=AB(p);return xe.cloneElement(p,{...IB(y,p.props),ref:l?mR(l,T):T})}return xe.Children.count(p)>1?xe.Children.only(null):null});Mw.displayName="SlotClone";var gR=({children:r})=>ce.jsx(ce.Fragment,{children:r});function EB(r){return xe.isValidElement(r)&&r.type===gR}function IB(r,l){const p={...l};for(const y in l){const T=r[y],I=l[y];/^on[A-Z]/.test(y)?T&&I?p[y]=(...o)=>{I(...o),T(...o)}:T&&(p[y]=T):y==="style"?p[y]={...T,...I}:y==="className"&&(p[y]=[T,I].filter(Boolean).join(" "))}return{...r,...p}}function AB(r){var y,T;let l=(y=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:y.get,p=l&&"isReactWarning"in l&&l.isReactWarning;return p?r.ref:(l=(T=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:T.get,p=l&&"isReactWarning"in l&&l.isReactWarning,p?r.props.ref:r.props.ref||r.ref)}function _R(r){const l=r+"CollectionProvider",[p,y]=TB(l),[T,I]=p(l,{collectionRef:{current:null},itemMap:new Map}),R=Ee=>{const{scope:Ie,children:me}=Ee,Pe=ei.useRef(null),he=ei.useRef(new Map).current;return ce.jsx(T,{scope:Ie,itemMap:he,collectionRef:Pe,children:me})};R.displayName=l;const o=r+"CollectionSlot",j=ei.forwardRef((Ee,Ie)=>{const{scope:me,children:Pe}=Ee,he=I(o,me),pe=Ls(Ie,he.collectionRef);return ce.jsx(Vg,{ref:pe,children:Pe})});j.displayName=o;const W=r+"CollectionItemSlot",re="data-radix-collection-item",te=ei.forwardRef((Ee,Ie)=>{const{scope:me,children:Pe,...he}=Ee,pe=ei.useRef(null),we=Ls(Ie,pe),Ue=I(W,me);return ei.useEffect(()=>(Ue.itemMap.set(pe,{ref:pe,...he}),()=>void Ue.itemMap.delete(pe))),ce.jsx(Vg,{[re]:"",ref:we,children:Pe})});te.displayName=W;function Y(Ee){const Ie=I(r+"CollectionConsumer",Ee);return ei.useCallback(()=>{const Pe=Ie.collectionRef.current;if(!Pe)return[];const he=Array.from(Pe.querySelectorAll(`[${re}]`));return Array.from(Ie.itemMap.values()).sort((Ue,tt)=>he.indexOf(Ue.ref.current)-he.indexOf(tt.ref.current))},[Ie.collectionRef,Ie.itemMap])}return[{Provider:R,Slot:j,ItemSlot:te},Y,y]}function Nv(r,l=[]){let p=[];function y(I,R){const o=xe.createContext(R),j=p.length;p=[...p,R];const W=te=>{var he;const{scope:Y,children:Ee,...Ie}=te,me=((he=Y==null?void 0:Y[r])==null?void 0:he[j])||o,Pe=xe.useMemo(()=>Ie,Object.values(Ie));return ce.jsx(me.Provider,{value:Pe,children:Ee})};W.displayName=I+"Provider";function re(te,Y){var me;const Ee=((me=Y==null?void 0:Y[r])==null?void 0:me[j])||o,Ie=xe.useContext(Ee);if(Ie)return Ie;if(R!==void 0)return R;throw new Error(`\`${te}\` must be used within \`${I}\``)}return[W,re]}const T=()=>{const I=p.map(R=>xe.createContext(R));return function(o){const j=(o==null?void 0:o[r])||I;return xe.useMemo(()=>({[`__scope${r}`]:{...o,[r]:j}}),[o,j])}};return T.scopeName=r,[y,CB(T,...l)]}function CB(...r){const l=r[0];if(r.length===1)return l;const p=()=>{const y=r.map(T=>({useScope:T(),scopeName:T.scopeName}));return function(I){const R=y.reduce((o,{useScope:j,scopeName:W})=>{const te=j(I)[`__scope${W}`];return{...o,...te}},{});return xe.useMemo(()=>({[`__scope${l.scopeName}`]:R}),[R])}};return p.scopeName=l.scopeName,p}var MB=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Er=MB.reduce((r,l)=>{const p=xe.forwardRef((y,T)=>{const{asChild:I,...R}=y,o=I?Vg:l;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),ce.jsx(o,{...R,ref:T})});return p.displayName=`Primitive.${l}`,{...r,[l]:p}},{});function yR(r,l){r&&n_.flushSync(()=>r.dispatchEvent(l))}function Ma(r){const l=xe.useRef(r);return xe.useEffect(()=>{l.current=r}),xe.useMemo(()=>(...p)=>{var y;return(y=l.current)==null?void 0:y.call(l,...p)},[])}function PB(r,l=globalThis==null?void 0:globalThis.document){const p=Ma(r);xe.useEffect(()=>{const y=T=>{T.key==="Escape"&&p(T)};return l.addEventListener("keydown",y,{capture:!0}),()=>l.removeEventListener("keydown",y,{capture:!0})},[p,l])}var RB="DismissableLayer",Pw="dismissableLayer.update",zB="dismissableLayer.pointerDownOutside",DB="dismissableLayer.focusOutside",fC,vR=xe.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),GT=xe.forwardRef((r,l)=>{const{disableOutsidePointerEvents:p=!1,onEscapeKeyDown:y,onPointerDownOutside:T,onFocusOutside:I,onInteractOutside:R,onDismiss:o,...j}=r,W=xe.useContext(vR),[re,te]=xe.useState(null),Y=(re==null?void 0:re.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,Ee]=xe.useState({}),Ie=Ls(l,wt=>te(wt)),me=Array.from(W.layers),[Pe]=[...W.layersWithOutsidePointerEventsDisabled].slice(-1),he=me.indexOf(Pe),pe=re?me.indexOf(re):-1,we=W.layersWithOutsidePointerEventsDisabled.size>0,Ue=pe>=he,tt=kB(wt=>{const xt=wt.target,ci=[...W.branches].some(ti=>ti.contains(xt));!Ue||ci||(T==null||T(wt),R==null||R(wt),wt.defaultPrevented||o==null||o())},Y),_t=OB(wt=>{const xt=wt.target;[...W.branches].some(ti=>ti.contains(xt))||(I==null||I(wt),R==null||R(wt),wt.defaultPrevented||o==null||o())},Y);return PB(wt=>{pe===W.layers.size-1&&(y==null||y(wt),!wt.defaultPrevented&&o&&(wt.preventDefault(),o()))},Y),xe.useEffect(()=>{if(re)return p&&(W.layersWithOutsidePointerEventsDisabled.size===0&&(fC=Y.body.style.pointerEvents,Y.body.style.pointerEvents="none"),W.layersWithOutsidePointerEventsDisabled.add(re)),W.layers.add(re),pC(),()=>{p&&W.layersWithOutsidePointerEventsDisabled.size===1&&(Y.body.style.pointerEvents=fC)}},[re,Y,p,W]),xe.useEffect(()=>()=>{re&&(W.layers.delete(re),W.layersWithOutsidePointerEventsDisabled.delete(re),pC())},[re,W]),xe.useEffect(()=>{const wt=()=>Ee({});return document.addEventListener(Pw,wt),()=>document.removeEventListener(Pw,wt)},[]),ce.jsx(Er.div,{...j,ref:Ie,style:{pointerEvents:we?Ue?"auto":"none":void 0,...r.style},onFocusCapture:Kn(r.onFocusCapture,_t.onFocusCapture),onBlurCapture:Kn(r.onBlurCapture,_t.onBlurCapture),onPointerDownCapture:Kn(r.onPointerDownCapture,tt.onPointerDownCapture)})});GT.displayName=RB;var LB="DismissableLayerBranch",xR=xe.forwardRef((r,l)=>{const p=xe.useContext(vR),y=xe.useRef(null),T=Ls(l,y);return xe.useEffect(()=>{const I=y.current;if(I)return p.branches.add(I),()=>{p.branches.delete(I)}},[p.branches]),ce.jsx(Er.div,{...r,ref:T})});xR.displayName=LB;function kB(r,l=globalThis==null?void 0:globalThis.document){const p=Ma(r),y=xe.useRef(!1),T=xe.useRef(()=>{});return xe.useEffect(()=>{const I=o=>{if(o.target&&!y.current){let j=function(){bR(zB,p,W,{discrete:!0})};const W={originalEvent:o};o.pointerType==="touch"?(l.removeEventListener("click",T.current),T.current=j,l.addEventListener("click",T.current,{once:!0})):j()}else l.removeEventListener("click",T.current);y.current=!1},R=window.setTimeout(()=>{l.addEventListener("pointerdown",I)},0);return()=>{window.clearTimeout(R),l.removeEventListener("pointerdown",I),l.removeEventListener("click",T.current)}},[l,p]),{onPointerDownCapture:()=>y.current=!0}}function OB(r,l=globalThis==null?void 0:globalThis.document){const p=Ma(r),y=xe.useRef(!1);return xe.useEffect(()=>{const T=I=>{I.target&&!y.current&&bR(DB,p,{originalEvent:I},{discrete:!1})};return l.addEventListener("focusin",T),()=>l.removeEventListener("focusin",T)},[l,p]),{onFocusCapture:()=>y.current=!0,onBlurCapture:()=>y.current=!1}}function pC(){const r=new CustomEvent(Pw);document.dispatchEvent(r)}function bR(r,l,p,{discrete:y}){const T=p.originalEvent.target,I=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:p});l&&T.addEventListener(r,l,{once:!0}),y?yR(T,I):T.dispatchEvent(I)}var FB=GT,BB=xR,xu=globalThis!=null&&globalThis.document?xe.useLayoutEffect:()=>{},NB="Portal",wR=xe.forwardRef((r,l)=>{var o;const{container:p,...y}=r,[T,I]=xe.useState(!1);xu(()=>I(!0),[]);const R=p||T&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return R?fR.createPortal(ce.jsx(Er.div,{...y,ref:l}),R):null});wR.displayName=NB;function jB(r,l){return xe.useReducer((p,y)=>l[p][y]??p,r)}var jv=r=>{const{present:l,children:p}=r,y=VB(l),T=typeof p=="function"?p({present:y.isPresent}):xe.Children.only(p),I=Ls(y.ref,UB(T));return typeof p=="function"||y.isPresent?xe.cloneElement(T,{ref:I}):null};jv.displayName="Presence";function VB(r){const[l,p]=xe.useState(),y=xe.useRef({}),T=xe.useRef(r),I=xe.useRef("none"),R=r?"mounted":"unmounted",[o,j]=jB(R,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return xe.useEffect(()=>{const W=T0(y.current);I.current=o==="mounted"?W:"none"},[o]),xu(()=>{const W=y.current,re=T.current;if(re!==r){const Y=I.current,Ee=T0(W);r?j("MOUNT"):Ee==="none"||(W==null?void 0:W.display)==="none"?j("UNMOUNT"):j(re&&Y!==Ee?"ANIMATION_OUT":"UNMOUNT"),T.current=r}},[r,j]),xu(()=>{if(l){let W;const re=l.ownerDocument.defaultView??window,te=Ee=>{const me=T0(y.current).includes(Ee.animationName);if(Ee.target===l&&me&&(j("ANIMATION_END"),!T.current)){const Pe=l.style.animationFillMode;l.style.animationFillMode="forwards",W=re.setTimeout(()=>{l.style.animationFillMode==="forwards"&&(l.style.animationFillMode=Pe)})}},Y=Ee=>{Ee.target===l&&(I.current=T0(y.current))};return l.addEventListener("animationstart",Y),l.addEventListener("animationcancel",te),l.addEventListener("animationend",te),()=>{re.clearTimeout(W),l.removeEventListener("animationstart",Y),l.removeEventListener("animationcancel",te),l.removeEventListener("animationend",te)}}else j("ANIMATION_END")},[l,j]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:xe.useCallback(W=>{W&&(y.current=getComputedStyle(W)),p(W)},[])}}function T0(r){return(r==null?void 0:r.animationName)||"none"}function UB(r){var y,T;let l=(y=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:y.get,p=l&&"isReactWarning"in l&&l.isReactWarning;return p?r.ref:(l=(T=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:T.get,p=l&&"isReactWarning"in l&&l.isReactWarning,p?r.props.ref:r.props.ref||r.ref)}function Vv({prop:r,defaultProp:l,onChange:p=()=>{}}){const[y,T]=GB({defaultProp:l,onChange:p}),I=r!==void 0,R=I?r:y,o=Ma(p),j=xe.useCallback(W=>{if(I){const te=typeof W=="function"?W(r):W;te!==r&&o(te)}else T(W)},[I,r,T,o]);return[R,j]}function GB({defaultProp:r,onChange:l}){const p=xe.useState(r),[y]=p,T=xe.useRef(y),I=Ma(l);return xe.useEffect(()=>{T.current!==y&&(I(y),T.current=y)},[y,T,I]),p}var $B="VisuallyHidden",Uv=xe.forwardRef((r,l)=>ce.jsx(Er.span,{...r,ref:l,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...r.style}}));Uv.displayName=$B;var HB=Uv,$T="ToastProvider",[HT,qB,WB]=_R("Toast"),[TR,yU]=Nv("Toast",[WB]),[ZB,Gv]=TR($T),SR=r=>{const{__scopeToast:l,label:p="Notification",duration:y=5e3,swipeDirection:T="right",swipeThreshold:I=50,children:R}=r,[o,j]=xe.useState(null),[W,re]=xe.useState(0),te=xe.useRef(!1),Y=xe.useRef(!1);return p.trim()||console.error(`Invalid prop \`label\` supplied to \`${$T}\`. Expected non-empty \`string\`.`),ce.jsx(HT.Provider,{scope:l,children:ce.jsx(ZB,{scope:l,label:p,duration:y,swipeDirection:T,swipeThreshold:I,toastCount:W,viewport:o,onViewportChange:j,onToastAdd:xe.useCallback(()=>re(Ee=>Ee+1),[]),onToastRemove:xe.useCallback(()=>re(Ee=>Ee-1),[]),isFocusedToastEscapeKeyDownRef:te,isClosePausedRef:Y,children:R})})};SR.displayName=$T;var ER="ToastViewport",XB=["F8"],Rw="toast.viewportPause",zw="toast.viewportResume",IR=xe.forwardRef((r,l)=>{const{__scopeToast:p,hotkey:y=XB,label:T="Notifications ({hotkey})",...I}=r,R=Gv(ER,p),o=qB(p),j=xe.useRef(null),W=xe.useRef(null),re=xe.useRef(null),te=xe.useRef(null),Y=Ls(l,te,R.onViewportChange),Ee=y.join("+").replace(/Key/g,"").replace(/Digit/g,""),Ie=R.toastCount>0;xe.useEffect(()=>{const Pe=he=>{var we;y.length!==0&&y.every(Ue=>he[Ue]||he.code===Ue)&&((we=te.current)==null||we.focus())};return document.addEventListener("keydown",Pe),()=>document.removeEventListener("keydown",Pe)},[y]),xe.useEffect(()=>{const Pe=j.current,he=te.current;if(Ie&&Pe&&he){const pe=()=>{if(!R.isClosePausedRef.current){const _t=new CustomEvent(Rw);he.dispatchEvent(_t),R.isClosePausedRef.current=!0}},we=()=>{if(R.isClosePausedRef.current){const _t=new CustomEvent(zw);he.dispatchEvent(_t),R.isClosePausedRef.current=!1}},Ue=_t=>{!Pe.contains(_t.relatedTarget)&&we()},tt=()=>{Pe.contains(document.activeElement)||we()};return Pe.addEventListener("focusin",pe),Pe.addEventListener("focusout",Ue),Pe.addEventListener("pointermove",pe),Pe.addEventListener("pointerleave",tt),window.addEventListener("blur",pe),window.addEventListener("focus",we),()=>{Pe.removeEventListener("focusin",pe),Pe.removeEventListener("focusout",Ue),Pe.removeEventListener("pointermove",pe),Pe.removeEventListener("pointerleave",tt),window.removeEventListener("blur",pe),window.removeEventListener("focus",we)}}},[Ie,R.isClosePausedRef]);const me=xe.useCallback(({tabbingDirection:Pe})=>{const pe=o().map(we=>{const Ue=we.ref.current,tt=[Ue,...lN(Ue)];return Pe==="forwards"?tt:tt.reverse()});return(Pe==="forwards"?pe.reverse():pe).flat()},[o]);return xe.useEffect(()=>{const Pe=te.current;if(Pe){const he=pe=>{var tt,_t,wt;const we=pe.altKey||pe.ctrlKey||pe.metaKey;if(pe.key==="Tab"&&!we){const xt=document.activeElement,ci=pe.shiftKey;if(pe.target===Pe&&ci){(tt=W.current)==null||tt.focus();return}const ui=me({tabbingDirection:ci?"backwards":"forwards"}),Pi=ui.findIndex(Vt=>Vt===xt);Cb(ui.slice(Pi+1))?pe.preventDefault():ci?(_t=W.current)==null||_t.focus():(wt=re.current)==null||wt.focus()}};return Pe.addEventListener("keydown",he),()=>Pe.removeEventListener("keydown",he)}},[o,me]),ce.jsxs(BB,{ref:j,role:"region","aria-label":T.replace("{hotkey}",Ee),tabIndex:-1,style:{pointerEvents:Ie?void 0:"none"},children:[Ie&&ce.jsx(Dw,{ref:W,onFocusFromOutsideViewport:()=>{const Pe=me({tabbingDirection:"forwards"});Cb(Pe)}}),ce.jsx(HT.Slot,{scope:p,children:ce.jsx(Er.ol,{tabIndex:-1,...I,ref:Y})}),Ie&&ce.jsx(Dw,{ref:re,onFocusFromOutsideViewport:()=>{const Pe=me({tabbingDirection:"backwards"});Cb(Pe)}})]})});IR.displayName=ER;var AR="ToastFocusProxy",Dw=xe.forwardRef((r,l)=>{const{__scopeToast:p,onFocusFromOutsideViewport:y,...T}=r,I=Gv(AR,p);return ce.jsx(Uv,{"aria-hidden":!0,tabIndex:0,...T,ref:l,style:{position:"fixed"},onFocus:R=>{var W;const o=R.relatedTarget;!((W=I.viewport)!=null&&W.contains(o))&&y()}})});Dw.displayName=AR;var $v="Toast",YB="toast.swipeStart",KB="toast.swipeMove",QB="toast.swipeCancel",JB="toast.swipeEnd",CR=xe.forwardRef((r,l)=>{const{forceMount:p,open:y,defaultOpen:T,onOpenChange:I,...R}=r,[o=!0,j]=Vv({prop:y,defaultProp:T,onChange:I});return ce.jsx(jv,{present:p||o,children:ce.jsx(iN,{open:o,...R,ref:l,onClose:()=>j(!1),onPause:Ma(r.onPause),onResume:Ma(r.onResume),onSwipeStart:Kn(r.onSwipeStart,W=>{W.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Kn(r.onSwipeMove,W=>{const{x:re,y:te}=W.detail.delta;W.currentTarget.setAttribute("data-swipe","move"),W.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${re}px`),W.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${te}px`)}),onSwipeCancel:Kn(r.onSwipeCancel,W=>{W.currentTarget.setAttribute("data-swipe","cancel"),W.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),W.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),W.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),W.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Kn(r.onSwipeEnd,W=>{const{x:re,y:te}=W.detail.delta;W.currentTarget.setAttribute("data-swipe","end"),W.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),W.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),W.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${re}px`),W.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${te}px`),j(!1)})})})});CR.displayName=$v;var[eN,tN]=TR($v,{onClose(){}}),iN=xe.forwardRef((r,l)=>{const{__scopeToast:p,type:y="foreground",duration:T,open:I,onClose:R,onEscapeKeyDown:o,onPause:j,onResume:W,onSwipeStart:re,onSwipeMove:te,onSwipeCancel:Y,onSwipeEnd:Ee,...Ie}=r,me=Gv($v,p),[Pe,he]=xe.useState(null),pe=Ls(l,Vt=>he(Vt)),we=xe.useRef(null),Ue=xe.useRef(null),tt=T||me.duration,_t=xe.useRef(0),wt=xe.useRef(tt),xt=xe.useRef(0),{onToastAdd:ci,onToastRemove:ti}=me,ni=Ma(()=>{var vi;(Pe==null?void 0:Pe.contains(document.activeElement))&&((vi=me.viewport)==null||vi.focus()),R()}),ui=xe.useCallback(Vt=>{!Vt||Vt===1/0||(window.clearTimeout(xt.current),_t.current=new Date().getTime(),xt.current=window.setTimeout(ni,Vt))},[ni]);xe.useEffect(()=>{const Vt=me.viewport;if(Vt){const vi=()=>{ui(wt.current),W==null||W()},ai=()=>{const Vi=new Date().getTime()-_t.current;wt.current=wt.current-Vi,window.clearTimeout(xt.current),j==null||j()};return Vt.addEventListener(Rw,ai),Vt.addEventListener(zw,vi),()=>{Vt.removeEventListener(Rw,ai),Vt.removeEventListener(zw,vi)}}},[me.viewport,tt,j,W,ui]),xe.useEffect(()=>{I&&!me.isClosePausedRef.current&&ui(tt)},[I,tt,me.isClosePausedRef,ui]),xe.useEffect(()=>(ci(),()=>ti()),[ci,ti]);const Pi=xe.useMemo(()=>Pe?kR(Pe):null,[Pe]);return me.viewport?ce.jsxs(ce.Fragment,{children:[Pi&&ce.jsx(nN,{__scopeToast:p,role:"status","aria-live":y==="foreground"?"assertive":"polite","aria-atomic":!0,children:Pi}),ce.jsx(eN,{scope:p,onClose:ni,children:n_.createPortal(ce.jsx(HT.ItemSlot,{scope:p,children:ce.jsx(FB,{asChild:!0,onEscapeKeyDown:Kn(o,()=>{me.isFocusedToastEscapeKeyDownRef.current||ni(),me.isFocusedToastEscapeKeyDownRef.current=!1}),children:ce.jsx(Er.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":I?"open":"closed","data-swipe-direction":me.swipeDirection,...Ie,ref:pe,style:{userSelect:"none",touchAction:"none",...r.style},onKeyDown:Kn(r.onKeyDown,Vt=>{Vt.key==="Escape"&&(o==null||o(Vt.nativeEvent),Vt.nativeEvent.defaultPrevented||(me.isFocusedToastEscapeKeyDownRef.current=!0,ni()))}),onPointerDown:Kn(r.onPointerDown,Vt=>{Vt.button===0&&(we.current={x:Vt.clientX,y:Vt.clientY})}),onPointerMove:Kn(r.onPointerMove,Vt=>{if(!we.current)return;const vi=Vt.clientX-we.current.x,ai=Vt.clientY-we.current.y,Vi=!!Ue.current,ft=["left","right"].includes(me.swipeDirection),$t=["left","up"].includes(me.swipeDirection)?Math.min:Math.max,Gt=ft?$t(0,vi):0,ii=ft?0:$t(0,ai),Li=Vt.pointerType==="touch"?10:2,Ji={x:Gt,y:ii},Vn={originalEvent:Vt,delta:Ji};Vi?(Ue.current=Ji,S0(KB,te,Vn,{discrete:!1})):mC(Ji,me.swipeDirection,Li)?(Ue.current=Ji,S0(YB,re,Vn,{discrete:!1}),Vt.target.setPointerCapture(Vt.pointerId)):(Math.abs(vi)>Li||Math.abs(ai)>Li)&&(we.current=null)}),onPointerUp:Kn(r.onPointerUp,Vt=>{const vi=Ue.current,ai=Vt.target;if(ai.hasPointerCapture(Vt.pointerId)&&ai.releasePointerCapture(Vt.pointerId),Ue.current=null,we.current=null,vi){const Vi=Vt.currentTarget,ft={originalEvent:Vt,delta:vi};mC(vi,me.swipeDirection,me.swipeThreshold)?S0(JB,Ee,ft,{discrete:!0}):S0(QB,Y,ft,{discrete:!0}),Vi.addEventListener("click",$t=>$t.preventDefault(),{once:!0})}})})})}),me.viewport)})]}):null}),nN=r=>{const{__scopeToast:l,children:p,...y}=r,T=Gv($v,l),[I,R]=xe.useState(!1),[o,j]=xe.useState(!1);return sN(()=>R(!0)),xe.useEffect(()=>{const W=window.setTimeout(()=>j(!0),1e3);return()=>window.clearTimeout(W)},[]),o?null:ce.jsx(wR,{asChild:!0,children:ce.jsx(Uv,{...y,children:I&&ce.jsxs(ce.Fragment,{children:[T.label," ",p]})})})},rN="ToastTitle",MR=xe.forwardRef((r,l)=>{const{__scopeToast:p,...y}=r;return ce.jsx(Er.div,{...y,ref:l})});MR.displayName=rN;var oN="ToastDescription",PR=xe.forwardRef((r,l)=>{const{__scopeToast:p,...y}=r;return ce.jsx(Er.div,{...y,ref:l})});PR.displayName=oN;var RR="ToastAction",zR=xe.forwardRef((r,l)=>{const{altText:p,...y}=r;return p.trim()?ce.jsx(LR,{altText:p,asChild:!0,children:ce.jsx(qT,{...y,ref:l})}):(console.error(`Invalid prop \`altText\` supplied to \`${RR}\`. Expected non-empty \`string\`.`),null)});zR.displayName=RR;var DR="ToastClose",qT=xe.forwardRef((r,l)=>{const{__scopeToast:p,...y}=r,T=tN(DR,p);return ce.jsx(LR,{asChild:!0,children:ce.jsx(Er.button,{type:"button",...y,ref:l,onClick:Kn(r.onClick,T.onClose)})})});qT.displayName=DR;var LR=xe.forwardRef((r,l)=>{const{__scopeToast:p,altText:y,...T}=r;return ce.jsx(Er.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":y||void 0,...T,ref:l})});function kR(r){const l=[];return Array.from(r.childNodes).forEach(y=>{if(y.nodeType===y.TEXT_NODE&&y.textContent&&l.push(y.textContent),aN(y)){const T=y.ariaHidden||y.hidden||y.style.display==="none",I=y.dataset.radixToastAnnounceExclude==="";if(!T)if(I){const R=y.dataset.radixToastAnnounceAlt;R&&l.push(R)}else l.push(...kR(y))}}),l}function S0(r,l,p,{discrete:y}){const T=p.originalEvent.currentTarget,I=new CustomEvent(r,{bubbles:!0,cancelable:!0,detail:p});l&&T.addEventListener(r,l,{once:!0}),y?yR(T,I):T.dispatchEvent(I)}var mC=(r,l,p=0)=>{const y=Math.abs(r.x),T=Math.abs(r.y),I=y>T;return l==="left"||l==="right"?I&&y>p:!I&&T>p};function sN(r=()=>{}){const l=Ma(r);xu(()=>{let p=0,y=0;return p=window.requestAnimationFrame(()=>y=window.requestAnimationFrame(l)),()=>{window.cancelAnimationFrame(p),window.cancelAnimationFrame(y)}},[l])}function aN(r){return r.nodeType===r.ELEMENT_NODE}function lN(r){const l=[],p=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:y=>{const T=y.tagName==="INPUT"&&y.type==="hidden";return y.disabled||y.hidden||T?NodeFilter.FILTER_SKIP:y.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;p.nextNode();)l.push(p.currentNode);return l}function Cb(r){const l=document.activeElement;return r.some(p=>p===l?!0:(p.focus(),document.activeElement!==l))}var cN=SR,OR=IR,FR=CR,BR=MR,NR=PR,jR=zR,VR=qT;function UR(r){var l,p,y="";if(typeof r=="string"||typeof r=="number")y+=r;else if(typeof r=="object")if(Array.isArray(r)){var T=r.length;for(l=0;l<T;l++)r[l]&&(p=UR(r[l]))&&(y&&(y+=" "),y+=p)}else for(p in r)r[p]&&(y&&(y+=" "),y+=p);return y}function GR(){for(var r,l,p=0,y="",T=arguments.length;p<T;p++)(r=arguments[p])&&(l=UR(r))&&(y&&(y+=" "),y+=l);return y}const gC=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,_C=GR,Hv=(r,l)=>p=>{var y;if((l==null?void 0:l.variants)==null)return _C(r,p==null?void 0:p.class,p==null?void 0:p.className);const{variants:T,defaultVariants:I}=l,R=Object.keys(T).map(W=>{const re=p==null?void 0:p[W],te=I==null?void 0:I[W];if(re===null)return null;const Y=gC(re)||gC(te);return T[W][Y]}),o=p&&Object.entries(p).reduce((W,re)=>{let[te,Y]=re;return Y===void 0||(W[te]=Y),W},{}),j=l==null||(y=l.compoundVariants)===null||y===void 0?void 0:y.reduce((W,re)=>{let{class:te,className:Y,...Ee}=re;return Object.entries(Ee).every(Ie=>{let[me,Pe]=Ie;return Array.isArray(Pe)?Pe.includes({...I,...o}[me]):{...I,...o}[me]===Pe})?[...W,te,Y]:W},[]);return _C(r,R,j,p==null?void 0:p.class,p==null?void 0:p.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uN=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),$R=(...r)=>r.filter((l,p,y)=>!!l&&l.trim()!==""&&y.indexOf(l)===p).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var hN={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dN=xe.forwardRef(({color:r="currentColor",size:l=24,strokeWidth:p=2,absoluteStrokeWidth:y,className:T="",children:I,iconNode:R,...o},j)=>xe.createElement("svg",{ref:j,...hN,width:l,height:l,stroke:r,strokeWidth:y?Number(p)*24/Number(l):p,className:$R("lucide",T),...o},[...R.map(([W,re])=>xe.createElement(W,re)),...Array.isArray(I)?I:[I]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cl=(r,l)=>{const p=xe.forwardRef(({className:y,...T},I)=>xe.createElement(dN,{ref:I,iconNode:l,className:$R(`lucide-${uN(r)}`,y),...T}));return p.displayName=`${r}`,p};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fN=cl("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WT=cl("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pN=cl("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mN=cl("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lw=cl("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HR=cl("ListOrdered",[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ug=cl("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gN=cl("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _N=cl("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yN=cl("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ZT="-",vN=r=>{const l=bN(r),{conflictingClassGroups:p,conflictingClassGroupModifiers:y}=r;return{getClassGroupId:R=>{const o=R.split(ZT);return o[0]===""&&o.length!==1&&o.shift(),qR(o,l)||xN(R)},getConflictingClassGroupIds:(R,o)=>{const j=p[R]||[];return o&&y[R]?[...j,...y[R]]:j}}},qR=(r,l)=>{var R;if(r.length===0)return l.classGroupId;const p=r[0],y=l.nextPart.get(p),T=y?qR(r.slice(1),y):void 0;if(T)return T;if(l.validators.length===0)return;const I=r.join(ZT);return(R=l.validators.find(({validator:o})=>o(I)))==null?void 0:R.classGroupId},yC=/^\[(.+)\]$/,xN=r=>{if(yC.test(r)){const l=yC.exec(r)[1],p=l==null?void 0:l.substring(0,l.indexOf(":"));if(p)return"arbitrary.."+p}},bN=r=>{const{theme:l,prefix:p}=r,y={nextPart:new Map,validators:[]};return TN(Object.entries(r.classGroups),p).forEach(([I,R])=>{kw(R,y,I,l)}),y},kw=(r,l,p,y)=>{r.forEach(T=>{if(typeof T=="string"){const I=T===""?l:vC(l,T);I.classGroupId=p;return}if(typeof T=="function"){if(wN(T)){kw(T(y),l,p,y);return}l.validators.push({validator:T,classGroupId:p});return}Object.entries(T).forEach(([I,R])=>{kw(R,vC(l,I),p,y)})})},vC=(r,l)=>{let p=r;return l.split(ZT).forEach(y=>{p.nextPart.has(y)||p.nextPart.set(y,{nextPart:new Map,validators:[]}),p=p.nextPart.get(y)}),p},wN=r=>r.isThemeGetter,TN=(r,l)=>l?r.map(([p,y])=>{const T=y.map(I=>typeof I=="string"?l+I:typeof I=="object"?Object.fromEntries(Object.entries(I).map(([R,o])=>[l+R,o])):I);return[p,T]}):r,SN=r=>{if(r<1)return{get:()=>{},set:()=>{}};let l=0,p=new Map,y=new Map;const T=(I,R)=>{p.set(I,R),l++,l>r&&(l=0,y=p,p=new Map)};return{get(I){let R=p.get(I);if(R!==void 0)return R;if((R=y.get(I))!==void 0)return T(I,R),R},set(I,R){p.has(I)?p.set(I,R):T(I,R)}}},WR="!",EN=r=>{const{separator:l,experimentalParseClassName:p}=r,y=l.length===1,T=l[0],I=l.length,R=o=>{const j=[];let W=0,re=0,te;for(let Pe=0;Pe<o.length;Pe++){let he=o[Pe];if(W===0){if(he===T&&(y||o.slice(Pe,Pe+I)===l)){j.push(o.slice(re,Pe)),re=Pe+I;continue}if(he==="/"){te=Pe;continue}}he==="["?W++:he==="]"&&W--}const Y=j.length===0?o:o.substring(re),Ee=Y.startsWith(WR),Ie=Ee?Y.substring(1):Y,me=te&&te>re?te-re:void 0;return{modifiers:j,hasImportantModifier:Ee,baseClassName:Ie,maybePostfixModifierPosition:me}};return p?o=>p({className:o,parseClassName:R}):R},IN=r=>{if(r.length<=1)return r;const l=[];let p=[];return r.forEach(y=>{y[0]==="["?(l.push(...p.sort(),y),p=[]):p.push(y)}),l.push(...p.sort()),l},AN=r=>({cache:SN(r.cacheSize),parseClassName:EN(r),...vN(r)}),CN=/\s+/,MN=(r,l)=>{const{parseClassName:p,getClassGroupId:y,getConflictingClassGroupIds:T}=l,I=[],R=r.trim().split(CN);let o="";for(let j=R.length-1;j>=0;j-=1){const W=R[j],{modifiers:re,hasImportantModifier:te,baseClassName:Y,maybePostfixModifierPosition:Ee}=p(W);let Ie=!!Ee,me=y(Ie?Y.substring(0,Ee):Y);if(!me){if(!Ie){o=W+(o.length>0?" "+o:o);continue}if(me=y(Y),!me){o=W+(o.length>0?" "+o:o);continue}Ie=!1}const Pe=IN(re).join(":"),he=te?Pe+WR:Pe,pe=he+me;if(I.includes(pe))continue;I.push(pe);const we=T(me,Ie);for(let Ue=0;Ue<we.length;++Ue){const tt=we[Ue];I.push(he+tt)}o=W+(o.length>0?" "+o:o)}return o};function PN(){let r=0,l,p,y="";for(;r<arguments.length;)(l=arguments[r++])&&(p=ZR(l))&&(y&&(y+=" "),y+=p);return y}const ZR=r=>{if(typeof r=="string")return r;let l,p="";for(let y=0;y<r.length;y++)r[y]&&(l=ZR(r[y]))&&(p&&(p+=" "),p+=l);return p};function RN(r,...l){let p,y,T,I=R;function R(j){const W=l.reduce((re,te)=>te(re),r());return p=AN(W),y=p.cache.get,T=p.cache.set,I=o,o(j)}function o(j){const W=y(j);if(W)return W;const re=MN(j,p);return T(j,re),re}return function(){return I(PN.apply(null,arguments))}}const dr=r=>{const l=p=>p[r]||[];return l.isThemeGetter=!0,l},XR=/^\[(?:([a-z-]+):)?(.+)\]$/i,zN=/^\d+\/\d+$/,DN=new Set(["px","full","screen"]),LN=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,kN=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,ON=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,FN=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,BN=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ul=r=>Of(r)||DN.has(r)||zN.test(r),Zc=r=>op(r,"length",qN),Of=r=>!!r&&!Number.isNaN(Number(r)),Mb=r=>op(r,"number",Of),ag=r=>!!r&&Number.isInteger(Number(r)),NN=r=>r.endsWith("%")&&Of(r.slice(0,-1)),dn=r=>XR.test(r),Xc=r=>LN.test(r),jN=new Set(["length","size","percentage"]),VN=r=>op(r,jN,YR),UN=r=>op(r,"position",YR),GN=new Set(["image","url"]),$N=r=>op(r,GN,ZN),HN=r=>op(r,"",WN),lg=()=>!0,op=(r,l,p)=>{const y=XR.exec(r);return y?y[1]?typeof l=="string"?y[1]===l:l.has(y[1]):p(y[2]):!1},qN=r=>kN.test(r)&&!ON.test(r),YR=()=>!1,WN=r=>FN.test(r),ZN=r=>BN.test(r),XN=()=>{const r=dr("colors"),l=dr("spacing"),p=dr("blur"),y=dr("brightness"),T=dr("borderColor"),I=dr("borderRadius"),R=dr("borderSpacing"),o=dr("borderWidth"),j=dr("contrast"),W=dr("grayscale"),re=dr("hueRotate"),te=dr("invert"),Y=dr("gap"),Ee=dr("gradientColorStops"),Ie=dr("gradientColorStopPositions"),me=dr("inset"),Pe=dr("margin"),he=dr("opacity"),pe=dr("padding"),we=dr("saturate"),Ue=dr("scale"),tt=dr("sepia"),_t=dr("skew"),wt=dr("space"),xt=dr("translate"),ci=()=>["auto","contain","none"],ti=()=>["auto","hidden","clip","visible","scroll"],ni=()=>["auto",dn,l],ui=()=>[dn,l],Pi=()=>["",Ul,Zc],Vt=()=>["auto",Of,dn],vi=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],ai=()=>["solid","dashed","dotted","double","none"],Vi=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ft=()=>["start","end","center","between","around","evenly","stretch"],$t=()=>["","0",dn],Gt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ii=()=>[Of,dn];return{cacheSize:500,separator:":",theme:{colors:[lg],spacing:[Ul,Zc],blur:["none","",Xc,dn],brightness:ii(),borderColor:[r],borderRadius:["none","","full",Xc,dn],borderSpacing:ui(),borderWidth:Pi(),contrast:ii(),grayscale:$t(),hueRotate:ii(),invert:$t(),gap:ui(),gradientColorStops:[r],gradientColorStopPositions:[NN,Zc],inset:ni(),margin:ni(),opacity:ii(),padding:ui(),saturate:ii(),scale:ii(),sepia:$t(),skew:ii(),space:ui(),translate:ui()},classGroups:{aspect:[{aspect:["auto","square","video",dn]}],container:["container"],columns:[{columns:[Xc]}],"break-after":[{"break-after":Gt()}],"break-before":[{"break-before":Gt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...vi(),dn]}],overflow:[{overflow:ti()}],"overflow-x":[{"overflow-x":ti()}],"overflow-y":[{"overflow-y":ti()}],overscroll:[{overscroll:ci()}],"overscroll-x":[{"overscroll-x":ci()}],"overscroll-y":[{"overscroll-y":ci()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[me]}],"inset-x":[{"inset-x":[me]}],"inset-y":[{"inset-y":[me]}],start:[{start:[me]}],end:[{end:[me]}],top:[{top:[me]}],right:[{right:[me]}],bottom:[{bottom:[me]}],left:[{left:[me]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",ag,dn]}],basis:[{basis:ni()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",dn]}],grow:[{grow:$t()}],shrink:[{shrink:$t()}],order:[{order:["first","last","none",ag,dn]}],"grid-cols":[{"grid-cols":[lg]}],"col-start-end":[{col:["auto",{span:["full",ag,dn]},dn]}],"col-start":[{"col-start":Vt()}],"col-end":[{"col-end":Vt()}],"grid-rows":[{"grid-rows":[lg]}],"row-start-end":[{row:["auto",{span:[ag,dn]},dn]}],"row-start":[{"row-start":Vt()}],"row-end":[{"row-end":Vt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",dn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",dn]}],gap:[{gap:[Y]}],"gap-x":[{"gap-x":[Y]}],"gap-y":[{"gap-y":[Y]}],"justify-content":[{justify:["normal",...ft()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ft(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ft(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[pe]}],px:[{px:[pe]}],py:[{py:[pe]}],ps:[{ps:[pe]}],pe:[{pe:[pe]}],pt:[{pt:[pe]}],pr:[{pr:[pe]}],pb:[{pb:[pe]}],pl:[{pl:[pe]}],m:[{m:[Pe]}],mx:[{mx:[Pe]}],my:[{my:[Pe]}],ms:[{ms:[Pe]}],me:[{me:[Pe]}],mt:[{mt:[Pe]}],mr:[{mr:[Pe]}],mb:[{mb:[Pe]}],ml:[{ml:[Pe]}],"space-x":[{"space-x":[wt]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[wt]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",dn,l]}],"min-w":[{"min-w":[dn,l,"min","max","fit"]}],"max-w":[{"max-w":[dn,l,"none","full","min","max","fit","prose",{screen:[Xc]},Xc]}],h:[{h:[dn,l,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[dn,l,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[dn,l,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[dn,l,"auto","min","max","fit"]}],"font-size":[{text:["base",Xc,Zc]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Mb]}],"font-family":[{font:[lg]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",dn]}],"line-clamp":[{"line-clamp":["none",Of,Mb]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Ul,dn]}],"list-image":[{"list-image":["none",dn]}],"list-style-type":[{list:["none","disc","decimal",dn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[he]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[he]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ai(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Ul,Zc]}],"underline-offset":[{"underline-offset":["auto",Ul,dn]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ui()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",dn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",dn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[he]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...vi(),UN]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",VN]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},$N]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[Ie]}],"gradient-via-pos":[{via:[Ie]}],"gradient-to-pos":[{to:[Ie]}],"gradient-from":[{from:[Ee]}],"gradient-via":[{via:[Ee]}],"gradient-to":[{to:[Ee]}],rounded:[{rounded:[I]}],"rounded-s":[{"rounded-s":[I]}],"rounded-e":[{"rounded-e":[I]}],"rounded-t":[{"rounded-t":[I]}],"rounded-r":[{"rounded-r":[I]}],"rounded-b":[{"rounded-b":[I]}],"rounded-l":[{"rounded-l":[I]}],"rounded-ss":[{"rounded-ss":[I]}],"rounded-se":[{"rounded-se":[I]}],"rounded-ee":[{"rounded-ee":[I]}],"rounded-es":[{"rounded-es":[I]}],"rounded-tl":[{"rounded-tl":[I]}],"rounded-tr":[{"rounded-tr":[I]}],"rounded-br":[{"rounded-br":[I]}],"rounded-bl":[{"rounded-bl":[I]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[he]}],"border-style":[{border:[...ai(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[he]}],"divide-style":[{divide:ai()}],"border-color":[{border:[T]}],"border-color-x":[{"border-x":[T]}],"border-color-y":[{"border-y":[T]}],"border-color-s":[{"border-s":[T]}],"border-color-e":[{"border-e":[T]}],"border-color-t":[{"border-t":[T]}],"border-color-r":[{"border-r":[T]}],"border-color-b":[{"border-b":[T]}],"border-color-l":[{"border-l":[T]}],"divide-color":[{divide:[T]}],"outline-style":[{outline:["",...ai()]}],"outline-offset":[{"outline-offset":[Ul,dn]}],"outline-w":[{outline:[Ul,Zc]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:Pi()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[he]}],"ring-offset-w":[{"ring-offset":[Ul,Zc]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",Xc,HN]}],"shadow-color":[{shadow:[lg]}],opacity:[{opacity:[he]}],"mix-blend":[{"mix-blend":[...Vi(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Vi()}],filter:[{filter:["","none"]}],blur:[{blur:[p]}],brightness:[{brightness:[y]}],contrast:[{contrast:[j]}],"drop-shadow":[{"drop-shadow":["","none",Xc,dn]}],grayscale:[{grayscale:[W]}],"hue-rotate":[{"hue-rotate":[re]}],invert:[{invert:[te]}],saturate:[{saturate:[we]}],sepia:[{sepia:[tt]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[p]}],"backdrop-brightness":[{"backdrop-brightness":[y]}],"backdrop-contrast":[{"backdrop-contrast":[j]}],"backdrop-grayscale":[{"backdrop-grayscale":[W]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[re]}],"backdrop-invert":[{"backdrop-invert":[te]}],"backdrop-opacity":[{"backdrop-opacity":[he]}],"backdrop-saturate":[{"backdrop-saturate":[we]}],"backdrop-sepia":[{"backdrop-sepia":[tt]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[R]}],"border-spacing-x":[{"border-spacing-x":[R]}],"border-spacing-y":[{"border-spacing-y":[R]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",dn]}],duration:[{duration:ii()}],ease:[{ease:["linear","in","out","in-out",dn]}],delay:[{delay:ii()}],animate:[{animate:["none","spin","ping","pulse","bounce",dn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Ue]}],"scale-x":[{"scale-x":[Ue]}],"scale-y":[{"scale-y":[Ue]}],rotate:[{rotate:[ag,dn]}],"translate-x":[{"translate-x":[xt]}],"translate-y":[{"translate-y":[xt]}],"skew-x":[{"skew-x":[_t]}],"skew-y":[{"skew-y":[_t]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",dn]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",dn]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ui()}],"scroll-mx":[{"scroll-mx":ui()}],"scroll-my":[{"scroll-my":ui()}],"scroll-ms":[{"scroll-ms":ui()}],"scroll-me":[{"scroll-me":ui()}],"scroll-mt":[{"scroll-mt":ui()}],"scroll-mr":[{"scroll-mr":ui()}],"scroll-mb":[{"scroll-mb":ui()}],"scroll-ml":[{"scroll-ml":ui()}],"scroll-p":[{"scroll-p":ui()}],"scroll-px":[{"scroll-px":ui()}],"scroll-py":[{"scroll-py":ui()}],"scroll-ps":[{"scroll-ps":ui()}],"scroll-pe":[{"scroll-pe":ui()}],"scroll-pt":[{"scroll-pt":ui()}],"scroll-pr":[{"scroll-pr":ui()}],"scroll-pb":[{"scroll-pb":ui()}],"scroll-pl":[{"scroll-pl":ui()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",dn]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[Ul,Zc,Mb]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},YN=RN(XN);function Jn(...r){return YN(GR(r))}const KN=cN,KR=xe.forwardRef(({className:r,...l},p)=>ce.jsx(OR,{ref:p,className:Jn("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...l}));KR.displayName=OR.displayName;const QN=Hv("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),QR=xe.forwardRef(({className:r,variant:l,...p},y)=>ce.jsx(FR,{ref:y,className:Jn(QN({variant:l}),r),...p}));QR.displayName=FR.displayName;const JN=xe.forwardRef(({className:r,...l},p)=>ce.jsx(jR,{ref:p,className:Jn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",r),...l}));JN.displayName=jR.displayName;const JR=xe.forwardRef(({className:r,...l},p)=>ce.jsx(VR,{ref:p,className:Jn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...l,children:ce.jsx(yN,{className:"h-4 w-4"})}));JR.displayName=VR.displayName;const ez=xe.forwardRef(({className:r,...l},p)=>ce.jsx(BR,{ref:p,className:Jn("text-sm font-semibold",r),...l}));ez.displayName=BR.displayName;const tz=xe.forwardRef(({className:r,...l},p)=>ce.jsx(NR,{ref:p,className:Jn("text-sm opacity-90",r),...l}));tz.displayName=NR.displayName;function e5(){const{toasts:r}=bB();return ce.jsxs(KN,{children:[r.map(function({id:l,title:p,description:y,action:T,...I}){return ce.jsxs(QR,{...I,children:[ce.jsxs("div",{className:"grid gap-1",children:[p&&ce.jsx(ez,{children:p}),y&&ce.jsx(tz,{children:y})]}),T,ce.jsx(JR,{})]},l)}),ce.jsx(KR,{})]})}var xC=["light","dark"],t5="(prefers-color-scheme: dark)",i5=xe.createContext(void 0),n5={setTheme:r=>{},themes:[]},r5=()=>{var r;return(r=xe.useContext(i5))!=null?r:n5};xe.memo(({forcedTheme:r,storageKey:l,attribute:p,enableSystem:y,enableColorScheme:T,defaultTheme:I,value:R,attrs:o,nonce:j})=>{let W=I==="system",re=p==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${o.map(Ie=>`'${Ie}'`).join(",")})`};`:`var d=document.documentElement,n='${p}',s='setAttribute';`,te=T?xC.includes(I)&&I?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${I}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",Y=(Ie,me=!1,Pe=!0)=>{let he=R?R[Ie]:Ie,pe=me?Ie+"|| ''":`'${he}'`,we="";return T&&Pe&&!me&&xC.includes(Ie)&&(we+=`d.style.colorScheme = '${Ie}';`),p==="class"?me||he?we+=`c.add(${pe})`:we+="null":he&&(we+=`d[s](n,${pe})`),we},Ee=r?`!function(){${re}${Y(r)}}()`:y?`!function(){try{${re}var e=localStorage.getItem('${l}');if('system'===e||(!e&&${W})){var t='${t5}',m=window.matchMedia(t);if(m.media!==t||m.matches){${Y("dark")}}else{${Y("light")}}}else if(e){${R?`var x=${JSON.stringify(R)};`:""}${Y(R?"x[e]":"e",!0)}}${W?"":"else{"+Y(I,!1,!1)+"}"}${te}}catch(e){}}()`:`!function(){try{${re}var e=localStorage.getItem('${l}');if(e){${R?`var x=${JSON.stringify(R)};`:""}${Y(R?"x[e]":"e",!0)}}else{${Y(I,!1,!1)};}${te}}catch(t){}}();`;return xe.createElement("script",{nonce:j,dangerouslySetInnerHTML:{__html:Ee}})});var o5=r=>{switch(r){case"success":return l5;case"info":return u5;case"warning":return c5;case"error":return h5;default:return null}},s5=Array(12).fill(0),a5=({visible:r})=>ei.createElement("div",{className:"sonner-loading-wrapper","data-visible":r},ei.createElement("div",{className:"sonner-spinner"},s5.map((l,p)=>ei.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${p}`})))),l5=ei.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ei.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),c5=ei.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},ei.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),u5=ei.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ei.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),h5=ei.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ei.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),d5=()=>{let[r,l]=ei.useState(document.hidden);return ei.useEffect(()=>{let p=()=>{l(document.hidden)};return document.addEventListener("visibilitychange",p),()=>window.removeEventListener("visibilitychange",p)},[]),r},Ow=1,f5=class{constructor(){this.subscribe=r=>(this.subscribers.push(r),()=>{let l=this.subscribers.indexOf(r);this.subscribers.splice(l,1)}),this.publish=r=>{this.subscribers.forEach(l=>l(r))},this.addToast=r=>{this.publish(r),this.toasts=[...this.toasts,r]},this.create=r=>{var l;let{message:p,...y}=r,T=typeof(r==null?void 0:r.id)=="number"||((l=r.id)==null?void 0:l.length)>0?r.id:Ow++,I=this.toasts.find(o=>o.id===T),R=r.dismissible===void 0?!0:r.dismissible;return I?this.toasts=this.toasts.map(o=>o.id===T?(this.publish({...o,...r,id:T,title:p}),{...o,...r,id:T,dismissible:R,title:p}):o):this.addToast({title:p,...y,dismissible:R,id:T}),T},this.dismiss=r=>(r||this.toasts.forEach(l=>{this.subscribers.forEach(p=>p({id:l.id,dismiss:!0}))}),this.subscribers.forEach(l=>l({id:r,dismiss:!0})),r),this.message=(r,l)=>this.create({...l,message:r}),this.error=(r,l)=>this.create({...l,message:r,type:"error"}),this.success=(r,l)=>this.create({...l,type:"success",message:r}),this.info=(r,l)=>this.create({...l,type:"info",message:r}),this.warning=(r,l)=>this.create({...l,type:"warning",message:r}),this.loading=(r,l)=>this.create({...l,type:"loading",message:r}),this.promise=(r,l)=>{if(!l)return;let p;l.loading!==void 0&&(p=this.create({...l,promise:r,type:"loading",message:l.loading,description:typeof l.description!="function"?l.description:void 0}));let y=r instanceof Promise?r:r(),T=p!==void 0;return y.then(async I=>{if(m5(I)&&!I.ok){T=!1;let R=typeof l.error=="function"?await l.error(`HTTP error! status: ${I.status}`):l.error,o=typeof l.description=="function"?await l.description(`HTTP error! status: ${I.status}`):l.description;this.create({id:p,type:"error",message:R,description:o})}else if(l.success!==void 0){T=!1;let R=typeof l.success=="function"?await l.success(I):l.success,o=typeof l.description=="function"?await l.description(I):l.description;this.create({id:p,type:"success",message:R,description:o})}}).catch(async I=>{if(l.error!==void 0){T=!1;let R=typeof l.error=="function"?await l.error(I):l.error,o=typeof l.description=="function"?await l.description(I):l.description;this.create({id:p,type:"error",message:R,description:o})}}).finally(()=>{var I;T&&(this.dismiss(p),p=void 0),(I=l.finally)==null||I.call(l)}),p},this.custom=(r,l)=>{let p=(l==null?void 0:l.id)||Ow++;return this.create({jsx:r(p),id:p,...l}),p},this.subscribers=[],this.toasts=[]}},As=new f5,p5=(r,l)=>{let p=(l==null?void 0:l.id)||Ow++;return As.addToast({title:r,...l,id:p}),p},m5=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",g5=p5,_5=()=>As.toasts;Object.assign(g5,{success:As.success,info:As.info,warning:As.warning,error:As.error,custom:As.custom,message:As.message,promise:As.promise,dismiss:As.dismiss,loading:As.loading},{getHistory:_5});function y5(r,{insertAt:l}={}){if(typeof document>"u")return;let p=document.head||document.getElementsByTagName("head")[0],y=document.createElement("style");y.type="text/css",l==="top"&&p.firstChild?p.insertBefore(y,p.firstChild):p.appendChild(y),y.styleSheet?y.styleSheet.cssText=r:y.appendChild(document.createTextNode(r))}y5(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function E0(r){return r.label!==void 0}var v5=3,x5="32px",b5=4e3,w5=356,T5=14,S5=20,E5=200;function I5(...r){return r.filter(Boolean).join(" ")}var A5=r=>{var l,p,y,T,I,R,o,j,W,re;let{invert:te,toast:Y,unstyled:Ee,interacting:Ie,setHeights:me,visibleToasts:Pe,heights:he,index:pe,toasts:we,expanded:Ue,removeToast:tt,defaultRichColors:_t,closeButton:wt,style:xt,cancelButtonStyle:ci,actionButtonStyle:ti,className:ni="",descriptionClassName:ui="",duration:Pi,position:Vt,gap:vi,loadingIcon:ai,expandByDefault:Vi,classNames:ft,icons:$t,closeButtonAriaLabel:Gt="Close toast",pauseWhenPageIsHidden:ii,cn:Li}=r,[Ji,Vn]=ei.useState(!1),[$i,Ei]=ei.useState(!1),[xn,fo]=ei.useState(!1),[fn,po]=ei.useState(!1),[Oo,Ir]=ei.useState(0),[Tn,ea]=ei.useState(0),Wo=ei.useRef(null),ir=ei.useRef(null),Fo=pe===0,Zo=pe+1<=Pe,Bn=Y.type,Or=Y.dismissible!==!1,Fs=Y.className||"",hs=Y.descriptionClassName||"",Xo=ei.useMemo(()=>he.findIndex(oi=>oi.toastId===Y.id)||0,[he,Y.id]),$r=ei.useMemo(()=>{var oi;return(oi=Y.closeButton)!=null?oi:wt},[Y.closeButton,wt]),Jr=ei.useMemo(()=>Y.duration||Pi||b5,[Y.duration,Pi]),ta=ei.useRef(0),wo=ei.useRef(0),ia=ei.useRef(0),Hr=ei.useRef(null),[Yo,qr]=Vt.split("-"),Bs=ei.useMemo(()=>he.reduce((oi,Sn,Ln)=>Ln>=Xo?oi:oi+Sn.height,0),[he,Xo]),ds=d5(),Ko=Y.invert||te,fs=Bn==="loading";wo.current=ei.useMemo(()=>Xo*vi+Bs,[Xo,Bs]),ei.useEffect(()=>{Vn(!0)},[]),ei.useLayoutEffect(()=>{if(!Ji)return;let oi=ir.current,Sn=oi.style.height;oi.style.height="auto";let Ln=oi.getBoundingClientRect().height;oi.style.height=Sn,ea(Ln),me(ur=>ur.find(to=>to.toastId===Y.id)?ur.map(to=>to.toastId===Y.id?{...to,height:Ln}:to):[{toastId:Y.id,height:Ln,position:Y.position},...ur])},[Ji,Y.title,Y.description,me,Y.id]);let eo=ei.useCallback(()=>{Ei(!0),Ir(wo.current),me(oi=>oi.filter(Sn=>Sn.toastId!==Y.id)),setTimeout(()=>{tt(Y)},E5)},[Y,tt,me,wo]);ei.useEffect(()=>{if(Y.promise&&Bn==="loading"||Y.duration===1/0||Y.type==="loading")return;let oi,Sn=Jr;return Ue||Ie||ii&&ds?(()=>{if(ia.current<ta.current){let Ln=new Date().getTime()-ta.current;Sn=Sn-Ln}ia.current=new Date().getTime()})():Sn!==1/0&&(ta.current=new Date().getTime(),oi=setTimeout(()=>{var Ln;(Ln=Y.onAutoClose)==null||Ln.call(Y,Y),eo()},Sn)),()=>clearTimeout(oi)},[Ue,Ie,Vi,Y,Jr,eo,Y.promise,Bn,ii,ds]),ei.useEffect(()=>{let oi=ir.current;if(oi){let Sn=oi.getBoundingClientRect().height;return ea(Sn),me(Ln=>[{toastId:Y.id,height:Sn,position:Y.position},...Ln]),()=>me(Ln=>Ln.filter(ur=>ur.toastId!==Y.id))}},[me,Y.id]),ei.useEffect(()=>{Y.delete&&eo()},[eo,Y.delete]);function hl(){return $t!=null&&$t.loading?ei.createElement("div",{className:"sonner-loader","data-visible":Bn==="loading"},$t.loading):ai?ei.createElement("div",{className:"sonner-loader","data-visible":Bn==="loading"},ai):ei.createElement(a5,{visible:Bn==="loading"})}return ei.createElement("li",{"aria-live":Y.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:ir,className:Li(ni,Fs,ft==null?void 0:ft.toast,(l=Y==null?void 0:Y.classNames)==null?void 0:l.toast,ft==null?void 0:ft.default,ft==null?void 0:ft[Bn],(p=Y==null?void 0:Y.classNames)==null?void 0:p[Bn]),"data-sonner-toast":"","data-rich-colors":(y=Y.richColors)!=null?y:_t,"data-styled":!(Y.jsx||Y.unstyled||Ee),"data-mounted":Ji,"data-promise":!!Y.promise,"data-removed":$i,"data-visible":Zo,"data-y-position":Yo,"data-x-position":qr,"data-index":pe,"data-front":Fo,"data-swiping":xn,"data-dismissible":Or,"data-type":Bn,"data-invert":Ko,"data-swipe-out":fn,"data-expanded":!!(Ue||Vi&&Ji),style:{"--index":pe,"--toasts-before":pe,"--z-index":we.length-pe,"--offset":`${$i?Oo:wo.current}px`,"--initial-height":Vi?"auto":`${Tn}px`,...xt,...Y.style},onPointerDown:oi=>{fs||!Or||(Wo.current=new Date,Ir(wo.current),oi.target.setPointerCapture(oi.pointerId),oi.target.tagName!=="BUTTON"&&(fo(!0),Hr.current={x:oi.clientX,y:oi.clientY}))},onPointerUp:()=>{var oi,Sn,Ln,ur;if(fn||!Or)return;Hr.current=null;let to=Number(((oi=ir.current)==null?void 0:oi.style.getPropertyValue("--swipe-amount").replace("px",""))||0),na=new Date().getTime()-((Sn=Wo.current)==null?void 0:Sn.getTime()),dl=Math.abs(to)/na;if(Math.abs(to)>=S5||dl>.11){Ir(wo.current),(Ln=Y.onDismiss)==null||Ln.call(Y,Y),eo(),po(!0);return}(ur=ir.current)==null||ur.style.setProperty("--swipe-amount","0px"),fo(!1)},onPointerMove:oi=>{var Sn;if(!Hr.current||!Or)return;let Ln=oi.clientY-Hr.current.y,ur=oi.clientX-Hr.current.x,to=(Yo==="top"?Math.min:Math.max)(0,Ln),na=oi.pointerType==="touch"?10:2;Math.abs(to)>na?(Sn=ir.current)==null||Sn.style.setProperty("--swipe-amount",`${Ln}px`):Math.abs(ur)>na&&(Hr.current=null)}},$r&&!Y.jsx?ei.createElement("button",{"aria-label":Gt,"data-disabled":fs,"data-close-button":!0,onClick:fs||!Or?()=>{}:()=>{var oi;eo(),(oi=Y.onDismiss)==null||oi.call(Y,Y)},className:Li(ft==null?void 0:ft.closeButton,(T=Y==null?void 0:Y.classNames)==null?void 0:T.closeButton)},ei.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},ei.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),ei.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,Y.jsx||ei.isValidElement(Y.title)?Y.jsx||Y.title:ei.createElement(ei.Fragment,null,Bn||Y.icon||Y.promise?ei.createElement("div",{"data-icon":"",className:Li(ft==null?void 0:ft.icon,(I=Y==null?void 0:Y.classNames)==null?void 0:I.icon)},Y.promise||Y.type==="loading"&&!Y.icon?Y.icon||hl():null,Y.type!=="loading"?Y.icon||($t==null?void 0:$t[Bn])||o5(Bn):null):null,ei.createElement("div",{"data-content":"",className:Li(ft==null?void 0:ft.content,(R=Y==null?void 0:Y.classNames)==null?void 0:R.content)},ei.createElement("div",{"data-title":"",className:Li(ft==null?void 0:ft.title,(o=Y==null?void 0:Y.classNames)==null?void 0:o.title)},Y.title),Y.description?ei.createElement("div",{"data-description":"",className:Li(ui,hs,ft==null?void 0:ft.description,(j=Y==null?void 0:Y.classNames)==null?void 0:j.description)},Y.description):null),ei.isValidElement(Y.cancel)?Y.cancel:Y.cancel&&E0(Y.cancel)?ei.createElement("button",{"data-button":!0,"data-cancel":!0,style:Y.cancelButtonStyle||ci,onClick:oi=>{var Sn,Ln;E0(Y.cancel)&&Or&&((Ln=(Sn=Y.cancel).onClick)==null||Ln.call(Sn,oi),eo())},className:Li(ft==null?void 0:ft.cancelButton,(W=Y==null?void 0:Y.classNames)==null?void 0:W.cancelButton)},Y.cancel.label):null,ei.isValidElement(Y.action)?Y.action:Y.action&&E0(Y.action)?ei.createElement("button",{"data-button":!0,"data-action":!0,style:Y.actionButtonStyle||ti,onClick:oi=>{var Sn,Ln;E0(Y.action)&&(oi.defaultPrevented||((Ln=(Sn=Y.action).onClick)==null||Ln.call(Sn,oi),eo()))},className:Li(ft==null?void 0:ft.actionButton,(re=Y==null?void 0:Y.classNames)==null?void 0:re.actionButton)},Y.action.label):null))};function bC(){if(typeof window>"u"||typeof document>"u")return"ltr";let r=document.documentElement.getAttribute("dir");return r==="auto"||!r?window.getComputedStyle(document.documentElement).direction:r}var C5=r=>{let{invert:l,position:p="bottom-right",hotkey:y=["altKey","KeyT"],expand:T,closeButton:I,className:R,offset:o,theme:j="light",richColors:W,duration:re,style:te,visibleToasts:Y=v5,toastOptions:Ee,dir:Ie=bC(),gap:me=T5,loadingIcon:Pe,icons:he,containerAriaLabel:pe="Notifications",pauseWhenPageIsHidden:we,cn:Ue=I5}=r,[tt,_t]=ei.useState([]),wt=ei.useMemo(()=>Array.from(new Set([p].concat(tt.filter(ii=>ii.position).map(ii=>ii.position)))),[tt,p]),[xt,ci]=ei.useState([]),[ti,ni]=ei.useState(!1),[ui,Pi]=ei.useState(!1),[Vt,vi]=ei.useState(j!=="system"?j:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),ai=ei.useRef(null),Vi=y.join("+").replace(/Key/g,"").replace(/Digit/g,""),ft=ei.useRef(null),$t=ei.useRef(!1),Gt=ei.useCallback(ii=>{var Li;(Li=tt.find(Ji=>Ji.id===ii.id))!=null&&Li.delete||As.dismiss(ii.id),_t(Ji=>Ji.filter(({id:Vn})=>Vn!==ii.id))},[tt]);return ei.useEffect(()=>As.subscribe(ii=>{if(ii.dismiss){_t(Li=>Li.map(Ji=>Ji.id===ii.id?{...Ji,delete:!0}:Ji));return}setTimeout(()=>{fR.flushSync(()=>{_t(Li=>{let Ji=Li.findIndex(Vn=>Vn.id===ii.id);return Ji!==-1?[...Li.slice(0,Ji),{...Li[Ji],...ii},...Li.slice(Ji+1)]:[ii,...Li]})})})}),[]),ei.useEffect(()=>{if(j!=="system"){vi(j);return}j==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?vi("dark"):vi("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:ii})=>{vi(ii?"dark":"light")})},[j]),ei.useEffect(()=>{tt.length<=1&&ni(!1)},[tt]),ei.useEffect(()=>{let ii=Li=>{var Ji,Vn;y.every($i=>Li[$i]||Li.code===$i)&&(ni(!0),(Ji=ai.current)==null||Ji.focus()),Li.code==="Escape"&&(document.activeElement===ai.current||(Vn=ai.current)!=null&&Vn.contains(document.activeElement))&&ni(!1)};return document.addEventListener("keydown",ii),()=>document.removeEventListener("keydown",ii)},[y]),ei.useEffect(()=>{if(ai.current)return()=>{ft.current&&(ft.current.focus({preventScroll:!0}),ft.current=null,$t.current=!1)}},[ai.current]),tt.length?ei.createElement("section",{"aria-label":`${pe} ${Vi}`,tabIndex:-1},wt.map((ii,Li)=>{var Ji;let[Vn,$i]=ii.split("-");return ei.createElement("ol",{key:ii,dir:Ie==="auto"?bC():Ie,tabIndex:-1,ref:ai,className:R,"data-sonner-toaster":!0,"data-theme":Vt,"data-y-position":Vn,"data-x-position":$i,style:{"--front-toast-height":`${((Ji=xt[0])==null?void 0:Ji.height)||0}px`,"--offset":typeof o=="number"?`${o}px`:o||x5,"--width":`${w5}px`,"--gap":`${me}px`,...te},onBlur:Ei=>{$t.current&&!Ei.currentTarget.contains(Ei.relatedTarget)&&($t.current=!1,ft.current&&(ft.current.focus({preventScroll:!0}),ft.current=null))},onFocus:Ei=>{Ei.target instanceof HTMLElement&&Ei.target.dataset.dismissible==="false"||$t.current||($t.current=!0,ft.current=Ei.relatedTarget)},onMouseEnter:()=>ni(!0),onMouseMove:()=>ni(!0),onMouseLeave:()=>{ui||ni(!1)},onPointerDown:Ei=>{Ei.target instanceof HTMLElement&&Ei.target.dataset.dismissible==="false"||Pi(!0)},onPointerUp:()=>Pi(!1)},tt.filter(Ei=>!Ei.position&&Li===0||Ei.position===ii).map((Ei,xn)=>{var fo,fn;return ei.createElement(A5,{key:Ei.id,icons:he,index:xn,toast:Ei,defaultRichColors:W,duration:(fo=Ee==null?void 0:Ee.duration)!=null?fo:re,className:Ee==null?void 0:Ee.className,descriptionClassName:Ee==null?void 0:Ee.descriptionClassName,invert:l,visibleToasts:Y,closeButton:(fn=Ee==null?void 0:Ee.closeButton)!=null?fn:I,interacting:ui,position:ii,style:Ee==null?void 0:Ee.style,unstyled:Ee==null?void 0:Ee.unstyled,classNames:Ee==null?void 0:Ee.classNames,cancelButtonStyle:Ee==null?void 0:Ee.cancelButtonStyle,actionButtonStyle:Ee==null?void 0:Ee.actionButtonStyle,removeToast:Gt,toasts:tt.filter(po=>po.position==Ei.position),heights:xt.filter(po=>po.position==Ei.position),setHeights:ci,expandByDefault:T,gap:me,loadingIcon:Pe,expanded:ti,pauseWhenPageIsHidden:we,cn:Ue})}))})):null};const M5=({...r})=>{const{theme:l="system"}=r5();return ce.jsx(C5,{theme:l,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})};var P5=uM.useId||(()=>{}),R5=0;function iz(r){const[l,p]=xe.useState(P5());return xu(()=>{r||p(y=>y??String(R5++))},[r]),r||(l?`radix-${l}`:"")}const z5=["top","right","bottom","left"],bu=Math.min,Ms=Math.max,gv=Math.round,I0=Math.floor,wu=r=>({x:r,y:r}),D5={left:"right",right:"left",bottom:"top",top:"bottom"},L5={start:"end",end:"start"};function Fw(r,l,p){return Ms(r,bu(l,p))}function Jl(r,l){return typeof r=="function"?r(l):r}function ec(r){return r.split("-")[0]}function sp(r){return r.split("-")[1]}function XT(r){return r==="x"?"y":"x"}function YT(r){return r==="y"?"height":"width"}function Tu(r){return["top","bottom"].includes(ec(r))?"y":"x"}function KT(r){return XT(Tu(r))}function k5(r,l,p){p===void 0&&(p=!1);const y=sp(r),T=KT(r),I=YT(T);let R=T==="x"?y===(p?"end":"start")?"right":"left":y==="start"?"bottom":"top";return l.reference[I]>l.floating[I]&&(R=_v(R)),[R,_v(R)]}function O5(r){const l=_v(r);return[Bw(r),l,Bw(l)]}function Bw(r){return r.replace(/start|end/g,l=>L5[l])}function F5(r,l,p){const y=["left","right"],T=["right","left"],I=["top","bottom"],R=["bottom","top"];switch(r){case"top":case"bottom":return p?l?T:y:l?y:T;case"left":case"right":return l?I:R;default:return[]}}function B5(r,l,p,y){const T=sp(r);let I=F5(ec(r),p==="start",y);return T&&(I=I.map(R=>R+"-"+T),l&&(I=I.concat(I.map(Bw)))),I}function _v(r){return r.replace(/left|right|bottom|top/g,l=>D5[l])}function N5(r){return{top:0,right:0,bottom:0,left:0,...r}}function nz(r){return typeof r!="number"?N5(r):{top:r,right:r,bottom:r,left:r}}function yv(r){const{x:l,y:p,width:y,height:T}=r;return{width:y,height:T,top:p,left:l,right:l+y,bottom:p+T,x:l,y:p}}function wC(r,l,p){let{reference:y,floating:T}=r;const I=Tu(l),R=KT(l),o=YT(R),j=ec(l),W=I==="y",re=y.x+y.width/2-T.width/2,te=y.y+y.height/2-T.height/2,Y=y[o]/2-T[o]/2;let Ee;switch(j){case"top":Ee={x:re,y:y.y-T.height};break;case"bottom":Ee={x:re,y:y.y+y.height};break;case"right":Ee={x:y.x+y.width,y:te};break;case"left":Ee={x:y.x-T.width,y:te};break;default:Ee={x:y.x,y:y.y}}switch(sp(l)){case"start":Ee[R]-=Y*(p&&W?-1:1);break;case"end":Ee[R]+=Y*(p&&W?-1:1);break}return Ee}const j5=async(r,l,p)=>{const{placement:y="bottom",strategy:T="absolute",middleware:I=[],platform:R}=p,o=I.filter(Boolean),j=await(R.isRTL==null?void 0:R.isRTL(l));let W=await R.getElementRects({reference:r,floating:l,strategy:T}),{x:re,y:te}=wC(W,y,j),Y=y,Ee={},Ie=0;for(let me=0;me<o.length;me++){const{name:Pe,fn:he}=o[me],{x:pe,y:we,data:Ue,reset:tt}=await he({x:re,y:te,initialPlacement:y,placement:Y,strategy:T,middlewareData:Ee,rects:W,platform:R,elements:{reference:r,floating:l}});re=pe??re,te=we??te,Ee={...Ee,[Pe]:{...Ee[Pe],...Ue}},tt&&Ie<=50&&(Ie++,typeof tt=="object"&&(tt.placement&&(Y=tt.placement),tt.rects&&(W=tt.rects===!0?await R.getElementRects({reference:r,floating:l,strategy:T}):tt.rects),{x:re,y:te}=wC(W,Y,j)),me=-1)}return{x:re,y:te,placement:Y,strategy:T,middlewareData:Ee}};async function Gg(r,l){var p;l===void 0&&(l={});const{x:y,y:T,platform:I,rects:R,elements:o,strategy:j}=r,{boundary:W="clippingAncestors",rootBoundary:re="viewport",elementContext:te="floating",altBoundary:Y=!1,padding:Ee=0}=Jl(l,r),Ie=nz(Ee),Pe=o[Y?te==="floating"?"reference":"floating":te],he=yv(await I.getClippingRect({element:(p=await(I.isElement==null?void 0:I.isElement(Pe)))==null||p?Pe:Pe.contextElement||await(I.getDocumentElement==null?void 0:I.getDocumentElement(o.floating)),boundary:W,rootBoundary:re,strategy:j})),pe=te==="floating"?{x:y,y:T,width:R.floating.width,height:R.floating.height}:R.reference,we=await(I.getOffsetParent==null?void 0:I.getOffsetParent(o.floating)),Ue=await(I.isElement==null?void 0:I.isElement(we))?await(I.getScale==null?void 0:I.getScale(we))||{x:1,y:1}:{x:1,y:1},tt=yv(I.convertOffsetParentRelativeRectToViewportRelativeRect?await I.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:pe,offsetParent:we,strategy:j}):pe);return{top:(he.top-tt.top+Ie.top)/Ue.y,bottom:(tt.bottom-he.bottom+Ie.bottom)/Ue.y,left:(he.left-tt.left+Ie.left)/Ue.x,right:(tt.right-he.right+Ie.right)/Ue.x}}const V5=r=>({name:"arrow",options:r,async fn(l){const{x:p,y,placement:T,rects:I,platform:R,elements:o,middlewareData:j}=l,{element:W,padding:re=0}=Jl(r,l)||{};if(W==null)return{};const te=nz(re),Y={x:p,y},Ee=KT(T),Ie=YT(Ee),me=await R.getDimensions(W),Pe=Ee==="y",he=Pe?"top":"left",pe=Pe?"bottom":"right",we=Pe?"clientHeight":"clientWidth",Ue=I.reference[Ie]+I.reference[Ee]-Y[Ee]-I.floating[Ie],tt=Y[Ee]-I.reference[Ee],_t=await(R.getOffsetParent==null?void 0:R.getOffsetParent(W));let wt=_t?_t[we]:0;(!wt||!await(R.isElement==null?void 0:R.isElement(_t)))&&(wt=o.floating[we]||I.floating[Ie]);const xt=Ue/2-tt/2,ci=wt/2-me[Ie]/2-1,ti=bu(te[he],ci),ni=bu(te[pe],ci),ui=ti,Pi=wt-me[Ie]-ni,Vt=wt/2-me[Ie]/2+xt,vi=Fw(ui,Vt,Pi),ai=!j.arrow&&sp(T)!=null&&Vt!==vi&&I.reference[Ie]/2-(Vt<ui?ti:ni)-me[Ie]/2<0,Vi=ai?Vt<ui?Vt-ui:Vt-Pi:0;return{[Ee]:Y[Ee]+Vi,data:{[Ee]:vi,centerOffset:Vt-vi-Vi,...ai&&{alignmentOffset:Vi}},reset:ai}}}),U5=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(l){var p,y;const{placement:T,middlewareData:I,rects:R,initialPlacement:o,platform:j,elements:W}=l,{mainAxis:re=!0,crossAxis:te=!0,fallbackPlacements:Y,fallbackStrategy:Ee="bestFit",fallbackAxisSideDirection:Ie="none",flipAlignment:me=!0,...Pe}=Jl(r,l);if((p=I.arrow)!=null&&p.alignmentOffset)return{};const he=ec(T),pe=Tu(o),we=ec(o)===o,Ue=await(j.isRTL==null?void 0:j.isRTL(W.floating)),tt=Y||(we||!me?[_v(o)]:O5(o)),_t=Ie!=="none";!Y&&_t&&tt.push(...B5(o,me,Ie,Ue));const wt=[o,...tt],xt=await Gg(l,Pe),ci=[];let ti=((y=I.flip)==null?void 0:y.overflows)||[];if(re&&ci.push(xt[he]),te){const Vt=k5(T,R,Ue);ci.push(xt[Vt[0]],xt[Vt[1]])}if(ti=[...ti,{placement:T,overflows:ci}],!ci.every(Vt=>Vt<=0)){var ni,ui;const Vt=(((ni=I.flip)==null?void 0:ni.index)||0)+1,vi=wt[Vt];if(vi)return{data:{index:Vt,overflows:ti},reset:{placement:vi}};let ai=(ui=ti.filter(Vi=>Vi.overflows[0]<=0).sort((Vi,ft)=>Vi.overflows[1]-ft.overflows[1])[0])==null?void 0:ui.placement;if(!ai)switch(Ee){case"bestFit":{var Pi;const Vi=(Pi=ti.filter(ft=>{if(_t){const $t=Tu(ft.placement);return $t===pe||$t==="y"}return!0}).map(ft=>[ft.placement,ft.overflows.filter($t=>$t>0).reduce(($t,Gt)=>$t+Gt,0)]).sort((ft,$t)=>ft[1]-$t[1])[0])==null?void 0:Pi[0];Vi&&(ai=Vi);break}case"initialPlacement":ai=o;break}if(T!==ai)return{reset:{placement:ai}}}return{}}}};function TC(r,l){return{top:r.top-l.height,right:r.right-l.width,bottom:r.bottom-l.height,left:r.left-l.width}}function SC(r){return z5.some(l=>r[l]>=0)}const G5=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(l){const{rects:p}=l,{strategy:y="referenceHidden",...T}=Jl(r,l);switch(y){case"referenceHidden":{const I=await Gg(l,{...T,elementContext:"reference"}),R=TC(I,p.reference);return{data:{referenceHiddenOffsets:R,referenceHidden:SC(R)}}}case"escaped":{const I=await Gg(l,{...T,altBoundary:!0}),R=TC(I,p.floating);return{data:{escapedOffsets:R,escaped:SC(R)}}}default:return{}}}}};async function $5(r,l){const{placement:p,platform:y,elements:T}=r,I=await(y.isRTL==null?void 0:y.isRTL(T.floating)),R=ec(p),o=sp(p),j=Tu(p)==="y",W=["left","top"].includes(R)?-1:1,re=I&&j?-1:1,te=Jl(l,r);let{mainAxis:Y,crossAxis:Ee,alignmentAxis:Ie}=typeof te=="number"?{mainAxis:te,crossAxis:0,alignmentAxis:null}:{mainAxis:te.mainAxis||0,crossAxis:te.crossAxis||0,alignmentAxis:te.alignmentAxis};return o&&typeof Ie=="number"&&(Ee=o==="end"?Ie*-1:Ie),j?{x:Ee*re,y:Y*W}:{x:Y*W,y:Ee*re}}const H5=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(l){var p,y;const{x:T,y:I,placement:R,middlewareData:o}=l,j=await $5(l,r);return R===((p=o.offset)==null?void 0:p.placement)&&(y=o.arrow)!=null&&y.alignmentOffset?{}:{x:T+j.x,y:I+j.y,data:{...j,placement:R}}}}},q5=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(l){const{x:p,y,placement:T}=l,{mainAxis:I=!0,crossAxis:R=!1,limiter:o={fn:Pe=>{let{x:he,y:pe}=Pe;return{x:he,y:pe}}},...j}=Jl(r,l),W={x:p,y},re=await Gg(l,j),te=Tu(ec(T)),Y=XT(te);let Ee=W[Y],Ie=W[te];if(I){const Pe=Y==="y"?"top":"left",he=Y==="y"?"bottom":"right",pe=Ee+re[Pe],we=Ee-re[he];Ee=Fw(pe,Ee,we)}if(R){const Pe=te==="y"?"top":"left",he=te==="y"?"bottom":"right",pe=Ie+re[Pe],we=Ie-re[he];Ie=Fw(pe,Ie,we)}const me=o.fn({...l,[Y]:Ee,[te]:Ie});return{...me,data:{x:me.x-p,y:me.y-y,enabled:{[Y]:I,[te]:R}}}}}},W5=function(r){return r===void 0&&(r={}),{options:r,fn(l){const{x:p,y,placement:T,rects:I,middlewareData:R}=l,{offset:o=0,mainAxis:j=!0,crossAxis:W=!0}=Jl(r,l),re={x:p,y},te=Tu(T),Y=XT(te);let Ee=re[Y],Ie=re[te];const me=Jl(o,l),Pe=typeof me=="number"?{mainAxis:me,crossAxis:0}:{mainAxis:0,crossAxis:0,...me};if(j){const we=Y==="y"?"height":"width",Ue=I.reference[Y]-I.floating[we]+Pe.mainAxis,tt=I.reference[Y]+I.reference[we]-Pe.mainAxis;Ee<Ue?Ee=Ue:Ee>tt&&(Ee=tt)}if(W){var he,pe;const we=Y==="y"?"width":"height",Ue=["top","left"].includes(ec(T)),tt=I.reference[te]-I.floating[we]+(Ue&&((he=R.offset)==null?void 0:he[te])||0)+(Ue?0:Pe.crossAxis),_t=I.reference[te]+I.reference[we]+(Ue?0:((pe=R.offset)==null?void 0:pe[te])||0)-(Ue?Pe.crossAxis:0);Ie<tt?Ie=tt:Ie>_t&&(Ie=_t)}return{[Y]:Ee,[te]:Ie}}}},Z5=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(l){var p,y;const{placement:T,rects:I,platform:R,elements:o}=l,{apply:j=()=>{},...W}=Jl(r,l),re=await Gg(l,W),te=ec(T),Y=sp(T),Ee=Tu(T)==="y",{width:Ie,height:me}=I.floating;let Pe,he;te==="top"||te==="bottom"?(Pe=te,he=Y===(await(R.isRTL==null?void 0:R.isRTL(o.floating))?"start":"end")?"left":"right"):(he=te,Pe=Y==="end"?"top":"bottom");const pe=me-re.top-re.bottom,we=Ie-re.left-re.right,Ue=bu(me-re[Pe],pe),tt=bu(Ie-re[he],we),_t=!l.middlewareData.shift;let wt=Ue,xt=tt;if((p=l.middlewareData.shift)!=null&&p.enabled.x&&(xt=we),(y=l.middlewareData.shift)!=null&&y.enabled.y&&(wt=pe),_t&&!Y){const ti=Ms(re.left,0),ni=Ms(re.right,0),ui=Ms(re.top,0),Pi=Ms(re.bottom,0);Ee?xt=Ie-2*(ti!==0||ni!==0?ti+ni:Ms(re.left,re.right)):wt=me-2*(ui!==0||Pi!==0?ui+Pi:Ms(re.top,re.bottom))}await j({...l,availableWidth:xt,availableHeight:wt});const ci=await R.getDimensions(o.floating);return Ie!==ci.width||me!==ci.height?{reset:{rects:!0}}:{}}}};function qv(){return typeof window<"u"}function ap(r){return rz(r)?(r.nodeName||"").toLowerCase():"#document"}function zs(r){var l;return(r==null||(l=r.ownerDocument)==null?void 0:l.defaultView)||window}function ul(r){var l;return(l=(rz(r)?r.ownerDocument:r.document)||window.document)==null?void 0:l.documentElement}function rz(r){return qv()?r instanceof Node||r instanceof zs(r).Node:!1}function Pa(r){return qv()?r instanceof Element||r instanceof zs(r).Element:!1}function ll(r){return qv()?r instanceof HTMLElement||r instanceof zs(r).HTMLElement:!1}function EC(r){return!qv()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof zs(r).ShadowRoot}function r_(r){const{overflow:l,overflowX:p,overflowY:y,display:T}=Ra(r);return/auto|scroll|overlay|hidden|clip/.test(l+y+p)&&!["inline","contents"].includes(T)}function X5(r){return["table","td","th"].includes(ap(r))}function Wv(r){return[":popover-open",":modal"].some(l=>{try{return r.matches(l)}catch{return!1}})}function QT(r){const l=JT(),p=Pa(r)?Ra(r):r;return p.transform!=="none"||p.perspective!=="none"||(p.containerType?p.containerType!=="normal":!1)||!l&&(p.backdropFilter?p.backdropFilter!=="none":!1)||!l&&(p.filter?p.filter!=="none":!1)||["transform","perspective","filter"].some(y=>(p.willChange||"").includes(y))||["paint","layout","strict","content"].some(y=>(p.contain||"").includes(y))}function Y5(r){let l=Su(r);for(;ll(l)&&!ep(l);){if(QT(l))return l;if(Wv(l))return null;l=Su(l)}return null}function JT(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ep(r){return["html","body","#document"].includes(ap(r))}function Ra(r){return zs(r).getComputedStyle(r)}function Zv(r){return Pa(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function Su(r){if(ap(r)==="html")return r;const l=r.assignedSlot||r.parentNode||EC(r)&&r.host||ul(r);return EC(l)?l.host:l}function oz(r){const l=Su(r);return ep(l)?r.ownerDocument?r.ownerDocument.body:r.body:ll(l)&&r_(l)?l:oz(l)}function $g(r,l,p){var y;l===void 0&&(l=[]),p===void 0&&(p=!0);const T=oz(r),I=T===((y=r.ownerDocument)==null?void 0:y.body),R=zs(T);if(I){const o=Nw(R);return l.concat(R,R.visualViewport||[],r_(T)?T:[],o&&p?$g(o):[])}return l.concat(T,$g(T,[],p))}function Nw(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function sz(r){const l=Ra(r);let p=parseFloat(l.width)||0,y=parseFloat(l.height)||0;const T=ll(r),I=T?r.offsetWidth:p,R=T?r.offsetHeight:y,o=gv(p)!==I||gv(y)!==R;return o&&(p=I,y=R),{width:p,height:y,$:o}}function e2(r){return Pa(r)?r:r.contextElement}function Ff(r){const l=e2(r);if(!ll(l))return wu(1);const p=l.getBoundingClientRect(),{width:y,height:T,$:I}=sz(l);let R=(I?gv(p.width):p.width)/y,o=(I?gv(p.height):p.height)/T;return(!R||!Number.isFinite(R))&&(R=1),(!o||!Number.isFinite(o))&&(o=1),{x:R,y:o}}const K5=wu(0);function az(r){const l=zs(r);return!JT()||!l.visualViewport?K5:{x:l.visualViewport.offsetLeft,y:l.visualViewport.offsetTop}}function Q5(r,l,p){return l===void 0&&(l=!1),!p||l&&p!==zs(r)?!1:l}function qh(r,l,p,y){l===void 0&&(l=!1),p===void 0&&(p=!1);const T=r.getBoundingClientRect(),I=e2(r);let R=wu(1);l&&(y?Pa(y)&&(R=Ff(y)):R=Ff(r));const o=Q5(I,p,y)?az(I):wu(0);let j=(T.left+o.x)/R.x,W=(T.top+o.y)/R.y,re=T.width/R.x,te=T.height/R.y;if(I){const Y=zs(I),Ee=y&&Pa(y)?zs(y):y;let Ie=Y,me=Nw(Ie);for(;me&&y&&Ee!==Ie;){const Pe=Ff(me),he=me.getBoundingClientRect(),pe=Ra(me),we=he.left+(me.clientLeft+parseFloat(pe.paddingLeft))*Pe.x,Ue=he.top+(me.clientTop+parseFloat(pe.paddingTop))*Pe.y;j*=Pe.x,W*=Pe.y,re*=Pe.x,te*=Pe.y,j+=we,W+=Ue,Ie=zs(me),me=Nw(Ie)}}return yv({width:re,height:te,x:j,y:W})}function J5(r){let{elements:l,rect:p,offsetParent:y,strategy:T}=r;const I=T==="fixed",R=ul(y),o=l?Wv(l.floating):!1;if(y===R||o&&I)return p;let j={scrollLeft:0,scrollTop:0},W=wu(1);const re=wu(0),te=ll(y);if((te||!te&&!I)&&((ap(y)!=="body"||r_(R))&&(j=Zv(y)),ll(y))){const Y=qh(y);W=Ff(y),re.x=Y.x+y.clientLeft,re.y=Y.y+y.clientTop}return{width:p.width*W.x,height:p.height*W.y,x:p.x*W.x-j.scrollLeft*W.x+re.x,y:p.y*W.y-j.scrollTop*W.y+re.y}}function e4(r){return Array.from(r.getClientRects())}function jw(r,l){const p=Zv(r).scrollLeft;return l?l.left+p:qh(ul(r)).left+p}function t4(r){const l=ul(r),p=Zv(r),y=r.ownerDocument.body,T=Ms(l.scrollWidth,l.clientWidth,y.scrollWidth,y.clientWidth),I=Ms(l.scrollHeight,l.clientHeight,y.scrollHeight,y.clientHeight);let R=-p.scrollLeft+jw(r);const o=-p.scrollTop;return Ra(y).direction==="rtl"&&(R+=Ms(l.clientWidth,y.clientWidth)-T),{width:T,height:I,x:R,y:o}}function i4(r,l){const p=zs(r),y=ul(r),T=p.visualViewport;let I=y.clientWidth,R=y.clientHeight,o=0,j=0;if(T){I=T.width,R=T.height;const W=JT();(!W||W&&l==="fixed")&&(o=T.offsetLeft,j=T.offsetTop)}return{width:I,height:R,x:o,y:j}}function n4(r,l){const p=qh(r,!0,l==="fixed"),y=p.top+r.clientTop,T=p.left+r.clientLeft,I=ll(r)?Ff(r):wu(1),R=r.clientWidth*I.x,o=r.clientHeight*I.y,j=T*I.x,W=y*I.y;return{width:R,height:o,x:j,y:W}}function IC(r,l,p){let y;if(l==="viewport")y=i4(r,p);else if(l==="document")y=t4(ul(r));else if(Pa(l))y=n4(l,p);else{const T=az(r);y={...l,x:l.x-T.x,y:l.y-T.y}}return yv(y)}function lz(r,l){const p=Su(r);return p===l||!Pa(p)||ep(p)?!1:Ra(p).position==="fixed"||lz(p,l)}function r4(r,l){const p=l.get(r);if(p)return p;let y=$g(r,[],!1).filter(o=>Pa(o)&&ap(o)!=="body"),T=null;const I=Ra(r).position==="fixed";let R=I?Su(r):r;for(;Pa(R)&&!ep(R);){const o=Ra(R),j=QT(R);!j&&o.position==="fixed"&&(T=null),(I?!j&&!T:!j&&o.position==="static"&&!!T&&["absolute","fixed"].includes(T.position)||r_(R)&&!j&&lz(r,R))?y=y.filter(re=>re!==R):T=o,R=Su(R)}return l.set(r,y),y}function o4(r){let{element:l,boundary:p,rootBoundary:y,strategy:T}=r;const R=[...p==="clippingAncestors"?Wv(l)?[]:r4(l,this._c):[].concat(p),y],o=R[0],j=R.reduce((W,re)=>{const te=IC(l,re,T);return W.top=Ms(te.top,W.top),W.right=bu(te.right,W.right),W.bottom=bu(te.bottom,W.bottom),W.left=Ms(te.left,W.left),W},IC(l,o,T));return{width:j.right-j.left,height:j.bottom-j.top,x:j.left,y:j.top}}function s4(r){const{width:l,height:p}=sz(r);return{width:l,height:p}}function a4(r,l,p){const y=ll(l),T=ul(l),I=p==="fixed",R=qh(r,!0,I,l);let o={scrollLeft:0,scrollTop:0};const j=wu(0);if(y||!y&&!I)if((ap(l)!=="body"||r_(T))&&(o=Zv(l)),y){const Ee=qh(l,!0,I,l);j.x=Ee.x+l.clientLeft,j.y=Ee.y+l.clientTop}else T&&(j.x=jw(T));let W=0,re=0;if(T&&!y&&!I){const Ee=T.getBoundingClientRect();re=Ee.top+o.scrollTop,W=Ee.left+o.scrollLeft-jw(T,Ee)}const te=R.left+o.scrollLeft-j.x-W,Y=R.top+o.scrollTop-j.y-re;return{x:te,y:Y,width:R.width,height:R.height}}function Pb(r){return Ra(r).position==="static"}function AC(r,l){if(!ll(r)||Ra(r).position==="fixed")return null;if(l)return l(r);let p=r.offsetParent;return ul(r)===p&&(p=p.ownerDocument.body),p}function cz(r,l){const p=zs(r);if(Wv(r))return p;if(!ll(r)){let T=Su(r);for(;T&&!ep(T);){if(Pa(T)&&!Pb(T))return T;T=Su(T)}return p}let y=AC(r,l);for(;y&&X5(y)&&Pb(y);)y=AC(y,l);return y&&ep(y)&&Pb(y)&&!QT(y)?p:y||Y5(r)||p}const l4=async function(r){const l=this.getOffsetParent||cz,p=this.getDimensions,y=await p(r.floating);return{reference:a4(r.reference,await l(r.floating),r.strategy),floating:{x:0,y:0,width:y.width,height:y.height}}};function c4(r){return Ra(r).direction==="rtl"}const u4={convertOffsetParentRelativeRectToViewportRelativeRect:J5,getDocumentElement:ul,getClippingRect:o4,getOffsetParent:cz,getElementRects:l4,getClientRects:e4,getDimensions:s4,getScale:Ff,isElement:Pa,isRTL:c4};function h4(r,l){let p=null,y;const T=ul(r);function I(){var o;clearTimeout(y),(o=p)==null||o.disconnect(),p=null}function R(o,j){o===void 0&&(o=!1),j===void 0&&(j=1),I();const{left:W,top:re,width:te,height:Y}=r.getBoundingClientRect();if(o||l(),!te||!Y)return;const Ee=I0(re),Ie=I0(T.clientWidth-(W+te)),me=I0(T.clientHeight-(re+Y)),Pe=I0(W),pe={rootMargin:-Ee+"px "+-Ie+"px "+-me+"px "+-Pe+"px",threshold:Ms(0,bu(1,j))||1};let we=!0;function Ue(tt){const _t=tt[0].intersectionRatio;if(_t!==j){if(!we)return R();_t?R(!1,_t):y=setTimeout(()=>{R(!1,1e-7)},1e3)}we=!1}try{p=new IntersectionObserver(Ue,{...pe,root:T.ownerDocument})}catch{p=new IntersectionObserver(Ue,pe)}p.observe(r)}return R(!0),I}function d4(r,l,p,y){y===void 0&&(y={});const{ancestorScroll:T=!0,ancestorResize:I=!0,elementResize:R=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:j=!1}=y,W=e2(r),re=T||I?[...W?$g(W):[],...$g(l)]:[];re.forEach(he=>{T&&he.addEventListener("scroll",p,{passive:!0}),I&&he.addEventListener("resize",p)});const te=W&&o?h4(W,p):null;let Y=-1,Ee=null;R&&(Ee=new ResizeObserver(he=>{let[pe]=he;pe&&pe.target===W&&Ee&&(Ee.unobserve(l),cancelAnimationFrame(Y),Y=requestAnimationFrame(()=>{var we;(we=Ee)==null||we.observe(l)})),p()}),W&&!j&&Ee.observe(W),Ee.observe(l));let Ie,me=j?qh(r):null;j&&Pe();function Pe(){const he=qh(r);me&&(he.x!==me.x||he.y!==me.y||he.width!==me.width||he.height!==me.height)&&p(),me=he,Ie=requestAnimationFrame(Pe)}return p(),()=>{var he;re.forEach(pe=>{T&&pe.removeEventListener("scroll",p),I&&pe.removeEventListener("resize",p)}),te==null||te(),(he=Ee)==null||he.disconnect(),Ee=null,j&&cancelAnimationFrame(Ie)}}const f4=H5,p4=q5,m4=U5,g4=Z5,_4=G5,CC=V5,y4=W5,v4=(r,l,p)=>{const y=new Map,T={platform:u4,...p},I={...T.platform,_c:y};return j5(r,l,{...T,platform:I})};var G0=typeof document<"u"?xe.useLayoutEffect:xe.useEffect;function vv(r,l){if(r===l)return!0;if(typeof r!=typeof l)return!1;if(typeof r=="function"&&r.toString()===l.toString())return!0;let p,y,T;if(r&&l&&typeof r=="object"){if(Array.isArray(r)){if(p=r.length,p!==l.length)return!1;for(y=p;y--!==0;)if(!vv(r[y],l[y]))return!1;return!0}if(T=Object.keys(r),p=T.length,p!==Object.keys(l).length)return!1;for(y=p;y--!==0;)if(!{}.hasOwnProperty.call(l,T[y]))return!1;for(y=p;y--!==0;){const I=T[y];if(!(I==="_owner"&&r.$$typeof)&&!vv(r[I],l[I]))return!1}return!0}return r!==r&&l!==l}function uz(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function MC(r,l){const p=uz(r);return Math.round(l*p)/p}function Rb(r){const l=xe.useRef(r);return G0(()=>{l.current=r}),l}function x4(r){r===void 0&&(r={});const{placement:l="bottom",strategy:p="absolute",middleware:y=[],platform:T,elements:{reference:I,floating:R}={},transform:o=!0,whileElementsMounted:j,open:W}=r,[re,te]=xe.useState({x:0,y:0,strategy:p,placement:l,middlewareData:{},isPositioned:!1}),[Y,Ee]=xe.useState(y);vv(Y,y)||Ee(y);const[Ie,me]=xe.useState(null),[Pe,he]=xe.useState(null),pe=xe.useCallback(ft=>{ft!==_t.current&&(_t.current=ft,me(ft))},[]),we=xe.useCallback(ft=>{ft!==wt.current&&(wt.current=ft,he(ft))},[]),Ue=I||Ie,tt=R||Pe,_t=xe.useRef(null),wt=xe.useRef(null),xt=xe.useRef(re),ci=j!=null,ti=Rb(j),ni=Rb(T),ui=Rb(W),Pi=xe.useCallback(()=>{if(!_t.current||!wt.current)return;const ft={placement:l,strategy:p,middleware:Y};ni.current&&(ft.platform=ni.current),v4(_t.current,wt.current,ft).then($t=>{const Gt={...$t,isPositioned:ui.current!==!1};Vt.current&&!vv(xt.current,Gt)&&(xt.current=Gt,n_.flushSync(()=>{te(Gt)}))})},[Y,l,p,ni,ui]);G0(()=>{W===!1&&xt.current.isPositioned&&(xt.current.isPositioned=!1,te(ft=>({...ft,isPositioned:!1})))},[W]);const Vt=xe.useRef(!1);G0(()=>(Vt.current=!0,()=>{Vt.current=!1}),[]),G0(()=>{if(Ue&&(_t.current=Ue),tt&&(wt.current=tt),Ue&&tt){if(ti.current)return ti.current(Ue,tt,Pi);Pi()}},[Ue,tt,Pi,ti,ci]);const vi=xe.useMemo(()=>({reference:_t,floating:wt,setReference:pe,setFloating:we}),[pe,we]),ai=xe.useMemo(()=>({reference:Ue,floating:tt}),[Ue,tt]),Vi=xe.useMemo(()=>{const ft={position:p,left:0,top:0};if(!ai.floating)return ft;const $t=MC(ai.floating,re.x),Gt=MC(ai.floating,re.y);return o?{...ft,transform:"translate("+$t+"px, "+Gt+"px)",...uz(ai.floating)>=1.5&&{willChange:"transform"}}:{position:p,left:$t,top:Gt}},[p,o,ai.floating,re.x,re.y]);return xe.useMemo(()=>({...re,update:Pi,refs:vi,elements:ai,floatingStyles:Vi}),[re,Pi,vi,ai,Vi])}const b4=r=>{function l(p){return{}.hasOwnProperty.call(p,"current")}return{name:"arrow",options:r,fn(p){const{element:y,padding:T}=typeof r=="function"?r(p):r;return y&&l(y)?y.current!=null?CC({element:y.current,padding:T}).fn(p):{}:y?CC({element:y,padding:T}).fn(p):{}}}},w4=(r,l)=>({...f4(r),options:[r,l]}),T4=(r,l)=>({...p4(r),options:[r,l]}),S4=(r,l)=>({...y4(r),options:[r,l]}),E4=(r,l)=>({...m4(r),options:[r,l]}),I4=(r,l)=>({...g4(r),options:[r,l]}),A4=(r,l)=>({..._4(r),options:[r,l]}),C4=(r,l)=>({...b4(r),options:[r,l]});var M4="Arrow",hz=xe.forwardRef((r,l)=>{const{children:p,width:y=10,height:T=5,...I}=r;return ce.jsx(Er.svg,{...I,ref:l,width:y,height:T,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:r.asChild?p:ce.jsx("polygon",{points:"0,0 30,0 15,10"})})});hz.displayName=M4;var P4=hz;function R4(r,l=[]){let p=[];function y(I,R){const o=xe.createContext(R),j=p.length;p=[...p,R];function W(te){const{scope:Y,children:Ee,...Ie}=te,me=(Y==null?void 0:Y[r][j])||o,Pe=xe.useMemo(()=>Ie,Object.values(Ie));return ce.jsx(me.Provider,{value:Pe,children:Ee})}function re(te,Y){const Ee=(Y==null?void 0:Y[r][j])||o,Ie=xe.useContext(Ee);if(Ie)return Ie;if(R!==void 0)return R;throw new Error(`\`${te}\` must be used within \`${I}\``)}return W.displayName=I+"Provider",[W,re]}const T=()=>{const I=p.map(R=>xe.createContext(R));return function(o){const j=(o==null?void 0:o[r])||I;return xe.useMemo(()=>({[`__scope${r}`]:{...o,[r]:j}}),[o,j])}};return T.scopeName=r,[y,z4(T,...l)]}function z4(...r){const l=r[0];if(r.length===1)return l;const p=()=>{const y=r.map(T=>({useScope:T(),scopeName:T.scopeName}));return function(I){const R=y.reduce((o,{useScope:j,scopeName:W})=>{const te=j(I)[`__scope${W}`];return{...o,...te}},{});return xe.useMemo(()=>({[`__scope${l.scopeName}`]:R}),[R])}};return p.scopeName=l.scopeName,p}function dz(r){const[l,p]=xe.useState(void 0);return xu(()=>{if(r){p({width:r.offsetWidth,height:r.offsetHeight});const y=new ResizeObserver(T=>{if(!Array.isArray(T)||!T.length)return;const I=T[0];let R,o;if("borderBoxSize"in I){const j=I.borderBoxSize,W=Array.isArray(j)?j[0]:j;R=W.inlineSize,o=W.blockSize}else R=r.offsetWidth,o=r.offsetHeight;p({width:R,height:o})});return y.observe(r,{box:"border-box"}),()=>y.unobserve(r)}else p(void 0)},[r]),l}var fz="Popper",[pz,mz]=R4(fz),[vU,gz]=pz(fz),_z="PopperAnchor",yz=xe.forwardRef((r,l)=>{const{__scopePopper:p,virtualRef:y,...T}=r,I=gz(_z,p),R=xe.useRef(null),o=Ls(l,R);return xe.useEffect(()=>{I.onAnchorChange((y==null?void 0:y.current)||R.current)}),y?null:ce.jsx(Er.div,{...T,ref:o})});yz.displayName=_z;var t2="PopperContent",[D4,L4]=pz(t2),vz=xe.forwardRef((r,l)=>{var xn,fo,fn,po,Oo,Ir;const{__scopePopper:p,side:y="bottom",sideOffset:T=0,align:I="center",alignOffset:R=0,arrowPadding:o=0,avoidCollisions:j=!0,collisionBoundary:W=[],collisionPadding:re=0,sticky:te="partial",hideWhenDetached:Y=!1,updatePositionStrategy:Ee="optimized",onPlaced:Ie,...me}=r,Pe=gz(t2,p),[he,pe]=xe.useState(null),we=Ls(l,Tn=>pe(Tn)),[Ue,tt]=xe.useState(null),_t=dz(Ue),wt=(_t==null?void 0:_t.width)??0,xt=(_t==null?void 0:_t.height)??0,ci=y+(I!=="center"?"-"+I:""),ti=typeof re=="number"?re:{top:0,right:0,bottom:0,left:0,...re},ni=Array.isArray(W)?W:[W],ui=ni.length>0,Pi={padding:ti,boundary:ni.filter(O4),altBoundary:ui},{refs:Vt,floatingStyles:vi,placement:ai,isPositioned:Vi,middlewareData:ft}=x4({strategy:"fixed",placement:ci,whileElementsMounted:(...Tn)=>d4(...Tn,{animationFrame:Ee==="always"}),elements:{reference:Pe.anchor},middleware:[w4({mainAxis:T+xt,alignmentAxis:R}),j&&T4({mainAxis:!0,crossAxis:!1,limiter:te==="partial"?S4():void 0,...Pi}),j&&E4({...Pi}),I4({...Pi,apply:({elements:Tn,rects:ea,availableWidth:Wo,availableHeight:ir})=>{const{width:Fo,height:Zo}=ea.reference,Bn=Tn.floating.style;Bn.setProperty("--radix-popper-available-width",`${Wo}px`),Bn.setProperty("--radix-popper-available-height",`${ir}px`),Bn.setProperty("--radix-popper-anchor-width",`${Fo}px`),Bn.setProperty("--radix-popper-anchor-height",`${Zo}px`)}}),Ue&&C4({element:Ue,padding:o}),F4({arrowWidth:wt,arrowHeight:xt}),Y&&A4({strategy:"referenceHidden",...Pi})]}),[$t,Gt]=wz(ai),ii=Ma(Ie);xu(()=>{Vi&&(ii==null||ii())},[Vi,ii]);const Li=(xn=ft.arrow)==null?void 0:xn.x,Ji=(fo=ft.arrow)==null?void 0:fo.y,Vn=((fn=ft.arrow)==null?void 0:fn.centerOffset)!==0,[$i,Ei]=xe.useState();return xu(()=>{he&&Ei(window.getComputedStyle(he).zIndex)},[he]),ce.jsx("div",{ref:Vt.setFloating,"data-radix-popper-content-wrapper":"",style:{...vi,transform:Vi?vi.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:$i,"--radix-popper-transform-origin":[(po=ft.transformOrigin)==null?void 0:po.x,(Oo=ft.transformOrigin)==null?void 0:Oo.y].join(" "),...((Ir=ft.hide)==null?void 0:Ir.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:r.dir,children:ce.jsx(D4,{scope:p,placedSide:$t,onArrowChange:tt,arrowX:Li,arrowY:Ji,shouldHideArrow:Vn,children:ce.jsx(Er.div,{"data-side":$t,"data-align":Gt,...me,ref:we,style:{...me.style,animation:Vi?void 0:"none"}})})})});vz.displayName=t2;var xz="PopperArrow",k4={top:"bottom",right:"left",bottom:"top",left:"right"},bz=xe.forwardRef(function(l,p){const{__scopePopper:y,...T}=l,I=L4(xz,y),R=k4[I.placedSide];return ce.jsx("span",{ref:I.onArrowChange,style:{position:"absolute",left:I.arrowX,top:I.arrowY,[R]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[I.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[I.placedSide],visibility:I.shouldHideArrow?"hidden":void 0},children:ce.jsx(P4,{...T,ref:p,style:{...T.style,display:"block"}})})});bz.displayName=xz;function O4(r){return r!==null}var F4=r=>({name:"transformOrigin",options:r,fn(l){var Pe,he,pe;const{placement:p,rects:y,middlewareData:T}=l,R=((Pe=T.arrow)==null?void 0:Pe.centerOffset)!==0,o=R?0:r.arrowWidth,j=R?0:r.arrowHeight,[W,re]=wz(p),te={start:"0%",center:"50%",end:"100%"}[re],Y=(((he=T.arrow)==null?void 0:he.x)??0)+o/2,Ee=(((pe=T.arrow)==null?void 0:pe.y)??0)+j/2;let Ie="",me="";return W==="bottom"?(Ie=R?te:`${Y}px`,me=`${-j}px`):W==="top"?(Ie=R?te:`${Y}px`,me=`${y.floating.height+j}px`):W==="right"?(Ie=`${-j}px`,me=R?te:`${Ee}px`):W==="left"&&(Ie=`${y.floating.width+j}px`,me=R?te:`${Ee}px`),{data:{x:Ie,y:me}}}});function wz(r){const[l,p="center"]=r.split("-");return[l,p]}var B4=yz,N4=vz,j4=bz,[Xv,xU]=Nv("Tooltip",[mz]),i2=mz(),Tz="TooltipProvider",V4=700,PC="tooltip.open",[U4,Sz]=Xv(Tz),Ez=r=>{const{__scopeTooltip:l,delayDuration:p=V4,skipDelayDuration:y=300,disableHoverableContent:T=!1,children:I}=r,[R,o]=xe.useState(!0),j=xe.useRef(!1),W=xe.useRef(0);return xe.useEffect(()=>{const re=W.current;return()=>window.clearTimeout(re)},[]),ce.jsx(U4,{scope:l,isOpenDelayed:R,delayDuration:p,onOpen:xe.useCallback(()=>{window.clearTimeout(W.current),o(!1)},[]),onClose:xe.useCallback(()=>{window.clearTimeout(W.current),W.current=window.setTimeout(()=>o(!0),y)},[y]),isPointerInTransitRef:j,onPointerInTransitChange:xe.useCallback(re=>{j.current=re},[]),disableHoverableContent:T,children:I})};Ez.displayName=Tz;var Iz="Tooltip",[bU,Yv]=Xv(Iz),Vw="TooltipTrigger",G4=xe.forwardRef((r,l)=>{const{__scopeTooltip:p,...y}=r,T=Yv(Vw,p),I=Sz(Vw,p),R=i2(p),o=xe.useRef(null),j=Ls(l,o,T.onTriggerChange),W=xe.useRef(!1),re=xe.useRef(!1),te=xe.useCallback(()=>W.current=!1,[]);return xe.useEffect(()=>()=>document.removeEventListener("pointerup",te),[te]),ce.jsx(B4,{asChild:!0,...R,children:ce.jsx(Er.button,{"aria-describedby":T.open?T.contentId:void 0,"data-state":T.stateAttribute,...y,ref:j,onPointerMove:Kn(r.onPointerMove,Y=>{Y.pointerType!=="touch"&&!re.current&&!I.isPointerInTransitRef.current&&(T.onTriggerEnter(),re.current=!0)}),onPointerLeave:Kn(r.onPointerLeave,()=>{T.onTriggerLeave(),re.current=!1}),onPointerDown:Kn(r.onPointerDown,()=>{W.current=!0,document.addEventListener("pointerup",te,{once:!0})}),onFocus:Kn(r.onFocus,()=>{W.current||T.onOpen()}),onBlur:Kn(r.onBlur,T.onClose),onClick:Kn(r.onClick,T.onClose)})})});G4.displayName=Vw;var $4="TooltipPortal",[wU,H4]=Xv($4,{forceMount:void 0}),tp="TooltipContent",Az=xe.forwardRef((r,l)=>{const p=H4(tp,r.__scopeTooltip),{forceMount:y=p.forceMount,side:T="top",...I}=r,R=Yv(tp,r.__scopeTooltip);return ce.jsx(jv,{present:y||R.open,children:R.disableHoverableContent?ce.jsx(Cz,{side:T,...I,ref:l}):ce.jsx(q4,{side:T,...I,ref:l})})}),q4=xe.forwardRef((r,l)=>{const p=Yv(tp,r.__scopeTooltip),y=Sz(tp,r.__scopeTooltip),T=xe.useRef(null),I=Ls(l,T),[R,o]=xe.useState(null),{trigger:j,onClose:W}=p,re=T.current,{onPointerInTransitChange:te}=y,Y=xe.useCallback(()=>{o(null),te(!1)},[te]),Ee=xe.useCallback((Ie,me)=>{const Pe=Ie.currentTarget,he={x:Ie.clientX,y:Ie.clientY},pe=Y4(he,Pe.getBoundingClientRect()),we=K4(he,pe),Ue=Q4(me.getBoundingClientRect()),tt=ej([...we,...Ue]);o(tt),te(!0)},[te]);return xe.useEffect(()=>()=>Y(),[Y]),xe.useEffect(()=>{if(j&&re){const Ie=Pe=>Ee(Pe,re),me=Pe=>Ee(Pe,j);return j.addEventListener("pointerleave",Ie),re.addEventListener("pointerleave",me),()=>{j.removeEventListener("pointerleave",Ie),re.removeEventListener("pointerleave",me)}}},[j,re,Ee,Y]),xe.useEffect(()=>{if(R){const Ie=me=>{const Pe=me.target,he={x:me.clientX,y:me.clientY},pe=(j==null?void 0:j.contains(Pe))||(re==null?void 0:re.contains(Pe)),we=!J4(he,R);pe?Y():we&&(Y(),W())};return document.addEventListener("pointermove",Ie),()=>document.removeEventListener("pointermove",Ie)}},[j,re,R,W,Y]),ce.jsx(Cz,{...r,ref:I})}),[W4,Z4]=Xv(Iz,{isInside:!1}),Cz=xe.forwardRef((r,l)=>{const{__scopeTooltip:p,children:y,"aria-label":T,onEscapeKeyDown:I,onPointerDownOutside:R,...o}=r,j=Yv(tp,p),W=i2(p),{onClose:re}=j;return xe.useEffect(()=>(document.addEventListener(PC,re),()=>document.removeEventListener(PC,re)),[re]),xe.useEffect(()=>{if(j.trigger){const te=Y=>{const Ee=Y.target;Ee!=null&&Ee.contains(j.trigger)&&re()};return window.addEventListener("scroll",te,{capture:!0}),()=>window.removeEventListener("scroll",te,{capture:!0})}},[j.trigger,re]),ce.jsx(GT,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:I,onPointerDownOutside:R,onFocusOutside:te=>te.preventDefault(),onDismiss:re,children:ce.jsxs(N4,{"data-state":j.stateAttribute,...W,...o,ref:l,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[ce.jsx(gR,{children:y}),ce.jsx(W4,{scope:p,isInside:!0,children:ce.jsx(HB,{id:j.contentId,role:"tooltip",children:T||y})})]})})});Az.displayName=tp;var Mz="TooltipArrow",X4=xe.forwardRef((r,l)=>{const{__scopeTooltip:p,...y}=r,T=i2(p);return Z4(Mz,p).isInside?null:ce.jsx(j4,{...T,...y,ref:l})});X4.displayName=Mz;function Y4(r,l){const p=Math.abs(l.top-r.y),y=Math.abs(l.bottom-r.y),T=Math.abs(l.right-r.x),I=Math.abs(l.left-r.x);switch(Math.min(p,y,T,I)){case I:return"left";case T:return"right";case p:return"top";case y:return"bottom";default:throw new Error("unreachable")}}function K4(r,l,p=5){const y=[];switch(l){case"top":y.push({x:r.x-p,y:r.y+p},{x:r.x+p,y:r.y+p});break;case"bottom":y.push({x:r.x-p,y:r.y-p},{x:r.x+p,y:r.y-p});break;case"left":y.push({x:r.x+p,y:r.y-p},{x:r.x+p,y:r.y+p});break;case"right":y.push({x:r.x-p,y:r.y-p},{x:r.x-p,y:r.y+p});break}return y}function Q4(r){const{top:l,right:p,bottom:y,left:T}=r;return[{x:T,y:l},{x:p,y:l},{x:p,y},{x:T,y}]}function J4(r,l){const{x:p,y}=r;let T=!1;for(let I=0,R=l.length-1;I<l.length;R=I++){const o=l[I].x,j=l[I].y,W=l[R].x,re=l[R].y;j>y!=re>y&&p<(W-o)*(y-j)/(re-j)+o&&(T=!T)}return T}function ej(r){const l=r.slice();return l.sort((p,y)=>p.x<y.x?-1:p.x>y.x?1:p.y<y.y?-1:p.y>y.y?1:0),tj(l)}function tj(r){if(r.length<=1)return r.slice();const l=[];for(let y=0;y<r.length;y++){const T=r[y];for(;l.length>=2;){const I=l[l.length-1],R=l[l.length-2];if((I.x-R.x)*(T.y-R.y)>=(I.y-R.y)*(T.x-R.x))l.pop();else break}l.push(T)}l.pop();const p=[];for(let y=r.length-1;y>=0;y--){const T=r[y];for(;p.length>=2;){const I=p[p.length-1],R=p[p.length-2];if((I.x-R.x)*(T.y-R.y)>=(I.y-R.y)*(T.x-R.x))p.pop();else break}p.push(T)}return p.pop(),l.length===1&&p.length===1&&l[0].x===p[0].x&&l[0].y===p[0].y?l:l.concat(p)}var ij=Ez,Pz=Az;const nj=ij,rj=xe.forwardRef(({className:r,sideOffset:l=4,...p},y)=>ce.jsx(Pz,{ref:y,sideOffset:l,className:Jn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...p}));rj.displayName=Pz.displayName;var Kv=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Qv=typeof window>"u"||"Deno"in globalThis;function wa(){}function oj(r,l){return typeof r=="function"?r(l):r}function sj(r){return typeof r=="number"&&r>=0&&r!==1/0}function aj(r,l){return Math.max(r+(l||0)-Date.now(),0)}function RC(r,l){return typeof r=="function"?r(l):r}function lj(r,l){return typeof r=="function"?r(l):r}function zC(r,l){const{type:p="all",exact:y,fetchStatus:T,predicate:I,queryKey:R,stale:o}=r;if(R){if(y){if(l.queryHash!==n2(R,l.options))return!1}else if(!qg(l.queryKey,R))return!1}if(p!=="all"){const j=l.isActive();if(p==="active"&&!j||p==="inactive"&&j)return!1}return!(typeof o=="boolean"&&l.isStale()!==o||T&&T!==l.state.fetchStatus||I&&!I(l))}function DC(r,l){const{exact:p,status:y,predicate:T,mutationKey:I}=r;if(I){if(!l.options.mutationKey)return!1;if(p){if(Hg(l.options.mutationKey)!==Hg(I))return!1}else if(!qg(l.options.mutationKey,I))return!1}return!(y&&l.state.status!==y||T&&!T(l))}function n2(r,l){return((l==null?void 0:l.queryKeyHashFn)||Hg)(r)}function Hg(r){return JSON.stringify(r,(l,p)=>Uw(p)?Object.keys(p).sort().reduce((y,T)=>(y[T]=p[T],y),{}):p)}function qg(r,l){return r===l?!0:typeof r!=typeof l?!1:r&&l&&typeof r=="object"&&typeof l=="object"?!Object.keys(l).some(p=>!qg(r[p],l[p])):!1}function Rz(r,l){if(r===l)return r;const p=LC(r)&&LC(l);if(p||Uw(r)&&Uw(l)){const y=p?r:Object.keys(r),T=y.length,I=p?l:Object.keys(l),R=I.length,o=p?[]:{};let j=0;for(let W=0;W<R;W++){const re=p?W:I[W];(!p&&y.includes(re)||p)&&r[re]===void 0&&l[re]===void 0?(o[re]=void 0,j++):(o[re]=Rz(r[re],l[re]),o[re]===r[re]&&r[re]!==void 0&&j++)}return T===R&&j===T?r:o}return l}function LC(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function Uw(r){if(!kC(r))return!1;const l=r.constructor;if(l===void 0)return!0;const p=l.prototype;return!(!kC(p)||!p.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function kC(r){return Object.prototype.toString.call(r)==="[object Object]"}function cj(r){return new Promise(l=>{setTimeout(l,r)})}function uj(r,l,p){return typeof p.structuralSharing=="function"?p.structuralSharing(r,l):p.structuralSharing!==!1?Rz(r,l):l}function hj(r,l,p=0){const y=[...r,l];return p&&y.length>p?y.slice(1):y}function dj(r,l,p=0){const y=[l,...r];return p&&y.length>p?y.slice(0,-1):y}var r2=Symbol();function zz(r,l){return!r.queryFn&&(l!=null&&l.initialPromise)?()=>l.initialPromise:!r.queryFn||r.queryFn===r2?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}var Ph,tu,Bf,qC,fj=(qC=class extends Kv{constructor(){super();Xn(this,Ph);Xn(this,tu);Xn(this,Bf);vn(this,Bf,l=>{if(!Qv&&window.addEventListener){const p=()=>l();return window.addEventListener("visibilitychange",p,!1),()=>{window.removeEventListener("visibilitychange",p)}}})}onSubscribe(){Bt(this,tu)||this.setEventListener(Bt(this,Bf))}onUnsubscribe(){var l;this.hasListeners()||((l=Bt(this,tu))==null||l.call(this),vn(this,tu,void 0))}setEventListener(l){var p;vn(this,Bf,l),(p=Bt(this,tu))==null||p.call(this),vn(this,tu,l(y=>{typeof y=="boolean"?this.setFocused(y):this.onFocus()}))}setFocused(l){Bt(this,Ph)!==l&&(vn(this,Ph,l),this.onFocus())}onFocus(){const l=this.isFocused();this.listeners.forEach(p=>{p(l)})}isFocused(){var l;return typeof Bt(this,Ph)=="boolean"?Bt(this,Ph):((l=globalThis.document)==null?void 0:l.visibilityState)!=="hidden"}},Ph=new WeakMap,tu=new WeakMap,Bf=new WeakMap,qC),Dz=new fj,Nf,iu,jf,WC,pj=(WC=class extends Kv{constructor(){super();Xn(this,Nf,!0);Xn(this,iu);Xn(this,jf);vn(this,jf,l=>{if(!Qv&&window.addEventListener){const p=()=>l(!0),y=()=>l(!1);return window.addEventListener("online",p,!1),window.addEventListener("offline",y,!1),()=>{window.removeEventListener("online",p),window.removeEventListener("offline",y)}}})}onSubscribe(){Bt(this,iu)||this.setEventListener(Bt(this,jf))}onUnsubscribe(){var l;this.hasListeners()||((l=Bt(this,iu))==null||l.call(this),vn(this,iu,void 0))}setEventListener(l){var p;vn(this,jf,l),(p=Bt(this,iu))==null||p.call(this),vn(this,iu,l(this.setOnline.bind(this)))}setOnline(l){Bt(this,Nf)!==l&&(vn(this,Nf,l),this.listeners.forEach(y=>{y(l)}))}isOnline(){return Bt(this,Nf)}},Nf=new WeakMap,iu=new WeakMap,jf=new WeakMap,WC),xv=new pj;function mj(){let r,l;const p=new Promise((T,I)=>{r=T,l=I});p.status="pending",p.catch(()=>{});function y(T){Object.assign(p,T),delete p.resolve,delete p.reject}return p.resolve=T=>{y({status:"fulfilled",value:T}),r(T)},p.reject=T=>{y({status:"rejected",reason:T}),l(T)},p}function gj(r){return Math.min(1e3*2**r,3e4)}function Lz(r){return(r??"online")==="online"?xv.isOnline():!0}var kz=class extends Error{constructor(r){super("CancelledError"),this.revert=r==null?void 0:r.revert,this.silent=r==null?void 0:r.silent}};function zb(r){return r instanceof kz}function Oz(r){let l=!1,p=0,y=!1,T;const I=mj(),R=me=>{var Pe;y||(Y(new kz(me)),(Pe=r.abort)==null||Pe.call(r))},o=()=>{l=!0},j=()=>{l=!1},W=()=>Dz.isFocused()&&(r.networkMode==="always"||xv.isOnline())&&r.canRun(),re=()=>Lz(r.networkMode)&&r.canRun(),te=me=>{var Pe;y||(y=!0,(Pe=r.onSuccess)==null||Pe.call(r,me),T==null||T(),I.resolve(me))},Y=me=>{var Pe;y||(y=!0,(Pe=r.onError)==null||Pe.call(r,me),T==null||T(),I.reject(me))},Ee=()=>new Promise(me=>{var Pe;T=he=>{(y||W())&&me(he)},(Pe=r.onPause)==null||Pe.call(r)}).then(()=>{var me;T=void 0,y||(me=r.onContinue)==null||me.call(r)}),Ie=()=>{if(y)return;let me;const Pe=p===0?r.initialPromise:void 0;try{me=Pe??r.fn()}catch(he){me=Promise.reject(he)}Promise.resolve(me).then(te).catch(he=>{var _t;if(y)return;const pe=r.retry??(Qv?0:3),we=r.retryDelay??gj,Ue=typeof we=="function"?we(p,he):we,tt=pe===!0||typeof pe=="number"&&p<pe||typeof pe=="function"&&pe(p,he);if(l||!tt){Y(he);return}p++,(_t=r.onFail)==null||_t.call(r,p,he),cj(Ue).then(()=>W()?void 0:Ee()).then(()=>{l?Y(he):Ie()})})};return{promise:I,cancel:R,continue:()=>(T==null||T(),I),cancelRetry:o,continueRetry:j,canStart:re,start:()=>(re()?Ie():Ee().then(Ie),I)}}function _j(){let r=[],l=0,p=o=>{o()},y=o=>{o()},T=o=>setTimeout(o,0);const I=o=>{l?r.push(o):T(()=>{p(o)})},R=()=>{const o=r;r=[],o.length&&T(()=>{y(()=>{o.forEach(j=>{p(j)})})})};return{batch:o=>{let j;l++;try{j=o()}finally{l--,l||R()}return j},batchCalls:o=>(...j)=>{I(()=>{o(...j)})},schedule:I,setNotifyFunction:o=>{p=o},setBatchNotifyFunction:o=>{y=o},setScheduler:o=>{T=o}}}var Go=_j(),Rh,ZC,Fz=(ZC=class{constructor(){Xn(this,Rh)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),sj(this.gcTime)&&vn(this,Rh,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(Qv?1/0:5*60*1e3))}clearGcTimeout(){Bt(this,Rh)&&(clearTimeout(Bt(this,Rh)),vn(this,Rh,void 0))}},Rh=new WeakMap,ZC),Vf,Uf,Ws,Do,Yg,zh,Ta,Gl,XC,yj=(XC=class extends Fz{constructor(l){super();Xn(this,Ta);Xn(this,Vf);Xn(this,Uf);Xn(this,Ws);Xn(this,Do);Xn(this,Yg);Xn(this,zh);vn(this,zh,!1),vn(this,Yg,l.defaultOptions),this.setOptions(l.options),this.observers=[],vn(this,Ws,l.cache),this.queryKey=l.queryKey,this.queryHash=l.queryHash,vn(this,Vf,xj(this.options)),this.state=l.state??Bt(this,Vf),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var l;return(l=Bt(this,Do))==null?void 0:l.promise}setOptions(l){this.options={...Bt(this,Yg),...l},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Bt(this,Ws).remove(this)}setData(l,p){const y=uj(this.state.data,l,this.options);return Po(this,Ta,Gl).call(this,{data:y,type:"success",dataUpdatedAt:p==null?void 0:p.updatedAt,manual:p==null?void 0:p.manual}),y}setState(l,p){Po(this,Ta,Gl).call(this,{type:"setState",state:l,setStateOptions:p})}cancel(l){var y,T;const p=(y=Bt(this,Do))==null?void 0:y.promise;return(T=Bt(this,Do))==null||T.cancel(l),p?p.then(wa).catch(wa):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Bt(this,Vf))}isActive(){return this.observers.some(l=>lj(l.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===r2||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(l=>l.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(l=0){return this.state.isInvalidated||this.state.data===void 0||!aj(this.state.dataUpdatedAt,l)}onFocus(){var p;const l=this.observers.find(y=>y.shouldFetchOnWindowFocus());l==null||l.refetch({cancelRefetch:!1}),(p=Bt(this,Do))==null||p.continue()}onOnline(){var p;const l=this.observers.find(y=>y.shouldFetchOnReconnect());l==null||l.refetch({cancelRefetch:!1}),(p=Bt(this,Do))==null||p.continue()}addObserver(l){this.observers.includes(l)||(this.observers.push(l),this.clearGcTimeout(),Bt(this,Ws).notify({type:"observerAdded",query:this,observer:l}))}removeObserver(l){this.observers.includes(l)&&(this.observers=this.observers.filter(p=>p!==l),this.observers.length||(Bt(this,Do)&&(Bt(this,zh)?Bt(this,Do).cancel({revert:!0}):Bt(this,Do).cancelRetry()),this.scheduleGc()),Bt(this,Ws).notify({type:"observerRemoved",query:this,observer:l}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Po(this,Ta,Gl).call(this,{type:"invalidate"})}fetch(l,p){var j,W,re;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(p!=null&&p.cancelRefetch))this.cancel({silent:!0});else if(Bt(this,Do))return Bt(this,Do).continueRetry(),Bt(this,Do).promise}if(l&&this.setOptions(l),!this.options.queryFn){const te=this.observers.find(Y=>Y.options.queryFn);te&&this.setOptions(te.options)}const y=new AbortController,T=te=>{Object.defineProperty(te,"signal",{enumerable:!0,get:()=>(vn(this,zh,!0),y.signal)})},I=()=>{const te=zz(this.options,p),Y={queryKey:this.queryKey,meta:this.meta};return T(Y),vn(this,zh,!1),this.options.persister?this.options.persister(te,Y,this):te(Y)},R={fetchOptions:p,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:I};T(R),(j=this.options.behavior)==null||j.onFetch(R,this),vn(this,Uf,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((W=R.fetchOptions)==null?void 0:W.meta))&&Po(this,Ta,Gl).call(this,{type:"fetch",meta:(re=R.fetchOptions)==null?void 0:re.meta});const o=te=>{var Y,Ee,Ie,me;zb(te)&&te.silent||Po(this,Ta,Gl).call(this,{type:"error",error:te}),zb(te)||((Ee=(Y=Bt(this,Ws).config).onError)==null||Ee.call(Y,te,this),(me=(Ie=Bt(this,Ws).config).onSettled)==null||me.call(Ie,this.state.data,te,this)),this.scheduleGc()};return vn(this,Do,Oz({initialPromise:p==null?void 0:p.initialPromise,fn:R.fetchFn,abort:y.abort.bind(y),onSuccess:te=>{var Y,Ee,Ie,me;if(te===void 0){o(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(te)}catch(Pe){o(Pe);return}(Ee=(Y=Bt(this,Ws).config).onSuccess)==null||Ee.call(Y,te,this),(me=(Ie=Bt(this,Ws).config).onSettled)==null||me.call(Ie,te,this.state.error,this),this.scheduleGc()},onError:o,onFail:(te,Y)=>{Po(this,Ta,Gl).call(this,{type:"failed",failureCount:te,error:Y})},onPause:()=>{Po(this,Ta,Gl).call(this,{type:"pause"})},onContinue:()=>{Po(this,Ta,Gl).call(this,{type:"continue"})},retry:R.options.retry,retryDelay:R.options.retryDelay,networkMode:R.options.networkMode,canRun:()=>!0})),Bt(this,Do).start()}},Vf=new WeakMap,Uf=new WeakMap,Ws=new WeakMap,Do=new WeakMap,Yg=new WeakMap,zh=new WeakMap,Ta=new WeakSet,Gl=function(l){const p=y=>{switch(l.type){case"failed":return{...y,fetchFailureCount:l.failureCount,fetchFailureReason:l.error};case"pause":return{...y,fetchStatus:"paused"};case"continue":return{...y,fetchStatus:"fetching"};case"fetch":return{...y,...vj(y.data,this.options),fetchMeta:l.meta??null};case"success":return{...y,data:l.data,dataUpdateCount:y.dataUpdateCount+1,dataUpdatedAt:l.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!l.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const T=l.error;return zb(T)&&T.revert&&Bt(this,Uf)?{...Bt(this,Uf),fetchStatus:"idle"}:{...y,error:T,errorUpdateCount:y.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:y.fetchFailureCount+1,fetchFailureReason:T,fetchStatus:"idle",status:"error"};case"invalidate":return{...y,isInvalidated:!0};case"setState":return{...y,...l.state}}};this.state=p(this.state),Go.batch(()=>{this.observers.forEach(y=>{y.onQueryUpdate()}),Bt(this,Ws).notify({query:this,type:"updated",action:l})})},XC);function vj(r,l){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Lz(l.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function xj(r){const l=typeof r.initialData=="function"?r.initialData():r.initialData,p=l!==void 0,y=p?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:l,dataUpdateCount:0,dataUpdatedAt:p?y??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:p?"success":"pending",fetchStatus:"idle"}}var il,YC,bj=(YC=class extends Kv{constructor(l={}){super();Xn(this,il);this.config=l,vn(this,il,new Map)}build(l,p,y){const T=p.queryKey,I=p.queryHash??n2(T,p);let R=this.get(I);return R||(R=new yj({cache:this,queryKey:T,queryHash:I,options:l.defaultQueryOptions(p),state:y,defaultOptions:l.getQueryDefaults(T)}),this.add(R)),R}add(l){Bt(this,il).has(l.queryHash)||(Bt(this,il).set(l.queryHash,l),this.notify({type:"added",query:l}))}remove(l){const p=Bt(this,il).get(l.queryHash);p&&(l.destroy(),p===l&&Bt(this,il).delete(l.queryHash),this.notify({type:"removed",query:l}))}clear(){Go.batch(()=>{this.getAll().forEach(l=>{this.remove(l)})})}get(l){return Bt(this,il).get(l)}getAll(){return[...Bt(this,il).values()]}find(l){const p={exact:!0,...l};return this.getAll().find(y=>zC(p,y))}findAll(l={}){const p=this.getAll();return Object.keys(l).length>0?p.filter(y=>zC(l,y)):p}notify(l){Go.batch(()=>{this.listeners.forEach(p=>{p(l)})})}onFocus(){Go.batch(()=>{this.getAll().forEach(l=>{l.onFocus()})})}onOnline(){Go.batch(()=>{this.getAll().forEach(l=>{l.onOnline()})})}},il=new WeakMap,YC),nl,Vo,Dh,rl,Yc,KC,wj=(KC=class extends Fz{constructor(l){super();Xn(this,rl);Xn(this,nl);Xn(this,Vo);Xn(this,Dh);this.mutationId=l.mutationId,vn(this,Vo,l.mutationCache),vn(this,nl,[]),this.state=l.state||Tj(),this.setOptions(l.options),this.scheduleGc()}setOptions(l){this.options=l,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(l){Bt(this,nl).includes(l)||(Bt(this,nl).push(l),this.clearGcTimeout(),Bt(this,Vo).notify({type:"observerAdded",mutation:this,observer:l}))}removeObserver(l){vn(this,nl,Bt(this,nl).filter(p=>p!==l)),this.scheduleGc(),Bt(this,Vo).notify({type:"observerRemoved",mutation:this,observer:l})}optionalRemove(){Bt(this,nl).length||(this.state.status==="pending"?this.scheduleGc():Bt(this,Vo).remove(this))}continue(){var l;return((l=Bt(this,Dh))==null?void 0:l.continue())??this.execute(this.state.variables)}async execute(l){var T,I,R,o,j,W,re,te,Y,Ee,Ie,me,Pe,he,pe,we,Ue,tt,_t,wt;vn(this,Dh,Oz({fn:()=>this.options.mutationFn?this.options.mutationFn(l):Promise.reject(new Error("No mutationFn found")),onFail:(xt,ci)=>{Po(this,rl,Yc).call(this,{type:"failed",failureCount:xt,error:ci})},onPause:()=>{Po(this,rl,Yc).call(this,{type:"pause"})},onContinue:()=>{Po(this,rl,Yc).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Bt(this,Vo).canRun(this)}));const p=this.state.status==="pending",y=!Bt(this,Dh).canStart();try{if(!p){Po(this,rl,Yc).call(this,{type:"pending",variables:l,isPaused:y}),await((I=(T=Bt(this,Vo).config).onMutate)==null?void 0:I.call(T,l,this));const ci=await((o=(R=this.options).onMutate)==null?void 0:o.call(R,l));ci!==this.state.context&&Po(this,rl,Yc).call(this,{type:"pending",context:ci,variables:l,isPaused:y})}const xt=await Bt(this,Dh).start();return await((W=(j=Bt(this,Vo).config).onSuccess)==null?void 0:W.call(j,xt,l,this.state.context,this)),await((te=(re=this.options).onSuccess)==null?void 0:te.call(re,xt,l,this.state.context)),await((Ee=(Y=Bt(this,Vo).config).onSettled)==null?void 0:Ee.call(Y,xt,null,this.state.variables,this.state.context,this)),await((me=(Ie=this.options).onSettled)==null?void 0:me.call(Ie,xt,null,l,this.state.context)),Po(this,rl,Yc).call(this,{type:"success",data:xt}),xt}catch(xt){try{throw await((he=(Pe=Bt(this,Vo).config).onError)==null?void 0:he.call(Pe,xt,l,this.state.context,this)),await((we=(pe=this.options).onError)==null?void 0:we.call(pe,xt,l,this.state.context)),await((tt=(Ue=Bt(this,Vo).config).onSettled)==null?void 0:tt.call(Ue,void 0,xt,this.state.variables,this.state.context,this)),await((wt=(_t=this.options).onSettled)==null?void 0:wt.call(_t,void 0,xt,l,this.state.context)),xt}finally{Po(this,rl,Yc).call(this,{type:"error",error:xt})}}finally{Bt(this,Vo).runNext(this)}}},nl=new WeakMap,Vo=new WeakMap,Dh=new WeakMap,rl=new WeakSet,Yc=function(l){const p=y=>{switch(l.type){case"failed":return{...y,failureCount:l.failureCount,failureReason:l.error};case"pause":return{...y,isPaused:!0};case"continue":return{...y,isPaused:!1};case"pending":return{...y,context:l.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:l.isPaused,status:"pending",variables:l.variables,submittedAt:Date.now()};case"success":return{...y,data:l.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...y,data:void 0,error:l.error,failureCount:y.failureCount+1,failureReason:l.error,isPaused:!1,status:"error"}}};this.state=p(this.state),Go.batch(()=>{Bt(this,nl).forEach(y=>{y.onMutationUpdate(l)}),Bt(this,Vo).notify({mutation:this,type:"updated",action:l})})},KC);function Tj(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Is,Kg,QC,Sj=(QC=class extends Kv{constructor(l={}){super();Xn(this,Is);Xn(this,Kg);this.config=l,vn(this,Is,new Map),vn(this,Kg,Date.now())}build(l,p,y){const T=new wj({mutationCache:this,mutationId:++o0(this,Kg)._,options:l.defaultMutationOptions(p),state:y});return this.add(T),T}add(l){const p=A0(l),y=Bt(this,Is).get(p)??[];y.push(l),Bt(this,Is).set(p,y),this.notify({type:"added",mutation:l})}remove(l){var y;const p=A0(l);if(Bt(this,Is).has(p)){const T=(y=Bt(this,Is).get(p))==null?void 0:y.filter(I=>I!==l);T&&(T.length===0?Bt(this,Is).delete(p):Bt(this,Is).set(p,T))}this.notify({type:"removed",mutation:l})}canRun(l){var y;const p=(y=Bt(this,Is).get(A0(l)))==null?void 0:y.find(T=>T.state.status==="pending");return!p||p===l}runNext(l){var y;const p=(y=Bt(this,Is).get(A0(l)))==null?void 0:y.find(T=>T!==l&&T.state.isPaused);return(p==null?void 0:p.continue())??Promise.resolve()}clear(){Go.batch(()=>{this.getAll().forEach(l=>{this.remove(l)})})}getAll(){return[...Bt(this,Is).values()].flat()}find(l){const p={exact:!0,...l};return this.getAll().find(y=>DC(p,y))}findAll(l={}){return this.getAll().filter(p=>DC(l,p))}notify(l){Go.batch(()=>{this.listeners.forEach(p=>{p(l)})})}resumePausedMutations(){const l=this.getAll().filter(p=>p.state.isPaused);return Go.batch(()=>Promise.all(l.map(p=>p.continue().catch(wa))))}},Is=new WeakMap,Kg=new WeakMap,QC);function A0(r){var l;return((l=r.options.scope)==null?void 0:l.id)??String(r.mutationId)}function OC(r){return{onFetch:(l,p)=>{var re,te,Y,Ee,Ie;const y=l.options,T=(Y=(te=(re=l.fetchOptions)==null?void 0:re.meta)==null?void 0:te.fetchMore)==null?void 0:Y.direction,I=((Ee=l.state.data)==null?void 0:Ee.pages)||[],R=((Ie=l.state.data)==null?void 0:Ie.pageParams)||[];let o={pages:[],pageParams:[]},j=0;const W=async()=>{let me=!1;const Pe=we=>{Object.defineProperty(we,"signal",{enumerable:!0,get:()=>(l.signal.aborted?me=!0:l.signal.addEventListener("abort",()=>{me=!0}),l.signal)})},he=zz(l.options,l.fetchOptions),pe=async(we,Ue,tt)=>{if(me)return Promise.reject();if(Ue==null&&we.pages.length)return Promise.resolve(we);const _t={queryKey:l.queryKey,pageParam:Ue,direction:tt?"backward":"forward",meta:l.options.meta};Pe(_t);const wt=await he(_t),{maxPages:xt}=l.options,ci=tt?dj:hj;return{pages:ci(we.pages,wt,xt),pageParams:ci(we.pageParams,Ue,xt)}};if(T&&I.length){const we=T==="backward",Ue=we?Ej:FC,tt={pages:I,pageParams:R},_t=Ue(y,tt);o=await pe(tt,_t,we)}else{const we=r??I.length;do{const Ue=j===0?R[0]??y.initialPageParam:FC(y,o);if(j>0&&Ue==null)break;o=await pe(o,Ue),j++}while(j<we)}return o};l.options.persister?l.fetchFn=()=>{var me,Pe;return(Pe=(me=l.options).persister)==null?void 0:Pe.call(me,W,{queryKey:l.queryKey,meta:l.options.meta,signal:l.signal},p)}:l.fetchFn=W}}}function FC(r,{pages:l,pageParams:p}){const y=l.length-1;return l.length>0?r.getNextPageParam(l[y],l,p[y],p):void 0}function Ej(r,{pages:l,pageParams:p}){var y;return l.length>0?(y=r.getPreviousPageParam)==null?void 0:y.call(r,l[0],l,p[0],p):void 0}var Pr,nu,ru,Gf,$f,ou,Hf,qf,JC,Ij=(JC=class{constructor(r={}){Xn(this,Pr);Xn(this,nu);Xn(this,ru);Xn(this,Gf);Xn(this,$f);Xn(this,ou);Xn(this,Hf);Xn(this,qf);vn(this,Pr,r.queryCache||new bj),vn(this,nu,r.mutationCache||new Sj),vn(this,ru,r.defaultOptions||{}),vn(this,Gf,new Map),vn(this,$f,new Map),vn(this,ou,0)}mount(){o0(this,ou)._++,Bt(this,ou)===1&&(vn(this,Hf,Dz.subscribe(async r=>{r&&(await this.resumePausedMutations(),Bt(this,Pr).onFocus())})),vn(this,qf,xv.subscribe(async r=>{r&&(await this.resumePausedMutations(),Bt(this,Pr).onOnline())})))}unmount(){var r,l;o0(this,ou)._--,Bt(this,ou)===0&&((r=Bt(this,Hf))==null||r.call(this),vn(this,Hf,void 0),(l=Bt(this,qf))==null||l.call(this),vn(this,qf,void 0))}isFetching(r){return Bt(this,Pr).findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return Bt(this,nu).findAll({...r,status:"pending"}).length}getQueryData(r){var p;const l=this.defaultQueryOptions({queryKey:r});return(p=Bt(this,Pr).get(l.queryHash))==null?void 0:p.state.data}ensureQueryData(r){const l=this.getQueryData(r.queryKey);if(l===void 0)return this.fetchQuery(r);{const p=this.defaultQueryOptions(r),y=Bt(this,Pr).build(this,p);return r.revalidateIfStale&&y.isStaleByTime(RC(p.staleTime,y))&&this.prefetchQuery(p),Promise.resolve(l)}}getQueriesData(r){return Bt(this,Pr).findAll(r).map(({queryKey:l,state:p})=>{const y=p.data;return[l,y]})}setQueryData(r,l,p){const y=this.defaultQueryOptions({queryKey:r}),T=Bt(this,Pr).get(y.queryHash),I=T==null?void 0:T.state.data,R=oj(l,I);if(R!==void 0)return Bt(this,Pr).build(this,y).setData(R,{...p,manual:!0})}setQueriesData(r,l,p){return Go.batch(()=>Bt(this,Pr).findAll(r).map(({queryKey:y})=>[y,this.setQueryData(y,l,p)]))}getQueryState(r){var p;const l=this.defaultQueryOptions({queryKey:r});return(p=Bt(this,Pr).get(l.queryHash))==null?void 0:p.state}removeQueries(r){const l=Bt(this,Pr);Go.batch(()=>{l.findAll(r).forEach(p=>{l.remove(p)})})}resetQueries(r,l){const p=Bt(this,Pr),y={type:"active",...r};return Go.batch(()=>(p.findAll(r).forEach(T=>{T.reset()}),this.refetchQueries(y,l)))}cancelQueries(r={},l={}){const p={revert:!0,...l},y=Go.batch(()=>Bt(this,Pr).findAll(r).map(T=>T.cancel(p)));return Promise.all(y).then(wa).catch(wa)}invalidateQueries(r={},l={}){return Go.batch(()=>{if(Bt(this,Pr).findAll(r).forEach(y=>{y.invalidate()}),r.refetchType==="none")return Promise.resolve();const p={...r,type:r.refetchType??r.type??"active"};return this.refetchQueries(p,l)})}refetchQueries(r={},l){const p={...l,cancelRefetch:(l==null?void 0:l.cancelRefetch)??!0},y=Go.batch(()=>Bt(this,Pr).findAll(r).filter(T=>!T.isDisabled()).map(T=>{let I=T.fetch(void 0,p);return p.throwOnError||(I=I.catch(wa)),T.state.fetchStatus==="paused"?Promise.resolve():I}));return Promise.all(y).then(wa)}fetchQuery(r){const l=this.defaultQueryOptions(r);l.retry===void 0&&(l.retry=!1);const p=Bt(this,Pr).build(this,l);return p.isStaleByTime(RC(l.staleTime,p))?p.fetch(l):Promise.resolve(p.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(wa).catch(wa)}fetchInfiniteQuery(r){return r.behavior=OC(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(wa).catch(wa)}ensureInfiniteQueryData(r){return r.behavior=OC(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return xv.isOnline()?Bt(this,nu).resumePausedMutations():Promise.resolve()}getQueryCache(){return Bt(this,Pr)}getMutationCache(){return Bt(this,nu)}getDefaultOptions(){return Bt(this,ru)}setDefaultOptions(r){vn(this,ru,r)}setQueryDefaults(r,l){Bt(this,Gf).set(Hg(r),{queryKey:r,defaultOptions:l})}getQueryDefaults(r){const l=[...Bt(this,Gf).values()];let p={};return l.forEach(y=>{qg(r,y.queryKey)&&(p={...p,...y.defaultOptions})}),p}setMutationDefaults(r,l){Bt(this,$f).set(Hg(r),{mutationKey:r,defaultOptions:l})}getMutationDefaults(r){const l=[...Bt(this,$f).values()];let p={};return l.forEach(y=>{qg(r,y.mutationKey)&&(p={...p,...y.defaultOptions})}),p}defaultQueryOptions(r){if(r._defaulted)return r;const l={...Bt(this,ru).queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return l.queryHash||(l.queryHash=n2(l.queryKey,l)),l.refetchOnReconnect===void 0&&(l.refetchOnReconnect=l.networkMode!=="always"),l.throwOnError===void 0&&(l.throwOnError=!!l.suspense),!l.networkMode&&l.persister&&(l.networkMode="offlineFirst"),l.enabled!==!0&&l.queryFn===r2&&(l.enabled=!1),l}defaultMutationOptions(r){return r!=null&&r._defaulted?r:{...Bt(this,ru).mutations,...(r==null?void 0:r.mutationKey)&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){Bt(this,Pr).clear(),Bt(this,nu).clear()}},Pr=new WeakMap,nu=new WeakMap,ru=new WeakMap,Gf=new WeakMap,$f=new WeakMap,ou=new WeakMap,Hf=new WeakMap,qf=new WeakMap,JC),Aj=xe.createContext(void 0),Cj=({client:r,children:l})=>(xe.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),ce.jsx(Aj.Provider,{value:r,children:l}));/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wg(){return Wg=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var p=arguments[l];for(var y in p)Object.prototype.hasOwnProperty.call(p,y)&&(r[y]=p[y])}return r},Wg.apply(this,arguments)}var lu;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(lu||(lu={}));const BC="popstate";function Mj(r){r===void 0&&(r={});function l(y,T){let{pathname:I,search:R,hash:o}=y.location;return Gw("",{pathname:I,search:R,hash:o},T.state&&T.state.usr||null,T.state&&T.state.key||"default")}function p(y,T){return typeof T=="string"?T:bv(T)}return Rj(l,p,null,r)}function Gr(r,l){if(r===!1||r===null||typeof r>"u")throw new Error(l)}function Bz(r,l){if(!r){typeof console<"u"&&console.warn(l);try{throw new Error(l)}catch{}}}function Pj(){return Math.random().toString(36).substr(2,8)}function NC(r,l){return{usr:r.state,key:r.key,idx:l}}function Gw(r,l,p,y){return p===void 0&&(p=null),Wg({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof l=="string"?lp(l):l,{state:p,key:l&&l.key||y||Pj()})}function bv(r){let{pathname:l="/",search:p="",hash:y=""}=r;return p&&p!=="?"&&(l+=p.charAt(0)==="?"?p:"?"+p),y&&y!=="#"&&(l+=y.charAt(0)==="#"?y:"#"+y),l}function lp(r){let l={};if(r){let p=r.indexOf("#");p>=0&&(l.hash=r.substr(p),r=r.substr(0,p));let y=r.indexOf("?");y>=0&&(l.search=r.substr(y),r=r.substr(0,y)),r&&(l.pathname=r)}return l}function Rj(r,l,p,y){y===void 0&&(y={});let{window:T=document.defaultView,v5Compat:I=!1}=y,R=T.history,o=lu.Pop,j=null,W=re();W==null&&(W=0,R.replaceState(Wg({},R.state,{idx:W}),""));function re(){return(R.state||{idx:null}).idx}function te(){o=lu.Pop;let Pe=re(),he=Pe==null?null:Pe-W;W=Pe,j&&j({action:o,location:me.location,delta:he})}function Y(Pe,he){o=lu.Push;let pe=Gw(me.location,Pe,he);W=re()+1;let we=NC(pe,W),Ue=me.createHref(pe);try{R.pushState(we,"",Ue)}catch(tt){if(tt instanceof DOMException&&tt.name==="DataCloneError")throw tt;T.location.assign(Ue)}I&&j&&j({action:o,location:me.location,delta:1})}function Ee(Pe,he){o=lu.Replace;let pe=Gw(me.location,Pe,he);W=re();let we=NC(pe,W),Ue=me.createHref(pe);R.replaceState(we,"",Ue),I&&j&&j({action:o,location:me.location,delta:0})}function Ie(Pe){let he=T.location.origin!=="null"?T.location.origin:T.location.href,pe=typeof Pe=="string"?Pe:bv(Pe);return pe=pe.replace(/ $/,"%20"),Gr(he,"No window.location.(origin|href) available to create URL for href: "+pe),new URL(pe,he)}let me={get action(){return o},get location(){return r(T,R)},listen(Pe){if(j)throw new Error("A history only accepts one active listener");return T.addEventListener(BC,te),j=Pe,()=>{T.removeEventListener(BC,te),j=null}},createHref(Pe){return l(T,Pe)},createURL:Ie,encodeLocation(Pe){let he=Ie(Pe);return{pathname:he.pathname,search:he.search,hash:he.hash}},push:Y,replace:Ee,go(Pe){return R.go(Pe)}};return me}var jC;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(jC||(jC={}));function zj(r,l,p){return p===void 0&&(p="/"),Dj(r,l,p,!1)}function Dj(r,l,p,y){let T=typeof l=="string"?lp(l):l,I=o2(T.pathname||"/",p);if(I==null)return null;let R=Nz(r);Lj(R);let o=null;for(let j=0;o==null&&j<R.length;++j){let W=Hj(I);o=Gj(R[j],W,y)}return o}function Nz(r,l,p,y){l===void 0&&(l=[]),p===void 0&&(p=[]),y===void 0&&(y="");let T=(I,R,o)=>{let j={relativePath:o===void 0?I.path||"":o,caseSensitive:I.caseSensitive===!0,childrenIndex:R,route:I};j.relativePath.startsWith("/")&&(Gr(j.relativePath.startsWith(y),'Absolute route path "'+j.relativePath+'" nested under path '+('"'+y+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),j.relativePath=j.relativePath.slice(y.length));let W=_u([y,j.relativePath]),re=p.concat(j);I.children&&I.children.length>0&&(Gr(I.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+W+'".')),Nz(I.children,l,re,W)),!(I.path==null&&!I.index)&&l.push({path:W,score:Vj(W,I.index),routesMeta:re})};return r.forEach((I,R)=>{var o;if(I.path===""||!((o=I.path)!=null&&o.includes("?")))T(I,R);else for(let j of jz(I.path))T(I,R,j)}),l}function jz(r){let l=r.split("/");if(l.length===0)return[];let[p,...y]=l,T=p.endsWith("?"),I=p.replace(/\?$/,"");if(y.length===0)return T?[I,""]:[I];let R=jz(y.join("/")),o=[];return o.push(...R.map(j=>j===""?I:[I,j].join("/"))),T&&o.push(...R),o.map(j=>r.startsWith("/")&&j===""?"/":j)}function Lj(r){r.sort((l,p)=>l.score!==p.score?p.score-l.score:Uj(l.routesMeta.map(y=>y.childrenIndex),p.routesMeta.map(y=>y.childrenIndex)))}const kj=/^:[\w-]+$/,Oj=3,Fj=2,Bj=1,Nj=10,jj=-2,VC=r=>r==="*";function Vj(r,l){let p=r.split("/"),y=p.length;return p.some(VC)&&(y+=jj),l&&(y+=Fj),p.filter(T=>!VC(T)).reduce((T,I)=>T+(kj.test(I)?Oj:I===""?Bj:Nj),y)}function Uj(r,l){return r.length===l.length&&r.slice(0,-1).every((y,T)=>y===l[T])?r[r.length-1]-l[l.length-1]:0}function Gj(r,l,p){let{routesMeta:y}=r,T={},I="/",R=[];for(let o=0;o<y.length;++o){let j=y[o],W=o===y.length-1,re=I==="/"?l:l.slice(I.length)||"/",te=UC({path:j.relativePath,caseSensitive:j.caseSensitive,end:W},re),Y=j.route;if(!te&&W&&p&&!y[y.length-1].route.index&&(te=UC({path:j.relativePath,caseSensitive:j.caseSensitive,end:!1},re)),!te)return null;Object.assign(T,te.params),R.push({params:T,pathname:_u([I,te.pathname]),pathnameBase:Xj(_u([I,te.pathnameBase])),route:Y}),te.pathnameBase!=="/"&&(I=_u([I,te.pathnameBase]))}return R}function UC(r,l){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[p,y]=$j(r.path,r.caseSensitive,r.end),T=l.match(p);if(!T)return null;let I=T[0],R=I.replace(/(.)\/+$/,"$1"),o=T.slice(1);return{params:y.reduce((W,re,te)=>{let{paramName:Y,isOptional:Ee}=re;if(Y==="*"){let me=o[te]||"";R=I.slice(0,I.length-me.length).replace(/(.)\/+$/,"$1")}const Ie=o[te];return Ee&&!Ie?W[Y]=void 0:W[Y]=(Ie||"").replace(/%2F/g,"/"),W},{}),pathname:I,pathnameBase:R,pattern:r}}function $j(r,l,p){l===void 0&&(l=!1),p===void 0&&(p=!0),Bz(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let y=[],T="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(R,o,j)=>(y.push({paramName:o,isOptional:j!=null}),j?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(y.push({paramName:"*"}),T+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):p?T+="\\/*$":r!==""&&r!=="/"&&(T+="(?:(?=\\/|$))"),[new RegExp(T,l?void 0:"i"),y]}function Hj(r){try{return r.split("/").map(l=>decodeURIComponent(l).replace(/\//g,"%2F")).join("/")}catch(l){return Bz(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+l+").")),r}}function o2(r,l){if(l==="/")return r;if(!r.toLowerCase().startsWith(l.toLowerCase()))return null;let p=l.endsWith("/")?l.length-1:l.length,y=r.charAt(p);return y&&y!=="/"?null:r.slice(p)||"/"}function qj(r,l){l===void 0&&(l="/");let{pathname:p,search:y="",hash:T=""}=typeof r=="string"?lp(r):r;return{pathname:p?p.startsWith("/")?p:Wj(p,l):l,search:Yj(y),hash:Kj(T)}}function Wj(r,l){let p=l.replace(/\/+$/,"").split("/");return r.split("/").forEach(T=>{T===".."?p.length>1&&p.pop():T!=="."&&p.push(T)}),p.length>1?p.join("/"):"/"}function Db(r,l,p,y){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+l+"` field ["+JSON.stringify(y)+"].  Please separate it out to the ")+("`to."+p+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Zj(r){return r.filter((l,p)=>p===0||l.route.path&&l.route.path.length>0)}function Vz(r,l){let p=Zj(r);return l?p.map((y,T)=>T===p.length-1?y.pathname:y.pathnameBase):p.map(y=>y.pathnameBase)}function Uz(r,l,p,y){y===void 0&&(y=!1);let T;typeof r=="string"?T=lp(r):(T=Wg({},r),Gr(!T.pathname||!T.pathname.includes("?"),Db("?","pathname","search",T)),Gr(!T.pathname||!T.pathname.includes("#"),Db("#","pathname","hash",T)),Gr(!T.search||!T.search.includes("#"),Db("#","search","hash",T)));let I=r===""||T.pathname==="",R=I?"/":T.pathname,o;if(R==null)o=p;else{let te=l.length-1;if(!y&&R.startsWith("..")){let Y=R.split("/");for(;Y[0]==="..";)Y.shift(),te-=1;T.pathname=Y.join("/")}o=te>=0?l[te]:"/"}let j=qj(T,o),W=R&&R!=="/"&&R.endsWith("/"),re=(I||R===".")&&p.endsWith("/");return!j.pathname.endsWith("/")&&(W||re)&&(j.pathname+="/"),j}const _u=r=>r.join("/").replace(/\/\/+/g,"/"),Xj=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),Yj=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,Kj=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function Qj(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const Gz=["post","put","patch","delete"];new Set(Gz);const Jj=["get",...Gz];new Set(Jj);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Zg(){return Zg=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var p=arguments[l];for(var y in p)Object.prototype.hasOwnProperty.call(p,y)&&(r[y]=p[y])}return r},Zg.apply(this,arguments)}const s2=xe.createContext(null),eV=xe.createContext(null),Xh=xe.createContext(null),Jv=xe.createContext(null),Yh=xe.createContext({outlet:null,matches:[],isDataRoute:!1}),$z=xe.createContext(null);function tV(r,l){let{relative:p}=l===void 0?{}:l;o_()||Gr(!1);let{basename:y,navigator:T}=xe.useContext(Xh),{hash:I,pathname:R,search:o}=Wz(r,{relative:p}),j=R;return y!=="/"&&(j=R==="/"?y:_u([y,R])),T.createHref({pathname:j,search:o,hash:I})}function o_(){return xe.useContext(Jv)!=null}function s_(){return o_()||Gr(!1),xe.useContext(Jv).location}function Hz(r){xe.useContext(Xh).static||xe.useLayoutEffect(r)}function qz(){let{isDataRoute:r}=xe.useContext(Yh);return r?pV():iV()}function iV(){o_()||Gr(!1);let r=xe.useContext(s2),{basename:l,future:p,navigator:y}=xe.useContext(Xh),{matches:T}=xe.useContext(Yh),{pathname:I}=s_(),R=JSON.stringify(Vz(T,p.v7_relativeSplatPath)),o=xe.useRef(!1);return Hz(()=>{o.current=!0}),xe.useCallback(function(W,re){if(re===void 0&&(re={}),!o.current)return;if(typeof W=="number"){y.go(W);return}let te=Uz(W,JSON.parse(R),I,re.relative==="path");r==null&&l!=="/"&&(te.pathname=te.pathname==="/"?l:_u([l,te.pathname])),(re.replace?y.replace:y.push)(te,re.state,re)},[l,y,R,I,r])}function Wz(r,l){let{relative:p}=l===void 0?{}:l,{future:y}=xe.useContext(Xh),{matches:T}=xe.useContext(Yh),{pathname:I}=s_(),R=JSON.stringify(Vz(T,y.v7_relativeSplatPath));return xe.useMemo(()=>Uz(r,JSON.parse(R),I,p==="path"),[r,R,I,p])}function nV(r,l){return rV(r,l)}function rV(r,l,p,y){o_()||Gr(!1);let{navigator:T}=xe.useContext(Xh),{matches:I}=xe.useContext(Yh),R=I[I.length-1],o=R?R.params:{};R&&R.pathname;let j=R?R.pathnameBase:"/";R&&R.route;let W=s_(),re;if(l){var te;let Pe=typeof l=="string"?lp(l):l;j==="/"||(te=Pe.pathname)!=null&&te.startsWith(j)||Gr(!1),re=Pe}else re=W;let Y=re.pathname||"/",Ee=Y;if(j!=="/"){let Pe=j.replace(/^\//,"").split("/");Ee="/"+Y.replace(/^\//,"").split("/").slice(Pe.length).join("/")}let Ie=zj(r,{pathname:Ee}),me=cV(Ie&&Ie.map(Pe=>Object.assign({},Pe,{params:Object.assign({},o,Pe.params),pathname:_u([j,T.encodeLocation?T.encodeLocation(Pe.pathname).pathname:Pe.pathname]),pathnameBase:Pe.pathnameBase==="/"?j:_u([j,T.encodeLocation?T.encodeLocation(Pe.pathnameBase).pathname:Pe.pathnameBase])})),I,p,y);return l&&me?xe.createElement(Jv.Provider,{value:{location:Zg({pathname:"/",search:"",hash:"",state:null,key:"default"},re),navigationType:lu.Pop}},me):me}function oV(){let r=fV(),l=Qj(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),p=r instanceof Error?r.stack:null,T={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return xe.createElement(xe.Fragment,null,xe.createElement("h2",null,"Unexpected Application Error!"),xe.createElement("h3",{style:{fontStyle:"italic"}},l),p?xe.createElement("pre",{style:T},p):null,null)}const sV=xe.createElement(oV,null);class aV extends xe.Component{constructor(l){super(l),this.state={location:l.location,revalidation:l.revalidation,error:l.error}}static getDerivedStateFromError(l){return{error:l}}static getDerivedStateFromProps(l,p){return p.location!==l.location||p.revalidation!=="idle"&&l.revalidation==="idle"?{error:l.error,location:l.location,revalidation:l.revalidation}:{error:l.error!==void 0?l.error:p.error,location:p.location,revalidation:l.revalidation||p.revalidation}}componentDidCatch(l,p){console.error("React Router caught the following error during render",l,p)}render(){return this.state.error!==void 0?xe.createElement(Yh.Provider,{value:this.props.routeContext},xe.createElement($z.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function lV(r){let{routeContext:l,match:p,children:y}=r,T=xe.useContext(s2);return T&&T.static&&T.staticContext&&(p.route.errorElement||p.route.ErrorBoundary)&&(T.staticContext._deepestRenderedBoundaryId=p.route.id),xe.createElement(Yh.Provider,{value:l},y)}function cV(r,l,p,y){var T;if(l===void 0&&(l=[]),p===void 0&&(p=null),y===void 0&&(y=null),r==null){var I;if(!p)return null;if(p.errors)r=p.matches;else if((I=y)!=null&&I.v7_partialHydration&&l.length===0&&!p.initialized&&p.matches.length>0)r=p.matches;else return null}let R=r,o=(T=p)==null?void 0:T.errors;if(o!=null){let re=R.findIndex(te=>te.route.id&&(o==null?void 0:o[te.route.id])!==void 0);re>=0||Gr(!1),R=R.slice(0,Math.min(R.length,re+1))}let j=!1,W=-1;if(p&&y&&y.v7_partialHydration)for(let re=0;re<R.length;re++){let te=R[re];if((te.route.HydrateFallback||te.route.hydrateFallbackElement)&&(W=re),te.route.id){let{loaderData:Y,errors:Ee}=p,Ie=te.route.loader&&Y[te.route.id]===void 0&&(!Ee||Ee[te.route.id]===void 0);if(te.route.lazy||Ie){j=!0,W>=0?R=R.slice(0,W+1):R=[R[0]];break}}}return R.reduceRight((re,te,Y)=>{let Ee,Ie=!1,me=null,Pe=null;p&&(Ee=o&&te.route.id?o[te.route.id]:void 0,me=te.route.errorElement||sV,j&&(W<0&&Y===0?(Ie=!0,Pe=null):W===Y&&(Ie=!0,Pe=te.route.hydrateFallbackElement||null)));let he=l.concat(R.slice(0,Y+1)),pe=()=>{let we;return Ee?we=me:Ie?we=Pe:te.route.Component?we=xe.createElement(te.route.Component,null):te.route.element?we=te.route.element:we=re,xe.createElement(lV,{match:te,routeContext:{outlet:re,matches:he,isDataRoute:p!=null},children:we})};return p&&(te.route.ErrorBoundary||te.route.errorElement||Y===0)?xe.createElement(aV,{location:p.location,revalidation:p.revalidation,component:me,error:Ee,children:pe(),routeContext:{outlet:null,matches:he,isDataRoute:!0}}):pe()},null)}var Zz=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(Zz||{}),wv=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(wv||{});function uV(r){let l=xe.useContext(s2);return l||Gr(!1),l}function hV(r){let l=xe.useContext(eV);return l||Gr(!1),l}function dV(r){let l=xe.useContext(Yh);return l||Gr(!1),l}function Xz(r){let l=dV(),p=l.matches[l.matches.length-1];return p.route.id||Gr(!1),p.route.id}function fV(){var r;let l=xe.useContext($z),p=hV(wv.UseRouteError),y=Xz(wv.UseRouteError);return l!==void 0?l:(r=p.errors)==null?void 0:r[y]}function pV(){let{router:r}=uV(Zz.UseNavigateStable),l=Xz(wv.UseNavigateStable),p=xe.useRef(!1);return Hz(()=>{p.current=!0}),xe.useCallback(function(T,I){I===void 0&&(I={}),p.current&&(typeof T=="number"?r.navigate(T):r.navigate(T,Zg({fromRouteId:l},I)))},[r,l])}function fg(r){Gr(!1)}function mV(r){let{basename:l="/",children:p=null,location:y,navigationType:T=lu.Pop,navigator:I,static:R=!1,future:o}=r;o_()&&Gr(!1);let j=l.replace(/^\/*/,"/"),W=xe.useMemo(()=>({basename:j,navigator:I,static:R,future:Zg({v7_relativeSplatPath:!1},o)}),[j,o,I,R]);typeof y=="string"&&(y=lp(y));let{pathname:re="/",search:te="",hash:Y="",state:Ee=null,key:Ie="default"}=y,me=xe.useMemo(()=>{let Pe=o2(re,j);return Pe==null?null:{location:{pathname:Pe,search:te,hash:Y,state:Ee,key:Ie},navigationType:T}},[j,re,te,Y,Ee,Ie,T]);return me==null?null:xe.createElement(Xh.Provider,{value:W},xe.createElement(Jv.Provider,{children:p,value:me}))}function gV(r){let{children:l,location:p}=r;return nV($w(l),p)}new Promise(()=>{});function $w(r,l){l===void 0&&(l=[]);let p=[];return xe.Children.forEach(r,(y,T)=>{if(!xe.isValidElement(y))return;let I=[...l,T];if(y.type===xe.Fragment){p.push.apply(p,$w(y.props.children,I));return}y.type!==fg&&Gr(!1),!y.props.index||!y.props.children||Gr(!1);let R={id:y.props.id||I.join("-"),caseSensitive:y.props.caseSensitive,element:y.props.element,Component:y.props.Component,index:y.props.index,path:y.props.path,loader:y.props.loader,action:y.props.action,errorElement:y.props.errorElement,ErrorBoundary:y.props.ErrorBoundary,hasErrorBoundary:y.props.ErrorBoundary!=null||y.props.errorElement!=null,shouldRevalidate:y.props.shouldRevalidate,handle:y.props.handle,lazy:y.props.lazy};y.props.children&&(R.children=$w(y.props.children,I)),p.push(R)}),p}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Hw(){return Hw=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var p=arguments[l];for(var y in p)Object.prototype.hasOwnProperty.call(p,y)&&(r[y]=p[y])}return r},Hw.apply(this,arguments)}function _V(r,l){if(r==null)return{};var p={},y=Object.keys(r),T,I;for(I=0;I<y.length;I++)T=y[I],!(l.indexOf(T)>=0)&&(p[T]=r[T]);return p}function yV(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function vV(r,l){return r.button===0&&(!l||l==="_self")&&!yV(r)}const xV=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],bV="6";try{window.__reactRouterVersion=bV}catch{}const wV="startTransition",GC=uM[wV];function TV(r){let{basename:l,children:p,future:y,window:T}=r,I=xe.useRef();I.current==null&&(I.current=Mj({window:T,v5Compat:!0}));let R=I.current,[o,j]=xe.useState({action:R.action,location:R.location}),{v7_startTransition:W}=y||{},re=xe.useCallback(te=>{W&&GC?GC(()=>j(te)):j(te)},[j,W]);return xe.useLayoutEffect(()=>R.listen(re),[R,re]),xe.createElement(mV,{basename:l,children:p,location:o.location,navigationType:o.action,navigator:R,future:y})}const SV=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",EV=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Xg=xe.forwardRef(function(l,p){let{onClick:y,relative:T,reloadDocument:I,replace:R,state:o,target:j,to:W,preventScrollReset:re,viewTransition:te}=l,Y=_V(l,xV),{basename:Ee}=xe.useContext(Xh),Ie,me=!1;if(typeof W=="string"&&EV.test(W)&&(Ie=W,SV))try{let we=new URL(window.location.href),Ue=W.startsWith("//")?new URL(we.protocol+W):new URL(W),tt=o2(Ue.pathname,Ee);Ue.origin===we.origin&&tt!=null?W=tt+Ue.search+Ue.hash:me=!0}catch{}let Pe=tV(W,{relative:T}),he=IV(W,{replace:R,state:o,target:j,preventScrollReset:re,relative:T,viewTransition:te});function pe(we){y&&y(we),we.defaultPrevented||he(we)}return xe.createElement("a",Hw({},Y,{href:Ie||Pe,onClick:me||I?y:pe,ref:p,target:j}))});var $C;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})($C||($C={}));var HC;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(HC||(HC={}));function IV(r,l){let{target:p,replace:y,state:T,preventScrollReset:I,relative:R,viewTransition:o}=l===void 0?{}:l,j=qz(),W=s_(),re=Wz(r,{relative:R});return xe.useCallback(te=>{if(vV(te,p)){te.preventDefault();let Y=y!==void 0?y:bv(W)===bv(re);j(r,{replace:Y,state:T,preventScrollReset:I,relative:R,viewTransition:o})}},[W,j,re,y,T,p,r,I,R,o])}const Vr=[{id:1,date:"August 30, 2025",location:"Palermo",coordinates:[13.3614,38.1157],zoomLevel:12,accommodation:{name:"Via gallo Nicolo2",address:"Via gallo Nicolo2 Palermo, PA 90139",checkIn:"2.00 pm - 00.00 pm",checkOut:"12.00 pm",parking:"Aanwezig (nog niet zeker of het mee in de prijs zit)",contact:"+39 913819026"},activities:[],extra:["Geen Zwembad"]},{id:2,date:"August 31, 2025",location:"Palermo",coordinates:[13.3614,38.1157],zoomLevel:12,accommodation:{name:"Via gallo Nicolo2",address:"Via gallo Nicolo2 Palermo, PA 90139"},activities:[]},{id:3,date:"September 1, 2025",location:"Trapani",coordinates:[12.5144,38.0173],zoomLevel:13,accommodation:{name:"Hotel San Michele",address:"Viale Regina Margherita, 31  Trapani 91100",checkIn:"2.00 pm - 00.00 pm",checkOut:"11:00 am",parking:"Parking available in Piazza Vittorio Emanuele (next to hotel) for 0.20/hour in winter and 0.50/hour in summer. Use coins in ticket machines or the Easypark/Droptickets apps. Display ticket on dashboard. Reception can assist with information, bookings, tours, and airport transfers.",contact:"+39 0923 365728",bookedBy:"Stijn"},activities:[],extra:["Rooftop zwembad"],travelFrom:"Palermo"},{id:4,date:"September 2, 2025",location:"Trapani",coordinates:[12.5144,38.0173],zoomLevel:13,accommodation:{name:"Hotel San Michele",address:"Viale Regina Margherita, 31  Trapani 91100"},activities:[]},{id:5,date:"September 3, 2025",location:"Agrigento",coordinates:[13.5819,37.3089],zoomLevel:13,accommodation:{name:"Salita Francesco Sala 2",address:"Salita Francesco Sala 2, Agrigento, 92100, IT",checkIn:"2.00 pm - 08.00 pm",checkOut:"11:00 am",parking:"mail gestuurd",contact:"+393921038256",bookedBy:"Ine"},activities:[],extra:["Geen zwembad"],travelFrom:"Trapani"},{id:6,date:"September 4, 2025",location:"Noto",coordinates:[15.0698,36.8924],zoomLevel:13,accommodation:{name:"Casale Modica",address:"Loc. Casale Modica Sp.26 snc",checkIn:"/",checkOut:"/",parking:"Parking aanwezig",contact:"+393938336595",bookedBy:"Ine"},activities:[],extra:["Wel een zwembad niet te veel doen hier is chill","Hier ontbijt eens nemen","Fietsen gebruiken/huren kan ook"],travelFrom:"Agrigento"},{id:7,date:"September 5, 2025",location:"Noto",coordinates:[15.0698,36.8924],zoomLevel:13,accommodation:{name:"Casale Modica",address:"Loc. Casale Modica Sp.26 snc"},activities:["Restaurant geboekt (Manna Noto)"]},{id:8,date:"September 6, 2025",location:"Regalbuto",coordinates:[14.6383,37.6513],zoomLevel:13,accommodation:{name:"Rocca dei Saraceni",address:"Contrada Sotto Rocca - 94017 Regalbuto (Enna)",checkIn:"16:00 - 21:00",checkOut:"before 11:00",parking:"Parking aanwezig",contact:"+39093571978",bookedBy:"Ine",url:"https://www.caractere.be/nl/hotel/rocca-dei-saraceni"},activities:[],extra:["Restaurant aanwezig","Ook een zwembad"],travelFrom:"Noto"},{id:9,date:"September 7, 2025",location:"Regalbuto",coordinates:[14.6383,37.6513],zoomLevel:13,accommodation:{name:"Rocca dei Saraceni",address:"Contrada Sotto Rocca - 94017 Regalbuto (Enna)"},activities:[]},{id:10,date:"September 8, 2025",location:"Nicolosi",coordinates:[15.0233,37.6113],zoomLevel:14,accommodation:{name:"Criu Boutique Hotel",address:"Viale della Regione, n 12 Nicolosi",checkIn:"mail gestuurd",checkOut:"",parking:"Parking aanwezig",contact:"0039 3277575338",bookedBy:"Ine",url:"https://www.criuboutiquehotel.it/index_en.php"},activities:["Vragen voor kook cursus"],extra:["Geen zwembad","Restaurant aanwezig","Breakfast Included"],travelFrom:"Regalbuto"},{id:11,date:"September 9, 2025",location:"Maina",coordinates:[14.786311,38.12027],zoomLevel:13,accommodation:{name:"Maina Country Resort",address:"C/DA MAINA 259 NASO, ME 98074",checkIn:"",checkOut:"",parking:"Parking daar aanwezig",contact:"+39 348 300 2704",bookedBy:"Stijn",url:"https://mainacountryresort.it/"},activities:[],travelFrom:"Nicolosi"},{id:12,date:"September 10, 2025",location:"Maina",coordinates:[14.786311,38.12027],zoomLevel:13,accommodation:{name:"Maina Country Resort",address:"C/DA MAINA 259 NASO, ME 98074"},activities:[]},{id:13,date:"September 11, 2025",location:"Cefal",coordinates:[14.0223,38.041],zoomLevel:13,accommodation:{name:"Elecla Cefal",address:"24 Via Costa, Cefal, 90015, Itali",checkIn:"15:00",checkOut:"voor 10:00",parking:"Er is geen parkeergelegenheid. (Lungomare street parking for free)",contact:"+393761602060",bookedBy:"Booking Stijn",bookingNumber:"4855782440",url:"https://www.booking.com/hotel/it/elecla-cefalu.nl.html"},activities:[],extra:["geen zwembad"],travelFrom:"Maina"},{id:14,date:"September 12, 2025",location:"Cefal",coordinates:[14.0223,38.041],zoomLevel:13,accommodation:{name:"Elecla Cefal",address:"24 Via Costa, Cefal, 90015, Itali"},activities:[]},{id:15,date:"September 13, 2025",location:"Palermo",coordinates:[13.3614,38.1157],zoomLevel:12,accommodation:{name:"Addimura Rooms",address:"VIA MAQUEDA 331, 90133 Palermo, Itali",checkIn:"13:30 - 23:30",checkOut:"(08:00 - 11:00)",contact:"+393762630001",bookedBy:"Booking Stijn",url:"https://www.booking.com/hotel/it/addimura-rooms.nl.html"},activities:["Cooking Workshop at Susafa"],travelFrom:"Cefal"},{id:16,date:"September 14, 2025",location:"Palermo",coordinates:[13.3614,38.1157],zoomLevel:12,accommodation:{name:"Addimura Rooms",address:"VIA MAQUEDA 331, 90133 Palermo, Itali"},activities:["Flight back home"]}],Yz=()=>{const r=Vr.reduce((l,p)=>{if(p.travelDistance){const y=p.travelDistance.match(/(\d+)/);if(y&&y[1])return l+parseInt(y[1],10)}return l},0);return ce.jsx("header",{className:"absolute top-0 left-0 right-0 z-30 bg-gradient-to-b from-black/80 to-transparent py-4 px-6",children:ce.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[ce.jsx("h1",{className:"text-white text-2xl md:text-3xl font-bold",children:"Sicily Journey"}),ce.jsxs("div",{className:"text-white/90",children:[ce.jsxs("p",{className:"hidden md:block",children:["Summer 2025  ",r," km total"]}),ce.jsx("p",{className:"md:hidden text-sm",children:"Summer 2025"})]})]})})};var Kz={exports:{}};(function(r,l){(function(p,y){r.exports=y()})($3,function(){var p,y,T;function I(o,j){if(!p)p=j;else if(!y)y=j;else{var W="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+p+")(sharedChunk); ("+y+")(sharedChunk); self.onerror = null;",re={};p(re),T=j(re),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(T.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}I(["exports"],function(o){var j=1e-6,W=typeof Float32Array<"u"?Float32Array:Array;function re(n,e){var i=e[0],a=e[1],c=e[2],d=e[3],f=i*d-c*a;return f?(n[0]=d*(f=1/f),n[1]=-a*f,n[2]=-c*f,n[3]=i*f,n):null}function te(){var n=new W(9);return W!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Y(n,e){var i=e[0],a=e[1],c=e[2],d=e[3],f=e[4],_=e[5],x=e[6],w=e[7],E=e[8];return n[0]=f*E-_*w,n[1]=c*w-a*E,n[2]=a*_-c*f,n[3]=_*x-d*E,n[4]=i*E-c*x,n[5]=c*d-i*_,n[6]=d*w-f*x,n[7]=a*x-i*w,n[8]=i*f-a*d,n}function Ee(n,e,i){var a=e[0],c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],w=e[6],E=e[7],A=e[8],M=i[0],L=i[1],k=i[2],F=i[3],$=i[4],q=i[5],ee=i[6],K=i[7],B=i[8];return n[0]=M*a+L*f+k*w,n[1]=M*c+L*_+k*E,n[2]=M*d+L*x+k*A,n[3]=F*a+$*f+q*w,n[4]=F*c+$*_+q*E,n[5]=F*d+$*x+q*A,n[6]=ee*a+K*f+B*w,n[7]=ee*c+K*_+B*E,n[8]=ee*d+K*x+B*A,n}function Ie(){var n=new W(16);return W!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function me(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Pe(n,e){var i=e[0],a=e[1],c=e[2],d=e[3],f=e[4],_=e[5],x=e[6],w=e[7],E=e[8],A=e[9],M=e[10],L=e[11],k=e[12],F=e[13],$=e[14],q=e[15],ee=i*_-a*f,K=i*x-c*f,B=i*w-d*f,Z=a*x-c*_,J=a*w-d*_,oe=c*w-d*x,_e=E*F-A*k,Se=E*$-M*k,Ae=E*q-L*k,De=A*$-M*F,qe=A*q-L*F,rt=M*q-L*$,Je=ee*rt-K*qe+B*De+Z*Ae-J*Se+oe*_e;return Je?(n[0]=(_*rt-x*qe+w*De)*(Je=1/Je),n[1]=(c*qe-a*rt-d*De)*Je,n[2]=(F*oe-$*J+q*Z)*Je,n[3]=(M*J-A*oe-L*Z)*Je,n[4]=(x*Ae-f*rt-w*Se)*Je,n[5]=(i*rt-c*Ae+d*Se)*Je,n[6]=($*B-k*oe-q*K)*Je,n[7]=(E*oe-M*B+L*K)*Je,n[8]=(f*qe-_*Ae+w*_e)*Je,n[9]=(a*Ae-i*qe-d*_e)*Je,n[10]=(k*J-F*B+q*ee)*Je,n[11]=(A*B-E*J-L*ee)*Je,n[12]=(_*Se-f*De-x*_e)*Je,n[13]=(i*De-a*Se+c*_e)*Je,n[14]=(F*K-k*Z-$*ee)*Je,n[15]=(E*Z-A*K+M*ee)*Je,n):null}function he(n,e,i){var a=e[0],c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],w=e[6],E=e[7],A=e[8],M=e[9],L=e[10],k=e[11],F=e[12],$=e[13],q=e[14],ee=e[15],K=i[0],B=i[1],Z=i[2],J=i[3];return n[0]=K*a+B*_+Z*A+J*F,n[1]=K*c+B*x+Z*M+J*$,n[2]=K*d+B*w+Z*L+J*q,n[3]=K*f+B*E+Z*k+J*ee,n[4]=(K=i[4])*a+(B=i[5])*_+(Z=i[6])*A+(J=i[7])*F,n[5]=K*c+B*x+Z*M+J*$,n[6]=K*d+B*w+Z*L+J*q,n[7]=K*f+B*E+Z*k+J*ee,n[8]=(K=i[8])*a+(B=i[9])*_+(Z=i[10])*A+(J=i[11])*F,n[9]=K*c+B*x+Z*M+J*$,n[10]=K*d+B*w+Z*L+J*q,n[11]=K*f+B*E+Z*k+J*ee,n[12]=(K=i[12])*a+(B=i[13])*_+(Z=i[14])*A+(J=i[15])*F,n[13]=K*c+B*x+Z*M+J*$,n[14]=K*d+B*w+Z*L+J*q,n[15]=K*f+B*E+Z*k+J*ee,n}function pe(n,e,i){var a,c,d,f,_,x,w,E,A,M,L,k,F=i[0],$=i[1],q=i[2];return e===n?(n[12]=e[0]*F+e[4]*$+e[8]*q+e[12],n[13]=e[1]*F+e[5]*$+e[9]*q+e[13],n[14]=e[2]*F+e[6]*$+e[10]*q+e[14],n[15]=e[3]*F+e[7]*$+e[11]*q+e[15]):(c=e[1],d=e[2],f=e[3],_=e[4],x=e[5],w=e[6],E=e[7],A=e[8],M=e[9],L=e[10],k=e[11],n[0]=a=e[0],n[1]=c,n[2]=d,n[3]=f,n[4]=_,n[5]=x,n[6]=w,n[7]=E,n[8]=A,n[9]=M,n[10]=L,n[11]=k,n[12]=a*F+_*$+A*q+e[12],n[13]=c*F+x*$+M*q+e[13],n[14]=d*F+w*$+L*q+e[14],n[15]=f*F+E*$+k*q+e[15]),n}function we(n,e,i){var a=i[0],c=i[1],d=i[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Ue(n,e,i){var a=Math.sin(i),c=Math.cos(i),d=e[4],f=e[5],_=e[6],x=e[7],w=e[8],E=e[9],A=e[10],M=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*c+w*a,n[5]=f*c+E*a,n[6]=_*c+A*a,n[7]=x*c+M*a,n[8]=w*c-d*a,n[9]=E*c-f*a,n[10]=A*c-_*a,n[11]=M*c-x*a,n}function tt(n,e,i){var a=Math.sin(i),c=Math.cos(i),d=e[0],f=e[1],_=e[2],x=e[3],w=e[8],E=e[9],A=e[10],M=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*c-w*a,n[1]=f*c-E*a,n[2]=_*c-A*a,n[3]=x*c-M*a,n[8]=d*a+w*c,n[9]=f*a+E*c,n[10]=_*a+A*c,n[11]=x*a+M*c,n}function _t(n,e,i){var a=Math.sin(i),c=Math.cos(i),d=e[0],f=e[1],_=e[2],x=e[3],w=e[4],E=e[5],A=e[6],M=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*c+w*a,n[1]=f*c+E*a,n[2]=_*c+A*a,n[3]=x*c+M*a,n[4]=w*c-d*a,n[5]=E*c-f*a,n[6]=A*c-_*a,n[7]=M*c-x*a,n}function wt(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function xt(n,e,i){var a,c,d,f=i[0],_=i[1],x=i[2],w=Math.hypot(f,_,x);return w<j?null:(f*=w=1/w,_*=w,x*=w,a=Math.sin(e),c=Math.cos(e),n[0]=f*f*(d=1-c)+c,n[1]=_*f*d+x*a,n[2]=x*f*d-_*a,n[3]=0,n[4]=f*_*d-x*a,n[5]=_*_*d+c,n[6]=x*_*d+f*a,n[7]=0,n[8]=f*x*d+_*a,n[9]=_*x*d-f*a,n[10]=x*x*d+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function ci(n,e){var i=e[0],a=e[1],c=e[2],d=e[3],f=i+i,_=a+a,x=c+c,w=i*f,E=a*f,A=a*_,M=c*f,L=c*_,k=c*x,F=d*f,$=d*_,q=d*x;return n[0]=1-A-k,n[1]=E+q,n[2]=M-$,n[3]=0,n[4]=E-q,n[5]=1-w-k,n[6]=L+F,n[7]=0,n[8]=M+$,n[9]=L-F,n[10]=1-w-A,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var ti=he;function ni(){var n=new W(3);return W!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ui(n){var e=new W(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Pi(n){return Math.hypot(n[0],n[1],n[2])}function Vt(n,e,i){var a=new W(3);return a[0]=n,a[1]=e,a[2]=i,a}function vi(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function ai(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function Vi(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function ft(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function $t(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function Gt(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function ii(n,e,i,a){return n[0]=e[0]+i[0]*a,n[1]=e[1]+i[1]*a,n[2]=e[2]+i[2]*a,n}function Li(n,e){var i=e[0]-n[0],a=e[1]-n[1],c=e[2]-n[2];return i*i+a*a+c*c}function Ji(n){var e=n[0],i=n[1],a=n[2];return e*e+i*i+a*a}function Vn(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function $i(n,e){var i=e[0],a=e[1],c=e[2],d=i*i+a*a+c*c;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n}function Ei(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function xn(n,e,i){var a=e[0],c=e[1],d=e[2],f=i[0],_=i[1],x=i[2];return n[0]=c*x-d*_,n[1]=d*f-a*x,n[2]=a*_-c*f,n}function fo(n,e,i,a){var c=e[0],d=e[1],f=e[2];return n[0]=c+a*(i[0]-c),n[1]=d+a*(i[1]-d),n[2]=f+a*(i[2]-f),n}function fn(n,e,i){var a=e[0],c=e[1],d=e[2],f=i[3]*a+i[7]*c+i[11]*d+i[15];return n[0]=(i[0]*a+i[4]*c+i[8]*d+i[12])/(f=f||1),n[1]=(i[1]*a+i[5]*c+i[9]*d+i[13])/f,n[2]=(i[2]*a+i[6]*c+i[10]*d+i[14])/f,n}function po(n,e,i){var a=e[0],c=e[1],d=e[2];return n[0]=a*i[0]+c*i[3]+d*i[6],n[1]=a*i[1]+c*i[4]+d*i[7],n[2]=a*i[2]+c*i[5]+d*i[8],n}function Oo(n,e,i){var a=i[0],c=i[1],d=i[2],f=e[0],_=e[1],x=e[2],w=c*x-d*_,E=d*f-a*x,A=a*_-c*f,M=c*A-d*E,L=d*w-a*A,k=a*E-c*w,F=2*i[3];return E*=F,A*=F,L*=2,k*=2,n[0]=f+(w*=F)+(M*=2),n[1]=_+E+L,n[2]=x+A+k,n}function Ir(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var Tn=ai,ea=Vi,Wo=Pi;function ir(){var n=new W(4);return W!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Fo(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function Zo(n,e){var i=e[0],a=e[1],c=e[2],d=e[3],f=i*i+a*a+c*c+d*d;return f>0&&(f=1/Math.sqrt(f)),n[0]=i*f,n[1]=a*f,n[2]=c*f,n[3]=d*f,n}function Bn(n,e,i){var a=e[0],c=e[1],d=e[2],f=e[3];return n[0]=i[0]*a+i[4]*c+i[8]*d+i[12]*f,n[1]=i[1]*a+i[5]*c+i[9]*d+i[13]*f,n[2]=i[2]*a+i[6]*c+i[10]*d+i[14]*f,n[3]=i[3]*a+i[7]*c+i[11]*d+i[15]*f,n}function Or(){var n=new W(4);return W!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Fs(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function hs(n,e,i){i*=.5;var a=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(i),x=Math.cos(i);return n[0]=a*x+f*_,n[1]=c*x+d*_,n[2]=d*x-c*_,n[3]=f*x-a*_,n}function Xo(n,e,i){i*=.5;var a=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(i),x=Math.cos(i);return n[0]=a*x-d*_,n[1]=c*x+f*_,n[2]=d*x+a*_,n[3]=f*x-c*_,n}ni(),ir();var $r,Jr,ta,wo,ia,Hr=Zo,Yo=($r=ni(),Jr=Vt(1,0,0),ta=Vt(0,1,0),function(n,e,i){var a=Ei(e,i);return a<-.999999?(xn($r,Jr,e),Wo($r)<1e-6&&xn($r,ta,e),$i($r,$r),function(c,d,f){f*=.5;var _=Math.sin(f);c[0]=_*d[0],c[1]=_*d[1],c[2]=_*d[2],c[3]=Math.cos(f)}(n,$r,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(xn($r,e,i),n[0]=$r[0],n[1]=$r[1],n[2]=$r[2],n[3]=1+a,Hr(n,n))});function qr(){var n=new W(2);return W!=Float32Array&&(n[0]=0,n[1]=0),n}function Bs(n,e){var i=new W(2);return i[0]=n,i[1]=e,i}function ds(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function Ko(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function fs(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function eo(n){return Math.hypot(n[0],n[1])}function hl(n,e){var i=e[0],a=e[1],c=i*i+a*a;return c>0&&(c=1/Math.sqrt(c)),n[0]=e[0]*c,n[1]=e[1]*c,n}function oi(n,e){return n[0]*e[0]+n[1]*e[1]}function Sn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}Or(),Or(),te(),qr();var Ln,ur,to=function(){if(ia)return wo;function n(e,i,a,c){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=a,this.p2y=c}return ia=1,wo=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,c=0;c<8;c++){var d=this.sampleCurveX(a)-e;if(Math.abs(d)<i)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=d/f}var _=0,x=1;for(a=e,c=0;c<20&&(d=this.sampleCurveX(a),!(Math.abs(d-e)<i));c++)e>d?_=a:x=a,a=.5*(x-_)+_;return a},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},wo}(),na=Sn(to);function dl(){if(ur)return Ln;function n(e,i){this.x=e,this.y=i}return ur=1,Ln=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,a=e.y-this.y;return i*i+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),a=Math.sin(e),c=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=c,this},_rotateAround:function(e,i){var a=Math.cos(e),c=Math.sin(e),d=i.y+c*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-c*(this.y-i.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},Ln}var gt=Sn(dl());function ra(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!ra(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!ra(n[i],e[i]))return!1;return!0}return n===e}const Kh=Math.PI/180,We=180/Math.PI;function G(n){return n*Kh}function X(n){return n*We}const ue=[[0,0],[1,0],[1,1],[0,1]];function Te(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function ve(n,e,i,a){const c=new na(n,e,i,a);return function(d){return c.solve(d)}}const Ce=ve(.25,.1,.25,1);function Me(n,e,i){return Math.min(i,Math.max(e,n))}function Re(n,e,i){return(i=Me((i-n)/(e-n),0,1))*i*(3-2*i)}function Ve(n,e,i){const a=i-e,c=((n-e)%a+a)%a+e;return c===e?i:c}function Ye(n,e,i){if(!n.length)return i(null,[]);let a=n.length;const c=new Array(n.length);let d=null;n.forEach((f,_)=>{e(f,(x,w)=>{x&&(d=x),c[_]=w,--a==0&&i(d,c)})})}function Ne(n,...e){for(const i of e)for(const a in i)n[a]=i[a];return n}let yt=1;function Et(){return yt++}function Ot(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function li(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function fi(n,e,i){const a={};for(const c in n)a[c]=e.call(this,n[c],c,n);return a}function xi(n,e,i){const a={};for(const c in n)e.call(this,n[c],c,n)&&(a[c]=n[c]);return a}function Ii(n){return Array.isArray(n)?n.map(Ii):typeof n=="object"&&n?fi(n,Ii):n}const Nn={};function Ci(n){Nn[n]||(typeof console<"u"&&console.warn(n),Nn[n]=!0)}function ln(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Ui(n){let e=0;for(let i,a,c=0,d=n.length,f=d-1;c<d;f=c++)i=n[c],a=n[f],e+=(a.x-i.x)*(i.y+a.y);return e}function cn([n,e,i]){const a=G(e+90),c=G(i);return{x:n*Math.cos(a)*Math.sin(c),y:n*Math.sin(a)*Math.sin(c),z:n*Math.cos(c),azimuthal:e,polar:i}}function pn(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Zn(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,c,d)=>{const f=c||d;return e[a]=!f||f.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let or=null;function yr(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function zr(n,e,i,a){for(;e<i;){const c=e+i>>1;n[c]<a?e=c+1:i=c}return e}function oa(n,e,i,a){for(;e<i;){const c=e+i>>1;n[c]<=a?e=c+1:i=c}return e}function Wr(n){return n>0?1/(1.001-n):1+n}function Zr(n){return n>0?1-1/(1.001-n):-n}function Ar(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Fr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Fr.API_URL)return null;try{const n=new URL(Fr.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ns(n){return Fr.API_URL_REGEX.test(n)}function fl(n){return Fr.API_SPRITE_REGEX.test(n)}let Cu,ic,Qh,Mu,pl,Pu;function cp(){return Cu==null&&(Cu=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Cu}const ps={now:()=>Mu!==void 0?Mu:performance.now(),setNow(n){Mu=n},restoreNow(){Mu=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:a}=n;pl||(pl=document.createElement("canvas"));const c=pl.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>pl.width||a>pl.height)&&(pl.width=i,pl.height=a),c.clearRect(-e,-e,i+2*e,a+2*e),c.drawImage(n,0,0,i,a),c.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:n=>(ic||(ic=document.createElement("a")),ic.href=n,ic.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Qh==null&&(Qh=window.matchMedia("(prefers-reduced-motion: reduce)")),Qh.matches)},hasCanvasFingerprintNoise(){if(Pu!==void 0)return Pu;if(!cp())return Pu=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let c=0;c<n.width;++c)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(c,0,1,1);const a=e.getImageData(0,0,n.width,n.height);i=0;for(let c=0;c<a.data.length;++c)if(c%4!=3&&i++!==a.data[c])return Pu=!0,!0;return Pu=!1,!1}};function up(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(n.slice(i));for(const c in e)a.set(c,e[c]);return`${n.slice(0,i)}?${a.toString()}`}function To(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const a=new URLSearchParams,c=new URLSearchParams(n.slice(i));for(const f of e.persistentParams){const _=c.get(f);_&&a.set(f,_)}const d=a.toString();return`${n.slice(0,i)}${d.length>0?`?${d}`:""}`}const ms="mapbox-tiles";let sa=500,gs=50;const aa=["language","worldview","jobid"];let Qo,Ru;function hp(){try{return caches}catch{}}function la(){const n=hp();n&&Qo==null&&(Qo=n.open(ms))}let zu=1/0;const dp={supported:!1,testSupport:function(n){!Jh&&io&&(ed?a_(n):Du=n)}};let Du,io,Jh=!1,ed=!1;const nc=typeof self<"u"?self:{};function a_(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,io),n.isContextLost())return;dp.supported=!0}catch{}n.deleteTexture(e),Jh=!0}nc.document&&(io=nc.document.createElement("img"),io.onload=function(){Du&&a_(Du),Du=null,ed=!0},io.onerror=function(){Jh=!0,Du=null},io.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const td={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(td);class id extends Error{constructor(e,i,a){i===401&&Ns(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ni=pn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,rc=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(Ni())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,c){const d=new AbortController,f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Ni(),referrerPolicy:a.referrerPolicy,signal:d.signal});let _=!1,x=!1;const w=(E=f.url).indexOf("sku=")>0&&Ns(E);var E;a.type==="json"&&f.headers.set("Accept","application/json");const A=(L,k,F)=>{if(x)return;if(L&&L.message!=="SecurityError"&&Ci(L.toString()),k&&F)return M(k);const $=Date.now();fetch(f).then(q=>{if(q.ok){const ee=w?q.clone():null;return M(q,ee,$)}return c(new id(q.statusText,q.status,a.url))}).catch(q=>{q.name!=="AbortError"&&c(new Error(`${q.message} ${a.url}`))})},M=(L,k,F)=>{(a.type==="arrayBuffer"?L.arrayBuffer():a.type==="json"?L.json():L.text()).then($=>{x||(k&&F&&function(q,ee,K){if(la(),Qo==null)return;const B=Zn(ee.headers.get("Cache-Control")||"");if(B["no-store"])return;const Z={status:ee.status,statusText:ee.statusText,headers:new Headers};ee.headers.forEach((_e,Se)=>Z.headers.set(Se,_e)),B["max-age"]&&Z.headers.set("Expires",new Date(K+1e3*B["max-age"]).toUTCString());const J=Z.headers.get("Expires");if(!J||new Date(J).getTime()-K<42e4)return;let oe=To(q.url,{persistentParams:aa});if(ee.status===206){const _e=q.headers.get("Range");if(!_e)return;Z.status=200,oe=up(oe,{range:_e})}(function(_e,Se){if(Ru===void 0)try{new Response(new ReadableStream),Ru=!0}catch{Ru=!1}Ru?Se(_e.body):_e.blob().then(Se).catch(Ae=>Ci(Ae.message))})(ee,_e=>{const Se=new Response((Ae=ee.status)!==200&&Ae!==404&&[101,103,204,205,304].includes(Ae)?null:_e,Z);var Ae;la(),Qo!=null&&Qo.then(De=>De.put(oe,Se)).catch(De=>Ci(De.message))})}(f,k,F),_=!0,c(null,$,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch($=>{x||c(new Error($.message))})};return w?function(L,k){if(la(),Qo==null)return k(null);Qo.then(F=>{let $=To(L.url,{persistentParams:aa});const q=L.headers.get("Range");q&&($=up($,{range:q})),F.match($).then(ee=>{const K=function(B){if(!B)return!1;const Z=new Date(B.headers.get("Expires")||0),J=Zn(B.headers.get("Cache-Control")||"");return Number(Z)>Date.now()&&!J["no-cache"]}(ee);F.delete($).catch(k),K&&F.put($,ee.clone()).catch(k),k(null,ee,K)}).catch(k)}).catch(k)}(f,A):A(null,null),{cancel:()=>{x=!0,_||d.abort()}}}(n,e);if(pn(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(a,c){const d=new XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const f in a.headers)d.setRequestHeader(f,a.headers[f]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let f=d.response;if(a.type==="json")try{f=JSON.parse(d.response)}catch(_){return c(_)}c(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else c(new id(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(n,e)},oc=function(n,e){return rc(Ne(n,{type:"arrayBuffer"}),e)};function tx(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const l_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ml,za;ml=[],za=0;const sc=function(n,e){if(dp.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),za>=Fr.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ml.push(d),d}za++;let i=!1;const a=()=>{if(!i)for(i=!0,za--;ml.length&&za<Fr.MAX_PARALLEL_IMAGE_REQUESTS;){const d=ml.shift(),{requestParameters:f,callback:_,cancelled:x}=d;x||(d.cancel=sc(f,_).cancel)}},c=oc(n,(d,f,_,x)=>{a(),d?e(d):f&&(self.createImageBitmap?function(w,E){const A=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(A).then(M=>{E(null,M)}).catch(M=>{E(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(w,E)=>e(w,E,_,x)):function(w,E){const A=new Image;A.onload=()=>{E(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=l_})},A.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(w)],{type:"image/png"});A.src=w.byteLength?URL.createObjectURL(M):l_}(f,(w,E)=>e(w,E,_,x)))});return{cancel:()=>{c.cancel(),a()}}};var c_,fp,gl,Lu={exports:{}},ac={exports:{}},nd={exports:{}},pp=function(){if(gl)return Lu.exports;gl=1;var n=(c_||(c_=1,ac.exports=function(i,a){var c,d,f,_,x,w,E,A;for(d=i.length-(c=3&i.length),f=a,x=3432918353,w=461845907,A=0;A<d;)E=255&i.charCodeAt(A)|(255&i.charCodeAt(++A))<<8|(255&i.charCodeAt(++A))<<16|(255&i.charCodeAt(++A))<<24,++A,f=27492+(65535&(_=5*(65535&(f=(f^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(E=0,c){case 3:E^=(255&i.charCodeAt(A+2))<<16;case 2:E^=(255&i.charCodeAt(A+1))<<8;case 1:f^=E=(65535&(E=(E=(65535&(E^=255&i.charCodeAt(A)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),ac.exports),e=(fp||(fp=1,nd.exports=function(i,a){for(var c,d=i.length,f=a^d,_=0;d>=4;)c=1540483477*(65535&(c=255&i.charCodeAt(_)|(255&i.charCodeAt(++_))<<8|(255&i.charCodeAt(++_))<<16|(255&i.charCodeAt(++_))<<24))+((1540483477*(c>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++_;switch(d){case 3:f^=(255&i.charCodeAt(_+2))<<16;case 2:f^=(255&i.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),nd.exports);return Lu.exports=n,Lu.exports.murmur3=n,Lu.exports.murmur2=e,Lu.exports}(),So=Sn(pp);class Da{constructor(e,...i){Ne(this,i[0]||{}),this.type=e}}class mp extends Da{constructor(e,i={}){super("error",Ne({error:e},i))}}function gp(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function rd(n,e,i){if(i&&i[n]){const a=i[n].indexOf(e);a!==-1&&i[n].splice(a,1)}}class _l{on(e,i){return this._listeners=this._listeners||{},gp(e,i,this._listeners),this}off(e,i){return rd(e,i,this._listeners),rd(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},gp(e,i,this._oneTimeListeners),this):new Promise(a=>{this.once(e,a)})}fire(e,i){const a=typeof e=="string"?new Da(e,i):e,c=a.type;if(this.listens(c)){a.target=this;const d=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of d)x.call(this,a);const f=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of f)rd(c,x,this._oneTimeListeners),x.call(this,a);const _=this._eventedParent;_&&(Ne(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(a))}else a instanceof mp&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Eo{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Eo(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,a]=e.split("");return new Eo({name:i,iconsetId:a})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Eo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var _p,od={},ku=function(){if(_p)return od;_p=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(d){return(d=Math.round(d))<0?0:d>255?255:d}function i(d){return e(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function a(d){return(f=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:f>1?1:f;var f}function c(d,f,_){return _<0?_+=1:_>1&&(_-=1),6*_<1?d+(f-d)*_*6:2*_<1?f:3*_<2?d+(f-d)*(2/3-_)*6:d}try{od.parseCSSColor=function(d){var f,_=d.replace(/ /g,"").toLowerCase();if(_ in n)return n[_].slice();if(_[0]==="#")return _.length===4?(f=parseInt(_.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:_.length===7&&(f=parseInt(_.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var x=_.indexOf("("),w=_.indexOf(")");if(x!==-1&&w+1===_.length){var E=_.substr(0,x),A=_.substr(x+1,w-(x+1)).split(","),M=1;switch(E){case"rgba":if(A.length!==4)return null;M=a(A.pop());case"rgb":return A.length!==3?null:[i(A[0]),i(A[1]),i(A[2]),M];case"hsla":if(A.length!==4)return null;M=a(A.pop());case"hsl":if(A.length!==3)return null;var L=(parseFloat(A[0])%360+360)%360/360,k=a(A[1]),F=a(A[2]),$=F<=.5?F*(k+1):F+k-F*k,q=2*F-$;return[e(255*c(q,$,L+1/3)),e(255*c(q,$,L)),e(255*c(q,$,L-1/3)),M];default:return null}}return null}}catch{}return od}();class Hi{constructor(e,i,a,c=1){this.r=e,this.g=i,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof Hi)return e;if(typeof e!="string")return;const i=ku.parseCSSColor(e);return i?new Hi(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[e,i,a,c]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(a)},${c})`}toString(){const[e,i,a,c]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*a)},${c})`}toRenderColor(e){const{r:i,g:a,b:c,a:d}=this;return new u_(e,i,a,c,d)}clone(){return new Hi(this.r,this.g,this.b,this.a)}}class u_{constructor(e,i,a,c,d){if(e){const f=e.image.height,_=f*f;i=d===0?0:i/d*(f-1),a=d===0?0:a/d*(f-1),c=d===0?0:c/d*(f-1);const x=Math.floor(i),w=Math.floor(a),E=Math.floor(c),A=Math.ceil(i),M=Math.ceil(a),L=Math.ceil(c),k=i-x,F=a-w,$=c-E,q=e.image.data,ee=4*(x+w*_+E*f),K=4*(x+w*_+L*f),B=4*(x+M*_+E*f),Z=4*(x+M*_+L*f),J=4*(A+w*_+E*f),oe=4*(A+w*_+L*f),_e=4*(A+M*_+E*f),Se=4*(A+M*_+L*f);if(ee<0||Se>=q.length)throw new Error("out of range");this.r=qt(qt(qt(q[ee],q[K],$),qt(q[B],q[Z],$),F),qt(qt(q[J],q[oe],$),qt(q[_e],q[Se],$),F),k)/255*d,this.g=qt(qt(qt(q[ee+1],q[K+1],$),qt(q[B+1],q[Z+1],$),F),qt(qt(q[J+1],q[oe+1],$),qt(q[_e+1],q[Se+1],$),F),k)/255*d,this.b=qt(qt(qt(q[ee+2],q[K+2],$),qt(q[B+2],q[Z+2],$),F),qt(qt(q[J+2],q[oe+2],$),qt(q[_e+2],q[Se+2],$),F),k)/255*d,this.a=d}else this.r=i,this.g=a,this.b=c,this.a=d}toArray(){const{r:e,g:i,b:a,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*i/c,255*a/c,c]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:i,b:a,a:c}=this,d=Math.min(Math.max(e/c,0),1),f=Math.min(Math.max(i/c,0),1),_=Math.min(Math.max(a/c,0),1),x=Math.min(d,f,_),w=Math.max(d,f,_),E=(x+w)/2;if(x===w)return[0,0,100*E,c];const A=w-x,M=E>.5?A/(2-w-x):A/(w+x);let L=0;return w===d?L=(f-_)/A+(f<_?6:0):w===f?L=(_-d)/A+2:w===_&&(L=(d-f)/A+4),L*=60,[Math.min(Math.max(L,0),360),Math.min(Math.max(100*M,0),100),Math.min(Math.max(100*E,0),100),c]}toArray01(){const{r:e,g:i,b:a,a:c}=this;return c===0?[0,0,0,0]:[e/c,i/c,a/c,c]}toArray01Scaled(e){const{r:i,g:a,b:c,a:d}=this;return d===0?[0,0,0]:[i/d*e,a/d*e,c/d*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:a,a:c}=this;return[e,i,a,c]}toArray01Linear(){const{r:e,g:i,b:a,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(i/c,2.2),Math.pow(a/c,2.2),c]}}function qt(n,e,i){return n*(1-i)+e*i}function h_(n,e,i){return n.map((a,c)=>qt(a,e[c],i))}function sd(n){return n*n*n*n*n}Hi.black=new Hi(0,0,0,1),Hi.white=new Hi(1,1,1,1),Hi.transparent=new Hi(0,0,0,0),Hi.red=new Hi(1,0,0,1),Hi.blue=new Hi(0,0,1,1);var ad=Object.freeze({__proto__:null,array:h_,color:function(n,e,i){return new Hi(qt(n.r,e.r,i),qt(n.g,e.g,i),qt(n.b,e.b,i),qt(n.a,e.a,i))},easeIn:sd,number:qt});function Ou(n,...e){for(const i of e)for(const a in i)n[a]=i[a];return n}class Jo extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class yl{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,c]of i)this.bindings[a]=c}concat(e){return new yl(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const La={kind:"null"},Ut={kind:"number"},on={kind:"string"},Xi={kind:"boolean"},mo={kind:"color"},ka={kind:"object"},Wi={kind:"value"},vl={kind:"collator"},Fu={kind:"formatted"},Bu={kind:"resolvedImage"};function no(n,e){return{kind:"array",itemType:n,N:e}}function sr(n){if(n.kind==="array"){const e=sr(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const ix=[La,Ut,on,Xi,mo,Fu,ka,no(Wi),Bu];function Nu(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Nu(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of ix)if(!Nu(i,e))return null}}return`Expected ${sr(n)} but found ${sr(e)} instead.`}function yp(n,e){return e.some(i=>i.kind===n.kind)}function lc(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}class Oa{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ld{constructor(e,i,a,c,d){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=c,this.textColor=d}}class ro{constructor(e){this.sections=e}static fromString(e){return new ro([new ld(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof ro?e:ro.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const c=i.image.getPrimary().id.toString();e.push(["image",c]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class _s{constructor(e,i={}){if(this.id=Eo.from(e),this.options=Object.assign({},i),i.transform){const{a,b:c,c:d,d:f,e:_,f:x}=i.transform;this.options.transform=new DOMMatrix([a,c,d,f,_,x])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:a,d:c,e:d,f}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:a,d:c,e:d,f}})}static parse(e){let i,a,c,d;try{({name:i,iconsetId:a,params:c,transform:d}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:f,b:_,c:x,d:w,e:E,f:A}=d||{};return new _s({name:i,iconsetId:a},{params:c,transform:new DOMMatrix([f,_,x,w,E,A])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class go{constructor(e,i,a,c,d=!1){this.primaryId=Eo.from(e),this.primaryOptions=i,a&&(this.secondaryId=Eo.from(a)),this.secondaryOptions=c,this.available=d}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new _s(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new _s(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?go.build({name:e}):e}static build(e,i,a,c){return!e||typeof e=="object"&&!("name"in e)?null:new go(e,a,i,c)}}function d_(n,e,i,a){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,e,i,a]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cc(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Hi||n instanceof Oa||n instanceof ro||n instanceof go)return!0;if(Array.isArray(n)){for(const e of n)if(!cc(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!cc(n[e]))return!1;return!0}return!1}function mr(n){if(n===null)return La;if(typeof n=="string")return on;if(typeof n=="boolean")return Xi;if(typeof n=="number")return Ut;if(n instanceof Hi)return mo;if(n instanceof Oa)return vl;if(n instanceof ro)return Fu;if(n instanceof go)return Bu;if(Array.isArray(n)){const e=n.length;let i;for(const a of n){const c=mr(a);if(i){if(i===c)continue;i=Wi;break}i=c}return no(i||Wi,e)}return ka}function oo(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Hi?n.toStringPremultipliedAlpha():n instanceof ro||n instanceof go?n.toString():JSON.stringify(n)}class bi{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!cc(e[1]))return i.error("invalid value");const a=e[1];let c=mr(a);const d=i.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new bi(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Hi?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof ro?this.value.serialize():this.value}}class Rt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ju={string:on,number:Ut,boolean:Xi,object:ka};class Qt{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,c=1;const d=e[0];if(d==="array"){let _,x;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in ju)||w==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);_=ju[w],c++}else _=Wi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}a=no(_,x)}else a=ju[d];const f=[];for(;c<e.length;c++){const _=i.parse(e[c],c,Wi);if(!_)return null;f.push(_)}return new Qt(a,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!Nu(this.type,mr(a)))return a;if(i===this.args.length-1)throw new Rt(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${sr(mr(a))} but was expected to be of type ${sr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(a=>a.serialize()))}}class xl{constructor(e){this.type=Fu,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const c=[];let d=!1;for(let f=1;f<=e.length-1;++f){const _=e[f];if(d&&typeof _=="object"&&!Array.isArray(_)){d=!1;let x=null;if(_["font-scale"]&&(x=i.parseObjectValue(_["font-scale"],f,"font-scale",Ut),!x))return null;let w=null;if(_["text-font"]&&(w=i.parseObjectValue(_["text-font"],f,"text-font",no(on)),!w))return null;let E=null;if(_["text-color"]&&(E=i.parseObjectValue(_["text-color"],f,"text-color",mo),!E))return null;const A=c[c.length-1];A.scale=x,A.font=w,A.textColor=E}else{const x=i.parse(e[f],f,Wi);if(!x)return null;const w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new xl(c)}evaluate(e){return new ro(this.sections.map(i=>{const a=i.content.evaluate(e);return mr(a)===Bu?new ld("",a,null,null,null):new ld(oo(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class uc{constructor(e,i,a,c){this._imageWarnHistory={},this.type=Bu,this.namePrimary=e,this.nameSecondary=i,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),c&&(this.paramsSecondary=c.params,this.iconsetIdSecondary=c.iconset?c.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let a=1;const c=[];function d(){if(a<e.length){const _=i.parse(e[a],a++,on);return _?(c.push({image:_,options:{}}),!0):(i.error(c.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(a<e.length){const x=e[a];if((_=x)===null||typeof _!="object"||Array.isArray(_))return!0;const w=x.params,E=x.iconset,A=i.concat(a);if(!w&&!E)return a++,!0;if(w){if(typeof w!="object"||w.constructor!==Object)return A.error('Image options "params" should be an object'),!1;const M={},L=A.concat(void 0,"params");for(const k in w){if(!k)return L.error("Image parameter name should be non-empty"),!1;const F=L.concat(void 0,k).parse(w[k],void 0,mo,void 0,{typeAnnotation:"coerce"});if(!F)return!1;M[k]=F}c[c.length-1].options.params=M}if(E){if(typeof E!="object"||E.constructor!==Object)return A.error('Image options "iconset" should be an object'),!1;if(!E.id)return A.error('Image options "iconset" should have an "id" property'),!1;c[c.length-1].options.iconset=E}return a++,!0}var _;return!0}for(let _=0;_<2;_++)if(!d()||!f())return;return new uc(c[0].image,c[1]?c[1].image:void 0,c[0].options,c[1]?c[1].options:void 0)}evaluateParams(e,i){const a={};if(i){for(const c in i)if(i[c])try{a[c]=i[c].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,c=go.build(i,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(c&&e.availableImages){const d=c.getPrimary().id;if(c.available=e.availableImages.some(f=>Eo.isEqual(f,d)),c.available){const f=c.getSecondary()?c.getSecondary().id:null;f&&(c.available=e.availableImages.some(_=>Eo.isEqual(_,f)))}}return c}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const a={};if(i&&(a.iconset={id:i}),e){a.params={};for(const c in e)e[c]&&(a.params[c]=e[c].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Jt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}const f_={"to-boolean":Xi,"to-color":mo,"to-number":Ut,"to-string":on};class ys{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0],c=[];let d=La;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);d=no(i.expectedType.itemType,f)}else{if(!(f>0&&cc(e[1][0])))return null;d=no(mr(e[1][0]),f)}for(let _=0;_<f;_++){const x=e[1][_];let w;if(Jt(x)==="array")w=i.parse(x,void 0,d.itemType);else{const E=Jt(x);if(E!==d.itemType.kind)return i.error(`Expected ${d.itemType.kind} but found ${E}.`);w=i.registry.literal.parse(["literal",x===void 0?null:x],i)}if(!w)return null;c.push(w)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");d=f_[a];for(let f=1;f<e.length;f++){const _=i.parse(e[f],f,Wi);if(!_)return null;c.push(_)}}return new ys(d,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,a;for(const c of this.args){if(i=c.evaluate(e),a=null,i instanceof Hi)return i;if(typeof i=="string"){const d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:d_(i[0],i[1],i[2],i[3]),!a))return new Hi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Rt(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new Rt(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ro.fromString(oo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?go.build(oo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):oo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new xl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new uc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const p_=["Unknown","Point","LineString","Polygon"];class cd{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?p_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(c*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Hi.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Xr{constructor(e,i,a,c,d){this.name=e,this.type=i,this._evaluate=a,this.args=c,this._overloadIndex=d}evaluate(e){if(!this._evaluate){const i=Xr.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const a=e[0],c=Xr.definitions[a];if(!c)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=[];let x=null,w=-1;for(const[E,A]of f){if(Array.isArray(E)&&E.length!==e.length-1)continue;_.push(E),w++,x=new S_(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const M=[];let L=!1;for(let k=1;k<e.length;k++){const F=e[k],$=Array.isArray(E)?E[k-1]:E.type,q=x.parse(F,1+M.length,$);if(!q){L=!0;break}M.push(q)}if(!L)if(Array.isArray(E)&&E.length!==M.length)x.error(`Expected ${E.length} arguments, but found ${M.length} instead.`);else{for(let k=0;k<M.length;k++){const F=Array.isArray(E)?E[k]:E.type,$=M[k];x.concat(k+1).checkSubtype(F,$.type)}if(x.errors.length===0)return new Xr(a,d,A,M,w)}}if(_.length===1)i.errors.push(...x.errors);else{const E=(_.length?_:f.map(([M])=>M)).map(so).join(" | "),A=[];for(let M=1;M<e.length;M++){const L=i.parse(e[M],1+A.length);if(!L)return null;A.push(sr(L.type))}i.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){Xr.definitions=i;for(const a in i)e[a]=Xr}}function so(n){return Array.isArray(n)?`(${n.map(sr).join(", ")})`:`(${sr(n.type)}...)`}class hc{constructor(e,i,a){this.type=vl,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const c=a["case-sensitive"]===void 0?i.parse(!1,1,Xi):i.parseObjectValue(a["case-sensitive"],1,"case-sensitive",Xi);if(!c)return null;const d=a["diacritic-sensitive"]===void 0?i.parse(!1,1,Xi):i.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",Xi);if(!d)return null;let f=null;return a.locale&&(f=i.parseObjectValue(a.locale,1,"locale",on),!f)?null:new hc(c,d,f)}evaluate(e){return new Oa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Fa(n,e,i=0,a=n.length-1,c=wl){for(;a>i;){if(a-i>600){const x=a-i+1,w=e-i+1,E=Math.log(x),A=.5*Math.exp(2*E/3),M=.5*Math.sqrt(E*A*(x-A)/x)*(w-x/2<0?-1:1);Fa(n,e,Math.max(i,Math.floor(e-w*A/x+M)),Math.min(a,Math.floor(e+(x-w)*A/x+M)),c)}const d=n[e];let f=i,_=a;for(bl(n,i,e),c(n[a],d)>0&&bl(n,i,a);f<_;){for(bl(n,f,_),f++,_--;c(n[f],d)<0;)f++;for(;c(n[_],d)>0;)_--}c(n[i],d)===0?bl(n,i,_):(_++,bl(n,_,a)),_<=e&&(i=_+1),e<=_&&(a=_-1)}}function bl(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}function wl(n,e){return n<e?-1:n>e?1:0}function ao(n){let e=0;for(let i,a,c=0,d=n.length,f=d-1;c<d;f=c++)i=n[c],a=n[f],e+=(a.x-i.x)*(i.y+a.y);return e}function Vu(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Uu(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function nx(n,e,i){const a=n[0]-e[0],c=n[1]-e[1],d=n[0]-i[0],f=n[1]-i[1];return a*f-d*c==0&&a*d<=0&&c*f<=0}function ca(n,e,i=!1){let a=!1;for(let _=0,x=e.length;_<x;_++){const w=e[_];for(let E=0,A=w.length,M=A-1;E<A;M=E++){const L=w[M],k=w[E];if(nx(n,L,k))return i;(d=L)[1]>(c=n)[1]!=(f=k)[1]>c[1]&&c[0]<(f[0]-d[0])*(c[1]-d[1])/(f[1]-d[1])+d[0]&&(a=!a)}}var c,d,f;return a}function vp(n,e,i,a){const c=a[0]-i[0],d=a[1]-i[1],f=(n[0]-i[0])*d-c*(n[1]-i[1]),_=(e[0]-i[0])*d-c*(e[1]-i[1]);return f>0&&_<0||f<0&&_>0}function js(n,e,i,a){return(c=[a[0]-i[0],a[1]-i[1]])[0]*(d=[e[0]-n[0],e[1]-n[1]])[1]-c[1]*d[0]!=0&&!(!vp(n,e,i,a)||!vp(i,a,n,e));var c,d}function xp(n){const e=new gt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new gt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const a of n[0])e.x>a.x&&(e.x=a.x),e.y>a.y&&(e.y=a.y),i.x<a.x&&(i.x=a.x),i.y<a.y&&(i.y=a.y);return{min:e,max:i}}const Ba=8192;function rx(n,e){const i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*Ba),Math.round(a*c*Ba)]}function ox(n,e){for(let i=0;i<e.length;i++)if(ca(n,e[i]))return!0;return!1}function m_(n,e,i){for(const a of i)for(let c=0,d=a.length,f=d-1;c<d;f=c++)if(js(n,e,a[f],a[c]))return!0;return!1}function g_(n,e){for(let i=0;i<n.length;++i)if(!ca(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(m_(n[i],n[i+1],e))return!1;return!0}function sx(n,e){for(let i=0;i<e.length;i++)if(g_(n,e[i]))return!0;return!1}function ud(n,e,i){const a=[];for(let c=0;c<n.length;c++){const d=[];for(let f=0;f<n[c].length;f++){const _=rx(n[c][f],i);Vu(e,_),d.push(_)}a.push(d)}return a}function __(n,e,i){const a=[];for(let c=0;c<n.length;c++){const d=ud(n[c],e,i);a.push(d)}return a}function Na(n,e,i,a){if(n[0]<i[0]||n[0]>i[2]){const c=.5*a;let d=n[0]-i[0]>c?-a:i[0]-n[0]>c?a:0;d===0&&(d=n[0]-i[2]>c?-a:i[2]-n[0]>c?a:0),n[0]+=d}Vu(e,n)}function y_(n,e,i,a){const c=Math.pow(2,a.z)*Ba,d=[a.x*Ba,a.y*Ba],f=[];if(!n)return f;for(const _ of n)for(const x of _){const w=[x.x+d[0],x.y+d[1]];Na(w,e,i,c),f.push(w)}return f}function v_(n,e,i,a){const c=Math.pow(2,a.z)*Ba,d=[a.x*Ba,a.y*Ba],f=[];if(!n)return f;for(const x of n){const w=[];for(const E of x){const A=[E.x+d[0],E.y+d[1]];Vu(e,A),w.push(A)}f.push(w)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of f)for(const w of x)Na(w,e,i,c)}var _;return f}class ua{constructor(e,i){this.type=Xi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(cc(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){const d=a.features[c].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new ua(a,a.features[c].geometry)}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ua(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new ua(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(a.type==="Polygon"){const _=ud(a.coordinates,d,f),x=y_(i.geometry(),c,d,f);if(!Uu(c,d))return!1;for(const w of x)if(!ca(w,_))return!1}if(a.type==="MultiPolygon"){const _=__(a.coordinates,d,f),x=y_(i.geometry(),c,d,f);if(!Uu(c,d))return!1;for(const w of x)if(!ox(w,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(a.type==="Polygon"){const _=ud(a.coordinates,d,f),x=v_(i.geometry(),c,d,f);if(!Uu(c,d))return!1;for(const w of x)if(!g_(w,_))return!1}if(a.type==="MultiPolygon"){const _=__(a.coordinates,d,f),x=v_(i.geometry(),c,d,f);if(!Uu(c,d))return!1;for(const w of x)if(!sx(w,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Gu={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},bp=1/298.257223563,es=bp*(2-bp),dc=Math.PI/180;class fc{static fromTile(e,i,a){const c=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),d=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/dc;return new fc(d,a)}static get units(){return Gu}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Gu[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Gu).join(", ")}`);const a=6378.137*dc*(i?Gu[i]:1),c=Math.cos(e*dc),d=1/(1-es*(1-c*c)),f=Math.sqrt(d);this.kx=a*f*c,this.ky=a*f*d*(1-es)}distance(e,i){const a=Bo(e[0]-i[0])*this.kx,c=(e[1]-i[1])*this.ky;return Math.sqrt(a*a+c*c)}bearing(e,i){const a=Bo(i[0]-e[0])*this.kx;return Math.atan2(a,(i[1]-e[1])*this.ky)/dc}destination(e,i,a){const c=a*dc;return this.offset(e,Math.sin(c)*i,Math.cos(c)*i)}offset(e,i,a){return[e[0]+i/this.kx,e[1]+a/this.ky]}lineDistance(e){let i=0;for(let a=0;a<e.length-1;a++)i+=this.distance(e[a],e[a+1]);return i}area(e){let i=0;for(let a=0;a<e.length;a++){const c=e[a];for(let d=0,f=c.length,_=f-1;d<f;_=d++)i+=Bo(c[d][0]-c[_][0])*(c[d][1]+c[_][1])*(a?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let a=0;if(i<=0)return e[0];for(let c=0;c<e.length-1;c++){const d=e[c],f=e[c+1],_=this.distance(d,f);if(a+=_,a>i)return hd(d,f,(i-(a-_))/_)}return e[e.length-1]}pointToSegmentDistance(e,i,a){let[c,d]=i,f=Bo(a[0]-c)*this.kx,_=(a[1]-d)*this.ky;if(f!==0||_!==0){const x=(Bo(e[0]-c)*this.kx*f+(e[1]-d)*this.ky*_)/(f*f+_*_);x>1?(c=a[0],d=a[1]):x>0&&(c+=f/this.kx*x,d+=_/this.ky*x)}return f=Bo(e[0]-c)*this.kx,_=(e[1]-d)*this.ky,Math.sqrt(f*f+_*_)}pointOnLine(e,i){let a=1/0,c=e[0][0],d=e[0][1],f=0,_=0;for(let x=0;x<e.length-1;x++){let w=e[x][0],E=e[x][1],A=Bo(e[x+1][0]-w)*this.kx,M=(e[x+1][1]-E)*this.ky,L=0;A===0&&M===0||(L=(Bo(i[0]-w)*this.kx*A+(i[1]-E)*this.ky*M)/(A*A+M*M),L>1?(w=e[x+1][0],E=e[x+1][1]):L>0&&(w+=A/this.kx*L,E+=M/this.ky*L)),A=Bo(i[0]-w)*this.kx,M=(i[1]-E)*this.ky;const k=A*A+M*M;k<a&&(a=k,c=w,d=E,f=x,_=L)}return{point:[c,d],index:f,t:Math.max(0,Math.min(1,_))}}lineSlice(e,i,a){let c=this.pointOnLine(a,e),d=this.pointOnLine(a,i);if(c.index>d.index||c.index===d.index&&c.t>d.t){const w=c;c=d,d=w}const f=[c.point],_=c.index+1,x=d.index;!wp(a[_],f[0])&&_<=x&&f.push(a[_]);for(let w=_+1;w<=x;w++)f.push(a[w]);return wp(a[x],d.point)||f.push(d.point),f}lineSliceAlong(e,i,a){let c=0;const d=[];for(let f=0;f<a.length-1;f++){const _=a[f],x=a[f+1],w=this.distance(_,x);if(c+=w,c>e&&d.length===0&&d.push(hd(_,x,(e-(c-w))/w)),c>=i)return d.push(hd(_,x,(i-(c-w))/w)),d;c>e&&d.push(x)}return d}bufferPoint(e,i){const a=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-a,e[0]+c,e[1]+a]}bufferBBox(e,i){const a=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-a,e[2]+c,e[3]+a]}insideBBox(e,i){return Bo(e[0]-i[0])>=0&&Bo(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function wp(n,e){return n[0]===e[0]&&n[1]===e[1]}function hd(n,e,i){const a=Bo(e[0]-n[0]);return[n[0]+a*i,n[1]+(e[1]-n[1])*i]}function Bo(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class dd{constructor(e=[],i=(a,c)=>a<c?-1:a>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,c=i[e];for(;e>0;){const d=e-1>>1,f=i[d];if(a(c,f)>=0)break;i[e]=f,e=d}i[e]=c}_down(e){const{data:i,compare:a}=this,c=this.length>>1,d=i[e];for(;e<c;){let f=1+(e<<1);const _=f+1;if(_<this.length&&a(i[_],i[f])<0&&(f=_),a(i[f],d)>=0)break;i[e]=i[f],e=f}i[e]=d}}var vt=8192;function Tp(n,e){return e.dist-n.dist}const fd=100,pd=50;function Sp(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function Tl(n){return n[1]-n[0]+1}function ts(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function pc(n,e){if(n[0]>n[1])return[null,null];const i=Tl(n);if(e){if(i===2)return[n,null];const a=Math.floor(i/2);return[[n[0],n[0]+a],[n[0]+a,n[1]]]}{if(i===1)return[n,null];const a=Math.floor(i/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}}function ja(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!ts(e,n.length))return i;for(let a=e[0];a<=e[1];++a)Vu(i,n[a]);return i}function $u(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let a=0;a<n[i].length;++a)Vu(e,n[i][a]);return e}function Sl(n,e,i){if(Sp(n)||Sp(e))return NaN;let a=0,c=0;return n[2]<e[0]&&(a=e[0]-n[2]),n[0]>e[2]&&(a=n[0]-e[2]),n[1]>e[3]&&(c=n[1]-e[3]),n[3]<e[1]&&(c=e[1]-n[3]),i.distance([0,0],[a,c])}function mc(n){return 360*n-180}function Oi(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Ep(n,e){const i=Math.pow(2,e.z),a=(n.y/vt+e.y)/i;return[mc((n.x/vt+e.x)/i),Oi(a)]}function ax(n,e){const i=[];for(let a=0;a<n.length;++a)i.push(Ep(n[a],e));return i}function x_(n,e,i){const a=i.pointOnLine(e,n).point;return i.distance(n,a)}function Ip(n,e,i,a,c){const d=i.slice(a[0],a[1]+1);let f=1/0;for(let _=e[0];_<=e[1];++_)if((f=Math.min(f,x_(n[_],d,c)))===0)return 0;return f}function Ap(n,e,i,a,c){const d=Math.min(c.pointToSegmentDistance(n,i,a),c.pointToSegmentDistance(e,i,a)),f=Math.min(c.pointToSegmentDistance(i,n,e),c.pointToSegmentDistance(a,n,e));return Math.min(d,f)}function jn(n,e,i,a,c){if(!ts(e,n.length)||!ts(a,i.length))return NaN;let d=1/0;for(let f=e[0];f<e[1];++f)for(let _=a[0];_<a[1];++_){if(js(n[f],n[f+1],i[_],i[_+1]))return 0;d=Math.min(d,Ap(n[f],n[f+1],i[_],i[_+1],c))}return d}function lx(n,e,i,a,c){if(!ts(e,n.length)||!ts(a,i.length))return NaN;let d=1/0;for(let f=e[0];f<=e[1];++f)for(let _=a[0];_<=a[1];++_)if((d=Math.min(d,c.distance(n[f],i[_])))===0)return d;return d}function cx(n,e,i){if(ca(n,e,!0))return 0;let a=1/0;for(const c of e){const d=c.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[d-1]&&(a=Math.min(a,i.pointToSegmentDistance(n,c[d-1],c[0])))===0||(a=Math.min(a,x_(n,c,i)))===0)return a}return a}function ux(n,e,i,a){if(!ts(e,n.length))return NaN;for(let d=e[0];d<=e[1];++d)if(ca(n[d],i,!0))return 0;let c=1/0;for(let d=e[0];d<e[1];++d)for(const f of i)for(let _=0,x=f.length,w=x-1;_<x;w=_++){if(js(n[d],n[d+1],f[w],f[_]))return 0;c=Math.min(c,Ap(n[d],n[d+1],f[w],f[_],a))}return c}function b_(n,e){for(const i of n)for(let a=0;a<=i.length-1;++a)if(ca(i[a],e,!0))return!0;return!1}function hx(n,e,i,a=1/0){const c=$u(n),d=$u(e);if(a!==1/0&&Sl(c,d,i)>=a)return a;if(Uu(c,d)){if(b_(n,e))return 0}else if(b_(e,n))return 0;let f=a;for(const _ of n)for(let x=0,w=_.length,E=w-1;x<w;E=x++)for(const A of e)for(let M=0,L=A.length,k=L-1;M<L;k=M++){if(js(_[E],_[x],A[k],A[M]))return 0;f=Math.min(f,Ap(_[E],_[x],A[k],A[M],i))}return f}function md(n,e,i,a,c,d,f){if(d===null||f===null)return;const _=Sl(ja(a,d),ja(c,f),i);_<e&&n.push({dist:_,range1:d,range2:f})}function dx(n,e,i,a,c=1/0){let d=Math.min(a.distance(n[0],i[0][0]),c);if(d===0)return d;const f=new dd([{dist:0,range1:[0,n.length-1],range2:[0,0]}],Tp),_=e?pd:fd,x=$u(i);for(;f.length;){const w=f.pop();if(w.dist>=d)continue;const E=w.range1;if(Tl(E)<=_){if(!ts(E,n.length))return NaN;if(e){const A=ux(n,E,i,a);if((d=Math.min(d,A))===0)return d}else for(let A=E[0];A<=E[1];++A){const M=cx(n[A],i,a);if((d=Math.min(d,M))===0)return d}}else{const A=pc(E,e);if(A[0]!==null){const M=Sl(ja(n,A[0]),x,a);M<d&&f.push({dist:M,range1:A[0],range2:[0,0]})}if(A[1]!==null){const M=Sl(ja(n,A[1]),x,a);M<d&&f.push({dist:M,range1:A[1],range2:[0,0]})}}}return d}function w_(n,e,i,a,c,d=1/0){let f=Math.min(d,c.distance(n[0],i[0]));if(f===0)return f;const _=new dd([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],Tp),x=e?pd:fd,w=a?pd:fd;for(;_.length;){const E=_.pop();if(E.dist>=f)continue;const A=E.range1,M=E.range2;if(Tl(A)<=x&&Tl(M)<=w){if(!ts(A,n.length)||!ts(M,i.length))return NaN;if(e&&a?f=Math.min(f,jn(n,A,i,M,c)):e||a?e&&!a?f=Math.min(f,Ip(i,M,n,A,c)):!e&&a&&(f=Math.min(f,Ip(n,A,i,M,c))):f=Math.min(f,lx(n,A,i,M,c)),f===0)return f}else{const L=pc(A,e),k=pc(M,a);md(_,f,c,n,i,L[0],k[0]),md(_,f,c,n,i,L[0],k[1]),md(_,f,c,n,i,L[1],k[0]),md(_,f,c,n,i,L[1],k[1])}}return f}function Cp(n,e,i,a,c=1/0){let d=c;const f=ja(n,[0,n.length-1]);for(const _ of i)if(!(d!==1/0&&Sl(f,ja(_,[0,_.length-1]),a)>=d)&&(d=Math.min(d,w_(n,e,_,!0,a,d)),d===0))return d;return d}function gd(n,e,i,a,c=1/0){let d=c;const f=ja(n,[0,n.length-1]);for(const _ of i){if(d!==1/0&&Sl(f,$u(_),a)>=d)continue;const x=dx(n,e,_,a,d);if(isNaN(x))return x;if((d=Math.min(d,x))===0)return d}return d}function Mp(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class El{constructor(e,i){this.type=Ut,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(cc(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let c=0;c<a.features.length;++c)if(Mp(a.features[c].geometry.type))return new El(a,a.features[c].geometry)}else if(a.type==="Feature"){if(Mp(a.geometry.type))return new El(a,a.geometry)}else if(Mp(a.type))return new El(a,a)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),a=e.canonicalID();if(i!=null&&a!=null){if(e.geometryType()==="Point")return function(c,d,f){const _=[];for(const w of c)for(const E of w)_.push(Ep(E,d));const x=new fc(_[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?w_(_,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",x):f.type==="MultiLineString"?Cp(_,!1,f.coordinates,x):f.type==="Polygon"||f.type==="MultiPolygon"?gd(_,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,x):null}(i,a,this.geometries);if(e.geometryType()==="LineString")return function(c,d,f){const _=[];for(const w of c){const E=[];for(const A of w)E.push(Ep(A,d));_.push(E)}const x=new fc(_[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Cp(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",_,x);if(f.type==="MultiLineString"){let w=1/0;for(let E=0;E<f.coordinates.length;E++){const A=Cp(f.coordinates[E],!0,_,x,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}if(f.type==="Polygon"||f.type==="MultiPolygon"){let w=1/0;for(let E=0;E<_.length;E++){const A=gd(_[E],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,x,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}return null}(i,a,this.geometries);if(e.geometryType()==="Polygon")return function(c,d,f){const _=[];for(const w of function(E,A){const M=E.length;if(M<=1)return[E];const L=[];let k,F;for(let $=0;$<M;$++){const q=ao(E[$]);q!==0&&(E[$].area=Math.abs(q),F===void 0&&(F=q<0),F===q<0?(k&&L.push(k),k=[E[$]]):k.push(E[$]))}return k&&L.push(k),L}(c)){const E=[];for(let A=0;A<w.length;++A)E.push(ax(w[A],d));_.push(E)}const x=new fc(_[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return gd(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",_,x);if(f.type==="MultiLineString"){let w=1/0;for(let E=0;E<f.coordinates.length;E++){const A=gd(f.coordinates[E],!0,_,x,w);if(isNaN(A))return A;if((w=Math.min(w,A))===0)return w}return w}return f.type==="Polygon"||f.type==="MultiPolygon"?function(w,E,A){let M=1/0;for(const L of w)for(const k of E){const F=hx(L,k,A,M);if(isNaN(F))return F;if((M=Math.min(M,F))===0)return M}return M}(f.type==="Polygon"?[f.coordinates]:f.coordinates,_,x):null}(i,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Pp(n,e){switch(n){case"string":return oo(e);case"number":return+e;case"boolean":return!!e;case"color":return Hi.parse(e);case"formatted":return ro.fromString(oo(e));case"resolvedImage":return go.build(oo(e))}return e}function T_(n,e,i,a){return a!==void 0&&(n=a*Math.round(n/a)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class gc{constructor(e,i,a){this.type=e,this.key=i,this.scope=a}static parse(e,i){let a=i.expectedType;if(a==null&&(a=Wi),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const c=i.parse(e[1],1);if(!(c instanceof bi))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const d=i.parse(e[2],2);return d instanceof bi?new gc(a,oo(c.value),oo(d.value)):i.error("Scope of 'config' expression must be a string literal.")}return new gc(a,oo(c.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(i);if(!a)return null;const{type:c,value:d,values:f,minValue:_,maxValue:x,stepValue:w}=a,E=a.default.evaluate(e);let A=E;if(d){const M=e.scope;e.scope=(M||"").split("").slice(1).join(""),A=d.evaluate(e),e.scope=M}return c&&(A=Pp(c,A)),A===void 0||_===void 0&&x===void 0&&w===void 0||(typeof A=="number"?A=T_(A,_,x,w):Array.isArray(A)&&(A=A.map(M=>typeof M=="number"?T_(M,_,x,w):M))),d!==void 0&&A!==void 0&&f&&!f.includes(A)&&(A=E,c&&(A=Pp(c,A))),(c&&c!==this.type||A!==void 0&&mr(A)!==this.type)&&(A=Pp(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Hu(n){if(n instanceof Xr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof ua||n instanceof El)return!1;let e=!0;return n.eachChild(i=>{e&&!Hu(i)&&(e=!1)}),e}function _d(n){if(n instanceof Xr&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!_d(i)&&(e=!1)}),e}function yd(n){if(n instanceof gc)return new Set([n.key]);let e=new Set;return n.eachChild(i=>{e=new Set([...e,...yd(i)])}),e}function _c(n,e){if(n instanceof Xr&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!_c(a,e)&&(i=!1)}),i}class vd{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new vd(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Rp{constructor(e,i=[],a,c=new yl,d=[],f,_){this.registry=e,this.path=i,this.key=i.map(x=>typeof x=="string"?`['${x}']`:`[${x}]`).join(""),this.scope=c,this.errors=d,this.expectedType=a,this._scope=f,this.options=_}parse(e,i,a,c,d={}){return i||a?this.concat(i,null,a,c)._parse(e,d):this._parse(e,d)}parseObjectValue(e,i,a,c,d,f={}){return this.concat(i,a,c,d)._parse(e,f)}_parse(e,i){function a(c,d,f){return f==="assert"?new Qt(d,[c]):f==="coerce"?new ys(d,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let d=c.parse(e,this);if(!d)return null;if(this.expectedType){const f=this.expectedType,_=d.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||_.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(f,_))return null}else d=a(d,f,i.typeAnnotation||"coerce");else d=a(d,f,i.typeAnnotation||"assert")}if(!(d instanceof bi)&&d.type.kind!=="resolvedImage"&&zp(d)){const f=new cd(this._scope,this.options);try{d=new bi(d.type,d.evaluate(f))}catch(_){return this.error(_.message),null}}return d}return ys.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a,c){let d=typeof e=="number"?this.path.concat(e):this.path;d=typeof i=="string"?d.concat(i):d;const f=c?this.scope.concat(c):this.scope;return new Rp(this.registry,d,a||null,f,this.errors,this._scope,this.options)}error(e,...i){const a=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new Jo(a,e))}checkSubtype(e,i){const a=Nu(e,i);return a&&this.error(a),a}}var S_=Rp;function zp(n){if(n instanceof vd)return zp(n.boundExpression);if(n instanceof Xr&&n.name==="error"||n instanceof hc||n instanceof ua||n instanceof El||n instanceof gc)return!1;const e=n instanceof ys||n instanceof Qt;let i=!0;return n.eachChild(a=>{i=e?i&&zp(a):i&&a instanceof bi}),!!i&&Hu(n)&&_c(n,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function xd(n,e){const i=n.length-1;let a,c,d=0,f=i,_=0;for(;d<=f;)if(_=Math.floor((d+f)/2),a=n[_],c=n[_+1],a<=e){if(_===i||e<c)return _;d=_+1}else{if(!(a>e))throw new Rt("Input is not a number.");f=_-1}return 0}class qu{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,d]of a)this.labels.push(c),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,Ut);if(!a)return null;const c=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let f=1;f<e.length;f+=2){const _=f===1?-1/0:e[f],x=e[f+1],w=f,E=f+1;if(typeof _!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=_)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const A=i.parse(x,E,d);if(!A)return null;d=d||A.type,c.push([_,A])}return new qu(d,a,c)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return a[0].evaluate(e);const d=i.length;return c>=i[d-1]?a[d-1].evaluate(e):a[xd(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const E_=.95047,I_=1.08883,A_=4/29,yc=6/29,C_=3*yc*yc,fx=yc*yc*yc,Dp=Math.PI/180,px=180/Math.PI;function bd(n){return n>fx?Math.pow(n,1/3):n/C_+A_}function Lp(n){return n>yc?n*n*n:C_*(n-A_)}function kp(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Op(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Fp(n){const e=Op(n.r),i=Op(n.g),a=Op(n.b),c=bd((.4124564*e+.3575761*i+.1804375*a)/E_),d=bd((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*d-16,a:500*(c-d),b:200*(d-bd((.0193339*e+.119192*i+.9503041*a)/I_)),alpha:n.a}}function Bp(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,a=isNaN(n.b)?e:e-n.b/200;return e=1*Lp(e),i=E_*Lp(i),a=I_*Lp(a),new Hi(kp(3.2404542*i-1.5371385*e-.4985314*a),kp(-.969266*i+1.8760108*e+.041556*a),kp(.0556434*i-.2040259*e+1.0572252*a),n.alpha)}function vc(n,e,i){const a=e-n;return n+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const xc={forward:Fp,reverse:Bp,interpolate:function(n,e,i){return{l:qt(n.l,e.l,i),a:qt(n.a,e.a,i),b:qt(n.b,e.b,i),alpha:qt(n.alpha,e.alpha,i)}}},bc={forward:function(n){const{l:e,a:i,b:a}=Fp(n),c=Math.atan2(a,i)*px;return{h:c<0?c+360:c,c:Math.sqrt(i*i+a*a),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Dp,i=n.c;return Bp({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:vc(n.h,e.h,i),c:qt(n.c,e.c,i),l:qt(n.l,e.l,i),alpha:qt(n.alpha,e.alpha,i)}}};var M_=Object.freeze({__proto__:null,hcl:bc,lab:xc});class _o{constructor(e,i,a,c,d){this.type=e,this.operator=i,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[f,_]of d)this.labels.push(f),this.outputs.push(_)}static interpolationFactor(e,i,a,c){let d=0;if(e.name==="exponential")d=Wu(i,e.base,a,c);else if(e.name==="linear")d=Wu(i,1,a,c);else if(e.name==="cubic-bezier"){const f=e.controlPoints;d=new na(f[0],f[1],f[2],f[3]).solve(Wu(i,1,a,c))}return d}static parse(e,i){let[a,c,d,...f]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const w=c[1];if(typeof w!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const w=c.slice(1);if(w.length!==4||w.some(E=>typeof E!="number"||E<0||E>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,Ut),!d)return null;const _=[];let x=null;a==="interpolate-hcl"||a==="interpolate-lab"?x=mo:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let w=0;w<f.length;w+=2){const E=f[w],A=f[w+1],M=w+3,L=w+4;if(typeof E!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(_.length&&_[_.length-1][0]>=E)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const k=i.parse(A,L,x);if(!k)return null;x=x||k.type,_.push([E,k])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new _o(x,a,c,d,_):i.error(`Type ${sr(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return a[0].evaluate(e);const d=i.length;if(c>=i[d-1])return a[d-1].evaluate(e);const f=xd(i,c),_=_o.interpolationFactor(this.interpolation,c,i[f],i[f+1]),x=a[f].evaluate(e),w=a[f+1].evaluate(e);return this.operator==="interpolate"?ad[this.type.kind.toLowerCase()](x,w,_):this.operator==="interpolate-hcl"?bc.reverse(bc.interpolate(bc.forward(x),bc.forward(w),_)):xc.reverse(xc.interpolate(xc.forward(x),xc.forward(w),_))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function Wu(n,e,i,a){const c=a-i,d=n-i;return c===0?0:e===1?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}class wd{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const c=i.expectedType;c&&c.kind!=="value"&&(a=c);const d=[];for(const _ of e.slice(1)){const x=i.parse(_,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!x)return null;a=a||x.type,d.push(x)}const f=c&&d.some(_=>Nu(c,_.type));return new wd(f?Wi:a,d)}evaluate(e){let i,a=null,c=0;for(const d of this.args){if(c++,a=d.evaluate(e),a&&a instanceof go&&!a.available&&(i||(i=a),a=null,c===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Td{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const _=i.parse(e[d+1],d+1);if(!_)return null;a.push([f,_])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return c?new Td(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class Sd{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Ut),c=i.parse(e[2],2,no(i.expectedType||Wi));return a&&c?new Sd(c.type.itemType,a,c):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Rt(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Rt(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Rt(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ed{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Ut),c=i.parse(e[2],2,no(i.expectedType||Wi));return a&&c?new Ed(c.type.itemType,a,c):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Rt(`Array index out of bounds: ${i} < 0.`);if(i>a.length-1)throw new Rt(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i===Math.floor(i))return a[i];const c=Math.floor(i),d=Math.ceil(i),f=a[c],_=a[d];if(typeof f!="number"||typeof _!="number")throw new Rt(`Cannot interpolate between non-number values at index ${i}.`);const x=i-c;return f*(1-x)+_*x}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Np{constructor(e,i){this.type=Xi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Wi),c=i.parse(e[2],2,Wi);return a&&c?yp(a.type,[Xi,on,Ut,La,Wi])?new Np(a,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${sr(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!lc(i,["boolean","string","number","null"]))throw new Rt(`Expected first argument to be of type boolean, string, number or null, but found ${sr(mr(i))} instead.`);if(!lc(a,["string","array"]))throw new Rt(`Expected second argument to be of type array or string, but found ${sr(mr(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Id{constructor(e,i,a){this.type=Ut,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Wi),c=i.parse(e[2],2,Wi);if(!a||!c)return null;if(!yp(a.type,[Xi,on,Ut,La,Wi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${sr(a.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,Ut);return d?new Id(a,c,d):null}return new Id(a,c)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!lc(i,["boolean","string","number","null"]))throw new Rt(`Expected first argument to be of type boolean, string, number or null, but found ${sr(mr(i))} instead.`);if(!lc(a,["string","array"]))throw new Rt(`Expected second argument to be of type array or string, but found ${sr(mr(a))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return a.indexOf(i,c)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class jp{constructor(e,i,a,c,d,f){this.inputType=e,this.type=i,this.input=a,this.cases=c,this.outputs=d,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const d={},f=[];for(let w=2;w<e.length-1;w+=2){let E=e[w];const A=e[w+1];Array.isArray(E)||(E=[E]);const M=i.concat(w);if(E.length===0)return M.error("Expected at least one branch label.");for(const k of E){if(typeof k!="number"&&typeof k!="string")return M.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return M.error("Numeric branch labels must be integer values.");if(a){if(M.checkSubtype(a,mr(k)))return null}else a=mr(k);if(d[String(k)]!==void 0)return M.error("Branch labels must be unique.");d[String(k)]=f.length}const L=i.parse(A,w,c);if(!L)return null;c=c||L.type,f.push(L)}const _=i.parse(e[1],1,Wi);if(!_)return null;const x=i.parse(e[e.length-1],e.length-1,c);return x?_.type.kind!=="value"&&i.concat(1).checkSubtype(a,_.type)?null:new jp(a,c,_,d,f,x):null}evaluate(e){const i=this.input.evaluate(e);return(mr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],c={};for(const f of i){const _=c[this.cases[f]];_===void 0?(c[this.cases[f]]=a.length,a.push([this.cases[f],[f]])):a[_][1].push(f)}const d=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,_]of a)e.push(_.length===1?d(_[0]):_.map(d)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class Ad{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const c=[];for(let f=1;f<e.length-1;f+=2){const _=i.parse(e[f],f,Xi);if(!_)return null;const x=i.parse(e[f+1],f+1,a);if(!x)return null;c.push([_,x]),a=a||x.type}const d=i.parse(e[e.length-1],e.length-1,a);return d?new Ad(a,c,d):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Zu{constructor(e,i,a,c){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Wi),c=i.parse(e[2],2,Ut);if(!a||!c)return null;if(!yp(a.type,[no(Wi),on,Wi]))return i.error(`Expected first argument to be of type array or string, but found ${sr(a.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,Ut);return d?new Zu(a.type,a,c,d):null}return new Zu(a.type,a,c)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!lc(i,["string","array"]))throw new Rt(`Expected first argument to be of type array or string, but found ${sr(mr(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(a,c)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Xu(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function P_(n,e,i,a){return a.compare(e,i)===0}function Il(n,e,i){const a=n!=="=="&&n!=="!=";return class Qz{constructor(d,f,_){this.type=Xi,this.lhs=d,this.rhs=f,this.collator=_,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const _=d[0];let x=f.parse(d[1],1,Wi);if(!x)return null;if(!Xu(_,x.type))return f.concat(1).error(`"${_}" comparisons are not supported for type '${sr(x.type)}'.`);let w=f.parse(d[2],2,Wi);if(!w)return null;if(!Xu(_,w.type))return f.concat(2).error(`"${_}" comparisons are not supported for type '${sr(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error(`Cannot compare types '${sr(x.type)}' and '${sr(w.type)}'.`);a&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new Qt(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new Qt(x.type,[w])));let E=null;if(d.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(E=f.parse(d[3],3,vl),!E)return null}return new Qz(x,w,E)}evaluate(d){const f=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const x=mr(f),w=mr(_);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new Rt(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const x=mr(f),w=mr(_);if(x.kind!=="string"||w.kind!=="string")return e(d,f,_)}return this.collator?i(d,f,_,this.collator.evaluate(d)):e(d,f,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[n];return this.eachChild(f=>{d.push(f.serialize())}),d}}}const mx=Il("==",function(n,e,i){return e===i},P_),gx=Il("!=",function(n,e,i){return e!==i},function(n,e,i,a){return!P_(0,e,i,a)}),R_=Il("<",function(n,e,i){return e<i},function(n,e,i,a){return a.compare(e,i)<0}),z_=Il(">",function(n,e,i){return e>i},function(n,e,i,a){return a.compare(e,i)>0}),_x=Il("<=",function(n,e,i){return e<=i},function(n,e,i,a){return a.compare(e,i)<=0}),yx=Il(">=",function(n,e,i){return e>=i},function(n,e,i,a){return a.compare(e,i)>=0});class Vp{constructor(e,i,a,c,d,f){this.type=on,this.number=e,this.locale=i,this.currency=a,this.unit=c,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,Ut);if(!a)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=i.parseObjectValue(c.locale,2,"locale",on),!d))return null;let f=null;if(c.currency&&(f=i.parseObjectValue(c.currency,2,"currency",on),!f))return null;let _=null;if(c.unit&&(_=i.parseObjectValue(c.unit,2,"unit",on),!_))return null;let x=null;if(c["min-fraction-digits"]&&(x=i.parseObjectValue(c["min-fraction-digits"],2,"min-fraction-digits",Ut),!x))return null;let w=null;return c["max-fraction-digits"]&&(w=i.parseObjectValue(c["max-fraction-digits"],2,"max-fraction-digits",Ut),!w)?null:new Vp(a,d,f,_,x,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Yu{constructor(e){this.type=Ut,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${sr(a.type)} instead.`):new Yu(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Rt(`Expected value to be of type string or array, but found ${sr(mr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function D_(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Al={"==":mx,"!=":gx,">":z_,"<":R_,">=":yx,"<=":_x,array:Qt,at:Sd,"at-interpolated":Ed,boolean:Qt,case:Ad,coalesce:wd,collator:hc,format:xl,image:uc,in:Np,"index-of":Id,interpolate:_o,"interpolate-hcl":_o,"interpolate-lab":_o,length:Yu,let:Td,literal:bi,match:jp,number:Qt,"number-format":Vp,object:Qt,slice:Zu,step:qu,string:Qt,"to-boolean":ys,"to-color":ys,"to-number":ys,"to-string":ys,var:vd,within:ua,distance:El,config:gc};function L_(n,[e,i,a,c]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const d=c?c.evaluate(n):1,f=d_(e,i,a,d);if(f)throw new Rt(f);return new Hi(e/255*d,i/255*d,a/255*d,d)}function k_(n,[e,i,a,c]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const d=c?c.evaluate(n):1,f=function(w,E,A,M){return typeof w=="number"&&w>=0&&w<=360?typeof E=="number"&&E>=0&&E<=100&&typeof A=="number"&&A>=0&&A<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[w,E,A,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[w,E,A,M]:[w,E,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[w,E,A,M]:[w,E,A]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,a,d);if(f)throw new Rt(f);const _=`hsla(${e}, ${i}%, ${a}%, ${d})`,x=Hi.parse(_);if(!x)throw new Rt(`Failed to parse HSLA color: ${_}`);return x}function Up(n,e){return n in e}function Cd(n,e){const i=e[n];return i===void 0?null:i}function Va(n){return{type:n}}function O_(n){return{result:"success",value:n}}function No(n){return{result:"error",value:n}}function Gp(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function Md(n){return n["property-type"]==="data-driven"}function F_(n){return Gp(n.expression,"measure-light")}function $p(n){return Gp(n.expression,"zoom")}function Pd(n){return!!n.expression&&n.expression.interpolated}function Rd(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function B_(n){return n}function zd(n,e){const i=e.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",c=a||!(a||n.property!==void 0),d=n.type||(Pd(e)?"exponential":"interval");if(i&&((n=Ou({},n)).stops&&(n.stops=n.stops.map(w=>[w[0],Hi.parse(w[1])])),n.default=Hi.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!M_[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let f,_,x;if(d==="exponential")f=ha;else if(d==="interval")f=vx;else if(d==="categorical"){f=N_,_=Object.create(null);for(const w of n.stops)_[w[0]]=w[1];x=typeof n.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);f=xx}if(a){const w={},E=[];for(let L=0;L<n.stops.length;L++){const k=n.stops[L],F=k[0].zoom;w[F]===void 0&&(w[F]={zoom:F,type:n.type,property:n.property,default:n.default,stops:[]},E.push(F)),w[F].stops.push([k[0].value,k[1]])}const A=[];for(const L of E)A.push([w[L].zoom,zd(w[L],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:_o.interpolationFactor.bind(void 0,M),zoomStops:A.map(L=>L[0]),evaluate:({zoom:L},k)=>ha({stops:A,base:n.base},e,L).evaluate(L,k)}}if(c){const w=d==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:_o.interpolationFactor.bind(void 0,w),zoomStops:n.stops.map(E=>E[0]),evaluate:({zoom:E})=>f(n,e,E,_,x)}}return{kind:"source",evaluate(w,E){const A=E&&E.properties?E.properties[n.property]:void 0;return A===void 0?Cl(n.default,e.default):f(n,e,A,_,x)}}}function Cl(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function N_(n,e,i,a,c){return Cl(typeof i===c?a[i]:void 0,n.default,e.default)}function vx(n,e,i){if(Jt(i)!=="number")return Cl(n.default,e.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const c=xd(n.stops.map(d=>d[0]),i);return n.stops[c][1]}function ha(n,e,i){const a=n.base!==void 0?n.base:1;if(Jt(i)!=="number")return Cl(n.default,e.default);const c=n.stops.length;if(c===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[c-1][0])return n.stops[c-1][1];const d=xd(n.stops.map(E=>E[0]),i),f=function(E,A,M,L){const k=L-M,F=E-M;return k===0?0:A===1?F/k:(Math.pow(A,F)-1)/(Math.pow(A,k)-1)}(i,a,n.stops[d][0],n.stops[d+1][0]),_=n.stops[d][1],x=n.stops[d+1][1];let w=ad[e.type]||B_;if(n.colorSpace&&n.colorSpace!=="rgb"){const E=M_[n.colorSpace];w=(A,M)=>E.reverse(E.interpolate(E.forward(A),E.forward(M),f))}return typeof _.evaluate=="function"?{evaluate(...E){const A=_.evaluate.apply(void 0,E),M=x.evaluate.apply(void 0,E);if(A!==void 0&&M!==void 0)return w(A,M,f)}}:w(_,x,f)}function xx(n,e,i){return e.type==="color"?i=Hi.parse(i):e.type==="formatted"?i=ro.fromString(i.toString()):e.type==="resolvedImage"?i=go.build(i.toString()):Jt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Cl(i,n.default,e.default)}Xr.register(Al,{error:[{kind:"error"},[on],(n,[e])=>{throw new Rt(e.evaluate(n))}],typeof:[on,[Wi],(n,[e])=>sr(mr(e.evaluate(n)))],"to-rgba":[no(Ut,4),[mo],(n,[e])=>e.evaluate(n).toRenderColor(null).toArray()],"to-hsla":[no(Ut,4),[mo],(n,[e])=>e.evaluate(n).toRenderColor(null).toHslaArray()],rgb:[mo,[Ut,Ut,Ut],L_],rgba:[mo,[Ut,Ut,Ut,Ut],L_],hsl:[mo,[Ut,Ut,Ut],k_],hsla:[mo,[Ut,Ut,Ut,Ut],k_],has:{type:Xi,overloads:[[[on],(n,[e])=>Up(e.evaluate(n),n.properties())],[[on,ka],(n,[e,i])=>Up(e.evaluate(n),i.evaluate(n))]]},get:{type:Wi,overloads:[[[on],(n,[e])=>Cd(e.evaluate(n),n.properties())],[[on,ka],(n,[e,i])=>Cd(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Wi,[on],(n,[e])=>Cd(e.evaluate(n),n.featureState||{})],properties:[ka,[],n=>n.properties()],"geometry-type":[on,[],n=>n.geometryType()],id:[Wi,[],n=>n.id()],zoom:[Ut,[],n=>n.globals.zoom],pitch:[Ut,[],n=>n.globals.pitch||0],"distance-from-center":[Ut,[],n=>n.distanceFromCenter()],"measure-light":[Ut,[on],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[Ut,[],n=>n.globals.heatmapDensity||0],"line-progress":[Ut,[],n=>n.globals.lineProgress||0],"raster-value":[Ut,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[Ut,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ut,[],n=>n.globals.skyRadialProgress||0],accumulated:[Wi,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Ut,Va(Ut),(n,e)=>{let i=0;for(const a of e)i+=a.evaluate(n);return i}],"*":[Ut,Va(Ut),(n,e)=>{let i=1;for(const a of e)i*=a.evaluate(n);return i}],"-":{type:Ut,overloads:[[[Ut,Ut],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Ut],(n,[e])=>-e.evaluate(n)]]},"/":[Ut,[Ut,Ut],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Ut,[Ut,Ut],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Ut,[],()=>Math.LN2],pi:[Ut,[],()=>Math.PI],e:[Ut,[],()=>Math.E],"^":[Ut,[Ut,Ut],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Ut,[Ut],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Ut,[Ut],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Ut,[Ut],(n,[e])=>Math.log(e.evaluate(n))],log2:[Ut,[Ut],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Ut,[Ut],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Ut,[Ut],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Ut,[Ut],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Ut,[Ut],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Ut,[Ut],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Ut,[Ut],(n,[e])=>Math.atan(e.evaluate(n))],min:[Ut,Va(Ut),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Ut,Va(Ut),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Ut,[Ut],(n,[e])=>Math.abs(e.evaluate(n))],round:[Ut,[Ut],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ut,[Ut],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Ut,[Ut],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Xi,[on,Wi],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Xi,[Wi],(n,[e])=>n.id()===e.value],"filter-type-==":[Xi,[on],(n,[e])=>n.geometryType()===e.value],"filter-<":[Xi,[on,Wi],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Xi,[Wi],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[Xi,[on,Wi],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a>c}],"filter-id->":[Xi,[Wi],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[Xi,[on,Wi],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Xi,[Wi],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[Xi,[on,Wi],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Xi,[Wi],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[Xi,[Wi],(n,[e])=>e.value in n.properties()],"filter-has-id":[Xi,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Xi,[no(on)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Xi,[no(Wi)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Xi,[on,no(Wi)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Xi,[on,no(Wi)],(n,[e,i])=>function(a,c,d,f){for(;d<=f;){const _=d+f>>1;if(c[_]===a)return!0;c[_]>a?f=_-1:d=_+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Xi,overloads:[[[Xi,Xi],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[Va(Xi),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Xi,overloads:[[[Xi,Xi],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[Va(Xi),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Xi,[Xi],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Xi,[on],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[on,[on],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[on,[on],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[on,Va(Wi),(n,e)=>e.map(i=>oo(i.evaluate(n))).join("")],"resolved-locale":[on,[vl],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[Ut,[Ut,Ut,Wi],(n,e)=>{const[i,a,c]=e.map(f=>f.evaluate(n));if(i>a||i===a)return i;let d;if(typeof c=="string")d=function(f){let _=0;if(f.length===0)return _;for(let x=0;x<f.length;x++)_=(_<<5)-_+f.charCodeAt(x),_|=0;return _}(c);else{if(typeof c!="number")throw new Rt(`Invalid seed input: ${c}`);d=c}return i+D_(d)()*(a-i)}]});class Hp{constructor(e,i,a,c){this.expression=e,this._warningHistory={},this._evaluator=new cd(a,c),this._defaultValue=i?function(d){return d.type==="color"&&(Rd(d.default)||Array.isArray(d.default))?new Hi(0,0,0,0):d.type==="color"?Hi.parse(d.default)||null:d.default===void 0?null:d.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=yd(e)}evaluateWithoutErrorHandling(e,i,a,c,d,f,_,x){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,c,d,f,_,x){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Rt(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${w.message}`)),this._defaultValue}}}function Dd(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Al}function wc(n,e,i,a){const c=new S_(Al,[],e?function(f){const _={color:mo,string:on,number:Ut,enum:on,boolean:Xi,formatted:Fu,resolvedImage:Bu};return f.type==="array"?no(_[f.value]||Wi,f.length):_[f.type]}(e):void 0,void 0,void 0,i,a),d=c.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?O_(new Hp(d,e,i,a)):No(c.errors)}class Ml{constructor(e,i,a,c){this.kind=e,this._styleExpression=i,this.isLightConstant=a,this.isLineProgressConstant=c,this.isStateDependent=e!=="constant"&&!_d(i.expression),this.configDependencies=yd(i.expression)}evaluateWithoutErrorHandling(e,i,a,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,c,d,f)}evaluate(e,i,a,c,d,f){return this._styleExpression.evaluate(e,i,a,c,d,f)}}class Tc{constructor(e,i,a,c,d,f){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!_d(i.expression),this.isLightConstant=d,this.isLineProgressConstant=f,this.configDependencies=yd(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,a,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,c,d,f)}evaluate(e,i,a,c,d,f){return this._styleExpression.evaluate(e,i,a,c,d,f)}interpolationFactor(e,i,a){return this.interpolationType?_o.interpolationFactor(this.interpolationType,e,i,a):0}}function Ku(n,e,i,a){if((n=wc(n,e,i,a)).result==="error")return n;const c=n.value.expression,d=Hu(c);if(!d&&!Md(e))return No([new Jo("","data expressions not supported")]);const f=_c(c,["zoom","pitch","distance-from-center"]);if(!f&&!$p(e))return No([new Jo("","zoom expressions not supported")]);const _=_c(c,["measure-light"]);if(!_&&!F_(e))return No([new Jo("","measure-light expression not supported")]);const x=_c(c,["line-progress"]);if(!x&&!function(A){return Gp(A.expression,"line-progress")}(e))return No([new Jo("","line-progress expression not supported")]);const w=e.expression&&e.expression.relaxZoomRestriction,E=Ld(c);return E||f||w?E instanceof Jo?No([E]):E instanceof _o&&!Pd(e)?No([new Jo("",'"interpolate" expressions cannot be used with this property')]):O_(E?new Tc(d&&x?"camera":"composite",n.value,E.labels,E instanceof _o?E.interpolation:void 0,_,x):new Ml(d&&x?"constant":"source",n.value,_,x)):No([new Jo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Qu{constructor(e,i){this._parameters=e,this._specification=i,Ou(this,zd(this._parameters,this._specification))}static deserialize(e){return new Qu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ld(n){let e=null;if(n instanceof Td)e=Ld(n.result);else if(n instanceof wd){for(const i of n.args)if(e=Ld(i),e)break}else(n instanceof qu||n instanceof _o)&&n.input instanceof Xr&&n.input.name==="zoom"&&(e=n);return e instanceof Jo||n.eachChild(i=>{const a=Ld(i);a instanceof Jo?e=a:e&&a&&e!==a&&(e=new Jo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var qp,kd,Wp=function(){if(kd)return qp;kd=1,qp=e;var n=3;function e(i,a,c){var d=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var f=new Int32Array(this.arrayBuffer);i=f[0],this.d=(a=f[1])+2*(c=f[2]);for(var _=0;_<this.d*this.d;_++){var x=f[n+_],w=f[n+_+1];d.push(x===w?null:f.subarray(x,w))}var E=f[n+d.length+1];this.keys=f.subarray(f[n+d.length],E),this.bboxes=f.subarray(E),this.insert=this._insertReadonly}else{this.d=a+2*c;for(var A=0;A<this.d*this.d;A++)d.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=i,this.padding=c,this.scale=a/i,this.uid=0;var M=c/a*i;this.min=-M,this.max=i+M}return e.prototype.insert=function(i,a,c,d,f){this._forEachCell(a,c,d,f,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,a,c,d,f,_){this.cells[f].push(_)},e.prototype.query=function(i,a,c,d,f){var _=this.min,x=this.max;if(i<=_&&a<=_&&x<=c&&x<=d&&!f)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(i,a,c,d,this._queryCell,w,{},f),w},e.prototype._queryCell=function(i,a,c,d,f,_,x,w){var E=this.cells[f];if(E!==null)for(var A=this.keys,M=this.bboxes,L=0;L<E.length;L++){var k=E[L];if(x[k]===void 0){var F=4*k;(w?w(M[F+0],M[F+1],M[F+2],M[F+3]):i<=M[F+2]&&a<=M[F+3]&&c>=M[F+0]&&d>=M[F+1])?(x[k]=!0,_.push(A[k])):x[k]=!1}}},e.prototype._forEachCell=function(i,a,c,d,f,_,x,w){for(var E=this._convertToCellCoord(i),A=this._convertToCellCoord(a),M=this._convertToCellCoord(c),L=this._convertToCellCoord(d),k=E;k<=M;k++)for(var F=A;F<=L;F++){var $=this.d*F+k;if((!w||w(this._convertFromCellCoord(k),this._convertFromCellCoord(F),this._convertFromCellCoord(k+1),this._convertFromCellCoord(F+1)))&&f.call(this,i,a,c,d,$,_,x,w))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,a=n+this.cells.length+1+1,c=0,d=0;d<this.cells.length;d++)c+=this.cells[d].length;var f=new Int32Array(a+c+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var _=a,x=0;x<i.length;x++){var w=i[x];f[n+x]=_,f.set(w,_),_+=w.length}return f[n+i.length]=_,f.set(this.keys,_),f[n+i.length+1]=_+=this.keys.length,f.set(this.bboxes,_),_+=this.bboxes.length,f.buffer},qp}(),Sc=Sn(Wp);const Ju={};function At(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),Ju[e]={klass:n,omit:i.omit||[]}}At(Object,"Object"),Sc.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},Sc.deserialize=function(n){return new Sc(n.buffer)},Object.defineProperty(Sc,"name",{value:"Grid"}),At(Sc,"Grid"),typeof DOMMatrix<"u"&&At(DOMMatrix,"DOMMatrix"),At(Hi,"Color"),At(Error,"Error"),At(ro,"Formatted"),At(ld,"FormattedSection"),At(id,"AJAXError"),At(go,"ResolvedImage"),At(Qu,"StylePropertyFunction"),At(Hp,"StyleExpression",{omit:["_evaluator"]}),At(Eo,"ImageId"),At(_s,"ImageVariant"),At(Tc,"ZoomDependentExpression"),At(Ml,"ZoomConstantExpression"),At(Xr,"CompoundExpression",{omit:["_evaluate"]});for(const n in Al)Ju[Al[n]._classRegistryKey]||At(Al[n],`Expression${n}`);function eh(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Pl(n){return self.ImageBitmap&&n instanceof ImageBitmap}function Ua(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(eh(n)||Pl(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const a of n)i.push(Ua(a,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[a,c]of n.entries())i.entries.push(Ua(a),Ua(c,e));return i}if(n instanceof Set){const i={$name:"Set"};let a=0;for(const c of n.values())i[++a]=Ua(c);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},a=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const c of a)i[c]=n[c];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,a=i._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const c=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const d in n)n.hasOwnProperty(d)&&(Ju[a].omit.indexOf(d)>=0||(c[d]=Ua(n[d],e)));n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof n)}function Ga(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||eh(n)||Pl(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Ga);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const c=n.entries||[],d=new Map;for(let f=0;f<c.length;f+=2)d.set(Ga(c[f]),Ga(c[f+1]));return d}if(e==="Set"){const c=new Set;for(const d of Object.keys(n))d!=="$name"&&c.add(Ga(n[d]));return c}if(e==="DOMMatrix"){let c;return c=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(c)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=Ju[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const a=Object.create(i.prototype);for(const c of Object.keys(n))c!=="$name"&&(a[c]=Ga(n[c]));return a}throw new Error("can't deserialize object of type "+typeof n)}const Wt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function Zp(n){for(const e of n)if(th(e.charCodeAt(0)))return!0;return!1}function bx(n){for(const e of n)if(!j_(e.charCodeAt(0)))return!1;return!0}function j_(n){return!(Wt.Arabic(n)||Wt["Arabic Supplement"](n)||Wt["Arabic Extended-A"](n)||Wt["Arabic Presentation Forms-A"](n)||Wt["Arabic Presentation Forms-B"](n))}function th(n){return!(n!==746&&n!==747&&(n<4352||!(Wt["Bopomofo Extended"](n)||Wt.Bopomofo(n)||Wt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Wt["CJK Compatibility Ideographs"](n)||Wt["CJK Compatibility"](n)||Wt["CJK Radicals Supplement"](n)||Wt["CJK Strokes"](n)||!(!Wt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Wt["CJK Unified Ideographs Extension A"](n)||Wt["CJK Unified Ideographs"](n)||Wt["Enclosed CJK Letters and Months"](n)||Wt["Hangul Compatibility Jamo"](n)||Wt["Hangul Jamo Extended-A"](n)||Wt["Hangul Jamo Extended-B"](n)||Wt["Hangul Jamo"](n)||Wt["Hangul Syllables"](n)||Wt.Hiragana(n)||Wt["Ideographic Description Characters"](n)||Wt.Kanbun(n)||Wt["Kangxi Radicals"](n)||Wt["Katakana Phonetic Extensions"](n)||Wt.Katakana(n)&&n!==12540||!(!Wt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Wt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Wt["Unified Canadian Aboriginal Syllabics"](n)||Wt["Unified Canadian Aboriginal Syllabics Extended"](n)||Wt["Vertical Forms"](n)||Wt["Yijing Hexagram Symbols"](n)||Wt["Yi Syllables"](n)||Wt["Yi Radicals"](n))))}function V_(n){return!(th(n)||function(e){return!!(Wt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Wt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Wt["Letterlike Symbols"](e)||Wt["Number Forms"](e)||Wt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Wt["Control Pictures"](e)&&e!==9251||Wt["Optical Character Recognition"](e)||Wt["Enclosed Alphanumerics"](e)||Wt["Geometric Shapes"](e)||Wt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Wt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Wt["CJK Symbols and Punctuation"](e)||Wt.Katakana(e)||Wt["Private Use Area"](e)||Wt["CJK Compatibility Forms"](e)||Wt["Small Form Variants"](e)||Wt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function wx(n){return Wt.Arabic(n)||Wt["Arabic Supplement"](n)||Wt["Arabic Extended-A"](n)||Wt["Arabic Presentation Forms-A"](n)||Wt["Arabic Presentation Forms-B"](n)}function U_(n){return n>=1424&&n<=2303||Wt["Arabic Presentation Forms-A"](n)||Wt["Arabic Presentation Forms-B"](n)}function Tx(n,e){return!(!e&&U_(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Wt.Khmer(n))}function Sx(n){for(const e of n)if(U_(e.charCodeAt(0)))return!0;return!1}const Xp="deferred",Yp="loading",Kp="loaded";let Qp=null,Io="unavailable",$a=null;const Rl=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Io="error"),Qp&&Qp(n)};function Od(){Fd.fire(new Da("pluginStateChange",{pluginStatus:Io,pluginURL:$a}))}const Fd=new _l,Ec=function(){return Io},G_=function(){if(Io!==Xp||!$a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Io=Yp,Od(),$a&&oc({url:$a},n=>{n?Rl(n):(Io=Kp,Od())})},is={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Io===Kp||is.applyArabicShaping!=null,isLoading:()=>Io===Yp,setState(n){Io=n.pluginStatus,$a=n.pluginURL},isParsed:()=>is.applyArabicShaping!=null&&is.processBidirectionalText!=null&&is.processStyledBidirectionalText!=null,getPluginURL:()=>$a};class en{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,a){for(const c of i)if(!Tx(c.charCodeAt(0),a))return!1;return!0}(e,is.isLoaded())}}class ih{constructor(e,i,a,c){this.property=e,this.value=i,this.expression=function(d,f,_,x){if(Rd(d))return new Qu(d,f);if(Dd(d)||Array.isArray(d)&&d.length>0){const w=Ku(d,f,_,x);if(w.result==="error")throw new Error(w.value.map(E=>`${E.key}: ${E.message}`).join(", "));return w.value}{let w=d;return typeof d=="string"&&f.type==="color"&&(w=Hi.parse(d)),{kind:"constant",configDependencies:new Set,evaluate:()=>w}}}(i===void 0?e.specification.default:i,e.specification,a,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a){return this.property.possiblyEvaluate(this,e,i,a)}}class Ha{constructor(e,i,a){this.property=e,this.value=new ih(e,void 0,i,a)}transitioned(e,i){return new H_(this.property,this.value,i,Ne({},e.transition,this.transition),e.now)}untransitioned(){return new H_(this.property,this.value,null,{},0)}}class $_{constructor(e,i,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=a,this.configDependencies=new Set}getValue(e){return Ii(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ha(this._values[e].property,this._scope,this._options)),this._values[e].value=new ih(this._values[e].property,i===null?void 0:Ii(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const a=this._properties.properties;if(e)for(const c in e){const d=e[c];if(c.endsWith("-transition")){const f=c.slice(0,-11);a[f]&&this.setTransition(f,d)}else a.hasOwnProperty(c)&&this.setValue(c,d)}}getTransition(e){return Ii(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ha(this._values[e].property)),this._values[e].transition=Ii(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const a=new q_(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,i._values[c]);return a}untransitioned(){const e=new q_(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class H_{constructor(e,i,a,c,d){const f=c.delay||0,_=c.duration||0;d=d||0,this.property=e,this.value=i,this.begin=d+f,this.end=this.begin+_,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const c=e.now||0,d=this.value.possiblyEvaluate(e,i,a),f=this.prior;if(f){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return f.possiblyEvaluate(e,i,a);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,a),d,Te(_))}}return d}}class q_{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const c=new zl(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,i,a);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ex{constructor(e,i,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=a,this.configDependencies=new Set}getValue(e){return Ii(this._values[e].value)}setValue(e,i){this._values[e]=new ih(this._values[e].property,i===null?void 0:Ii(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a){const c=new zl(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,i,a);return c}}class Ic{constructor(e,i,a){this.property=e,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,c){return this.property.evaluate(this.value,this.parameters,e,i,a,c)}}class zl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class pt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const c=ad[this.specification.type];return c?c(e,i,a):e}}class It{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,c){return new Ic(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},a,c)}:e.expression,i)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ic(this,{kind:"constant",value:void 0},e.parameters);const c=ad[this.specification.type];return c?new Ic(this,{kind:"constant",value:c(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,c,d,f){return e.kind==="constant"?e.value:e.evaluate(i,a,c,d,f)}}class Dl{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,c){return!!e.expression.evaluate(i,null,{},a,c)}interpolate(){return!1}}class Hn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new en(0,{});for(const a in e){const c=e[a];c.specification.overridable&&this.overridableProperties.push(a);const d=this.defaultPropertyValues[a]=new ih(c,void 0),f=this.defaultTransitionablePropertyValues[a]=new Ha(c);this.defaultTransitioningPropertyValues[a]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(i)}}}At(It,"DataDrivenProperty"),At(pt,"DataConstantProperty"),At(Dl,"ColorRampProperty");var Oe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white"},"sky-atmosphere-color":{"type":"color","default":"white"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function vs(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Bd(n){if(Array.isArray(n))return n.map(Bd);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Bd(n[i]);return e}return vs(n)}function Nd(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Nd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Jp(n,e="",i=null,a="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Nd(n)||(n=jd(n));const c=n;let d=!0;try{d=function(E){if(!Ac(E))return E;let A=Bd(E);return Z_(A),A=W_(A),A}(c)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(c,null,2)}
        `)}let f=null,_=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){_=Oe[`filter_${a}`];const E=wc(d,_,e,i);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));f=(A,M,L)=>E.value.evaluate(A,M,{},L)}let x=null,w=null;if(d!==c){const E=wc(c,_,e,i);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));x=(A,M,L,k,F)=>E.value.evaluate(A,M,{},L,void 0,void 0,k,F),w=!Hu(E.value.expression)}return{filter:f,dynamicFilter:x||void 0,needGeometry:X_(d),needFeature:!!w}}function W_(n){if(!Array.isArray(n))return n;const e=function(i){if(Ix.has(i[0])){for(let a=1;a<i.length;a++)if(Ac(i[a]))return!0}return i}(n);return e===!0?e:e.map(i=>W_(i))}function Z_(n){let e=!1;const i=[];if(n[0]==="case"){for(let a=1;a<n.length-1;a+=2)e=e||Ac(n[a]),i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||Ac(n[1]);for(let a=2;a<n.length-1;a+=2)i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||Ac(n[1]);for(let a=1;a<n.length-1;a+=2)i.push(n[a+1])}e&&(n.length=0,n.push("any",...i));for(let a=1;a<n.length;a++)Z_(n[a])}function Ac(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(Ac(n[i]))return!0;return!1}const Ix=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ax(n,e){return n<e?-1:n>e?1:0}function X_(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(X_(n[e]))return!0;return!1}function jd(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?em(n[1],n[2],"=="):e==="!="?Vd(em(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?em(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(jd))):e==="all"?["all"].concat(n.slice(1).map(jd)):e==="none"?["all"].concat(n.slice(1).map(jd).map(Vd)):e==="in"?tm(n[1],n.slice(2)):e==="!in"?Vd(tm(n[1],n.slice(2))):e==="has"?Y_(n[1]):e!=="!has"||Vd(Y_(n[1]));var i}function em(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function tm(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Ax)]]:["filter-in-small",n,["literal",e]]}}function Y_(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Vd(n){return["!",n]}const nh="";function Ll(n,e){return e?`${n}${nh}${e}`:n}const im="-transition",qa=new Set(["fill","line","background","hillshade","raster"]);class lo extends _l{constructor(e,i,a,c,d){if(super(),this.id=e.id,this.fqid=Ll(this.id,a),this.type=e.type,this.scope=a,this.lut=c,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=wc(this.filter,Oe[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Ex(i.layout,this.scope,d),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new $_(i.paint,this.scope,d);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new zl(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&qa.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(im)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const a=this._transitionablePaint,c=a._properties.properties;if(e.endsWith(im)){const A=e.slice(0,-11);return c[A]&&a.setTransition(A,i||void 0),!1}if(!c[e])return!1;const d=a._values[e],f=d.value.isDataDriven(),_=d.value;a.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const x=a._values[e].value,w=x.isDataDriven(),E=e.endsWith("pattern")||e==="line-dasharray";return w||f||E||this._handleOverridablePaintPropertyUpdate(e,_,x)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,a){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return xi({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ic&&Md(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Jp(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,a,c,d,f,_,x,w){}}const Cx={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class rh{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Mn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Gi(n,e=1){let i=0,a=0;return{members:n.map(c=>{const d=Cx[c.type].BYTES_PER_ELEMENT,f=i=nm(i,Math.max(e,d)),_=c.components||1;return a=Math.max(a,d),i+=d*_,{name:c.name,type:c.type,components:_,offset:f}}),size:nm(i,Math.max(a,e)),alignment:e}}function nm(n,e){return Math.ceil(n/e)*e}class da extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=a,e}}da.prototype.bytesPerElement=4,At(da,"StructArrayLayout2i4");class Ud extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const d=3*e;return this.int16[d+0]=i,this.int16[d+1]=a,this.int16[d+2]=c,e}}Ud.prototype.bytesPerElement=6,At(Ud,"StructArrayLayout3i6");class kl extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c)}emplace(e,i,a,c,d){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=a,this.int16[f+2]=c,this.int16[f+3]=d,e}}kl.prototype.bytesPerElement=8,At(kl,"StructArrayLayout4i8");class Cc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Cc.prototype.bytesPerElement=4,At(Cc,"StructArrayLayout1f4");class Gd extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const d=4*e,f=2*e;return this.int16[d+0]=i,this.int16[d+1]=a,this.float32[f+1]=c,e}}Gd.prototype.bytesPerElement=8,At(Gd,"StructArrayLayout2i1f8");class Mc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=a,this.int16[d+2]=c,e}}Mc.prototype.bytesPerElement=8,At(Mc,"StructArrayLayout3i8");class rm extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,c,d)}emplace(e,i,a,c,d,f){const _=5*e;return this.int16[_+0]=i,this.int16[_+1]=a,this.int16[_+2]=c,this.int16[_+3]=d,this.int16[_+4]=f,e}}rm.prototype.bytesPerElement=10,At(rm,"StructArrayLayout5i10");class om extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,c,d,f,_)}emplace(e,i,a,c,d,f,_,x){const w=6*e,E=12*e,A=3*e;return this.int16[w+0]=i,this.int16[w+1]=a,this.uint8[E+4]=c,this.uint8[E+5]=d,this.uint8[E+6]=f,this.uint8[E+7]=_,this.float32[A+2]=x,e}}om.prototype.bytesPerElement=12,At(om,"StructArrayLayout2i4ub1f12");class Vs extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const d=3*e;return this.float32[d+0]=i,this.float32[d+1]=a,this.float32[d+2]=c,e}}Vs.prototype.bytesPerElement=12,At(Vs,"StructArrayLayout3f12");class fa extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,c,d)}emplace(e,i,a,c,d,f){const _=6*e,x=3*e;return this.uint16[_+0]=i,this.uint16[_+1]=a,this.uint16[_+2]=c,this.uint16[_+3]=d,this.float32[x+2]=f,e}}fa.prototype.bytesPerElement=12,At(fa,"StructArrayLayout4ui1f12");class $d extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c)}emplace(e,i,a,c,d){const f=4*e;return this.uint16[f+0]=i,this.uint16[f+1]=a,this.uint16[f+2]=c,this.uint16[f+3]=d,e}}$d.prototype.bytesPerElement=8,At($d,"StructArrayLayout4ui8");class Ol extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,c,d,f)}emplace(e,i,a,c,d,f,_){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=d,this.int16[x+4]=f,this.int16[x+5]=_,e}}Ol.prototype.bytesPerElement=12,At(Ol,"StructArrayLayout6i12");class Pc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f,_,x,w,E,A,M){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,a,c,d,f,_,x,w,E,A,M)}emplace(e,i,a,c,d,f,_,x,w,E,A,M,L){const k=12*e;return this.int16[k+0]=i,this.int16[k+1]=a,this.int16[k+2]=c,this.int16[k+3]=d,this.uint16[k+4]=f,this.uint16[k+5]=_,this.uint16[k+6]=x,this.uint16[k+7]=w,this.int16[k+8]=E,this.int16[k+9]=A,this.int16[k+10]=M,this.int16[k+11]=L,e}}Pc.prototype.bytesPerElement=24,At(Pc,"StructArrayLayout4i4ui4i24");class yo extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,c,d,f)}emplace(e,i,a,c,d,f,_){const x=10*e,w=5*e;return this.int16[x+0]=i,this.int16[x+1]=a,this.int16[x+2]=c,this.float32[w+2]=d,this.float32[w+3]=f,this.float32[w+4]=_,e}}yo.prototype.bytesPerElement=20,At(yo,"StructArrayLayout3i3f20");class Us extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c)}emplace(e,i,a,c,d){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=a,this.float32[f+2]=c,this.float32[f+3]=d,e}}Us.prototype.bytesPerElement=16,At(Us,"StructArrayLayout4f16");class sm extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}sm.prototype.bytesPerElement=4,At(sm,"StructArrayLayout1ul4");class Wa extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=a,e}}Wa.prototype.bytesPerElement=4,At(Wa,"StructArrayLayout2ui4");class am extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f,_,x,w,E,A,M,L){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,a,c,d,f,_,x,w,E,A,M,L)}emplace(e,i,a,c,d,f,_,x,w,E,A,M,L,k){const F=20*e,$=10*e;return this.int16[F+0]=i,this.int16[F+1]=a,this.int16[F+2]=c,this.int16[F+3]=d,this.int16[F+4]=f,this.float32[$+3]=_,this.float32[$+4]=x,this.float32[$+5]=w,this.float32[$+6]=E,this.int16[F+14]=A,this.uint32[$+8]=M,this.uint16[F+18]=L,this.uint16[F+19]=k,e}}am.prototype.bytesPerElement=40,At(am,"StructArrayLayout5i4f1i1ul2ui40");class Hd extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,c,d,f,_)}emplace(e,i,a,c,d,f,_,x){const w=8*e;return this.int16[w+0]=i,this.int16[w+1]=a,this.int16[w+2]=c,this.int16[w+4]=d,this.int16[w+5]=f,this.int16[w+6]=_,this.int16[w+7]=x,e}}Hd.prototype.bytesPerElement=16,At(Hd,"StructArrayLayout3i2i2i16");class oh extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,c,d)}emplace(e,i,a,c,d,f){const _=4*e,x=8*e;return this.float32[_+0]=i,this.float32[_+1]=a,this.float32[_+2]=c,this.int16[x+6]=d,this.int16[x+7]=f,e}}oh.prototype.bytesPerElement=16,At(oh,"StructArrayLayout2f1f2i16");class lm extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,c,d,f)}emplace(e,i,a,c,d,f,_){const x=20*e,w=5*e;return this.uint8[x+0]=i,this.uint8[x+1]=a,this.float32[w+1]=c,this.float32[w+2]=d,this.float32[w+3]=f,this.float32[w+4]=_,e}}lm.prototype.bytesPerElement=20,At(lm,"StructArrayLayout2ub4f20");class vr extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=a,this.uint16[d+2]=c,e}}vr.prototype.bytesPerElement=6,At(vr,"StructArrayLayout3ui6");class cm extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f,_,x,w,E,A,M,L,k,F,$,q,ee,K,B,Z){const J=this.length;return this.resize(J+1),this.emplace(J,e,i,a,c,d,f,_,x,w,E,A,M,L,k,F,$,q,ee,K,B,Z)}emplace(e,i,a,c,d,f,_,x,w,E,A,M,L,k,F,$,q,ee,K,B,Z,J){const oe=30*e,_e=15*e,Se=60*e;return this.int16[oe+0]=i,this.int16[oe+1]=a,this.int16[oe+2]=c,this.float32[_e+2]=d,this.float32[_e+3]=f,this.uint16[oe+8]=_,this.uint16[oe+9]=x,this.uint32[_e+5]=w,this.uint32[_e+6]=E,this.uint32[_e+7]=A,this.uint16[oe+16]=M,this.uint16[oe+17]=L,this.uint16[oe+18]=k,this.float32[_e+10]=F,this.float32[_e+11]=$,this.uint8[Se+48]=q,this.uint8[Se+49]=ee,this.uint8[Se+50]=K,this.uint32[_e+13]=B,this.int16[oe+28]=Z,this.uint8[Se+58]=J,e}}cm.prototype.bytesPerElement=60,At(cm,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class um extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f,_,x,w,E,A,M,L,k,F,$,q,ee,K,B,Z,J,oe,_e,Se,Ae,De,qe,rt,Je,nt,lt,$e){const it=this.length;return this.resize(it+1),this.emplace(it,e,i,a,c,d,f,_,x,w,E,A,M,L,k,F,$,q,ee,K,B,Z,J,oe,_e,Se,Ae,De,qe,rt,Je,nt,lt,$e)}emplace(e,i,a,c,d,f,_,x,w,E,A,M,L,k,F,$,q,ee,K,B,Z,J,oe,_e,Se,Ae,De,qe,rt,Je,nt,lt,$e,it){const je=20*e,He=40*e,ut=80*e;return this.float32[je+0]=i,this.float32[je+1]=a,this.int16[He+4]=c,this.int16[He+5]=d,this.int16[He+6]=f,this.int16[He+7]=_,this.int16[He+8]=x,this.int16[He+9]=w,this.int16[He+10]=E,this.int16[He+11]=A,this.int16[He+12]=M,this.uint16[He+13]=L,this.uint16[He+14]=k,this.uint16[He+15]=F,this.uint16[He+16]=$,this.uint16[He+17]=q,this.uint16[He+18]=ee,this.uint16[He+19]=K,this.uint16[He+20]=B,this.uint16[He+21]=Z,this.uint16[He+22]=J,this.uint16[He+23]=oe,this.uint16[He+24]=_e,this.uint16[He+25]=Se,this.uint16[He+26]=Ae,this.uint16[He+27]=De,this.uint32[je+14]=qe,this.float32[je+15]=rt,this.float32[je+16]=Je,this.float32[je+17]=nt,this.float32[je+18]=lt,this.uint8[ut+76]=$e,this.uint16[He+39]=it,e}}um.prototype.bytesPerElement=80,At(um,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Za extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,c,d)}emplace(e,i,a,c,d,f){const _=5*e;return this.float32[_+0]=i,this.float32[_+1]=a,this.float32[_+2]=c,this.float32[_+3]=d,this.float32[_+4]=f,e}}Za.prototype.bytesPerElement=20,At(Za,"StructArrayLayout5f20");class sh extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,c,d,f,_)}emplace(e,i,a,c,d,f,_,x){const w=7*e;return this.float32[w+0]=i,this.float32[w+1]=a,this.float32[w+2]=c,this.float32[w+3]=d,this.float32[w+4]=f,this.float32[w+5]=_,this.float32[w+6]=x,e}}sh.prototype.bytesPerElement=28,At(sh,"StructArrayLayout7f28");class hm extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f,_,x,w,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,a,c,d,f,_,x,w,E,A)}emplace(e,i,a,c,d,f,_,x,w,E,A,M){const L=11*e;return this.float32[L+0]=i,this.float32[L+1]=a,this.float32[L+2]=c,this.float32[L+3]=d,this.float32[L+4]=f,this.float32[L+5]=_,this.float32[L+6]=x,this.float32[L+7]=w,this.float32[L+8]=E,this.float32[L+9]=A,this.float32[L+10]=M,e}}hm.prototype.bytesPerElement=44,At(hm,"StructArrayLayout11f44");class qd extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f,_,x,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,a,c,d,f,_,x,w)}emplace(e,i,a,c,d,f,_,x,w,E){const A=9*e;return this.float32[A+0]=i,this.float32[A+1]=a,this.float32[A+2]=c,this.float32[A+3]=d,this.float32[A+4]=f,this.float32[A+5]=_,this.float32[A+6]=x,this.float32[A+7]=w,this.float32[A+8]=E,e}}qd.prototype.bytesPerElement=36,At(qd,"StructArrayLayout9f36");class Fl extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=a,e}}Fl.prototype.bytesPerElement=8,At(Fl,"StructArrayLayout2f8");class dm extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c)}emplace(e,i,a,c,d){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=a,this.uint16[f+3]=c,this.uint16[f+4]=d,e}}dm.prototype.bytesPerElement=12,At(dm,"StructArrayLayout1ul3ui12");class ah extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}ah.prototype.bytesPerElement=2,At(ah,"StructArrayLayout1ui2");class Rc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f,_,x,w,E,A,M,L,k,F,$){const q=this.length;return this.resize(q+1),this.emplace(q,e,i,a,c,d,f,_,x,w,E,A,M,L,k,F,$)}emplace(e,i,a,c,d,f,_,x,w,E,A,M,L,k,F,$,q){const ee=16*e;return this.float32[ee+0]=i,this.float32[ee+1]=a,this.float32[ee+2]=c,this.float32[ee+3]=d,this.float32[ee+4]=f,this.float32[ee+5]=_,this.float32[ee+6]=x,this.float32[ee+7]=w,this.float32[ee+8]=E,this.float32[ee+9]=A,this.float32[ee+10]=M,this.float32[ee+11]=L,this.float32[ee+12]=k,this.float32[ee+13]=F,this.float32[ee+14]=$,this.float32[ee+15]=q,e}}Rc.prototype.bytesPerElement=64,At(Rc,"StructArrayLayout16f64");class lh extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,d,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,c,d,f,_)}emplace(e,i,a,c,d,f,_,x){const w=10*e,E=5*e;return this.uint16[w+0]=i,this.uint16[w+1]=a,this.uint16[w+2]=c,this.uint16[w+3]=d,this.float32[E+2]=f,this.float32[E+3]=_,this.float32[E+4]=x,e}}lh.prototype.bytesPerElement=20,At(lh,"StructArrayLayout4ui3f20");class fm extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}fm.prototype.bytesPerElement=2,At(fm,"StructArrayLayout1i2");class Wd extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Wd.prototype.bytesPerElement=1,At(Wd,"StructArrayLayout1ub1");class K_ extends rh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}K_.prototype.size=40;class Zd extends am{get(e){return new K_(this,e)}}At(Zd,"CollisionBoxArray");class Q_ extends rh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Q_.prototype.size=60;class J_ extends cm{get(e){return new Q_(this,e)}}At(J_,"PlacedSymbolArray");class ey extends rh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}ey.prototype.size=80;class ty extends um{get(e){return new ey(this,e)}}At(ty,"SymbolInstanceArray");class pm extends Cc{getoffsetX(e){return this.float32[1*e+0]}}At(pm,"GlyphOffsetArray");class iy extends da{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}At(iy,"SymbolLineVertexArray");class ny extends rh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ny.prototype.size=12;class ry extends dm{get(e){return new ny(this,e)}}At(ry,"FeatureIndexArray");class oy extends Wa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}At(oy,"FillExtrusionCentroidArray");class sy extends rh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}sy.prototype.size=6;class ay extends Ud{get(e){return new sy(this,e)}}At(ay,"FillExtrusionWallArray");const Mx=Gi([{name:"a_pos",components:2,type:"Int16"}],4),Px=Gi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class kn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,a,c){let d=this.segments[this.segments.length-1];return e>kn.MAX_VERTEX_ARRAY_LENGTH&&Ci(`Max vertices per segment is ${kn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>kn.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:i,primitiveOffset:a,vertexLength:0,primitiveLength:0},c!==void 0&&(d.sortKey=c),this.segments.push(d)),d}prepareSegment(e,i,a,c){return this._prepareSegment(e,i.length,a.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,c){return new kn([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function ly(n,e){return 256*(n=Me(Math.floor(n),0,255))+Me(Math.floor(e),0,255)}kn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,At(kn,"SegmentVector");const Rx=Gi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),zc=Gi([{name:"a_pattern_b",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),zx=Gi([{name:"a_dash",components:4,type:"Uint16"}]);class Dc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,a,c){this.ids.push(cy(e)),this.positions.push(i,a,c)}eachPosition(e,i){const a=cy(e);let c=0,d=this.ids.length-1;for(;c<d;){const f=c+d>>1;this.ids[f]>=a?d=f:c=f+1}for(;this.ids[c]===a;)i(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,i){const a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Xd(a,c,0,a.length-1),i&&(i.add(a.buffer),i.add(c.buffer)),{ids:a,positions:c}}static deserialize(e){const i=new Dc;let a;i.ids=e.ids,i.positions=e.positions;for(const c of i.ids)c!==a&&i.uniqueIds.push(c),a=c;return i.indexed=!0,i}}function cy(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:So(String(n))}function Xd(n,e,i,a){for(;i<a;){const c=n[i+a>>1];let d=i-1,f=a+1;for(;;){do d++;while(n[d]<c);do f--;while(n[f]>c);if(d>=f)break;ch(n,d,f),ch(e,3*d,3*f),ch(e,3*d+1,3*f+1),ch(e,3*d+2,3*f+2)}f-i<a-f?(Xd(n,e,i,f),i=f+1):(Xd(n,e,f+1,a),a=f)}}function ch(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}At(Dc,"FeaturePositionMap");class Gs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Yd extends Gs{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class er extends Gs{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class xs extends Gs{constructor(e){super(e),this.current=[0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class uh extends Gs{constructor(e){super(e),this.current=[0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class Kd extends Gs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class uy extends Gs{constructor(e){super(e),this.current=Hi.transparent.toRenderColor(null)}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const Dx=new Float32Array(16);class hh extends Gs{constructor(e){super(e),this.current=Dx}set(e,i,a){if(this.fetchUniformLocation(e,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const hy=new Float32Array(9),mm=new Float32Array(4);class ns extends Gs{constructor(e){super(e),this.current=mm}set(e,i,a){if(this.fetchUniformLocation(e,i)){for(let c=0;c<4;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function dh(n){return[ly(255*n.r,255*n.g),ly(255*n.b,255*n.a)]}class fh{constructor(e,i,a,c){this.value=e,this.uniformNames=i.map(d=>`u_${d}`),this.type=a,this.context=c}setUniform(e,i,a,c,d){const f=c.constantOr(this.value);i.set(e,d,f instanceof Hi?f.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):f)}getBinding(e,i){return this.type==="color"?new uy(e):new er(e)}}class Lc{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,a,c,d){let f=null;d!=="u_pattern"&&d!=="u_dash"||(f=this.pattern),d==="u_pattern_b"&&(f=this.patternTransition),d==="u_pixel_ratio"&&(f=this.pixelRatio),f&&i.set(e,d,f)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Kd(e):new er(e)}}class pa{constructor(e,i,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,a,c,d,f,_){const x=this.paintVertexArray.length,w=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new en(0,{brightness:f}),i,{},d,c,_):this.expression.kind==="constant"&&this.expression.value,E=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new en(0,{brightness:f}),i,{},d,c,_):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(x,e,w,E?null:this.context.lut)}updatePaintArray(e,i,a,c,d,f,_){const x=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:_},a,c,void 0,d):this.expression.kind==="constant"&&this.expression.value,w=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new en(0,{brightness:_}),a,c,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,x,w?null:this.context.lut)}_setPaintValue(e,i,a,c){if(this.type==="color"){const d=dh(a.toRenderColor(c));for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,d[0],d[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bs{constructor(e,i,a,c,d,f){this.expression=e,this.uniformNames=i.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=c,this.context=d,this.maxValue=0,this.paintVertexAttributes=i.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,a,c,d,f,_){const x=this.expression.evaluate(new en(this.context.zoom,{brightness:f}),i,{},d,c,_),w=this.expression.evaluate(new en(this.context.zoom+1,{brightness:f}),i,{},d,c,_),E=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new en(0,{brightness:f}),i,{},d,c,_):this.lutExpression.value)==="none",A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,x,w,E?null:this.context.lut)}updatePaintArray(e,i,a,c,d,f,_){const x=this.expression.evaluate({zoom:this.context.zoom,brightness:_},a,c,void 0,d),w=this.expression.evaluate({zoom:this.context.zoom+1,brightness:_},a,c,void 0,d),E=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new en(0,{brightness:_}),a,c,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,x,w,E?null:this.context.lut)}_setPaintValue(e,i,a,c,d){if(this.type==="color"){const f=dh(a.toRenderColor(d)),_=dh(a.toRenderColor(d));for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,f[0],f[1],_[0],_[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,c,d){const f=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,_=Me(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);i.set(e,d,_)}getBinding(e,i){return new er(e)}}class ws{constructor(e,i,a,c,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(a==="array"?zx:Rx).members;for(let f=0;f<i.length;++f);this.paintVertexArray=new c,this.paintTransitionVertexArray=new fa}populatePaintArray(e,i,a,c){const d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,c,d,f,_){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],f)}_setPaintValues(e,i,a,c){if(!c||!a)return;const d=c[a[0]],f=c[a[1]];if(d){if(d){const{tl:_,br:x,pixelRatio:w}=d;for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,_[0],_[1],x[0],x[1],w)}if(f){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:_,br:x,pixelRatio:w}=f;for(let E=e;E<i;E++)this.paintTransitionVertexArray.emplace(E,_[0],_[1],x[0],x[1],w)}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,zc.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Xa{constructor(e,i,a=()=>!0){this.binders={},this._buffers=[],this.context=i;const c=[];for(const d in e.paint._values){const f=e.paint.get(d);if(d.endsWith("-use-theme")||!a(d)||!(f instanceof Ic&&Md(f.property.specification)))continue;const _=t(d,e.type),x=f.value,w=f.property.specification.type,E=!!f.property.useIntegerZoom,A=d==="line-dasharray"||d.endsWith("pattern"),M=e.paint.get(`${d}-use-theme`),L=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||M&&M.value.kind!=="constant";if(x.kind!=="constant"||L)if(x.kind==="source"||L||A){const k=m(d,w,"source");this.binders[d]=A?new ws(x,_,w,k,e.id):new pa(x,_,w,k),c.push(`/a_${d}`)}else{const k=m(d,w,"composite");this.binders[d]=new bs(x,_,w,E,i,k),c.push(`/z_${d}`)}else this.binders[d]=A?new Lc(x.value,_):new fh(x.value,_,w,i),c.push(`/u_${d}`);M&&(this.binders[d].lutExpression=M.value)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof pa||i instanceof bs?i.maxValue:0}populatePaintArrays(e,i,a,c,d,f,_){for(const x in this.binders){const w=this.binders[x];w.context=this.context,(w instanceof pa||w instanceof bs||w instanceof ws)&&w.populatePaintArray(e,i,a,c,d,f,_)}}setConstantPatternPositions(e,i){for(const a in this.binders){const c=this.binders[a];c instanceof Lc&&c.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof ws?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,a,c,d,f,_,x,w){let E=!1;const A=Object.keys(e),M=A.length!==0&&!x,L=M?A:i.uniqueIds;this.context.lut=d.lut;for(const k in this.binders){const F=this.binders[k];if(F.context=this.context,(F instanceof pa||F instanceof bs||F instanceof ws)&&F.expression&&F.expression.kind&&F.expression.kind!=="constant"&&(F.expression.isStateDependent===!0||F.expression.isLightConstant===!1)){const $=d.paint.get(k);F.expression=$.value;for(const q of L){const ee=e[q.toString()];i.eachPosition(q,(K,B,Z)=>{const J=c.feature(K);F.updatePaintArray(B,Z,J,ee,f,_,w)})}if(!M)for(const q of a.uniqueIds){const ee=e[q.toString()];a.eachPosition(q,(K,B,Z)=>{const J=c.feature(K);F.updatePaintArray(B,Z,J,ee,f,_,w)})}E=!0}}return E}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof fh||a instanceof Lc)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof pa||a instanceof bs||a instanceof ws)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name);if(a instanceof ws)for(let c=0;c<zc.members.length;c++)e.push(zc.members[c].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof fh||a instanceof Lc||a instanceof bs)for(const c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof fh||c instanceof Lc||c instanceof bs)for(const d of c.uniformNames)i.push({name:d,property:a,binding:c.getBinding(e,d)})}return i}setUniforms(e,i,a,c,d){for(const{name:f,property:_,binding:x}of a)this.binders[_].setUniform(e,x,d,c.get(_),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof pa||i instanceof bs||i instanceof ws)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof ws&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof pa||a instanceof bs||a instanceof ws)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof pa||i instanceof bs||i instanceof ws)&&i.destroy()}}}class Bl{constructor(e,i,a=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Xa(c,i,a);this.needsUpload=!1,this._featureMap=new Dc,this._featureMapWithoutIds=new Dc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,a,c,d,f,_,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,c,d,f,_,x);i.id!==void 0?this._featureMap.add(i.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,c,d,f,_){for(const x of a)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,x,c,d,f,_||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const u={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"]};function t(n,e){return u[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const s={"line-pattern":{source:fa,composite:fa},"fill-pattern":{source:fa,composite:fa},"fill-extrusion-pattern":{source:fa,composite:fa},"line-dasharray":{source:$d,composite:$d}},h={color:{source:Fl,composite:Us},number:{source:Cc,composite:Fl}};function m(n,e,i){const a=s[n];return a&&a[i]||h[e][i]}At(fh,"ConstantBinder"),At(Lc,"PatternConstantBinder"),At(pa,"SourceExpressionBinder"),At(ws,"PatternCompositeBinder"),At(bs,"CompositeExpressionBinder"),At(Xa,"ProgramConfiguration",{omit:["_buffers"]}),At(Bl,"ProgramConfigurationSet");const g=vt/Math.PI/2,v=5,b=6,S=16383,C=64,P=[C,32,16],D=-g,z=g;function O(n,e,i,a=g){return i=G(i),[n*Math.sin(i)*a,-e*a,n*Math.cos(i)*a]}function V(n,e,i){return O(Math.cos(G(n)),Math.sin(G(n)),e,i)}const N=63710088e-1,H=2*Math.PI*N;class U{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new U(Ve(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,c=e.lat*i,d=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return N*Math.acos(Math.min(d,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new Q({lng:this.lng-a,lat:this.lat-i},{lng:this.lng+a,lat:this.lat+i})}toEcef(e){return V(this.lat,this.lng,g+e*g/N)}static convert(e){if(e instanceof U)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new U(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new U(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Q{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{const a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof U?new U(e.lng,e.lat):U.convert(e),this}setSouthWest(e){return this._sw=e instanceof U?new U(e.lng,e.lat):U.convert(e),this}extend(e){const i=this._sw,a=this._ne;let c,d;if(e instanceof U)c=e,d=e;else{if(!(e instanceof Q))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Q.convert(e)):this.extend(U.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(U.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return i||a?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new U(c.lng,c.lat),this._ne=new U(d.lng,d.lat)),this}getCenter(){return new U((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new U(this.getWest(),this.getNorth())}getSouthEast(){return new U(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=U.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){if(e)return e instanceof Q?e:new Q(e)}}const ne=0,ae=25.5;function ge(n){return H*Math.cos(n*Math.PI/180)}function de(n){return(180+n)/360}function fe(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function le(n,e){return n/ge(e)}function ye(n){return 360*n-180}function be(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Fe(n,e){return n*ge(be(e))}const Le=85.051129;function Ke(n){return Math.cos(G(Me(n,-Le,Le)))}function Xe(n,e){const i=Me(e,ne,ae),a=Math.pow(2,i);return Ke(n)*H/(512*a)}function dt(n){return 1/Math.cos(n*Math.PI/180)}function ke(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/vt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/vt/(1<<n.z)}class Be{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=U.convert(e);return new Be(de(a.lng),fe(a.lat),le(i,a.lat))}toLngLat(){return new U(ye(this.x),be(this.y))}toAltitude(){return Fe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/H*dt(be(this.y))}}function ze(n,e,i,a,c,d,f,_,x){const w=(e+a)/2,E=(i+c)/2,A=new gt(w,E);_(A),function(M,L,k,F,$,q){const ee=k-$,K=F-q;return Math.abs((F-L)*ee-(k-M)*K)/Math.hypot(ee,K)}(A.x,A.y,d.x,d.y,f.x,f.y)>=x?(ze(n,e,i,w,E,d,A,_,x),ze(n,w,E,a,c,A,f,_,x)):n.push(f)}function et(n,e,i){let a=n[0],c=a.x,d=a.y;e(a);const f=[a];for(let _=1;_<n.length;_++){const x=n[_],{x:w,y:E}=x;e(x),ze(f,c,d,w,E,a,x,e,i),c=w,d=E,a=x}return f}function Ge(n,e,i,a){if(a(e,i)){const c=e.add(i)._mult(.5);Ge(n,e,c,a),Ge(n,c,i,a)}else n.push(i)}function ot(n,e){let i=n[0];const a=[i];for(let c=1;c<n.length;c++){const d=n[c];Ge(a,i,d,e),i=d}return a}const Qe=Math.pow(2,14)-1,st=-Qe-1;function at(n,e){const i=Math.round(n.x*e),a=Math.round(n.y*e);return n.x=Me(i,st,Qe),n.y=Me(a,st,Qe),(i<n.x||i>n.x+1||a<n.y||a>n.y+1)&&Ci("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Pt(n,e,i){const a=n.loadGeometry(),c=n.extent,d=vt/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:_,x,y:w,projection:E}=i,A=M=>{const L=ye((e.x+M.x/c)/f),k=be((e.y+M.y/c)/f),F=E.project(L,k);M.x=(F.x*_-x)*c,M.y=(F.y*_-w)*c};for(let M=0;M<a.length;M++)if(n.type!==1)a[M]=et(a[M],A,1);else{const L=[];for(const k of a[M])k.x<0||k.x>=c||k.y<0||k.y>=c||(A(k),L.push(k));a[M]=L}}for(const f of a)for(const _ of f)at(_,d);return a}function Nt(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Pt(n):[]}}function Ct(n,e,i,a,c){n.emplaceBack(2*e+(a+1)/2,2*i+(c+1)/2)}function jt(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class zt{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new da,this.indexArray=new vr,this.segments=new kn,this.programConfigurations=new Bl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,a,c){const d=this.layers[0],f=[];let _=null;d.type==="circle"&&(_=d.layout.get("circle-sort-key"));for(const{feature:w,id:E,index:A,sourceLayerIndex:M}of e){const L=this.layers[0]._featureFilter.needGeometry,k=Nt(w,L);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),k,a))continue;const F=_?_.evaluate(k,{},a):void 0,$={id:E,properties:w.properties,type:w.type,sourceLayerIndex:M,index:A,geometry:L?k.geometry:Pt(w,a,c),patterns:{},sortKey:F};f.push($)}_&&f.sort((w,E)=>w.sortKey-E.sortKey);let x=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new Ol,x=c.projection);for(const w of f){const{geometry:E,index:A,sourceLayerIndex:M}=w,L=e[A].feature;this.addFeature(w,E,A,i.availableImages,a,x,i.brightness),i.featureIndex.insert(L,E,A,M,this.index)}}update(e,i,a,c,d,f,_){this.programConfigurations.updatePaintArrays(e,i,d,a,c,f,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Px.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,a,c,d,f,_){for(const x of i)for(const w of x){const E=w.x,A=w.y;if(E<0||E>=vt||A<0||A>=vt)continue;if(f){const k=f.projectTilePoint(E,A,d),F=f.upVector(d,E,A),$=this.globeExtVertexArray;jt($,k,F),jt($,k,F),jt($,k,F),jt($,k,F)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),L=M.vertexLength;Ct(this.layoutVertexArray,E,A,-1,-1),Ct(this.layoutVertexArray,E,A,1,-1),Ct(this.layoutVertexArray,E,A,1,1),Ct(this.layoutVertexArray,E,A,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,d,_)}}function Zt(n,e){for(let i=0;i<n.length;i++)if(nn(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(nn(n,e[i]))return!0;return!!Yi(n,e)}function si(n,e,i){return!!nn(n,e)||!!hi(e,n,i)}function Ai(n,e){if(n.length===1)return ji(e,n[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let c=0;c<a.length;c++)if(nn(n,a[c]))return!0}for(let i=0;i<n.length;i++)if(ji(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Yi(n,e[i]))return!0;return!1}function tn(n,e,i){if(n.length>1){if(Yi(n,e))return!0;for(let a=0;a<e.length;a++)if(hi(e[a],n,i))return!0}for(let a=0;a<n.length;a++)if(hi(n[a],e,i))return!0;return!1}function Yi(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const a=n[i],c=n[i+1];for(let d=0;d<e.length-1;d++)if(Mi(a,c,e[d],e[d+1]))return!0}return!1}function Mi(n,e,i,a){return ln(n,i,a)!==ln(e,i,a)&&ln(n,e,i)!==ln(n,e,a)}function Un(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function Dn(n,e,i,a){const c=Un(n,e,a),d=Un(n,e,i);if(Math.sign(c)===Math.sign(d))return;const f=Un(i,a,n),_=f+d-c;return Math.sign(f)!==Math.sign(_)?[f/(f-_),d/(d-c)]:void 0}function hi(n,e,i){const a=i*i;if(e.length===1)return n.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(ki(n,e[c-1],e[c])<a)return!0;return!1}function ki(n,e,i){const a=e.distSqr(i);if(a===0)return n.distSqr(e);const c=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/a;return n.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function ji(n,e){let i,a,c,d=!1;for(let f=0;f<n.length;f++){i=n[f];for(let _=0,x=i.length-1;_<i.length;x=_++)a=i[_],c=i[x],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(d=!d)}return d}function nn(n,e){let i=!1;for(let a=0,c=n.length-1;a<n.length;c=a++){const d=n[a],f=n[c];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(i=!i)}return i}function nr(n,e,i,a,c){for(const f of n)if(e<=f.x&&i<=f.y&&a>=f.x&&c>=f.y)return!0;const d=[new gt(e,i),new gt(e,c),new gt(a,c),new gt(a,i)];if(n.length>2){for(const f of d)if(nn(n,f))return!0}for(let f=0;f<n.length-1;f++)if(qn(n[f],n[f+1],d))return!0;return!1}function qn(n,e,i){const a=i[0],c=i[2];if(n.x<a.x&&e.x<a.x||n.x>c.x&&e.x>c.x||n.y<a.y&&e.y<a.y||n.y>c.y&&e.y>c.y)return!1;const d=ln(n,e,i[0]);return d!==ln(n,e,i[1])||d!==ln(n,e,i[2])||d!==ln(n,e,i[3])}function tr(n,e,i,a,c,d){let f=e.y-n.y,_=n.x-e.x;if(d=d||0){const x=f*f+_*_;if(x===0)return!0;const w=Math.sqrt(x);f/=w,_/=w}return!((i.x-n.x)*f+(i.y-n.y)*_-d<0||(a.x-n.x)*f+(a.y-n.y)*_-d<0||(c.x-n.x)*f+(c.y-n.y)*_-d<0)}function Pn(n,e,i,a,c,d,f){return!(tr(n,e,a,c,d,f)||tr(e,i,a,c,d,f)||tr(i,n,a,c,d,f)||tr(a,c,n,e,i,f)||tr(c,d,n,e,i,f)||tr(d,a,n,e,i,f))}function mi(n,e,i){const a=e.paint.get(n).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(n)}function En(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Bi(n,e,i,a,c){if(!e[0]&&!e[1])return n;const d=gt.convert(e)._mult(c);i==="viewport"&&d._rotate(-a);const f=[];for(let _=0;_<n.length;_++)f.push(n[_].sub(d));return f}function In(n,e,i,a){const c=gt.convert(n)._mult(a);return e==="viewport"&&c._rotate(-i),c}let qi,Rn;function xr(n,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}At(zt,"CircleBucket",{omit:["layers"]});class mn{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=Dr(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const a=function(d,f,_){var x=xr(256*d,256*(f=Math.pow(2,_)-f-1),_),w=xr(256*(d+1),256*(f+1),_);return x[0]+","+x[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),c=function(d,f,_){let x,w="";for(let E=d;E>0;E--)x=1<<E-1,w+=(f&x?1:0)+(_&x?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cr{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Dr(e,i.z,i.z,i.x,i.y)}}class Yn{constructor(e,i,a,c,d){this.overscaledZ=e,this.wrap=i,this.canonical=new mn(a,+c,+d),this.key=i===0&&e===a?this.canonical.key:Dr(i,e,a,c,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Yn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Yn(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Dr(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Dr(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Yn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new Yn(i,this.wrap,i,a,c),new Yn(i,this.wrap,i,a+1,c),new Yn(i,this.wrap,i,a,c+1),new Yn(i,this.wrap,i,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Yn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Yn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Dr(n,e,i,a,c){const d=1<<Math.min(i,22);let f=d*(c%d)+a%d;return n&&i<22&&(f+=d*d*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}const Ts=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new Yn(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new Yn(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new Yn(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new Yn(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];At(mn,"CanonicalTileID"),At(Yn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ma=Gi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ao}=ma,rs=Gi([{name:"a_pos_3",components:3,type:"Int16"}]);var $s=Gi([{name:"a_pos",type:"Int16",components:2}]);class Hs{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const c=oi(i,this.dir);if(Math.abs(c)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/c;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,!0}}class Ss{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const c=Ei(i,this.dir);if(Math.abs(c)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,i,a){if(function(L,k){var F=L[0],$=L[1],q=L[2],ee=k[0],K=k[1],B=k[2];return Math.abs(F-ee)<=j*Math.max(1,Math.abs(F),Math.abs(ee))&&Math.abs($-K)<=j*Math.max(1,Math.abs($),Math.abs(K))&&Math.abs(q-B)<=j*Math.max(1,Math.abs(q),Math.abs(B))}(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[c,d,f]=this.dir,_=this.pos[0]-e[0],x=this.pos[1]-e[1],w=this.pos[2]-e[2],E=c*c+d*d+f*f,A=2*(_*c+x*d+w*f),M=A*A-4*E*(_*_+x*x+w*w-i*i);if(M<0){const L=Math.max(-A/2,0),k=_+c*L,F=x+d*L,$=w+f*L,q=Math.hypot(k,F,$);return a[0]=k*i/q,a[1]=F*i/q,a[2]=$*i/q,!1}{const L=(-A-Math.sqrt(M))/(2*E);if(L<0){const k=Math.hypot(_,x,w);return a[0]=_*i/k,a[1]=x*i/k,a[2]=w*i/k,!1}return a[0]=_+c*L,a[1]=x+d*L,a[2]=w+f*L,!0}}}class kc{constructor(e,i,a,c,d){this.TL=e,this.TR=i,this.BR=a,this.BL=c,this.horizon=d}static fromInvProjectionMatrix(e,i,a){const c=[-1,1,1],d=[1,1,1],f=[1,-1,1],_=[-1,-1,1],x=fn(c,c,e),w=fn(d,d,e),E=fn(f,f,e),A=fn(_,_,e);return new kc(x,w,E,A,i/a)}}function Nl(n,e,i){let a=1/0,c=-1/0;const d=[];for(const f of n){Tn(d,f,e);const _=Ei(d,i);a=Math.min(a,_),c=Math.max(c,_)}return[a,c]}function Qd(n,e){let i=!0;for(let a=0;a<n.planes.length;a++){const c=n.planes[a];let d=0;for(let f=0;f<e.length;f++)d+=Ei(c,e[f])+c[3]>=0;if(d===0)return 0;d!==e.length&&(i=!1)}return i?2:1}function Jd(n,e){for(const i of n.projections){const a=Nl(e,n.points[0],i.axis);if(i.projection[1]<a[0]||i.projection[0]>a[1])return 0}return 1}function ef(n,e){let i=0;const a=[0,0,0,0];for(let f=0;f<n.length;f++)a[0]=n[f][0],a[1]=n[f][1],a[2]=n[f][2],a[3]=1,(c=a)[0]*(d=e)[0]+c[1]*d[1]+c[2]*d[2]+c[3]*d[3]>=0&&i++;var c,d;return i}class ph{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=An.fromPoints(this.points),this.projections=[],this.frustumEdges=[Tn([],this.points[2],this.points[3]),Tn([],this.points[0],this.points[3]),Tn([],this.points[4],this.points[0]),Tn([],this.points[5],this.points[1]),Tn([],this.points[6],this.points[2]),Tn([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const c=[0,-a[2],a[1]],d=[a[2],0,-a[0]];this.projections.push({axis:c,projection:Nl(this.points,this.points[0],c)}),this.projections.push({axis:d,projection:Nl(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,i,a,c){const d=Math.pow(2,a),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=Bn([],w,e),A=1/E[3]/i*d;return(M=E)[0]=(L=E)[0]*(k=[A,A,c?1/E[3]:A,A])[0],M[1]=L[1]*k[1],M[2]=L[2]*k[2],M[3]=L[3]*k[3],M;var M,L,k}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=$i([],xn([],Tn([],f[w[0]],f[w[1]]),Tn([],f[w[2]],f[w[1]]))),A=-Ei(E,f[w[1]]);return E.concat(A)}),x=[];for(let w=0;w<f.length;w++)x.push([f[w][0],f[w][1],f[w][2]]);return new ph(x,_)}intersectsPrecise(e,i,a){for(let c=0;c<i.length;c++)if(!ef(e,i[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!ef(e,this.planes[c]))return 0;for(const c of a)for(const d of this.frustumEdges){const f=xn([],c,d),_=Pi(f);if(_===0)continue;Gt(f,f,1/_);const x=Nl(this.points,this.points[0],f),w=Nl(e,this.points[0],f);if(x[0]>w[1]||w[0]>x[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const a=i[3];if(Ei([i[0],i[1],i[2]],e)+a<0)return!1}return!0}}class An{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const c of e)ft(i,i,c),$t(a,a,c);return new An(i,a)}static fromTileIdAndHeight(e,i,a){const c=1<<e.canonical.z,d=e.canonical.x,f=e.canonical.y;return new An([d/c,f/c,i],[(d+1)/c,(f+1)/c,a])}static applyTransform(e,i){const a=e.getCorners();for(let c=0;c<a.length;++c)fn(a[c],a[c],i);return An.fromPoints(a)}static applyTransformFast(e,i){const a=[i[12],i[13],i[14]],c=[...a];for(let d=0;d<3;d++)for(let f=0;f<3;f++){const _=i[4*f+d],x=_*e.min[f],w=_*e.max[f];a[d]+=Math.min(x,w),c[d]+=Math.max(x,w)}return new An(a,c)}static projectAabbCorners(e,i){const a=e.getCorners();for(let c=0;c<a.length;++c)fn(a[c],a[c],i);return a}constructor(e,i){this.min=e,this.max=i,this.center=Gt([],vi([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=ui(this.min),c=ui(this.max);for(let d=0;d<i.length;d++)a[d]=i[d]?this.min[d]:this.center[d],c[d]=i[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new An(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Qd(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Qd(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Jd(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Jd(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Oc(n){return n*g/N}At(An,"Aabb");const gm=[new An([D,D,D],[z,z,z]),new An([D,D,D],[0,0,z]),new An([0,D,D],[z,0,z]),new An([D,0,D],[0,z,z]),new An([0,0,D],[z,z,z])];function u2(n,e,i,a=!0){const c=Gt([],n._camera.position,n.worldSize),d=[e,i,1,1];Bn(d,d,n.pixelMatrixInverse),Fo(d,d,1/d[3]);const f=$i([],Tn([],d,c)),_=n.globeMatrix,x=[_[12],_[13],_[14]],w=Tn([],x,c),E=Pi(w),A=$i([],w),M=n.worldSize/(2*Math.PI),L=Ei(A,f),k=Math.asin(M/E);if(k<Math.acos(L)){if(!a)return null;const Ae=[],De=[];Gt(Ae,f,E/L),$i(De,Tn(De,Ae,w)),$i(f,vi(f,w,Gt(f,De,Math.tan(k)*E)))}const F=[];new Ss(c,f).closestPointOnSphere(x,M,F);const $=$i([],yr(_,0)),q=$i([],yr(_,1)),ee=$i([],yr(_,2)),K=Ei($,F),B=Ei(q,F),Z=Ei(ee,F),J=X(Math.asin(-B/M));let oe=X(Math.atan2(K,Z));oe=n.center.lng+function(Ae,De){const qe=(De-Ae+180)%360-180;return qe<-180?qe+360:qe}(n.center.lng,oe);const _e=de(oe),Se=Me(fe(J),0,1);return new Be(_e,Se)}class DD{constructor(e,i,a){this.a=Tn([],e,a),this.b=Tn([],i,a),this.center=a;const c=$i([],this.a),d=$i([],this.b);this.angle=Math.acos(Ei(c,d))}}function Lx(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(a,c,d,f){const _=Math.sin(d);return a*(Math.sin((1-f)*d)/_)+c*(Math.sin(f*d)/_)}(n.a[e],n.b[e],n.angle,Me(i,0,1))+n.center[e]}function Ya(n){if(n.z<=1)return gm[n.z+2*n.y+n.x];const e=kx(dy(n));return An.fromPoints(e)}function jl(n,e,i){return Gt(n,n,1-i),ii(n,n,e,i)}function h2(n,e,i){for(const a of n)fn(a,a,e),Gt(a,a,i)}function d2(n,e,i,a){const c=e/n.worldSize,d=n.globeMatrix;if(i.z<=1){const Se=Ya(i).getCorners();return h2(Se,d,c),An.fromPoints(Se)}const f=dy(i,a),_=kx(f,g+Oc(n._tileCoverLift));h2(_,d,c);const x=Number.MAX_VALUE,w=[-x,-x,-x],E=[x,x,x];if(f.contains(n.center)){for(const De of _)ft(E,E,De),$t(w,w,De);w[2]=0;const Se=n.point,Ae=[Se.x*c,Se.y*c,0];return ft(E,E,Ae),$t(w,w,Ae),new An(E,w)}if(n._tileCoverLift>0){for(const Se of _)ft(E,E,Se),$t(w,w,Se);return new An(E,w)}const A=[d[12]*c,d[13]*c,d[14]*c],M=f.getCenter(),L=Me(n.center.lat,-Le,Le),k=Me(M.lat,-Le,Le),F=de(n.center.lng),$=fe(L);let q=F-de(M.lng);const ee=$-fe(k);q>.5?q-=1:q<-.5&&(q+=1);let K=0;Math.abs(q)>Math.abs(ee)?K=q>=0?1:3:(K=ee>=0?0:2,ii(A,A,[d[4]*c,d[5]*c,d[6]*c],-Math.sin(G(ee>=0?f.getSouth():f.getNorth()))*g));const B=_[K],Z=_[(K+1)%4],J=new DD(B,Z,A),oe=[Lx(J,0)||B[0],Lx(J,1)||B[1],Lx(J,2)||B[2]],_e=Fc(n.zoom);if(_e>0){const Se=function({x:De,y:qe,z:rt},Je,nt,lt,$e){const it=1/(1<<rt);let je=De*it,He=je+it,ut=qe*it,ht=ut+it,Ft=0;const Mt=(je+He)/2-lt;return Mt>.5?Ft=-1:Mt<-.5&&(Ft=1),je=((je+Ft)*Je-(lt*=Je))*nt+lt,He=((He+Ft)*Je-lt)*nt+lt,ut=(ut*Je-($e*=Je))*nt+$e,ht=(ht*Je-$e)*nt+$e,[[je,ht,0],[He,ht,0],[He,ut,0],[je,ut,0]]}(i,e,n._pixelsPerMercatorPixel,F,$);for(let De=0;De<_.length;De++)jl(_[De],Se[De],_e);const Ae=vi([],Se[K],Se[(K+1)%4]);Gt(Ae,Ae,.5),jl(oe,Ae,_e)}for(const Se of _)ft(E,E,Se),$t(w,w,Se);return E[2]=Math.min(B[2],Z[2]),ft(E,E,oe),$t(w,w,oe),new An(E,w)}function dy({x:n,y:e,z:i},a=!1){const c=1/(1<<i),d=new U(ye(n*c),e===(1<<i)-1&&a?-90:be((e+1)*c)),f=new U(ye((n+1)*c),e===0&&a?90:be(e*c));return new Q(d,f)}function kx(n,e=g){const i=G(n.getNorth()),a=G(n.getSouth()),c=Math.cos(i),d=Math.cos(a),f=Math.sin(i),_=Math.sin(a),x=n.getWest(),w=n.getEast();return[O(d,_,x,e),O(d,_,w,e),O(c,f,w,e),O(c,f,x,e)]}function _m(n,e,i,a){const c=1<<i.z,d=(n/vt+i.x)/c;return V(be((e/vt+i.y)/c),ye(d),a)}function fy({min:n,max:e}){return S/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const f2=new Float64Array(16);function py(n){const e=fy(n),i=wt(f2,[e,e,e]);return pe(i,i,Vn([],n.min))}function Ox(n){const e=(a=n.min,(i=f2)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i);var i,a;const c=1/fy(n);return we(e,e,[c,c,c])}function Fx(n){const e=vt/(2*Math.PI);return n/(2*Math.PI)/e}function p2(n,e){return vt/(512*Math.pow(2,n))*fy(Ya(e))}function m2(n,e,i,a,c){const d=Fx(i),f=[n,e,-i/(2*Math.PI)],_=me(new Float64Array(16));return pe(_,_,f),we(_,_,[d,d,d]),Ue(_,_,G(-c)),tt(_,_,G(-a)),_}function Fc(n){return Re(v,b,n)}function g2(n,e){const i=V(e.lat,e.lng),a=function(k){const F=V(k._center.lat,k._center.lng);let $=xn([],Vt(0,1,0),F);const q=xt([],-k.angle,F);$=fn($,$,q),xt(q,-k._pitch,$);const ee=$i([],F);return Gt(ee,ee,Oc(k.cameraToCenterDistance/k.pixelsPerMeter)),fn(ee,ee,q),vi([],F,ee)}(n);return f=(c=ai([],a,i))[0],_=c[1],x=c[2],w=(d=i)[0],E=d[1],A=d[2],L=(M=Math.sqrt(f*f+_*_+x*x)*Math.sqrt(w*w+E*E+A*A))&&Ei(c,d)/M,Math.acos(Math.min(Math.max(L,-1),1));var c,d,f,_,x,w,E,A,M,L}function Bx(n,e){return g2(n,e)>Math.PI/2*1.01}const _2=G(85),LD=Math.cos(_2),kD=Math.sin(_2),OD=Ie(),y2=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function v2(n,e,i,a,c,d,f,_,x){if(d&&n.queryGeometry.isAboveHorizon)return!1;d&&(x*=n.pixelToTileUnitsFactor);const w=n.tileID.canonical,E=i.projection.upVectorScale(w,i.center.lat,i.worldSize).metersToTile;for(const A of e)for(const M of A){const L=M.add(_),k=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(L.x,L.y,!0):0,F=i.projection.projectTilePoint(L.x,L.y,w);if(k>0){const K=i.projection.upVector(w,L.x,L.y);F.x+=K[0]*E*k,F.y+=K[1]*E*k,F.z+=K[2]*E*k}const $=d?L:FD(F.x,F.y,F.z,a),q=d?n.tilespaceRays.map(K=>ND(K,k)):n.queryGeometry.screenGeometry,ee=Bn([],[F.x,F.y,F.z,1],a);if(!f&&d?x*=ee[3]/i.cameraToCenterDistance:f&&!d&&(x*=i.cameraToCenterDistance/ee[3]),d){const K=be((M.y/vt+w.y)/(1<<w.z));x/=i.projection.pixelsPerMeter(K,1)/le(1,K)}if(si(q,$,x))return!0}return!1}function FD(n,e,i,a){const c=Bn([],[n,e,i,1],a);return new gt(c[0]/c[3],c[1]/c[3])}const x2=Vt(0,0,0),BD=Vt(0,0,1);function ND(n,e){const i=ni();return x2[2]=e,n.intersectsPlane(x2,BD,i),new gt(i[0],i[1])}class b2 extends zt{}let w2,T2,S2,E2;function I2(n,{width:e,height:i},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*a);return n.width=e,n.height=i,n.data=c,n}function A2(n,e,i){const{width:a,height:c}=e;a===n.width&&c===n.height||(Nx(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,a),height:Math.min(n.height,c)},i,null),n.width=a,n.height=c,n.data=e.data)}function Nx(n,e,i,a,c,d,f,_){if(c.width===0||c.height===0)return e;if(c.width>n.width||c.height>n.height||i.x>n.width-c.width||i.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const x=n.data,w=e.data,E=d===4&&_;for(let A=0;A<c.height;A++){const M=((i.y+A)*n.width+i.x)*d,L=((a.y+A)*e.width+a.x)*d;if(E)for(let k=0;k<c.width;k++){const F=M+k*d+3,$=L+k*d;w[$+0]=255,w[$+1]=255,w[$+2]=255,w[$+3]=x[F]}else if(f)for(let k=0;k<c.width;k++){const F=M+k*d,$=L+k*d,q=x[F+3],ee=new Hi(x[F+0]/255*q,x[F+1]/255*q,x[F+2]/255*q,q).toRenderColor(f).toArray();w[$+0]=ee[0],w[$+1]=ee[1],w[$+2]=ee[2],w[$+3]=ee[3]}else for(let k=0;k<c.width*d;k++)w[L+k]=x[M+k]}return e}At(b2,"HeatmapBucket",{omit:["layers"]});class Bc{constructor(e,i){I2(this,e,1,i)}resize(e){A2(this,new Bc(e),1)}clone(){return new Bc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,c,d){Nx(e,i,a,c,d,1,null)}}class Br{constructor(e,i){I2(this,e,4,i)}resize(e){A2(this,new Br(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Br({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,c,d,f,_){Nx(e,i,a,c,d,4,f,_)}}class C2{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function ym(n){const e={},i=n.resolution||256,a=n.clips?n.clips.length:1,c=n.image||new Br({width:i,height:a}),d=(f,_,x)=>{e[n.evaluationKey]=x;const w=n.expression.evaluate(e);w&&(c.data[f+_+0]=Math.floor(255*w.r/w.a),c.data[f+_+1]=Math.floor(255*w.g/w.a),c.data[f+_+2]=Math.floor(255*w.b/w.a),c.data[f+_+3]=Math.floor(255*w.a))};if(n.clips)for(let f=0,_=0;f<a;++f,_+=4*i)for(let x=0,w=0;x<i;x++,w+=4){const E=x/(i-1),{start:A,end:M}=n.clips[f];d(_,w,A*(1-E)+M*E)}else for(let f=0,_=0;f<i;f++,_+=4)d(0,_,f/(i-1));return c}At(Bc,"AlphaImage"),At(Br,"RGBAImage");const jD=Gi([{name:"a_pos",components:2,type:"Int16"}],4),VD=Gi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),UD=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),GD=Gi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function vm(n,e,i=2){const a=e&&e.length,c=a?e[0]*i:n.length;let d=M2(n,0,c,i,!0);const f=[];if(!d||d.next===d.prev)return f;let _,x,w;if(a&&(d=function(E,A,M,L){const k=[];for(let F=0,$=A.length;F<$;F++){const q=M2(E,A[F]*L,F<$-1?A[F+1]*L:E.length,L,!1);q===q.next&&(q.steiner=!0),k.push(KD(q))}k.sort(ZD);for(let F=0;F<k.length;F++)M=XD(k[F],M);return M}(n,e,d,i)),n.length>80*i){_=1/0,x=1/0;let E=-1/0,A=-1/0;for(let M=i;M<c;M+=i){const L=n[M],k=n[M+1];L<_&&(_=L),k<x&&(x=k),L>E&&(E=L),k>A&&(A=k)}w=Math.max(E-_,A-x),w=w!==0?32767/w:0}return xm(d,f,i,_,x,w,0),f}function M2(n,e,i,a,c){let d;if(c===function(f,_,x,w){let E=0;for(let A=_,M=x-w;A<x;A+=w)E+=(f[M]-f[A])*(f[A+1]+f[M+1]),M=A;return E}(n,e,i,a)>0)for(let f=e;f<i;f+=a)d=D2(f/a|0,n[f],n[f+1],d);else for(let f=i-a;f>=e;f-=a)d=D2(f/a|0,n[f],n[f+1],d);return d&&tf(d,d.next)&&(Tm(d),d=d.next),d}function mh(n,e){if(!n)return n;e||(e=n);let i,a=n;do if(i=!1,a.steiner||!tf(a,a.next)&&br(a.prev,a,a.next)!==0)a=a.next;else{if(Tm(a),a=e=a.prev,a===a.next)break;i=!0}while(i||a!==e);return e}function xm(n,e,i,a,c,d,f){if(!n)return;!f&&d&&function(x,w,E,A){let M=x;do M.z===0&&(M.z=jx(M.x,M.y,w,E,A)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==x);M.prevZ.nextZ=null,M.prevZ=null,function(L){let k,F=1;do{let $,q=L;L=null;let ee=null;for(k=0;q;){k++;let K=q,B=0;for(let J=0;J<F&&(B++,K=K.nextZ,K);J++);let Z=F;for(;B>0||Z>0&&K;)B!==0&&(Z===0||!K||q.z<=K.z)?($=q,q=q.nextZ,B--):($=K,K=K.nextZ,Z--),ee?ee.nextZ=$:L=$,$.prevZ=ee,ee=$;q=K}ee.nextZ=null,F*=2}while(k>1)}(M)}(n,a,c,d);let _=n;for(;n.prev!==n.next;){const x=n.prev,w=n.next;if(d?HD(n,a,c,d):$D(n))e.push(x.i,n.i,w.i),Tm(n),n=w.next,_=w.next;else if((n=w)===_){f?f===1?xm(n=qD(mh(n),e),e,i,a,c,d,2):f===2&&WD(n,e,i,a,c,d):xm(mh(n),e,i,a,c,d,1);break}}}function $D(n){const e=n.prev,i=n,a=n.next;if(br(e,i,a)>=0)return!1;const c=e.x,d=i.x,f=a.x,_=e.y,x=i.y,w=a.y,E=Math.min(c,d,f),A=Math.min(_,x,w),M=Math.max(c,d,f),L=Math.max(_,x,w);let k=a.next;for(;k!==e;){if(k.x>=E&&k.x<=M&&k.y>=A&&k.y<=L&&bm(c,_,d,x,f,w,k.x,k.y)&&br(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function HD(n,e,i,a){const c=n.prev,d=n,f=n.next;if(br(c,d,f)>=0)return!1;const _=c.x,x=d.x,w=f.x,E=c.y,A=d.y,M=f.y,L=Math.min(_,x,w),k=Math.min(E,A,M),F=Math.max(_,x,w),$=Math.max(E,A,M),q=jx(L,k,e,i,a),ee=jx(F,$,e,i,a);let K=n.prevZ,B=n.nextZ;for(;K&&K.z>=q&&B&&B.z<=ee;){if(K.x>=L&&K.x<=F&&K.y>=k&&K.y<=$&&K!==c&&K!==f&&bm(_,E,x,A,w,M,K.x,K.y)&&br(K.prev,K,K.next)>=0||(K=K.prevZ,B.x>=L&&B.x<=F&&B.y>=k&&B.y<=$&&B!==c&&B!==f&&bm(_,E,x,A,w,M,B.x,B.y)&&br(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;K&&K.z>=q;){if(K.x>=L&&K.x<=F&&K.y>=k&&K.y<=$&&K!==c&&K!==f&&bm(_,E,x,A,w,M,K.x,K.y)&&br(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;B&&B.z<=ee;){if(B.x>=L&&B.x<=F&&B.y>=k&&B.y<=$&&B!==c&&B!==f&&bm(_,E,x,A,w,M,B.x,B.y)&&br(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function qD(n,e){let i=n;do{const a=i.prev,c=i.next.next;!tf(a,c)&&R2(a,i,i.next,c)&&wm(a,c)&&wm(c,a)&&(e.push(a.i,i.i,c.i),Tm(i),Tm(i.next),i=n=c),i=i.next}while(i!==n);return mh(i)}function WD(n,e,i,a,c,d){let f=n;do{let _=f.next.next;for(;_!==f.prev;){if(f.i!==_.i&&QD(f,_)){let x=z2(f,_);return f=mh(f,f.next),x=mh(x,x.next),xm(f,e,i,a,c,d,0),void xm(x,e,i,a,c,d,0)}_=_.next}f=f.next}while(f!==n)}function ZD(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function XD(n,e){const i=function(c,d){let f=d;const _=c.x,x=c.y;let w,E=-1/0;if(tf(c,f))return f;do{if(tf(c,f.next))return f.next;if(x<=f.y&&x>=f.next.y&&f.next.y!==f.y){const F=f.x+(x-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(F<=_&&F>E&&(E=F,w=f.x<f.next.x?f:f.next,F===_))return w}f=f.next}while(f!==d);if(!w)return null;const A=w,M=w.x,L=w.y;let k=1/0;f=w;do{if(_>=f.x&&f.x>=M&&_!==f.x&&P2(x<L?_:E,x,M,L,x<L?E:_,x,f.x,f.y)){const F=Math.abs(x-f.y)/(_-f.x);wm(f,c)&&(F<k||F===k&&(f.x>w.x||f.x===w.x&&YD(w,f)))&&(w=f,k=F)}f=f.next}while(f!==A);return w}(n,e);if(!i)return e;const a=z2(i,n);return mh(a,a.next),mh(i,i.next)}function YD(n,e){return br(n.prev,n,e.prev)<0&&br(e.next,n,n.next)<0}function jx(n,e,i,a,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function KD(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function P2(n,e,i,a,c,d,f,_){return(c-f)*(e-_)>=(n-f)*(d-_)&&(n-f)*(a-_)>=(i-f)*(e-_)&&(i-f)*(d-_)>=(c-f)*(a-_)}function bm(n,e,i,a,c,d,f,_){return!(n===f&&e===_)&&P2(n,e,i,a,c,d,f,_)}function QD(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,a){let c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==a.i&&c.next.i!==a.i&&R2(c,c.next,i,a))return!0;c=c.next}while(c!==i);return!1}(n,e)&&(wm(n,e)&&wm(e,n)&&function(i,a){let c=i,d=!1;const f=(i.x+a.x)/2,_=(i.y+a.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&f<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==i);return d}(n,e)&&(br(n.prev,n,e.prev)||br(n,e.prev,e))||tf(n,e)&&br(n.prev,n,n.next)>0&&br(e.prev,e,e.next)>0)}function br(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function tf(n,e){return n.x===e.x&&n.y===e.y}function R2(n,e,i,a){const c=gy(br(n,e,i)),d=gy(br(n,e,a)),f=gy(br(i,a,n)),_=gy(br(i,a,e));return c!==d&&f!==_||!(c!==0||!my(n,i,e))||!(d!==0||!my(n,a,e))||!(f!==0||!my(i,n,a))||!(_!==0||!my(i,e,a))}function my(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function gy(n){return n>0?1:n<0?-1:0}function wm(n,e){return br(n.prev,n,n.next)<0?br(n,e,n.next)>=0&&br(n,n.prev,e)>=0:br(n,e,n.prev)<0||br(n,n.next,e)<0}function z2(n,e){const i=Vx(n.i,n.x,n.y),a=Vx(e.i,e.x,e.y),c=n.next,d=e.prev;return n.next=e,e.prev=n,i.next=c,c.prev=i,a.next=i,i.prev=a,d.next=a,a.prev=d,a}function D2(n,e,i,a){const c=Vx(n,e,i);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Tm(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Vx(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function _y(n,e){const i=n.length;if(i<=1)return[n];const a=[];let c,d;for(let f=0;f<i;f++){const _=Ui(n[f]);_!==0&&(n[f].area=Math.abs(_),d===void 0&&(d=_<0),d===_<0?(c&&a.push(c),c=[n[f]]):c.push(n[f]))}if(c&&a.push(c),e>1)for(let f=0;f<a.length;f++)a[f].length<=e||(Fa(a[f],e,1,a[f].length-1,JD),a[f]=a[f].slice(0,e));return a}function JD(n,e){return e.area-n.area}function L2(n,e,i=1){if(!n)return null;const a=typeof n=="string"?go.from(n).getPrimary():n.getPrimary(),c=typeof n=="string"?null:n.getSecondary();for(const d of[a,c]){if(!d)continue;const f=d.id.toString();e.has(f)||e.set(f,[]),d.scaleSelf(i),e.get(f).push(d)}return{primary:a.toString(),secondary:c?c.toString():null}}function Ux(n,e,i,a){const c=a.patternDependencies;let d=!1;for(const f of e){const _=f.paint.get(`${n}-pattern`);_.isConstant()||(d=!0),L2(_.constantOr(null),c,i)&&(d=!0)}return d}function Gx(n,e,i,a,c,d){const f=d.patternDependencies;for(const _ of e){const x=_.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let w=x.evaluate({zoom:a},i,{},d.availableImages);w=w&&w.name?w.name:w;const E=L2(w,f,c);if(!E)continue;const{primary:A,secondary:M}=E;A&&(i.patterns[_.id]=[A,M].filter(Boolean))}}return i}var $x,k2,Hx,O2,qx,F2,B2,yy={};function N2(){if(k2)return $x;k2=1;var n=dl();function e(c,d,f,_,x){this.properties={},this.extent=f,this.type=0,this._pbf=c,this._geometry=-1,this._keys=_,this._values=x,c.readFields(i,this,d)}function i(c,d,f){c==1?d.id=f.readVarint():c==2?function(_,x){for(var w=_.readVarint()+_.pos;_.pos<w;){var E=x._keys[_.readVarint()],A=x._values[_.readVarint()];x.properties[E]=A}}(f,d):c==3?d.type=f.readVarint():c==4&&(d._geometry=f.pos)}function a(c){for(var d,f,_=0,x=0,w=c.length,E=w-1;x<w;E=x++)_+=((f=c[E]).x-(d=c[x]).x)*(d.y+f.y);return _}return $x=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var d,f=c.readVarint()+c.pos,_=1,x=0,w=0,E=0,A=[];c.pos<f;){if(x<=0){var M=c.readVarint();_=7&M,x=M>>3}if(x--,_===1||_===2)w+=c.readSVarint(),E+=c.readSVarint(),_===1&&(d&&A.push(d),d=[]),d.push(new n(w,E));else{if(_!==7)throw new Error("unknown command "+_);d&&d.push(d[0].clone())}}return d&&A.push(d),A},e.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var d=c.readVarint()+c.pos,f=1,_=0,x=0,w=0,E=1/0,A=-1/0,M=1/0,L=-1/0;c.pos<d;){if(_<=0){var k=c.readVarint();f=7&k,_=k>>3}if(_--,f===1||f===2)(x+=c.readSVarint())<E&&(E=x),x>A&&(A=x),(w+=c.readSVarint())<M&&(M=w),w>L&&(L=w);else if(f!==7)throw new Error("unknown command "+f)}return[E,M,A,L]},e.prototype.toGeoJSON=function(c,d,f){var _,x,w=this.extent*Math.pow(2,f),E=this.extent*c,A=this.extent*d,M=this.loadGeometry(),L=e.types[this.type];function k(q){for(var ee=0;ee<q.length;ee++){var K=q[ee];q[ee]=[360*(K.x+E)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+A)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(_=0;_<M.length;_++)F[_]=M[_][0];k(M=F);break;case 2:for(_=0;_<M.length;_++)k(M[_]);break;case 3:for(M=function(q){var ee=q.length;if(ee<=1)return[q];for(var K,B,Z=[],J=0;J<ee;J++){var oe=a(q[J]);oe!==0&&(B===void 0&&(B=oe<0),B===oe<0?(K&&Z.push(K),K=[q[J]]):K.push(q[J]))}return K&&Z.push(K),Z}(M),_=0;_<M.length;_++)for(x=0;x<M[_].length;x++)k(M[_][x])}M.length===1?M=M[0]:L="Multi"+L;var $={type:"Feature",geometry:{type:L,coordinates:M},properties:this.properties};return"id"in this&&($.id=this.id),$},$x}function j2(){if(O2)return Hx;O2=1;var n=N2();function e(a,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(i,this,c),this.length=this._features.length}function i(a,c,d){a===15?c.version=d.readVarint():a===1?c.name=d.readString():a===5?c.extent=d.readVarint():a===2?c._features.push(d.pos):a===3?c._keys.push(d.readString()):a===4&&c._values.push(function(f){for(var _=null,x=f.readVarint()+f.pos;f.pos<x;){var w=f.readVarint()>>3;_=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return _}(d))}return Hx=e,e.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var c=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,c,this.extent,this._keys,this._values)},Hx}function V2(){return B2||(B2=1,yy.VectorTile=function(){if(F2)return qx;F2=1;var n=j2();function e(i,a,c){if(i===3){var d=new n(c,c.readVarint()+c.pos);d.length&&(a[d.name]=d)}}return qx=function(i,a){this.layers=i.readFields(e,{},a)},qx}(),yy.VectorTileFeature=N2(),yy.VectorTileLayer=j2()),yy}var Nc=V2();const gh="3d_elevation_id",U2="level";class eL{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,a){return this.get(e,!0,i,a)}optional(e,i,a){return this.get(e,!1,i,a)}success(){return this._valid}get(e,i,a,c){const d=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&d!==void 0&&!Number.isNaN(d)?a(c?c(d):d):i&&(this._valid=!1),this}}class G2{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,a){return this.featureFunc(e,i,a)}parseVertex(e,i,a){return this.vertexFunc(e,i,a)}}const tL=new G2((n,e,i)=>n.reset(e).require(gh,a=>{i.id=a}).optional("fixed_height_relative",a=>{i.constantHeight=a},_h.decodeRelativeHeight).geometry(a=>{i.bounds=a},xp).success(),(n,e,i)=>n.reset(e).require(gh,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height_relative",a=>{i.height=a},_h.decodeRelativeHeight).geometry(a=>{i.position=a},_h.getPoint).success()),iL=new G2((n,e,i)=>n.reset(e).require(gh,a=>{i.id=a}).optional("fixed_height",a=>{i.constantHeight=a},_h.decodeMetricHeight).geometry(a=>{i.bounds=a},xp).success(),(n,e,i)=>n.reset(e).require(gh,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height",a=>{i.height=a},_h.decodeMetricHeight).geometry(a=>{i.position=a},_h.getPoint).success());class _h{static getPoint(e){return Bs(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],a=[],c=e.length,d=new eL;for(let _=0;_<c;_++){const x=e.feature(_),w=x.properties.hasOwnProperty("version")?String(x.properties.version):void 0,E=(f=w)?f==="1.0.1"?iL:void 0:tL;if(E===void 0){Ci(`Unknown elevation feature version number ${w||"(unknown)"}`);continue}const A=x.properties.hasOwnProperty("type")?x.properties.type:void 0;if(A){if(Nc.VectorTileFeature.types[x.type]==="Point"&&A==="curve_point"){const M={};E.parseVertex(d,x,M)&&i.push(M)}else if(Nc.VectorTileFeature.types[x.type]==="Polygon"&&A==="curve_meta"){const M={};E.parseFeature(d,x,M)&&a.push(M)}}}var f;return{vertices:i,features:a}}}class $2{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,a=i[1],c=-i[0],d=(e.extent+1)*this.metersToTile;return[new gt(Math.trunc(e.position[0]+a*d),Math.trunc(e.position[1]+c*d)),new gt(Math.trunc(e.position[0]-a*d),Math.trunc(e.position[1]-c*d))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Wx{constructor(e,i,a,c,d,f){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:a,max:a},this.safeArea=i,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||c.length!==0)){this.vertices=c,this.edges=d,this.edges=this.edges.filter(_=>{return _.a<this.vertices.length&&_.b<this.vertices.length&&!((x=this.vertices[_.a].position)[0]===(w=this.vertices[_.b].position)[0]&&x[1]===w[1]);var x,w}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const _ of this.vertices)this.vertexProps.push({dir:Bs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,_.height),this.heightRange.max=Math.max(this.heightRange.max,_.height);for(const _ of this.edges){const x=this.vertices[_.a].position,w=this.vertices[_.b].position,E=Ko(qr(),w,x),A=eo(E),M=fs(qr(),E,1/A);this.edgeProps.push({vec:E,dir:M,len:A});const L=this.vertexProps[_.a].dir,k=this.vertexProps[_.b].dir;ds(L,L,M),ds(k,k,M)}for(const _ of this.vertexProps)_.dir[0]===0&&_.dir[1]===0||hl(_.dir,_.dir);this.tessellate(f)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[a,c]=i;return((d,f,_)=>(1-_)*d+_*f)(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,c)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,a=Number.POSITIVE_INFINITY,c=0;const d=Bs(e.x,e.y);for(let f=0;f<this.edges.length;f++){const _=this.edges[f],x=this.edgeProps[f].dir,w=new Hs(d,this.edgeProps[f].dir),E=this.vertices[_.a].position,A=this.vertices[_.b].position,M=qr(),L=qr(),k=w.intersectsPlane(E,this.vertexProps[_.a].dir,M),F=w.intersectsPlane(A,this.vertexProps[_.b].dir,L);if(!k||!F)continue;const $=Ko(qr(),L,M),q=Ko(qr(),d,M),ee=oi($,$),K=ee>0?oi(q,$)/ee:0,B=Me(K,0,1),Z=Math.abs((K-B)*this.edgeProps[f].len),J=Ko(qr(),d,E),oe=Z+Math.abs(oi(J,Bs(x[1],-x[0])));oe<a&&(i=f,a=oe,c=B)}return[i,c]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const a=this.edges[i].a,c=this.edges[i].b,{position:d,height:f,extent:_}=this.vertices[a],{position:x,height:w,extent:E}=this.vertices[c],A=this.vertexProps[a].dir,M=this.vertexProps[c].dir,L=Vt(d[0]/e,d[1]/e,f),k=Vt(x[0]/e,x[1]/e,w),F=Vt(A[1],-A[0],0);Gt(F,F,_);const $=Vt(M[1],-M[0],0);if(Gt($,$,E),this.distSqLines(Vt(L[0]+.5*F[0],L[1]+.5*F[1],L[2]+.5*F[2]),Vt(k[0]-.5*$[0],k[1]-.5*$[1],k[2]-.5*$[2]),Vt(L[0]-.5*F[0],L[1]-.5*F[1],L[2]-.5*F[2]),Vt(k[0]+.5*$[0],k[1]+.5*$[1],k[2]+.5*$[2]))<=.0025000000000000005)continue;const q=this.vertices.length,ee=ds(qr(),d,x);this.vertices.push({position:fs(ee,ee,.5),height:.5*(f+w),extent:.5*(_+E)});const K=ds(qr(),A,M);this.vertexProps.push({dir:hl(K,K)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a,b:q}),this.edges.push({a:q,b:c});const B=Ko(qr(),this.vertices[q].position,d),Z=eo(B),J={vec:B,dir:fs(qr(),B,1/Z),len:Z};this.edgeProps.push(J),this.edgeProps.push(J)}}distSqLines(e,i,a,c){const d=ai(ni(),i,e),f=ai(ni(),c,a),_=ai(ni(),e,a),x=Ei(d,d),w=Ei(d,f),E=Ei(d,_),A=Ei(f,f),M=Ei(f,_),L=x*A-w*w;if(L===0){const $=Ei(_,f)/Ei(f,f);return Li(fo(ni(),a,c,$),e)}const k=(w*M-E*A)/L,F=(x*M-w*E)/L;return Li(fo(ni(),e,i,k),fo(ni(),a,c,F))}}class Zx{static parseFrom(e,i){const a=_h.parse(e);if(!a)return[];let{vertices:c,features:d}=a;const f=1/ke(i);d.sort((E,A)=>E.id-A.id),c.sort((E,A)=>E.id-A.id||E.idx-A.idx),c=c.filter((E,A,M)=>A===M.findIndex(L=>L.id===E.id&&L.idx===E.idx));const _=new Array;let x=0;const w=c.length;for(const E of d){if(E.constantHeight){_.push(new Wx(E.id,E.bounds,E.constantHeight));continue}for(;x!==w&&c[x].id<E.id;)x++;if(x===w||c[x].id!==E.id)continue;const A=new Array,M=new Array,L=x;for(;x!==w&&c[x].id===E.id;){const k=c[x];if(A.push({position:k.position,height:k.height,extent:k.extent}),x!==L&&c[x-1].idx===k.idx-1){const F=x-L;M.push({a:F-1,b:F})}x++}_.push(new Wx(E.id,E.bounds,void 0,A,M,f))}return _}static getElevationFeature(e,i){if(!i)return;const a=+e.properties[gh];return Number.isNaN(a)?void 0:i.find(c=>c.id===a)}}class H2{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*vt,this.yOffset=(e.y*this.zScale-i.y)*vt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,a){const c=this.constantElevation(i,a);return c??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),a))}computeBiasedHeight(e,i){return i<=0?e:e+i*Re(0,i,e>=0?e:Math.abs(.5*e))}}At(Wx,"ElevationFeature");class q2{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,a]of e.polygons)this.add(i,...a)}}class yh{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new yh;let i=[];for(const w of e)i.push(...w.portals);if(i.length===0)return new yh;const a=(w,E)=>w<=0&&E<=0||w>=vt&&E>=vt;for(const w of i){const E=w.va,A=w.vb;(a(E.x,A.x)||a(E.y,A.y))&&(w.type="border")}const c=i.filter(w=>w.type!=="unevaluated"),d=i.filter(w=>w.type==="unevaluated");if(d.length===0)return new yh;d.sort((w,E)=>w.hash===E.hash?w.isTunnel===E.isTunnel?0:w.isTunnel?-1:1:w.hash<E.hash?1:-1),i=c.concat(d);let f=c.length,_=f,x=f;do if(_++,_===i.length||i[f].hash!==i[_].hash){if(_-f==2){x<f&&(i[x]=i[f],i[f]=null);const w=i[x],E=i[_-1];w.type=w.isTunnel!==E.isTunnel?"tunnel":"polygon",w.connection={a:w.connection.a,b:E.connection.a},x++}f=_}while(f!==i.length);return i.splice(x),i.sort((w,E)=>w.hash<E.hash?1:-1),{portals:i}}}At(yh,"ElevationPortalGraph"),At(q2,"ElevationPolygons");class nL{constructor(e,i,a){this.outPositions=e,this.outNormals=i,this.outIndices=a,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,a){let c=e[2];a!=null&&(c*=a);const d=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),f=this.vertexLookup.get(d);if(f!=null)return f;const _=this.outPositions.length;this.vertexLookup.set(d,_);const x=Math.trunc(16384*i[0]),w=Math.trunc(16384*i[1]),E=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],c),this.outNormals.emplaceBack(x,w,E),_}addVertices(e,i,...a){const c=[];for(const d of a){const f=this.addVertex(d,e,i);c.push(f)}return c}addTriangles(e,i,a){if(i&&a){const c=a.length===1,d=Vt(0,0,0);for(let f=0;f<e.length;f+=3){const _=i[e[f+0]],x=i[e[f+1]],w=i[e[f+2]],E=c?a[0]:a[e[f+1]],A=c?a[0]:a[e[f+2]],M=this.addVertex(Vt(_.x,_.y,c?a[0]:a[e[f+0]]),d),L=this.addVertex(Vt(x.x,x.y,E),d),k=this.addVertex(Vt(w.x,w.y,A),d);this.outIndices.emplaceBack(M,L,k)}}else for(let c=0;c<e.length;c+=3)this.outIndices.emplaceBack(e[c+0],e[c+1],e[c+2])}addQuad(e,i){const a=this.addVertices(i,void 0,...e.map(x=>Vt(x.coord.x,x.coord.y,x.height))),[c,d,f,_]=a;this.addTriangles([c,d,f,f,_,c])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class os{constructor(e){this.unevaluatedPortals=new yh,this.portalPolygons=new q2,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Gd,this.vertexNormals=new Mc,this.indexArray=new vr,this.tileToMeters=ke(e)}addVertices(e,i){const a=this.unevalVertices.length;for(let c=0;c<e.length;c++)this.unevalVertices.push(e[c]),this.unevalHeights.push(i[c]);return a}addTriangles(e,i,a){const c=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const d of e)c.push(d+i)}addRenderableRing(e,i,a,c,d){const f=[new gt(d.min.x,d.min.y),new gt(d.max.x,d.min.y),new gt(d.max.x,d.max.y),new gt(d.min.x,d.max.y)];for(let _=0;_<a-1;_++){const x=i+_,w=x+1,E=this.unevalVertices[x],A=this.unevalVertices[w];if(!(E.x>=d.min.x&&E.x<=d.max.x&&E.y>=d.min.y&&E.y<=d.max.y||A.x>=d.min.x&&A.x<=d.max.x&&A.y>=d.min.y&&A.y<=d.max.y||qn(E,A,f))||this.isOnBorder(E.x,A.x)||this.isOnBorder(E.y,A.y))continue;const M=os.computeEdgeHash(this.unevalVertices[x],this.unevalVertices[w]);let L,k=this.vertexHashLookup.get(os.computePosHash(E));k!=null?L=k.next:(k=this.vertexHashLookup.get(os.computePosHash(A)),L=k!=null?k.prev:M),this.unevalEdges.push({polygonIdx:e,a:x,b:w,hash:M,portalHash:L,isTunnel:c,type:"unevaluated"})}}addPortalCandidates(e,i,a,c,d){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:d});const f=i[0];this.vertexHashLookup.clear();let _=os.computeEdgeHash(f[f.length-2],f[f.length-1]);for(let x=0;x<f.length-1;x++){const w=f[x+0],E=f[x+1],A=Bs(E.x-w.x,E.y-w.y),M=eo(A);if(M===0)continue;let L="unevaluated";const k=c.pointElevation(w),F=c.pointElevation(E);Math.abs(k)<.01&&Math.abs(F)<.01?L="entrance":(this.isOnBorder(w.x,E.x)||this.isOnBorder(w.y,E.y))&&(L="border");const $=os.computeEdgeHash(w,E);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:w,vb:E,vab:A,length:M,hash:$,isTunnel:a,type:L});const q=os.computePosHash(w);this.vertexHashLookup.set(q,{prev:_,next:$}),_=$}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=A=>{A.primitiveLength=this.indexArray.length-A.primitiveOffset},c=new nL(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const d=i(),f=i(),_=i(),x=(A,M)=>{A.sort((k,F)=>k.type===M&&F.type!==M?-1:k.type!==M&&F.type===M?1:0);const L=A.findIndex(k=>k.type!==M);return L>=0?L:A.length};let w=0;this.unevalEdges.length>0&&(w=x(this.unevalEdges,"none"),this.constructBridgeStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:w},this.tileToMeters));const E=i();if(this.unevalEdges.length>0){const A=this.unevalEdges.splice(w),M=x(A,"tunnel")+w;this.unevalEdges.push(...A),this.constructTunnelStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:w},{min:w,max:M})}a(_),c.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(E),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(f),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(d),this.maskSegments=kn.simpleSegment(0,E.primitiveOffset,0,E.primitiveLength),this.depthSegments=kn.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength),this.renderableSegments=kn.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.shadowCasterSegments=kn.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,UD.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,GD.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,i,a,c,d){const f=new Map;for(let _=c;_<d;_++){const x=a[_],w=x.a,E=x.b,A=os.computePosHash(e[w]),M=os.computePosHash(e[E]);f.has(A)||f.set(A,{}),f.has(M)||f.set(M,{});const L=f.get(A),k=f.get(M);i[w]<=0&&i[E]<=0||(L.to=E,k.from=w)}return f}constructBridgeStructures(e,i,a,c,d,f){const _=this.computeVertexConnections(i,a,c,d.min,d.max),x=1/f,w=.5*x,E=M=>Vt(i[M].x,i[M].y,a[M]*x),A=M=>{const L=_.get(os.computePosHash(i[M])),k=L.from,F=L.to;if(!k||!F)return;const $=E(k),q=E(M),ee=E(F),K=Vt(0,0,0);if(!Ir($,q)){const Z=Tn(ni(),q,$);vi(K,K,$i(Z,Z))}if(!Ir(ee,q)){const Z=Tn(ni(),ee,q);vi(K,K,$i(Z,Z))}const B=Wo(K);return B>0?Gt(K,K,1/B):void 0};for(let M=d.min;M<d.max;M++){const L=c[M],k=this.prepareEdgePoints(i,a,L,(ct,ri)=>ct>ri);if(k==null)continue;const F=k[0],$=k[1],q=Vt(F.coord.x,F.coord.y,x*F.height),ee=Vt($.coord.x,$.coord.y,x*$.height);if(Ir(q,ee))continue;const K=Tn(ni(),ee,q);$i(K,K);const B=ct=>$i(ct,ct),Z=A(L.a)||K,J=A(L.b)||K,oe=B(Vt(Z[1],-Z[0],0)),_e=B(Vt(J[1],-J[0],0)),Se=B(xn(ni(),oe,Z)),Ae=B(xn(ni(),_e,J)),De=ni(),qe=[vi(ni(),q,Gt(De,Tn(De,oe,Se),w)),vi(ni(),q,Gt(De,vi(De,oe,Se),w)),vi(ni(),q,Gt(De,Se,w)),q],rt=[vi(ni(),ee,Gt(De,Tn(De,_e,Ae),w)),vi(ni(),ee,Gt(De,vi(De,_e,Ae),w)),vi(ni(),ee,Gt(De,Ae,w)),ee],[Je,nt]=e.addVertices(oe,f,qe[0],qe[1]),[lt,$e]=e.addVertices(_e,f,rt[0],rt[1]);e.addTriangles([Je,nt,lt,nt,$e,lt]);const[it,je]=e.addVertices(Se,f,qe[1],qe[2]),[He,ut]=e.addVertices(Ae,f,rt[1],rt[2]);e.addTriangles([it,je,He,je,ut,He]);const[ht,Ft]=e.addVertices(Vn(oe,oe),f,qe[2],qe[3]),[Mt,bt]=e.addVertices(Vn(_e,_e),f,rt[2],rt[3]);e.addTriangles([ht,Ft,Mt,Ft,bt,Mt])}}constructTunnelStructures(e,i,a,c,d,f){const _=x=>$i(x,x);for(let x=d.min;x<d.max;x++){const w=this.prepareEdgePoints(i,a,c[x],(L,k)=>L<k);if(w==null)continue;const[E,A]=w,M=_(Vt(A.coord.y-E.coord.y,-(A.coord.x-E.coord.x),0));e.addQuad([E,A,{coord:A.coord,height:c[x].isTunnel?-.1:0},{coord:E.coord,height:c[x].isTunnel?-.1:0}],M)}for(let x=f.min;x<f.max;x++){const w=c[x],E=i[w.a],A=i[w.b],M=_(Vt(A.y-E.y,-(A.x-E.x),0));e.addQuad([{coord:A,height:0},{coord:E,height:0},{coord:E,height:a[w.a]+4},{coord:A,height:a[w.b]+4}],M),e.addQuad([{coord:E,height:0},{coord:A,height:0},{coord:A,height:a[w.b]+4},{coord:E,height:a[w.a]+4}],M)}}prepareEdgePoints(e,i,a,c){let d=i[a.a],f=i[a.b];const _=c(d,0),x=c(f,0);if(_&&x)return[{coord:e[a.a],height:d},{coord:e[a.b],height:f}];if(!_&&!x)return;const w=e[a.a].clone(),E=e[a.b].clone();if(_){if(!x){const A=f/(f-d);E.x=qt(E.x,w.x,A),E.y=qt(E.y,w.y,A),f=qt(f,d,A)}}else{const A=d/(d-f);w.x=qt(w.x,E.x,A),w.y=qt(w.y,E.y,A),d=qt(d,f,A)}return[{coord:w,height:d},{coord:E,height:f}]}prepareEdges(e,i){if(i.length===0)return;i.sort((_,x)=>_.hash===x.hash?x.polygonIdx-_.polygonIdx:x.hash>_.hash?1:-1);let a=0,c=0,d=0,f=i[a].polygonIdx;do c++,(c===i.length||i[a].hash!==i[c].hash)&&((c-a==1||i[c-1].polygonIdx!==f)&&(d<a&&(i[d]=i[a],i[a]=null),i[d].type="none",d++),a=c,a!==i.length&&(f=i[a].polygonIdx));while(a!==i.length);if(i.splice(d),i.length!==0&&e.length!==0){i.sort((w,E)=>w.portalHash<E.portalHash?1:-1);let _=0,x=0;for(;_!==i.length&&x!==e.length;){const w=i[_],E=e[x];w.portalHash>E.hash?_++:E.hash>w.portalHash?x++:(w.type=E.type,_++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=vt&&i>=vt}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(os.computePosHash(e))<<32n|BigInt(os.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var W2,Z2={exports:{}},X2=(W2||(W2=1,function(n,e){(function(i){function a(ie,se){return ie>se?1:ie<se?-1:0}var c=function(ie,se){ie===void 0&&(ie=a),se===void 0&&(se=!1),this._compare=ie,this._root=null,this._size=0,this._noDuplicates=!!se},d={size:{configurable:!0}};function f(ie,se,Ze,mt,St){var Tt=St-mt;if(Tt>0){var kt=mt+Math.floor(Tt/2),Yt={key:se[kt],data:Ze[kt],parent:ie};return Yt.left=f(Yt,se,Ze,mt,kt),Yt.right=f(Yt,se,Ze,kt+1,St),Yt}return null}function _(ie,se,Ze,mt,St){if(!(Ze>=mt)){for(var Tt=ie[Ze+mt>>1],kt=Ze-1,Yt=mt+1;;){do kt++;while(St(ie[kt],Tt)<0);do Yt--;while(St(ie[Yt],Tt)>0);if(kt>=Yt)break;var Ri=ie[kt];ie[kt]=ie[Yt],ie[Yt]=Ri,Ri=se[kt],se[kt]=se[Yt],se[Yt]=Ri}_(ie,se,Ze,Yt,St),_(ie,se,Yt+1,mt,St)}}c.prototype.rotateLeft=function(ie){var se=ie.right;se&&(ie.right=se.left,se.left&&(se.left.parent=ie),se.parent=ie.parent),ie.parent?ie===ie.parent.left?ie.parent.left=se:ie.parent.right=se:this._root=se,se&&(se.left=ie),ie.parent=se},c.prototype.rotateRight=function(ie){var se=ie.left;se&&(ie.left=se.right,se.right&&(se.right.parent=ie),se.parent=ie.parent),ie.parent?ie===ie.parent.left?ie.parent.left=se:ie.parent.right=se:this._root=se,se&&(se.right=ie),ie.parent=se},c.prototype._splay=function(ie){for(;ie.parent;){var se=ie.parent;se.parent?se.left===ie&&se.parent.left===se?(this.rotateRight(se.parent),this.rotateRight(se)):se.right===ie&&se.parent.right===se?(this.rotateLeft(se.parent),this.rotateLeft(se)):se.left===ie&&se.parent.right===se?(this.rotateRight(se),this.rotateLeft(se)):(this.rotateLeft(se),this.rotateRight(se)):se.left===ie?this.rotateRight(se):this.rotateLeft(se)}},c.prototype.splay=function(ie){for(var se,Ze,mt,St,Tt;ie.parent;)(Ze=(se=ie.parent).parent)&&Ze.parent?((mt=Ze.parent).left===Ze?mt.left=ie:mt.right=ie,ie.parent=mt):(ie.parent=null,this._root=ie),St=ie.left,Tt=ie.right,ie===se.left?(Ze&&(Ze.left===se?(se.right?(Ze.left=se.right,Ze.left.parent=Ze):Ze.left=null,se.right=Ze,Ze.parent=se):(St?(Ze.right=St,St.parent=Ze):Ze.right=null,ie.left=Ze,Ze.parent=ie)),Tt?(se.left=Tt,Tt.parent=se):se.left=null,ie.right=se,se.parent=ie):(Ze&&(Ze.right===se?(se.left?(Ze.right=se.left,Ze.right.parent=Ze):Ze.right=null,se.left=Ze,Ze.parent=se):(Tt?(Ze.left=Tt,Tt.parent=Ze):Ze.left=null,ie.right=Ze,Ze.parent=ie)),St?(se.right=St,St.parent=se):se.right=null,ie.left=se,se.parent=ie)},c.prototype.replace=function(ie,se){ie.parent?ie===ie.parent.left?ie.parent.left=se:ie.parent.right=se:this._root=se,se&&(se.parent=ie.parent)},c.prototype.minNode=function(ie){if(ie===void 0&&(ie=this._root),ie)for(;ie.left;)ie=ie.left;return ie},c.prototype.maxNode=function(ie){if(ie===void 0&&(ie=this._root),ie)for(;ie.right;)ie=ie.right;return ie},c.prototype.insert=function(ie,se){var Ze=this._root,mt=null,St=this._compare;if(this._noDuplicates)for(;Ze;){if(mt=Ze,St(Ze.key,ie)===0)return;Ze=St(Ze.key,ie)<0?Ze.right:Ze.left}else for(;Ze;)mt=Ze,Ze=St(Ze.key,ie)<0?Ze.right:Ze.left;return Ze={key:ie,data:se,left:null,right:null,parent:mt},mt?St(mt.key,Ze.key)<0?mt.right=Ze:mt.left=Ze:this._root=Ze,this.splay(Ze),this._size++,Ze},c.prototype.find=function(ie){for(var se=this._root,Ze=this._compare;se;){var mt=Ze(se.key,ie);if(mt<0)se=se.right;else{if(!(mt>0))return se;se=se.left}}return null},c.prototype.contains=function(ie){for(var se=this._root,Ze=this._compare;se;){var mt=Ze(ie,se.key);if(mt===0)return!0;se=mt<0?se.left:se.right}return!1},c.prototype.remove=function(ie){var se=this.find(ie);if(!se)return!1;if(this.splay(se),se.left)if(se.right){var Ze=this.minNode(se.right);Ze.parent!==se&&(this.replace(Ze,Ze.right),Ze.right=se.right,Ze.right.parent=Ze),this.replace(se,Ze),Ze.left=se.left,Ze.left.parent=Ze}else this.replace(se,se.left);else this.replace(se,se.right);return this._size--,!0},c.prototype.removeNode=function(ie){if(!ie)return!1;if(this.splay(ie),ie.left)if(ie.right){var se=this.minNode(ie.right);se.parent!==ie&&(this.replace(se,se.right),se.right=ie.right,se.right.parent=se),this.replace(ie,se),se.left=ie.left,se.left.parent=se}else this.replace(ie,ie.left);else this.replace(ie,ie.right);return this._size--,!0},c.prototype.erase=function(ie){var se=this.find(ie);if(se){this.splay(se);var Ze=se.left,mt=se.right,St=null;Ze&&(Ze.parent=null,St=this.maxNode(Ze),this.splay(St),this._root=St),mt&&(Ze?St.right=mt:this._root=mt,mt.parent=St),this._size--}},c.prototype.pop=function(){var ie=this._root,se=null;if(ie){for(;ie.left;)ie=ie.left;se={key:ie.key,data:ie.data},this.remove(ie.key)}return se},c.prototype.next=function(ie){var se=ie;if(se)if(se.right)for(se=se.right;se&&se.left;)se=se.left;else for(se=ie.parent;se&&se.right===ie;)ie=se,se=se.parent;return se},c.prototype.prev=function(ie){var se=ie;if(se)if(se.left)for(se=se.left;se&&se.right;)se=se.right;else for(se=ie.parent;se&&se.left===ie;)ie=se,se=se.parent;return se},c.prototype.forEach=function(ie){for(var se=this._root,Ze=[],mt=!1,St=0;!mt;)se?(Ze.push(se),se=se.left):Ze.length>0?(ie(se=Ze.pop(),St++),se=se.right):mt=!0;return this},c.prototype.range=function(ie,se,Ze,mt){for(var St=[],Tt=this._compare,kt=this._root;St.length!==0||kt;)if(kt)St.push(kt),kt=kt.left;else{if(Tt((kt=St.pop()).key,se)>0)break;if(Tt(kt.key,ie)>=0&&Ze.call(mt,kt))return this;kt=kt.right}return this},c.prototype.keys=function(){for(var ie=this._root,se=[],Ze=[],mt=!1;!mt;)ie?(se.push(ie),ie=ie.left):se.length>0?(ie=se.pop(),Ze.push(ie.key),ie=ie.right):mt=!0;return Ze},c.prototype.values=function(){for(var ie=this._root,se=[],Ze=[],mt=!1;!mt;)ie?(se.push(ie),ie=ie.left):se.length>0?(ie=se.pop(),Ze.push(ie.data),ie=ie.right):mt=!0;return Ze},c.prototype.at=function(ie){for(var se=this._root,Ze=[],mt=!1,St=0;!mt;)if(se)Ze.push(se),se=se.left;else if(Ze.length>0){if(se=Ze.pop(),St===ie)return se;St++,se=se.right}else mt=!0;return null},c.prototype.load=function(ie,se,Ze){if(ie===void 0&&(ie=[]),se===void 0&&(se=[]),Ze===void 0&&(Ze=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var mt=ie.length;return Ze&&_(ie,se,0,mt-1,this._compare),this._root=f(null,ie,se,0,mt),this._size=mt,this},c.prototype.min=function(){var ie=this.minNode(this._root);return ie?ie.key:null},c.prototype.max=function(){var ie=this.maxNode(this._root);return ie?ie.key:null},c.prototype.isEmpty=function(){return this._root===null},d.size.get=function(){return this._size},c.createTree=function(ie,se,Ze,mt,St){return new c(Ze,St).load(ie,se,mt)},Object.defineProperties(c.prototype,d);var x=0,w=1,E=2,A=3,M=0,L=1,k=2,F=3;function $(ie,se,Ze){se===null?(ie.inOut=!1,ie.otherInOut=!0):(ie.isSubject===se.isSubject?(ie.inOut=!se.inOut,ie.otherInOut=se.otherInOut):(ie.inOut=!se.otherInOut,ie.otherInOut=se.isVertical()?!se.inOut:se.inOut),se&&(ie.prevInResult=!q(se,Ze)||se.isVertical()?se.prevInResult:se));var mt=q(ie,Ze);ie.resultTransition=mt?function(St,Tt){var kt,Yt=!St.inOut,Ri=!St.otherInOut;switch(Tt){case M:kt=Yt&&Ri;break;case L:kt=Yt||Ri;break;case F:kt=Yt^Ri;break;case k:kt=St.isSubject?Yt&&!Ri:Ri&&!Yt}return kt?1:-1}(ie,Ze):0}function q(ie,se){switch(ie.type){case x:switch(se){case M:return!ie.otherInOut;case L:return ie.otherInOut;case k:return ie.isSubject&&ie.otherInOut||!ie.isSubject&&!ie.otherInOut;case F:return!0}break;case E:return se===M||se===L;case A:return se===k;case w:return!1}return!1}var ee=function(ie,se,Ze,mt,St){this.left=se,this.point=ie,this.otherEvent=Ze,this.isSubject=mt,this.type=St||x,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},K={inResult:{configurable:!0}};function B(ie,se){return ie[0]===se[0]&&ie[1]===se[1]}ee.prototype.isBelow=function(ie){var se=this.point,Ze=this.otherEvent.point;return this.left?(se[0]-ie[0])*(Ze[1]-ie[1])-(Ze[0]-ie[0])*(se[1]-ie[1])>0:(Ze[0]-ie[0])*(se[1]-ie[1])-(se[0]-ie[0])*(Ze[1]-ie[1])>0},ee.prototype.isAbove=function(ie){return!this.isBelow(ie)},ee.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},K.inResult.get=function(){return this.resultTransition!==0},ee.prototype.clone=function(){var ie=new ee(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ie.contourId=this.contourId,ie.resultTransition=this.resultTransition,ie.prevInResult=this.prevInResult,ie.isExteriorRing=this.isExteriorRing,ie.inOut=this.inOut,ie.otherInOut=this.otherInOut,ie},Object.defineProperties(ee.prototype,K);var Z=11102230246251565e-32,J=134217729,oe=(3+8*Z)*Z;function _e(ie,se,Ze,mt,St){var Tt,kt,Yt,Ri,zi=se[0],_i=mt[0],Ki=0,un=0;_i>zi==_i>-zi?(Tt=zi,zi=se[++Ki]):(Tt=_i,_i=mt[++un]);var Di=0;if(Ki<ie&&un<Ze)for(_i>zi==_i>-zi?(Yt=Tt-((kt=zi+Tt)-zi),zi=se[++Ki]):(Yt=Tt-((kt=_i+Tt)-_i),_i=mt[++un]),Tt=kt,Yt!==0&&(St[Di++]=Yt);Ki<ie&&un<Ze;)_i>zi==_i>-zi?(Yt=Tt-((kt=Tt+zi)-(Ri=kt-Tt))+(zi-Ri),zi=se[++Ki]):(Yt=Tt-((kt=Tt+_i)-(Ri=kt-Tt))+(_i-Ri),_i=mt[++un]),Tt=kt,Yt!==0&&(St[Di++]=Yt);for(;Ki<ie;)Yt=Tt-((kt=Tt+zi)-(Ri=kt-Tt))+(zi-Ri),zi=se[++Ki],Tt=kt,Yt!==0&&(St[Di++]=Yt);for(;un<Ze;)Yt=Tt-((kt=Tt+_i)-(Ri=kt-Tt))+(_i-Ri),_i=mt[++un],Tt=kt,Yt!==0&&(St[Di++]=Yt);return Tt===0&&Di!==0||(St[Di++]=Tt),Di}function Se(ie){return new Float64Array(ie)}var Ae=33306690738754716e-32,De=22204460492503146e-32,qe=11093356479670487e-47,rt=Se(4),Je=Se(8),nt=Se(12),lt=Se(16),$e=Se(4);function it(ie,se,Ze){var mt=function(St,Tt,kt,Yt,Ri,zi){var _i=(Tt-zi)*(kt-Ri),Ki=(St-Ri)*(Yt-zi),un=_i-Ki;if(_i===0||Ki===0||_i>0!=Ki>0)return un;var Di=Math.abs(_i+Ki);return Math.abs(un)>=Ae*Di?un:-function(On,_n,Zi,Wn,bn,hn,yn){var Qi,wi,rn,Fn,Xt,Fi,wn,Gn,Cn,ar,an,rr,Co,Nr,Lr,Mo,Ja,lr,gr=On-bn,jr=Zi-bn,co=_n-hn,Yr=Wn-hn;rt[0]=(Lr=(Gn=gr-(wn=(Fi=J*gr)-(Fi-gr)))*(ar=Yr-(Cn=(Fi=J*Yr)-(Fi-Yr)))-((Nr=gr*Yr)-wn*Cn-Gn*Cn-wn*ar))-((an=Lr-(Ja=(Gn=co-(wn=(Fi=J*co)-(Fi-co)))*(ar=jr-(Cn=(Fi=J*jr)-(Fi-jr)))-((Mo=co*jr)-wn*Cn-Gn*Cn-wn*ar)))+(Xt=Lr-an))+(Xt-Ja),rt[1]=(Co=Nr-((rr=Nr+an)-(Xt=rr-Nr))+(an-Xt))-((an=Co-Mo)+(Xt=Co-an))+(Xt-Mo),rt[2]=rr-((lr=rr+an)-(Xt=lr-rr))+(an-Xt),rt[3]=lr;var qc=function(gU,eA){for(var tA=eA[0],Q1=1;Q1<4;Q1++)tA+=eA[Q1];return tA}(0,rt),Qm=De*yn;if(qc>=Qm||-qc>=Qm||(Qi=On-(gr+(Xt=On-gr))+(Xt-bn),rn=Zi-(jr+(Xt=Zi-jr))+(Xt-bn),wi=_n-(co+(Xt=_n-co))+(Xt-hn),Fn=Wn-(Yr+(Xt=Wn-Yr))+(Xt-hn),Qi===0&&wi===0&&rn===0&&Fn===0)||(Qm=qe*yn+oe*Math.abs(qc),(qc+=gr*Fn+Yr*Qi-(co*rn+jr*wi))>=Qm||-qc>=Qm))return qc;$e[0]=(Lr=(Gn=Qi-(wn=(Fi=J*Qi)-(Fi-Qi)))*(ar=Yr-(Cn=(Fi=J*Yr)-(Fi-Yr)))-((Nr=Qi*Yr)-wn*Cn-Gn*Cn-wn*ar))-((an=Lr-(Ja=(Gn=wi-(wn=(Fi=J*wi)-(Fi-wi)))*(ar=jr-(Cn=(Fi=J*jr)-(Fi-jr)))-((Mo=wi*jr)-wn*Cn-Gn*Cn-wn*ar)))+(Xt=Lr-an))+(Xt-Ja),$e[1]=(Co=Nr-((rr=Nr+an)-(Xt=rr-Nr))+(an-Xt))-((an=Co-Mo)+(Xt=Co-an))+(Xt-Mo),$e[2]=rr-((lr=rr+an)-(Xt=lr-rr))+(an-Xt),$e[3]=lr;var j3=_e(4,rt,4,$e,Je);$e[0]=(Lr=(Gn=gr-(wn=(Fi=J*gr)-(Fi-gr)))*(ar=Fn-(Cn=(Fi=J*Fn)-(Fi-Fn)))-((Nr=gr*Fn)-wn*Cn-Gn*Cn-wn*ar))-((an=Lr-(Ja=(Gn=co-(wn=(Fi=J*co)-(Fi-co)))*(ar=rn-(Cn=(Fi=J*rn)-(Fi-rn)))-((Mo=co*rn)-wn*Cn-Gn*Cn-wn*ar)))+(Xt=Lr-an))+(Xt-Ja),$e[1]=(Co=Nr-((rr=Nr+an)-(Xt=rr-Nr))+(an-Xt))-((an=Co-Mo)+(Xt=Co-an))+(Xt-Mo),$e[2]=rr-((lr=rr+an)-(Xt=lr-rr))+(an-Xt),$e[3]=lr;var V3=_e(j3,Je,4,$e,nt);$e[0]=(Lr=(Gn=Qi-(wn=(Fi=J*Qi)-(Fi-Qi)))*(ar=Fn-(Cn=(Fi=J*Fn)-(Fi-Fn)))-((Nr=Qi*Fn)-wn*Cn-Gn*Cn-wn*ar))-((an=Lr-(Ja=(Gn=wi-(wn=(Fi=J*wi)-(Fi-wi)))*(ar=rn-(Cn=(Fi=J*rn)-(Fi-rn)))-((Mo=wi*rn)-wn*Cn-Gn*Cn-wn*ar)))+(Xt=Lr-an))+(Xt-Ja),$e[1]=(Co=Nr-((rr=Nr+an)-(Xt=rr-Nr))+(an-Xt))-((an=Co-Mo)+(Xt=Co-an))+(Xt-Mo),$e[2]=rr-((lr=rr+an)-(Xt=lr-rr))+(an-Xt),$e[3]=lr;var U3=_e(V3,nt,4,$e,lt);return lt[U3-1]}(St,Tt,kt,Yt,Ri,zi,Di)}(ie[0],ie[1],se[0],se[1],Ze[0],Ze[1]);return mt>0?-1:mt<0?1:0}function je(ie,se){var Ze=ie.point,mt=se.point;return Ze[0]>mt[0]?1:Ze[0]<mt[0]?-1:Ze[1]!==mt[1]?Ze[1]>mt[1]?1:-1:function(St,Tt,kt,Yt){return St.left!==Tt.left?St.left?1:-1:it(kt,St.otherEvent.point,Tt.otherEvent.point)!==0?St.isBelow(Tt.otherEvent.point)?-1:1:!St.isSubject&&Tt.isSubject?1:-1}(ie,se,Ze)}function He(ie,se,Ze){var mt=new ee(se,!1,ie,ie.isSubject),St=new ee(se,!0,ie.otherEvent,ie.isSubject);return B(ie.point,ie.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ie),mt.contourId=St.contourId=ie.contourId,je(St,ie.otherEvent)>0&&(ie.otherEvent.left=!0,St.left=!1),ie.otherEvent.otherEvent=St,ie.otherEvent=mt,Ze.push(St),Ze.push(mt),Ze}function ut(ie,se){return ie[0]*se[1]-ie[1]*se[0]}function ht(ie,se){return ie[0]*se[0]+ie[1]*se[1]}function Ft(ie,se,Ze){var mt=function(Ri,zi,_i,Ki,un){var Di=[zi[0]-Ri[0],zi[1]-Ri[1]],On=[Ki[0]-_i[0],Ki[1]-_i[1]];function _n(Fi,wn,Gn){return[Fi[0]+wn*Gn[0],Fi[1]+wn*Gn[1]]}var Zi=[_i[0]-Ri[0],_i[1]-Ri[1]],Wn=ut(Di,On),bn=Wn*Wn,hn=ht(Di,Di);if(bn>0){var yn=ut(Zi,On)/Wn;if(yn<0||yn>1)return null;var Qi=ut(Zi,Di)/Wn;return Qi<0||Qi>1?null:yn===0||yn===1?[_n(Ri,yn,Di)]:Qi===0||Qi===1?[_n(_i,Qi,On)]:[_n(Ri,yn,Di)]}if((bn=(Wn=ut(Zi,Di))*Wn)>0)return null;var wi=ht(Di,Zi)/hn,rn=wi+ht(Di,On)/hn,Fn=Math.min(wi,rn),Xt=Math.max(wi,rn);return Fn<=1&&Xt>=0?Fn===1?[_n(Ri,Fn>0?Fn:0,Di)]:Xt===0?[_n(Ri,Xt<1?Xt:1,Di)]:[_n(Ri,Fn>0?Fn:0,Di),_n(Ri,Xt<1?Xt:1,Di)]:null}(ie.point,ie.otherEvent.point,se.point,se.otherEvent.point),St=mt?mt.length:0;if(St===0||St===1&&(B(ie.point,se.point)||B(ie.otherEvent.point,se.otherEvent.point))||St===2&&ie.isSubject===se.isSubject)return 0;if(St===1)return B(ie.point,mt[0])||B(ie.otherEvent.point,mt[0])||He(ie,mt[0],Ze),B(se.point,mt[0])||B(se.otherEvent.point,mt[0])||He(se,mt[0],Ze),1;var Tt=[],kt=!1,Yt=!1;return B(ie.point,se.point)?kt=!0:je(ie,se)===1?Tt.push(se,ie):Tt.push(ie,se),B(ie.otherEvent.point,se.otherEvent.point)?Yt=!0:je(ie.otherEvent,se.otherEvent)===1?Tt.push(se.otherEvent,ie.otherEvent):Tt.push(ie.otherEvent,se.otherEvent),kt&&Yt||kt?(se.type=w,ie.type=se.inOut===ie.inOut?E:A,kt&&!Yt&&He(Tt[1].otherEvent,Tt[0].point,Ze),2):Yt?(He(Tt[0],Tt[1].point,Ze),3):Tt[0]!==Tt[3].otherEvent?(He(Tt[0],Tt[1].point,Ze),He(Tt[1],Tt[2].point,Ze),3):(He(Tt[0],Tt[1].point,Ze),He(Tt[3].otherEvent,Tt[2].point,Ze),3)}function Mt(ie,se){if(ie===se)return 0;if(it(ie.point,ie.otherEvent.point,se.point)!==0||it(ie.point,ie.otherEvent.point,se.otherEvent.point)!==0)return B(ie.point,se.point)?ie.isBelow(se.otherEvent.point)?-1:1:ie.point[0]===se.point[0]?ie.point[1]<se.point[1]?-1:1:je(ie,se)===1?se.isAbove(ie.point)?-1:1:ie.isBelow(se.point)?-1:1;if(ie.isSubject!==se.isSubject)return ie.isSubject?-1:1;var Ze=ie.point,mt=se.point;return Ze[0]===mt[0]&&Ze[1]===mt[1]?(Ze=ie.otherEvent.point)[0]===(mt=se.otherEvent.point)[0]&&Ze[1]===mt[1]?0:ie.contourId>se.contourId?1:-1:je(ie,se)===1?1:-1}var bt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ct(ie,se,Ze,mt){var St,Tt=ie+1,kt=se[ie].point,Yt=se.length;for(Tt<Yt&&(St=se[Tt].point);Tt<Yt&&St[0]===kt[0]&&St[1]===kt[1];){if(!Ze[Tt])return Tt;++Tt<Yt&&(St=se[Tt].point)}for(Tt=ie-1;Ze[Tt]&&Tt>mt;)Tt--;return Tt}bt.prototype.isExterior=function(){return this.holeOf==null};var ri=Lt,Dt=Lt;function Lt(ie,se){if(!(this instanceof Lt))return new Lt(ie,se);if(this.data=ie||[],this.length=this.data.length,this.compare=se||Kt,this.length>0)for(var Ze=(this.length>>1)-1;Ze>=0;Ze--)this._down(Ze)}function Kt(ie,se){return ie<se?-1:ie>se?1:0}Lt.prototype={push:function(ie){this.data.push(ie),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ie=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ie}},peek:function(){return this.data[0]},_up:function(ie){for(var se=this.data,Ze=this.compare,mt=se[ie];ie>0;){var St=ie-1>>1,Tt=se[St];if(Ze(mt,Tt)>=0)break;se[ie]=Tt,ie=St}se[ie]=mt},_down:function(ie){for(var se=this.data,Ze=this.compare,mt=this.length>>1,St=se[ie];ie<mt;){var Tt=1+(ie<<1),kt=Tt+1,Yt=se[Tt];if(kt<this.length&&Ze(se[kt],Yt)<0&&(Tt=kt,Yt=se[kt]),Ze(Yt,St)>=0)break;se[ie]=Yt,ie=Tt}se[ie]=St}},ri.default=Dt;var di=Math.max,pi=Math.min,Si=0;function yi(ie,se,Ze,mt,St,Tt){var kt,Yt,Ri,zi,_i,Ki;for(kt=0,Yt=ie.length-1;kt<Yt;kt++)if(zi=ie[kt+1],_i=new ee(Ri=ie[kt],!1,void 0,se),Ki=new ee(zi,!1,_i,se),_i.otherEvent=Ki,Ri[0]!==zi[0]||Ri[1]!==zi[1]){_i.contourId=Ki.contourId=Ze,Tt||(_i.isExteriorRing=!1,Ki.isExteriorRing=!1),je(_i,Ki)>0?Ki.left=!0:_i.left=!0;var un=Ri[0],Di=Ri[1];St[0]=pi(St[0],un),St[1]=pi(St[1],Di),St[2]=di(St[2],un),St[3]=di(St[3],Di),mt.push(_i),mt.push(Ki)}}var gi=[];function sn(ie,se,Ze){typeof ie[0][0][0]=="number"&&(ie=[ie]),typeof se[0][0][0]=="number"&&(se=[se]);var mt=function(Di,On,_n){var Zi=null;return Di.length*On.length==0&&(_n===M?Zi=gi:_n===k?Zi=Di:_n!==L&&_n!==F||(Zi=Di.length===0?On:Di)),Zi}(ie,se,Ze);if(mt)return mt===gi?null:mt;var St=[1/0,1/0,-1/0,-1/0],Tt=[1/0,1/0,-1/0,-1/0],kt=function(Di,On,_n,Zi,Wn){var bn,hn,yn,Qi,wi,rn,Fn=new ri(null,je);for(yn=0,Qi=Di.length;yn<Qi;yn++)for(wi=0,rn=(bn=Di[yn]).length;wi<rn;wi++)(hn=wi===0)&&Si++,yi(bn[wi],!0,Si,Fn,_n,hn);for(yn=0,Qi=On.length;yn<Qi;yn++)for(wi=0,rn=(bn=On[yn]).length;wi<rn;wi++)hn=wi===0,Wn===k&&(hn=!1),hn&&Si++,yi(bn[wi],!1,Si,Fn,Zi,hn);return Fn}(ie,se,St,Tt,Ze);if(mt=function(Di,On,_n,Zi,Wn){var bn=null;return(_n[0]>Zi[2]||Zi[0]>_n[2]||_n[1]>Zi[3]||Zi[1]>_n[3])&&(Wn===M?bn=gi:Wn===k?bn=Di:Wn!==L&&Wn!==F||(bn=Di.concat(On))),bn}(ie,se,St,Tt,Ze))return mt===gi?null:mt;for(var Yt=function(Di){var On,_n,Zi=function(yn){var Qi,wi,rn,Fn,Xt=[];for(wi=0,rn=yn.length;wi<rn;wi++)((Qi=yn[wi]).left&&Qi.inResult||!Qi.left&&Qi.otherEvent.inResult)&&Xt.push(Qi);for(var Fi=!1;!Fi;)for(Fi=!0,wi=0,rn=Xt.length;wi<rn;wi++)wi+1<rn&&je(Xt[wi],Xt[wi+1])===1&&(Fn=Xt[wi],Xt[wi]=Xt[wi+1],Xt[wi+1]=Fn,Fi=!1);for(wi=0,rn=Xt.length;wi<rn;wi++)(Qi=Xt[wi]).otherPos=wi;for(wi=0,rn=Xt.length;wi<rn;wi++)(Qi=Xt[wi]).left||(Fn=Qi.otherPos,Qi.otherPos=Qi.otherEvent.otherPos,Qi.otherEvent.otherPos=Fn);return Xt}(Di),Wn={},bn=[],hn=function(){if(!Wn[On]){var yn=bn.length,Qi=function(Xt,Fi,wn){var Gn=new bt;if(Xt.prevInResult!=null){var Cn=Xt.prevInResult,ar=Cn.outputContourId;if(Cn.resultTransition>0){var an=Fi[ar];if(an.holeOf!=null){var rr=an.holeOf;Fi[rr].holeIds.push(wn),Gn.holeOf=rr,Gn.depth=Fi[ar].depth}else Fi[ar].holeIds.push(wn),Gn.holeOf=ar,Gn.depth=Fi[ar].depth+1}else Gn.holeOf=null,Gn.depth=Fi[ar].depth}else Gn.holeOf=null,Gn.depth=0;return Gn}(Zi[On],bn,yn),wi=function(Xt){Wn[Xt]=!0,Xt<Zi.length&&Zi[Xt]&&(Zi[Xt].outputContourId=yn)},rn=On,Fn=On;for(Qi.points.push(Zi[On].point);wi(rn),wi(rn=Zi[rn].otherPos),Qi.points.push(Zi[rn].point),!((rn=ct(rn,Zi,Wn,Fn))==Fn||rn>=Zi.length)&&Zi[rn];);bn.push(Qi)}};for(On=0,_n=Zi.length;On<_n;On++)hn();return bn}(function(Di,On,_n,Zi,Wn,bn){for(var hn,yn,Qi,wi=new c(Mt),rn=[],Fn=Math.min(Zi[2],Wn[2]);Di.length!==0;){var Xt=Di.pop();if(rn.push(Xt),bn===M&&Xt.point[0]>Fn||bn===k&&Xt.point[0]>Zi[2])break;if(Xt.left){yn=hn=wi.insert(Xt),hn=hn!==(Qi=wi.minNode())?wi.prev(hn):null,yn=wi.next(yn);var Fi=hn?hn.key:null;if($(Xt,Fi,bn),yn&&Ft(Xt,yn.key,Di)===2&&($(Xt,Fi,bn),$(yn.key,Xt,bn)),hn&&Ft(hn.key,Xt,Di)===2){var wn=hn;$(Fi,(wn=wn!==Qi?wi.prev(wn):null)?wn.key:null,bn),$(Xt,Fi,bn)}}else yn=hn=wi.find(Xt=Xt.otherEvent),hn&&yn&&(hn=hn!==Qi?wi.prev(hn):null,yn=wi.next(yn),wi.remove(Xt),yn&&hn&&Ft(hn.key,yn.key,Di))}return rn}(kt,0,0,St,Tt,Ze)),Ri=[],zi=0;zi<Yt.length;zi++){var _i=Yt[zi];if(_i.isExterior()){for(var Ki=[_i.points],un=0;un<_i.holeIds.length;un++)Ki.push(Yt[_i.holeIds[un]].points);Ri.push(Ki)}}return Ri}var gn={UNION:L,DIFFERENCE:k,INTERSECTION:M,XOR:F};i.diff=function(ie,se){return sn(ie,se,k)},i.intersection=function(ie,se){return sn(ie,se,M)},i.operations=gn,i.union=function(ie,se){return sn(ie,se,L)},i.xor=function(ie,se){return sn(ie,se,F)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Z2.exports)),Z2.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function vy(n,e,i,a){const c=[],d=a===0?(f,_,x,w,E,A)=>{f.push(new gt(A,x+(A-_)/(w-_)*(E-x)))}:(f,_,x,w,E,A)=>{f.push(new gt(_+(A-x)/(E-x)*(w-_),A))};for(const f of n){const _=[];for(const x of f){if(x.length<=2)continue;const w=[];for(let M=0;M<x.length-1;M++){const L=x[M].x,k=x[M].y,F=x[M+1].x,$=x[M+1].y,q=a===0?L:k,ee=a===0?F:$;q<e?ee>e&&d(w,L,k,F,$,e):q>i?ee<i&&d(w,L,k,F,$,i):w.push(x[M]),ee<e&&q>=e&&d(w,L,k,F,$,e),ee>i&&q<=i&&d(w,L,k,F,$,i)}let E=x[x.length-1];const A=a===0?E.x:E.y;A>=e&&A<=i&&w.push(E),w.length&&(E=w[w.length-1],w[0].x===E.x&&w[0].y===E.y||w.push(w[0]),_.push(w))}_.length&&c.push(_)}return c}function rL(n,e){const i=Xx(n),a=Xx([e]),c=X2.intersection(i,a);return c==null?[]:Y2(c)}function oL(n,e){let a=Xx(n,65536);for(;e.valid();e.next()){const[c,d]=e.get(),f=c.x*65536,_=c.y*65536,x=d.x*65536,w=d.y*65536,E=x-f,A=w-_,M=Math.hypot(E,A),L=Math.trunc(A/M*3),k=-Math.trunc(E/M*3);a=X2.diff(a,[[[f,_],[x,w],[x+L,w+k],[f+L,_+k],[f,_]]])}return Y2(a,1/65536)}function Xx(n,e=1){return[n.map(i=>i.map(a=>[a.x*e,a.y*e]))]}function Y2(n,e=1){return n.map(i=>i.map((a,c)=>{const d=a.map(f=>new gt(f[0]*e,f[1]*e).round());return c>0&&d.reverse(),d}))}class Yx{constructor(e,i){this.layoutVertexArray=new da,this.indexArray=new vr,this.lineIndexArray=new Wa,this.triangleSegments=new kn,this.lineSegments=new kn,this.programConfigurations=new Bl(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Cc)}update(e,i,a,c,d,f,_){this.programConfigurations.updatePaintArrays(e,i,d,a,c,f,_)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jD.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,VD.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,a,c,d,f){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,a,c,d,f)}}class Kx{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new Yx(e,!1),this.elevationBufferData=new Yx(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,i){}populate(e,i,a,c){this.hasPattern=Ux("fill",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:_,id:x,index:w,sourceLayerIndex:E}of e){const A=this.layers[0]._featureFilter.needGeometry,M=Nt(_,A);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),M,a))continue;const L=d?d.evaluate(M,{},a,i.availableImages):void 0,k={id:x,properties:_.properties,type:_.type,sourceLayerIndex:E,index:w,geometry:A?M.geometry:Pt(_,a,c),patterns:{},sortKey:L};f.push(k)}d&&f.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of f){const{geometry:x,index:w,sourceLayerIndex:E}=_;if(this.hasPattern){const A=Gx("fill",this.layers,_,this.zoom,this.pixelRatio,i);this.patternFeatures.push(A)}else this.addFeature(_,x,w,a,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[w].feature,x,w,E,this.index)}}update(e,i,a,c,d,f,_){this.bufferData.update(e,i,a,c,d,f,_),this.elevationBufferData.update(e,i,a,c,d,f,_)}addFeatures(e,i,a,c,d,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,a,c,f,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,a,c,d,f=[],_,x){const w=_y(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,w,c,a,x):this.addGeometry(w,this.bufferData),this.bufferData.populatePaintArrays(e,a,d,f,c,_),this.elevationBufferData.populatePaintArrays(e,a,d,f,c,_)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,i,a,c,d){const f=new Array,_=Zx.getElevationFeature(e,d);if(_){{const x=this.clipPolygonsToTile(i,1);x.length>0&&f.push({polygons:x,elevationFeature:_,elevationTileID:a})}for(const x of f)if(x.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new os(x.elevationTileID));const E=x.elevationFeature.isTunnel();let A=0;e.properties.hasOwnProperty(U2)&&(A=+e.properties[U2]);for(const M of x.polygons)this.elevatedStructures.addPortalCandidates(x.elevationFeature.id,M,E,x.elevationFeature,A)}x.elevationFeature.constantHeight==null&&(x.polygons=this.prepareElevatedPolygons(x.polygons,x.elevationFeature,x.elevationTileID));const w=new H2(a,x.elevationTileID);this.addElevatedGeometry(x.polygons,w,x.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,c)}}else this.addGeometry(i,this.bufferData)}addElevatedGeometry(e,i,a,c,d){const f={elevation:a,elevationSampler:i,bias:c,index:d},[_,x]=this.addGeometry(e,this.elevationBufferData,f);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:_,max:x}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,_),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,x))}addGeometry(e,i,a){let c=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,f=null;a&&(f=a.elevationSampler.constantElevation(a.elevation,a.bias),f!=null&&(c=f,d=f));const _=(x,w,E)=>{if(a!=null)if(w.push(x),f!=null)i.elevatedLayoutVertexArray.emplaceBack(f),E.push(f);else{const A=a.elevationSampler.pointElevation(x,a.elevation,a.bias);i.elevatedLayoutVertexArray.emplaceBack(A),E.push(A),c=Math.min(c,A),d=Math.max(d,A)}};for(const x of e){let w=0;for(const K of x)w+=K.length;const E=i.triangleSegments.prepareSegment(w,i.layoutVertexArray,i.indexArray),A=E.vertexLength,M=[],L=[],k=[],F=[],$=[],q=i.layoutVertexArray.length;for(const K of x){if(K.length===0)continue;K!==x[0]&&L.push(M.length/2);const B=i.lineSegments.prepareSegment(K.length,i.layoutVertexArray,i.lineIndexArray),Z=B.vertexLength;a&&$.push(i.layoutVertexArray.length-q),_(K[0],k,F),i.layoutVertexArray.emplaceBack(K[0].x,K[0].y),i.lineIndexArray.emplaceBack(Z+K.length-1,Z),M.push(K[0].x),M.push(K[0].y);for(let J=1;J<K.length;J++)_(K[J],k,F),i.layoutVertexArray.emplaceBack(K[J].x,K[J].y),i.lineIndexArray.emplaceBack(Z+J-1,Z+J),M.push(K[J].x),M.push(K[J].y);B.vertexLength+=K.length,B.primitiveLength+=K.length}const ee=vm(M,L);for(let K=0;K<ee.length;K+=3)i.indexArray.emplaceBack(A+ee[K],A+ee[K+1],A+ee[K+2]);if(ee.length>0&&a&&this.elevationMode==="hd-road-base"){const K=a.elevation.isTunnel(),B=a.elevation.safeArea,Z=this.elevatedStructures.addVertices(k,F);this.elevatedStructures.addTriangles(ee,Z,K);const J=$.length;if(J>0){for(let oe=0;oe<J-1;oe++)this.elevatedStructures.addRenderableRing(a.index,$[oe]+Z,$[oe+1]-$[oe],K,B);this.elevatedStructures.addRenderableRing(a.index,$[J-1]+Z,k.length-$[J-1],K,B)}}E.vertexLength+=w,E.primitiveLength+=ee.length/3}return[c,d]}prepareElevatedPolygons(e,i,a){const c=1/ke(a),d=[];for(const f of e){const _=oL(f,new $2(i,c));d.push(..._)}return d}clipPolygonsToTile(e,i){const a=-i,c=-i,d=vt+i,f=vt+i;let _=0;const x=[],w=[];for(;_<e.length;_++){const M=e[_],L=xp(M);(L.min.x>=a&&L.max.x<=d&&L.min.y>=c&&L.max.y<=f?x:w).push(M)}if(x.length===e.length)return e;const E=[new gt(a,c),new gt(d,c),new gt(d,f),new gt(a,f),new gt(a,c)],A=x;for(const M of w)A.push(...rL(M,E));return A}}let K2,Q2,J2,eS;At(Kx,"FillBucket",{omit:["layers","patternFeatures"]}),At(Yx,"FillBufferData"),At(os,"ElevatedStructures");class Qx{constructor(e,i,a,c){if(this.triangleCount=i.length/3,this.min=new gt(0,0),this.max=new gt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[d,f]=[e[0].clone(),e[0].clone()];for(let A=1;A<e.length;++A){const M=e[A];d.x=Math.min(d.x,M.x),d.y=Math.min(d.y,M.y),f.x=Math.max(f.x,M.x),f.y=Math.max(f.y,M.y)}if(c){const A=Math.ceil(Math.max(f.x-d.x,f.y-d.y)/c);a=Math.max(a,A)}if(a===0)return;this.min=d,this.max=f;const _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);const x=Math.max(_.x,_.y)/a;this.cellsX=Math.max(1,Math.ceil(_.x/x)),this.cellsY=Math.max(1,Math.ceil(_.y/x)),this.xScale=1/x,this.yScale=1/x;const w=[];for(let A=0;A<this.triangleCount;A++){const M=e[i[3*A+0]].sub(this.min),L=e[i[3*A+1]].sub(this.min),k=e[i[3*A+2]].sub(this.min),F=Ka(Math.floor(Math.min(M.x,L.x,k.x)),this.xScale,this.cellsX),$=Ka(Math.floor(Math.max(M.x,L.x,k.x)),this.xScale,this.cellsX),q=Ka(Math.floor(Math.min(M.y,L.y,k.y)),this.yScale,this.cellsY),ee=Ka(Math.floor(Math.max(M.y,L.y,k.y)),this.yScale,this.cellsY),K=new gt(0,0),B=new gt(0,0),Z=new gt(0,0),J=new gt(0,0);for(let oe=q;oe<=ee;++oe){K.y=B.y=oe*x,Z.y=J.y=(oe+1)*x;for(let _e=F;_e<=$;++_e)K.x=Z.x=_e*x,B.x=J.x=(_e+1)*x,(Pn(M,L,k,K,B,J)||Pn(M,L,k,K,J,Z))&&w.push({cellIdx:oe*this.cellsX+_e,triIdx:A})}}if(w.length===0)return;w.sort((A,M)=>A.cellIdx-M.cellIdx||A.triIdx-M.triIdx);let E=0;for(;E<w.length;){const A=w[E].cellIdx,M={start:this.payload.length,len:0};for(;E<w.length&&w[E].cellIdx===A;)++M.len,this.payload.push(w[E++].triIdx);this.cells[A]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=Ka(e.x-this.min.x,this.xScale,this.cellsX),c=Ka(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[c*this.cellsX+a];if(d){this._lazyInitLookup();for(let f=0;f<d.len;f++){const _=this.payload[d.start+f],x=Math.floor(_/8),w=1<<_%8;if(!(this.lookup[x]&w)&&(this.lookup[x]|=w,i.push(_),i.length===this.triangleCount))return}}}query(e,i,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const c=Ka(e.x-this.min.x,this.xScale,this.cellsX),d=Ka(i.x-this.min.x,this.xScale,this.cellsX),f=Ka(e.y-this.min.y,this.yScale,this.cellsY),_=Ka(i.y-this.min.y,this.yScale,this.cellsY);for(let x=f;x<=_;x++)for(let w=c;w<=d;w++){const E=this.cells[x*this.cellsX+w];if(E)for(let A=0;A<E.len;A++){const M=this.payload[E.start+A],L=Math.floor(M/8),k=1<<M%8;if(!(this.lookup[L]&k)&&(this.lookup[L]|=k,a.push(M),a.length===this.triangleCount))return}}}}function Ka(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}At(Qx,"TriangleGridIndex");class tS{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}populate(e,i,a,c){const d=[];for(const{feature:f,id:_,index:x,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,A=Nt(f,E);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),A,a))continue;const M={id:_,properties:f.properties,type:f.type,sourceLayerIndex:w,index:x,geometry:E?A.geometry:Pt(f,a,c),patterns:{}};d.push(M)}for(const f of d){const{geometry:_,index:x,sourceLayerIndex:w}=f;this.addFeature(f,_,x,a,{},i.availableImages,i.brightness),i.featureIndex.insert(e[x].feature,_,x,w,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,a,c,d,f,_){}destroy(){}addFeature(e,i,a,c,d,f=[],_){for(const x of _y(i,2)){const w=[],E=[],A=[],M=new gt(1/0,1/0),L=new gt(-1/0,-1/0);for(const $ of x)if($.length!==0){$!==x[0]&&A.push(E.length/2);for(let q=0;q<$.length;q++)E.push($[q].x),E.push($[q].y),w.push($[q]),M.x=Math.min(M.x,$[q].x),M.y=Math.min(M.y,$[q].y),L.x=Math.max(L.x,$[q].x),L.y=Math.max(L.y,$[q].y)}const k=vm(E,A),F=new Qx(w,k,8,256);this.footprints.push({vertices:w,indices:k,grid:F,min:M,max:L})}}}At(tS,"ClipBucket",{omit:["layers"]});const sL=Gi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),aL=Gi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),lL=Gi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),cL=Gi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),uL=Gi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),hL=Gi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:dL}=sL,xy=Number.MAX_SAFE_INTEGER;function iS(n,e,i,a){return n.order<e||n.order===xy||!(n.clipMask&i)||function(c,d){return d.length!==0&&d.find(f=>f===c)===void 0}(a,n.clipScope)}function by(n,e){return n.x-e.x||n.y-e.y}function nS(n,e){return by(n.min,e.min)===0&&by(n.max,e.max)===0}function Jx(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function e1(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!nS(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!ra(n[i].clipScope,e[i].clipScope))return!1;return!0}function rS(n,e,i){const a=1/vt,c=1/(1<<i.canonical.z),d=(e.x*a+i.canonical.x)*c+i.wrap,f=(e.y*a+i.canonical.y)*c;return{min:new gt((n.x*a+i.canonical.x)*c+i.wrap,(n.y*a+i.canonical.y)*c),max:new gt(d,f)}}function fL(n,e,i){const a=1<<i.canonical.z,c=((e.x-i.wrap)*a-i.canonical.x)*vt,d=(e.y*a-i.canonical.y)*vt;return{min:new gt(((n.x-i.wrap)*a-i.canonical.x)*vt,(n.y*a-i.canonical.y)*vt),max:new gt(c,d)}}function oS(n,e,i,a,c,d,f){const _=n.indices,x=n.vertices,w=[];for(let E=a;E<a+c;E+=3){const A=e[i[E+0]+d],M=e[i[E+1]+d],L=e[i[E+2]+d],k=Math.min(A.x,M.x,L.x),F=Math.max(A.x,M.x,L.x),$=Math.min(A.y,M.y,L.y),q=Math.max(A.y,M.y,L.y);w.length=0,n.grid.query(new gt(k,$),new gt(F,q),w);for(let ee=0;ee<w.length;ee++){const K=w[ee];if(Pn(x[_[3*K+0]],x[_[3*K+1]],x[_[3*K+2]],A,M,L,f))return!0}}return!1}function sS(n,e,i,a){if(!n||!i)return!1;let c=n.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(i.vertices.length<n.vertices.length)return sS(i,a,n,e);const d=e.canonical,f=a.canonical,_=Math.pow(2,f.z-d.z);c=n.vertices.map(x=>new gt((x.x+d.x*vt)*_-f.x*vt,(x.y+d.y*vt)*_-f.y*vt))}return oS(i,c,n.indices,0,n.indices.length,0,0)}function aS(n,e,i,a){const c=Math.pow(2,a.z-i.z);return new gt((n+i.x*vt)*c-a.x*vt,(e+i.y*vt)*c-a.y*vt)}function lS(n,e){const i=[];e.grid.queryPoint(n,i);const a=e.indices,c=e.vertices;for(let d=0;d<i.length;d++){const f=i[d];if(nn([c[a[3*f+0]],c[a[3*f+1]],c[a[3*f+2]]],n))return!0}return!1}const t1=[new gt(0,0),new gt(vt,0),new gt(vt,vt),new gt(0,vt)];function cS(n,e){const i=[];let a=[];if(!e||n.length<2)return[n];if(n.length===2)return qn(n[0],n[1],t1)?[n]:[];for(let c=0;c<n.length+2;c++){const d=n[c%n.length],f=n[(c+1)%n.length],_=qn(c===0?n[n.length-1]:n[(c-1)%n.length],d,t1),x=qn(d,f,t1),w=_||x;w&&a.push(d),w&&x||a.length>0&&(a.length>1&&i.push(a),a=[])}return a.length>1&&i.push(a),i}const i1=Nc.VectorTileFeature.types,pL=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],mL=["fill-extrusion-flood-light-ground-radius"],gL=Math.pow(2,13),_L=Math.pow(2,15)-1,uS=new gt(0,1),jc=2147483648;function Sm(n,e,i,a,c,d,f,_){n.emplaceBack((e<<1)+f,(i<<1)+d,(Math.floor(a*gL)<<1)+c,Math.round(_))}function Em(n,e,i){n.emplaceBack(e.x*vt,e.y*vt,i?1:0)}function wy(n,e,i,a,c,d){n.emplaceBack(e.x,e.y,(i.x<<1)+a,(i.y<<1)+c,d)}function Im(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class hS{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class dS{constructor(){this.centroidXY=new gt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new gt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new gt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new gt(this.max.x-this.min.x,this.max.y-this.min.y)}}class fS{constructor(){this.acc=new gt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,a){this.accCount++,this.acc._add(i);let c=!!this.borders;i.x<e.min.x?(e.min.x=i.x,c=!0):i.x>e.max.x&&(e.max.x=i.x,c=!0),i.y<e.min.y?(e.min.y=i.y,c=!0):i.y>e.max.y&&(e.max.y=i.y,c=!0),((i.x===0||i.x===vt)&&i.x===a.x)!=((i.y===0||i.y===vt)&&i.y===a.y)&&this.processBorderOverlap(i,a),c&&this.checkBorderIntersection(i,a)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,qt(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>vt!=e.x>vt&&this.addBorderIntersection(1,qt(i.y,e.y,(vt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,qt(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>vt!=e.y>vt&&this.addBorderIntersection(3,qt(i.x,e.x,(vt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new gt(0,0):new gt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function pS(n,e){const i=n.add(e)._unit(),a=Me(n.x*i.x+n.y*i.y,-1,1);var c,d,f;return c=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(c)))/4*_L*((d=n).x*(f=e).y-d.y*f.x<0?-1:1)}const yL=[n=>n.x<0,n=>n.x>vt,n=>n.y<0,n=>n.y>vt];function vL(n,e,i,a){const c=[4];if(a===0)return c;i._mult(a);const d=n.sub(i),f=e.sub(i),_=[n,e,d,f];for(let x=0;x<4;x++)for(const w of _)if(yL[x](w)){c.push(x);break}return c}class mS{constructor(e){this.vertexArray=new rm,this.indexArray=new vr,this.programConfigurations=new Bl(e.layers,{zoom:e.zoom,lut:e.lut},i=>mL.includes(i)),this._segments=new kn,this.hiddenByLandmarkVertexArray=new Wd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new kn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,a,c=!1){const d=e.length;if(d>2){let f=Math.max(0,this._segments.get().length-1);const _=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let x;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const w=e[0],E=e[1];x=pS(w.sub(e[d-1])._perp()._unit(),E.sub(w)._perp()._unit())}for(let w=0;w<d;w++){const E=w===d-1?0:w+1,A=e[w],M=e[E],L=e[E===d-1?0:E+1],k=M.sub(A)._perp()._unit(),F=pS(k,L.sub(M)._perp()._unit()),$=x,q=F;if(n1(A,M,i)||c&&yS(A,i)&&yS(M,i)){x=F;continue}const ee=_.vertexLength;wy(this.vertexArray,A,M,1,1,$),wy(this.vertexArray,A,M,1,0,$),wy(this.vertexArray,A,M,0,1,q),wy(this.vertexArray,A,M,0,0,q),_.vertexLength+=4;const K=vL(A,M,k,a);for(const B of K)this._segmentToGroundQuads[f].push({id:ee,region:B}),this._segmentToRegionTriCounts[f][B]+=2,_.primitiveLength+=2;x=F}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let a=0;a<i;a++)this._segmentToGroundQuads[a].sort((c,d)=>c.region-d.region);for(let a=0;a<i;a++){const c=this._segmentToGroundQuads[a],d=e[a],f=this._segmentToRegionTriCounts[a];f.reduce((x,w)=>x+w,0);let _=0;for(let x=0;x<=4;x++){const w=f[x];if(w!==0){let E=this.regionSegments[x];E||(E=this.regionSegments[x]=new kn);const A={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+_,vertexLength:d.vertexLength,primitiveLength:w};E.get().push(A)}_+=w}for(let x=0;x<c.length;x++){const w=c[x].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,a,c,d,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,a,c,d,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,aL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,a,c,d,f,_){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,a,c,d,f,_)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const a=e.flags&jc?1:0;for(let c=e.groundVertexArrayOffset;c<i;++c)this.hiddenByLandmarkVertexArray.emplace(c,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,uL.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Ty{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new vr,this.footprintVertices=new da,this.footprintSegments=[],this.layoutVertexArray=new kl,this.centroidVertexArray=new oy,this.wallVertexArray=new ay,this.indexArray=new vr,this.programConfigurations=new Bl(e.layers,{zoom:e.zoom,lut:e.lut},i=>pL.includes(i)),this.segments=new kn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new mS(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,a,c){this.features=[],this.hasPattern=Ux("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ke(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:d,id:f,index:_,sourceLayerIndex:x}of e){const w=this.layers[0]._featureFilter.needGeometry,E=Nt(d,w);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),E,a))continue;const A={id:f,sourceLayerIndex:x,index:_,geometry:w?E.geometry:Pt(d,a,c),properties:d.properties,type:d.type,patterns:{}},M=this.layoutVertexArray.length,L=i1[A.type]==="Polygon";if(this.hasPattern)this.features.push(Gx("fill-extrusion",this.layers,A,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const k of A.geometry)for(const F of cS(k,L))this.addFeature(A,[F],_,a,{},i.availableImages,c,i.brightness);else this.addFeature(A,A.geometry,_,a,{},i.availableImages,c,i.brightness);i.featureIndex.insert(d,A.geometry,_,x,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,a,c,d,f){for(const _ of this.features){const x=i1[_.type]==="Polygon",{geometry:w}=_;if(this.wallMode)for(const E of w)for(const A of cS(E,x))this.addFeature(_,[A],_.index,i,a,c,d,f);else this.addFeature(_,w,_.index,i,a,c,d,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,a,c,d,f,_){this.programConfigurations.updatePaintArrays(e,i,d,a,c,f,_),this.groundEffect.update(e,i,d,a,c,f,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dL),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,cL.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,hL.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,lL.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,c,d,f,_,x){const w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,E=[new gt(0,0),new gt(vt,vt)],A=_.projection,M=A.name==="globe",L=this.wallMode||i1[e.type]==="Polygon",k=new fS;k.centroidDataIndex=this.centroidData.length;const F=new dS,$=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,q=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);let ee;if(F.height=q,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ol),this.wallMode){if(M)return void Ci("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;ee=function(Ae){const De=Ae[0].x===Ae[Ae.length-1].x&&Ae[0].y===Ae[Ae.length-1].y;(function(bt){let ct=0;const ri=bt.length;for(let Dt=0;Dt<ri;Dt++)ct+=(bt[(Dt+1)%ri].x-bt[Dt].x)*(bt[(Dt+1)%ri].y+bt[Dt].y);return ct>=0})(Ae)||(Ae=Ae.reverse());const rt={geometry:[],joinNormals:[],indices:[]},Je=[],nt=[],lt=[];let $e=Ae.length;for(;$e>=2&&Ae[$e-1].equals(Ae[$e-2]);)$e--;if($e<(De?3:2))return rt;let it,je,He,ut,ht,Ft=0;for(;Ft<$e-1&&Ae[Ft].equals(Ae[Ft+1]);)Ft++;De&&(it=Ae[$e-2],ht=Ae[Ft].sub(it)._unit()._perp());for(let bt=Ft;bt<$e;bt++){if(He=bt===$e-1?De?Ae[Ft+1]:void 0:Ae[bt+1],He&&Ae[bt].equals(He))continue;ht&&(ut=ht),it&&(je=it),it=Ae[bt],ht=He?He.sub(it)._unit()._perp():ut,ut=ut||ht;let ct=ut.add(ht);ct.x===0&&ct.y===0||ct._unit();const ri=ct.x*ht.x+ct.y*ht.y,Dt=ri!==0?1/ri:1/0,Lt=ut.x*ht.y-ut.y*ht.x>0;let Kt="miter";const di=2;Kt==="miter"&&Dt>di&&(Kt="bevel"),Kt==="bevel"&&(Dt>100&&(Kt="flipbevel"),Dt<di&&(Kt="miter"));const pi=(Si,yi,gi,sn)=>{const gn=new gt(Si.x,Si.y),ie=new gt(Si.x,Si.y);gn.x+=yi.x*sn,gn.y+=yi.y*sn,ie.x-=yi.x*Math.max(gi,1),ie.y-=yi.y*Math.max(gi,1),lt.push(yi),Je.push(gn),nt.push(ie)};if(Kt==="miter")ct._mult(Dt),pi(it,ct,0,0);else if(Kt==="flipbevel")ct=ht.mult(-1),pi(it,ct,0,0),pi(it,ct.mult(-1),0,0);else{const Si=-Math.sqrt(Dt*Dt-1),yi=Lt?Si:0,gi=Lt?0:Si;je&&pi(it,ut,yi,gi),He&&pi(it,ht,yi,gi)}}rt.geometry=[...Je,...nt.reverse(),Je[0]],rt.joinNormals=[...lt,...lt.reverse(),lt[lt.length-1]];const Mt=rt.geometry.length-1;for(let bt=0;bt<Mt/2;bt++)if(bt+1<Mt/2){let ct=bt,ri=bt+1,Dt=Mt-1-bt,Lt=Mt-2-bt;ct=ct===0?Mt-1:ct-1,ri=ri===0?Mt-1:ri-1,Dt=Dt===0?Mt-1:Dt-1,Lt=Lt===0?Mt-1:Lt-1,rt.indices.push(Dt),rt.indices.push(ri),rt.indices.push(ct),rt.indices.push(Dt),rt.indices.push(Lt),rt.indices.push(ri)}return rt}(i[0]),i=[ee.geometry]}const K=(Ae,De)=>Ae<(De.length-1)/2||Ae===De.length-1,B=this.wallMode?[i]:_y(i,500);for(let Ae=B.length-1;Ae>=0;Ae--){const De=B[Ae];(De.length===0||(Z=De[0]).every(qe=>qe.x<=0)||Z.every(qe=>qe.x>=vt)||Z.every(qe=>qe.y<=0)||Z.every(qe=>qe.y>=vt))&&B.splice(Ae,1)}var Z;let J;if(M)J=wS(B,E,c);else{J=[];for(const Ae of B)J.push({polygon:Ae,bounds:E})}const oe=L?this.edgeRadius:0,_e=oe>0&&this.zoom<17,Se=(Ae,De)=>{if(Ae.length===0)return!1;const qe=Ae[Ae.length-1];return De.x===qe.x&&De.y===qe.y};for(const{polygon:Ae,bounds:De}of J){let qe=0,rt=0;for(const $e of Ae)L&&!$e[0].equals($e[$e.length-1])&&$e.push($e[0]),rt+=L?$e.length-1:$e.length;const Je=this.segments.prepareSegment((L?5:4)*rt,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);const nt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},lt=new hS;if(lt.vertexOffset=this.footprintVertices.length,lt.indexOffset=3*this.footprintIndices.length,lt.ringIndices=[],L){const $e=[],it=[];qe=Je.vertexLength;for(let He=0;He<Ae.length;He++){const ut=Ae[He];ut.length&&He!==0&&it.push($e.length/2);const ht=[];let Ft,Mt;Ft=ut[1].sub(ut[0])._perp()._unit(),lt.ringIndices.push(ut.length-1);for(let bt=1;bt<ut.length;bt++){const ct=ut[bt],ri=ut[bt===ut.length-1?1:bt+1],Dt=ct.clone();if(oe){Mt=ri.sub(ct)._perp()._unit();const Lt=Ft.add(Mt)._unit(),Kt=oe*Math.min(4,1/(Ft.x*Lt.x+Ft.y*Lt.y));Dt.x+=Kt*Lt.x,Dt.y+=Kt*Lt.y,Dt.x=Math.round(Dt.x),Dt.y=Math.round(Dt.y),Ft=Mt}if(!$||oe!==0&&!_e||Se(ht,Dt)||ht.push(Dt),Sm(this.layoutVertexArray,Dt.x,Dt.y,0,0,1,1,0),this.wallMode){const Lt=K(bt,ut);Em(this.wallVertexArray,ee.joinNormals[bt],!Lt)}Je.vertexLength++,this.footprintVertices.emplaceBack(ct.x,ct.y),$e.push(ct.x,ct.y),M&&Im(this.layoutVertexExtArray,A.projectTilePoint(Dt.x,Dt.y,c),A.upVector(c,Dt.x,Dt.y))}$&&(oe===0||_e)&&(ht.length!==0&&Se(ht,ht[0])&&ht.pop(),this.groundEffect.addData(ht,De,w))}const je=this.wallMode?ee.indices:vm($e,it);for(let He=0;He<je.length;He+=3)this.footprintIndices.emplaceBack(lt.vertexOffset+je[He+0],lt.vertexOffset+je[He+1],lt.vertexOffset+je[He+2]),this.indexArray.emplaceBack(qe+je[He],qe+je[He+2],qe+je[He+1]),Je.primitiveLength++;lt.indexCount+=je.length,lt.vertexCount+=this.footprintVertices.length-lt.vertexOffset}for(let $e=0;$e<Ae.length;$e++){const it=Ae[$e];k.startRing(F,it[0]);let je=it.length>4&&vS(it[it.length-2],it[0],it[1]),He=oe?xL(it[it.length-2],it[0],it[1],oe):0;const ut=[];let ht,Ft,Mt;Ft=it[1].sub(it[0])._perp()._unit();let bt=!0;for(let ct=1,ri=0;ct<it.length;ct++){let Dt=it[ct-1],Lt=it[ct];const Kt=it[ct===it.length-1?1:ct+1];if(k.appendEdge(F,Lt,Dt),n1(Lt,Dt,De)){oe&&(Ft=Kt.sub(Lt)._perp()._unit(),bt=!bt);continue}const di=Lt.sub(Dt)._perp(),pi=di.x/(Math.abs(di.x)+Math.abs(di.y)),Si=di.y>0?1:0,yi=Dt.dist(Lt);if(ri+yi>32768&&(ri=0),oe){Mt=Kt.sub(Lt)._perp()._unit();let ie=_S(Dt,Lt,Kt,gS(Ft,Mt),oe);isNaN(ie)&&(ie=0);const se=Lt.sub(Dt)._unit();Dt=Dt.add(se.mult(He))._round(),Lt=Lt.add(se.mult(-ie))._round(),He=ie,Ft=Mt,$&&this.zoom>=17&&(Se(ut,Dt)||ut.push(Dt),Se(ut,Lt)||ut.push(Lt))}const gi=Je.vertexLength,sn=it.length>4&&vS(Dt,Lt,Kt);let gn=xS(ri,je,bt);if(Sm(this.layoutVertexArray,Dt.x,Dt.y,pi,Si,0,0,gn),Sm(this.layoutVertexArray,Dt.x,Dt.y,pi,Si,0,1,gn),this.wallMode){const ie=K(ct-1,it),se=ee.joinNormals[ct-1];Em(this.wallVertexArray,se,ie),Em(this.wallVertexArray,se,ie)}if(ri+=yi,gn=xS(ri,sn,!bt),je=sn,Sm(this.layoutVertexArray,Lt.x,Lt.y,pi,Si,0,0,gn),Sm(this.layoutVertexArray,Lt.x,Lt.y,pi,Si,0,1,gn),this.wallMode){const ie=K(ct,it),se=ee.joinNormals[ct];Em(this.wallVertexArray,se,ie),Em(this.wallVertexArray,se,ie)}if(Je.vertexLength+=4,this.indexArray.emplaceBack(gi+0,gi+1,gi+2),this.indexArray.emplaceBack(gi+1,gi+3,gi+2),Je.primitiveLength+=2,oe){const ie=qe+(ct===1?it.length-2:ct-2),se=ct===1?qe:ie+1;if(this.indexArray.emplaceBack(gi+1,ie,gi+3),this.indexArray.emplaceBack(ie,se,gi+3),Je.primitiveLength+=2,ht===void 0&&(ht=gi),!n1(Kt,it[ct],De)){const Ze=ct===it.length-1?ht:Je.vertexLength;this.indexArray.emplaceBack(gi+2,gi+3,Ze),this.indexArray.emplaceBack(gi+3,Ze+1,Ze),this.indexArray.emplaceBack(gi+3,se,Ze+1),Je.primitiveLength+=3}bt=!bt}if(M){const ie=this.layoutVertexExtArray,se=A.projectTilePoint(Dt.x,Dt.y,c),Ze=A.projectTilePoint(Lt.x,Lt.y,c),mt=A.upVector(c,Dt.x,Dt.y),St=A.upVector(c,Lt.x,Lt.y);Im(ie,se,mt),Im(ie,se,mt),Im(ie,Ze,St),Im(ie,Ze,St)}}L&&(qe+=it.length-1),$&&oe&&this.zoom>=17&&(ut.length!==0&&Se(ut,ut[0])&&ut.pop(),this.groundEffect.addData(ut,De,w,oe>0))}this.footprintSegments.push(lt),nt.triangleCount=this.indexArray.length-nt.triangleArrayOffset,this.polygonSegments.push(nt),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=k.borders?uS:this.encodeCentroid(k,F),this.centroidData.push(F),k.borders){this.featuresOnBorder.push(k);const Ae=this.featuresOnBorder.length-1;for(let De=0;De<k.borders.length;De++)k.borders[De][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[De].push(Ae)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,f,c,x),this.groundEffect.addPaintPropertiesData(e,a,d,f,c,x),this.maxHeight=Math.max(this.maxHeight,q)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let _=0;_<this.centroidData.length;_++){const x=this.centroidData[_],w=+(x.min.y+x.max.y>vt),E=2*w+(+(x.min.x+x.max.x>vt)^w);for(let A=0;A<x.polygonSegLen;A++){const M=x.polygonSegIdx+A;e.push({centroidIdx:_,subtile:E,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const i=new vr;e.sort((_,x)=>_.triangleSegmentIdx===x.triangleSegmentIdx?_.subtile-x.subtile:_.triangleSegmentIdx-x.triangleSegmentIdx);let a=0,c=0,d=0;for(const _ of e){if(_.triangleSegmentIdx!==a)break;d++}const f=e.length;for(;c!==e.length;){a=e[c].triangleSegmentIdx;let _=0,x=c,w=c;for(let E=x;E<d&&e[E].subtile===_;E++)w++;for(;x!==d;){const E=e[x];_=E.subtile;const A=this.centroidData[E.centroidIdx].min.clone(),M=this.centroidData[E.centroidIdx].max.clone(),L={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let k=x;k<w;k++){const F=e[k],$=this.polygonSegments[F.polygonSegmentIdx],q=this.centroidData[F.centroidIdx].min,ee=this.centroidData[F.centroidIdx].max,K=this.indexArray.uint16;for(let B=$.triangleArrayOffset;B<$.triangleArrayOffset+$.triangleCount;B++)i.emplaceBack(K[3*B],K[3*B+1],K[3*B+2]);L.primitiveLength+=$.triangleCount,A.x=Math.min(A.x,q.x),A.y=Math.min(A.y,q.y),M.x=Math.max(M.x,ee.x),M.y=Math.max(M.y,ee.y)}L.primitiveLength>0&&this.triangleSubSegments.push({segment:L,min:A,max:M}),x=w;for(let k=x;k<d&&e[k].subtile===e[x].subtile;k++)w++}c=d;for(let E=c;E<f&&e[E].triangleSegmentIdx===e[c].triangleSegmentIdx;E++)d++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,a){const c=new kn;if(this.wallMode){for(const F of this.triangleSubSegments)c.segments.push(F.segment);return c}let d=0,f=0;const _=1<<e.canonical.z;if(i){const F=i.getMinMaxForTile(e);F&&(d=F.min,f=F.max)}f+=this.maxHeight;const x=e.toUnwrapped();let w;const E=[x.canonical.x/_+x.wrap,x.canonical.y/_],A=[(x.canonical.x+1)/_+x.wrap,(x.canonical.y+1)/_],M=(F,$,q)=>[F[0]*(1-q[0])+$[0]*q[0],F[1]*(1-q[1])+$[1]*q[1]],L=[],k=[];for(const F of this.triangleSubSegments){L[0]=F.min.x/vt,L[1]=F.min.y/vt,k[0]=F.max.x/vt,k[1]=F.max.y/vt;const $=M(E,A,L),q=M(E,A,k);if(new An([$[0],$[1],d],[q[0],q[1],f]).intersectsPrecise(a)===0){w&&(c.segments.push(w),w=void 0);continue}const ee=F.segment;w&&w.vertexOffset!==ee.vertexOffset&&(c.segments.push(w),w=void 0),w?(w.vertexLength+=ee.vertexLength,w.primitiveLength+=ee.primitiveLength):w={vertexOffset:ee.vertexOffset,primitiveLength:ee.primitiveLength,vertexLength:ee.vertexLength,primitiveOffset:ee.primitiveOffset,sortKey:void 0,vaos:{}}}return w&&c.segments.push(w),c}encodeCentroid(e,i){const a=e.centroid(),c=i.span(),d=Math.min(7,Math.round(c.x*this.tileToMeter/10)),f=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new gt(Me(a.x,1,vt-1)<<3|d,Me(a.y,1,vt-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new gt(0,0);const i=e.borders,a=Number.MAX_VALUE;if(i[0][0]!==a||i[1][0]!==a){const c=i[0][0]!==a?0:1;return new gt(6|(i[0][0]!==a?0:65528),(i[c][0]+i[c][1])/2<<3|6)}{const c=i[2][0]!==a?2:3;return new gt((i[c][0]+i[c][1])/2<<3|6,6|(i[2][0]!==a?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=jc,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,c=e.flags&jc?uS:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==c.y||d!==c.x){for(let f=i;f<a;++f)this.centroidVertexArray.emplace(f,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(e.toUnwrapped());if(e1(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const d=[];for(const f of this.activeReplacements){if(f.order<a)continue;const _=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const x of this.centroidData)if(!(x.flags&jc||f.min.x>x.max.x||x.min.x>f.max.x||f.min.y>x.max.y||x.min.y>f.max.y))for(let w=0;w<x.footprintSegLen;w++){const E=this.footprintSegments[x.footprintSegIdx+w];if(d.length=0,bL(this.footprintVertices,E.vertexOffset,E.vertexCount,f.footprintTileId.canonical,e.canonical,d),oS(f.footprint,d,this.footprintIndices.uint16,E.indexOffset,E.indexCount,-E.vertexOffset,-_)){x.flags|=jc;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,a){let c=!1;for(let d=0;d<a.footprintSegLen;d++){const f=this.footprintSegments[a.footprintSegIdx+d];let _=0;for(const x of f.ringIndices){for(let w=_,E=x+_-1;w<x+_;E=w++){const A=this.footprintVertices.int16[2*(w+f.vertexOffset)+0],M=this.footprintVertices.int16[2*(w+f.vertexOffset)+1],L=this.footprintVertices.int16[2*(E+f.vertexOffset)+1];M>i!=L>i&&e<(this.footprintVertices.int16[2*(E+f.vertexOffset)+0]-A)*(i-M)/(L-M)+A&&(c=!c)}_=x}}return c}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,c=!0;const d=4*(e+vt)*vt+(i+vt);if(this.partLookup.hasOwnProperty(d)){const f=this.partLookup[d];return f?{height:f.height,hidden:!!(f.flags&jc)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||i>f.max.y||f.min.y>i||this.footprintContainsPoint(e,i,f)&&f&&f.height>a&&(a=f.height,this.partLookup[d]=f,c=!!(f.flags&jc));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.partLookup[d]=void 0}}function gS(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function xL(n,e,i,a){const c=e.sub(n)._perp()._unit(),d=i.sub(e)._perp()._unit();return _S(n,e,i,gS(c,d),a)}function _S(n,e,i,a,c){const d=Math.sqrt(1-a*a);return Math.min(n.dist(e)/3,e.dist(i)/3,c*d/a)}function n1(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function yS(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function vS(n,e,i){if(n.x<0||n.x>=vt||e.x<0||e.x>=vt||i.x<0||i.x>=vt)return!1;const a=i.sub(e),c=a.perp(),d=n.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&c.x*d.x+c.y*d.y<0}function xS(n,e,i){const a=e?2|n:-3&n;return i?1|a:-2&a}function bS(){const n=Math.PI/32,e=Math.tan(n),i=N;return i*Math.sqrt(1+2*e*e)-i}function wS(n,e,i){const a=1<<i.z,c=ye(i.x/a),d=ye((i.x+1)/a),f=be(i.y/a),_=be((i.y+1)/a);return function(x,w,E,A,M=0,L){const k=[];if(!x.length||!E||!A)return k;const F=(J,oe)=>{for(const _e of J)k.push({polygon:_e,bounds:oe})},$=Math.ceil(Math.log2(E)),q=Math.ceil(Math.log2(A)),ee=$-q,K=[];for(let J=0;J<Math.abs(ee);J++)K.push(ee>0?0:1);for(let J=0;J<Math.min($,q);J++)K.push(0),K.push(1);let B=x;if(B=vy(B,w[0].y-M,w[1].y+M,1),B=vy(B,w[0].x-M,w[1].x+M,0),!B.length)return k;const Z=[];for(K.length?Z.push({polygons:B,bounds:w,depth:0}):F(B,w);Z.length;){const J=Z.pop(),oe=J.depth,_e=K[oe],Se=J.bounds[0],Ae=J.bounds[1],De=_e===0?Se.x:Se.y,qe=_e===0?Ae.x:Ae.y,rt=L?L(_e,De,qe):.5*(De+qe),Je=vy(J.polygons,De-M,rt+M,_e),nt=vy(J.polygons,rt-M,qe+M,_e);if(Je.length){const lt=[Se,new gt(_e===0?rt:Ae.x,_e===1?rt:Ae.y)];K.length>oe+1?Z.push({polygons:Je,bounds:lt,depth:oe+1}):F(Je,lt)}if(nt.length){const lt=[new gt(_e===0?rt:Se.x,_e===1?rt:Se.y),Ae];K.length>oe+1?Z.push({polygons:nt,bounds:lt,depth:oe+1}):F(nt,lt)}}return k}(n,e,Math.ceil((d-c)/11.25),Math.ceil((f-_)/11.25),1,(x,w,E)=>{if(x===0)return .5*(w+E);{const A=be((i.y+w/vt)/a);return(fe(.5*(be((i.y+E/vt)/a)+A))*a-i.y)*vt}})}function bL(n,e,i,a,c,d){const f=Math.pow(2,a.z-c.z);for(let _=0;_<i;_++){let x=n.int16[2*(_+e)+0],w=n.int16[2*(_+e)+1];x=(x+c.x*vt)*f-a.x*vt,w=(w+c.y*vt)*f-a.y*vt,d.push(new gt(x,w))}}let TS,SS;At(Ty,"FillExtrusionBucket",{omit:["layers","features"]}),At(dS,"PartData"),At(hS,"FootprintSegment"),At(fS,"BorderCentroidData"),At(mS,"GroundEffect");class vh extends gt{constructor(e,i,a){super(e,i),this.z=a}}class ES extends vh{constructor(e,i,a,c){super(e,i,a),this.w=c}}function IS(n,e,i,a){const c=i==="x"?"y":"x",d=(a-n[i])/(e[i]-n[i]);n[c]=Math.round(n[c]+(e[c]-n[c])*d),n[i]=a,n.hasOwnProperty("z")&&(n.z=qt(n.z,e.z,d)),n.hasOwnProperty("w")&&(n.w=qt(n.w,e.w,d))}function AS(n,e,i,a){const c=i,d=a;for(const f of["x","y"]){let _=n,x=e;_[f]>=x[f]&&(_=e,x=n),_[f]<c&&x[f]>c&&IS(_,x,f,c),_[f]<d&&x[f]>d&&IS(x,_,f,d)}}function Sy(n,e,i,a,c,d){const f=[];for(let _=0;_<n.length;_++){const x=n[_];let w;const E=f.length;let A=0;for(let M=0;M<x.length-1;M++){let L=x[M],k=x[M+1],F=0;const $=A;let q,ee;d&&(F=Math.hypot(k.x-L.x,k.y-L.y),A+=F,q=L,ee=k),L.x<e&&k.x<e||(L.x<e?L=new gt(e,L.y+(e-L.x)/(k.x-L.x)*(k.y-L.y))._round():k.x<e&&(k=new gt(e,L.y+(e-L.x)/(k.x-L.x)*(k.y-L.y))._round()),L.y<i&&k.y<i||(L.y<i?L=new gt(L.x+(i-L.y)/(k.y-L.y)*(k.x-L.x),i)._round():k.y<i&&(k=new gt(L.x+(i-L.y)/(k.y-L.y)*(k.x-L.x),i)._round()),L.x>=a&&k.x>=a||(L.x>=a?L=new gt(a,L.y+(a-L.x)/(k.x-L.x)*(k.y-L.y))._round():k.x>=a&&(k=new gt(a,L.y+(a-L.x)/(k.x-L.x)*(k.y-L.y))._round()),L.y>=c&&k.y>=c||(L.y>=c?L=new gt(L.x+(c-L.y)/(k.y-L.y)*(k.x-L.x),c)._round():k.y>=c&&(k=new gt(L.x+(c-L.y)/(k.y-L.y)*(k.x-L.x),c)._round()),w&&L.equals(w[w.length-1])||(w=[L],f.push(w),d&&d.push({progress:{min:$+CS(q,ee,L)*F,max:1},parentIndex:_,prevPoint:q,nextPoint:ee})),w.push(k),d&&(d[d.length-1].progress.max=$+CS(q,ee,k)*F,d[d.length-1].nextPoint=ee)))))}if(d&&A>0)for(let M=E;M<f.length;M++)d[M].progress.min/=A,d[M].progress.max/=A}return f}function wL(n,e,i,a,c){if(n.length<2)return void a.push(n);const d=[];for(;e.valid();){const[w,E]=e.get();for(let A=0;A<n.length-1;A++){const M=n[A],L=n[A+1],k=Dn(M,L,w,E);if(k){const[F]=k,$=new gt(qt(M.x,L.x,F),qt(M.y,L.y,F));d.push({t:A+F,distance:0,point:$})}}e.next()}if(d.length===0)return void a.push(n);d.sort((w,E)=>w.t-E.t);let f=0,_=0,x=[];for(a.push(x);f!==n.length;){if(_===d.length){for(;f!==n.length;)x.length!==0&&x[x.length-1].equals(n[f])||x.push(n[f]),f++;break}d[_].t<=f?(x.length!==0&&x[x.length-1].equals(d[_].point)||x.push(d[_].point),Math.trunc(d[_].t),_++):(x.length!==0&&x[x.length-1].equals(n[f])||x.push(n[f]),f++)}}function CS(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function Am(n,e){return n.x*e.x+n.y*e.y}function MS(n,e){if(n.length===1){let i=0;const a=e[i++];let c;for(;!c||a.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const d=e[i],f=n[0],_=c.sub(a),x=d.sub(a),w=f.sub(a),E=Am(_,_),A=Am(_,x),M=Am(x,x),L=Am(w,_),k=Am(w,x),F=E*M-A*A,$=(M*L-A*k)/F,q=(E*k-A*L)/F,ee=a.z*(1-$-q)+c.z*$+d.z*q;if(isFinite(ee))return ee}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function PS(n,e,i,a,c,d,f,_){const x=f*c.getElevationAt(n,e,!0,!0),w=d[0]!==0,E=w?d[1]===0?f*(d[0]/7-450):f*function(A,M,L){const k=Math.floor(M[0]/8),F=Math.floor(M[1]/8),$=10*(M[0]-8*k),q=10*(M[1]-8*F),ee=A.getElevationAt(k,F,!0,!0),K=A.getMeterToDEM(L),B=Math.floor(.5*($*K-1)),Z=Math.floor(.5*(q*K-1)),J=A.tileCoordToPixel(k,F),oe=2*B+1,_e=2*Z+1,Se=function(nt,lt,$e,it,je){return[nt.getElevationAtPixel(lt,$e,!0),nt.getElevationAtPixel(lt+je,$e,!0),nt.getElevationAtPixel(lt,$e+je,!0),nt.getElevationAtPixel(lt+it,$e+je,!0)]}(A,J.x-B,J.y-Z,oe,_e),Ae=Math.abs(Se[0]-Se[1]),De=Math.abs(Se[2]-Se[3]),qe=Math.abs(Se[0]-Se[2])+Math.abs(Se[1]-Se[3]),rt=Math.min(.25,.5*K*(Ae+De)/oe),Je=Math.min(.25,.5*K*qe/_e);return ee+Math.max(rt*$,Je*q)}(c,d,_):x;return{base:x+(i===0?-1:i),top:w?Math.max(E+a,x+i+2):x+a}}const TL=Gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),SL=Gi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:EL}=TL,IL=Gi([{name:"a_packed",components:3,type:"Float32"}]),{members:AL}=IL,CL=Gi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:ML}=CL;class RS{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Bc({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=Ot(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const c=[];let d=e.length%2==1?-e[e.length-1]*a:0,f=e[0]*a,_=!0;c.push({left:d,right:f,isDash:_,zeroLength:e[0]===0});let x=e[0];for(let w=1;w<e.length;w++){_=!_;const E=e[w];d=x*a,x+=E,f=x*a,c.push({left:d,right:f,isDash:_,zeroLength:E===0})}return c}addRoundDash(e,i,a){const c=i/2;for(let d=-a;d<=a;d++){const f=this.width*(this.nextRow+a+d);let _=0,x=e[_];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++_]);const E=Math.abs(w-x.left),A=Math.abs(w-x.right),M=Math.min(E,A);let L;const k=d/a*(c+1);if(x.isDash){const F=c-Math.abs(k);L=Math.sqrt(M*M+F*F)}else L=c-Math.sqrt(M*M+k*k);this.image.data[f+w]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,i){for(let x=e.length-1;x>=0;--x){const w=e[x],E=e[x+1];w.zeroLength?e.splice(x,1):E&&E.isDash===w.isDash&&(E.left=w.left,e.splice(x,1))}const a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const d=this.width*this.nextRow;let f=0,_=e[f];for(let x=0;x<this.width;x++){x/_.right>1&&(_=e[++f]);const w=Math.abs(x-_.left),E=Math.abs(x-_.right),A=Math.min(w,E);this.image.data[d+x]=Math.max(0,Math.min(255,(_.isDash?A:-A)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const c=i==="round",d=c?7:0,f=2*d+1;if(this.nextRow+f>this.height)return Ci("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let E=0;E<e.length;E++)e[E]<0&&(Ci("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),_+=e[E];if(_!==0){const E=this.width/_,A=this.getDashRanges(e,this.width,E);c?this.addRoundDash(A,E,d):this.addRegularDash(A,i==="square"?.5*E:0)}const x=this.nextRow+d;this.nextRow+=f;const w={tl:[x,d],br:[_,0]};return this.positions[a]=w,w}}At(RS,"LineAtlas");const PL=Nc.VectorTileFeature.types,RL=Math.cos(Math.PI/180*37.5),zL=Math.cos(Math.PI/180*5);class r1{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new om,this.layoutVertexArray2=new Vs,this.patternVertexArray=new Vs,this.indexArray=new vr,this.programConfigurations=new Bl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new kn,this.maxLineLength=0,this.zOffsetVertexArray=new Vs,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:vt/64}updateFootprints(e,i){}populate(e,i,a,c){this.hasPattern=Ux("line",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ke(a);const f=this.layers[0].layout.get("line-elevation-reference");if(f==="hd-road-markup")this.elevationType="road";else{const M=this.layers[0].layout.get("line-z-offset"),L=M.isConstant()&&!M.constantOr(0);this.elevationType=f!=="sea"&&f!=="ground"&&L?"none":"offset",this.elevationType==="offset"&&f==="none"&&Ci(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const _=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&_!==void 0;const x=[];for(const{feature:M,id:L,index:k,sourceLayerIndex:F}of e){const $=this.layers[0]._featureFilter.needGeometry,q=Nt(M,$);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),q,a))continue;const ee=d?d.evaluate(q,{},a):void 0,K={id:L,properties:M.properties,type:M.type,sourceLayerIndex:F,index:k,geometry:$?q.geometry:Pt(M,a,c),patterns:{},sortKey:ee};x.push(K)}d&&x.sort((M,L)=>M.sortKey-L.sortKey);const{lineAtlas:w,featureIndex:E}=i,A=this.addConstantDashes(w);for(const M of x){const{geometry:L,index:k,sourceLayerIndex:F}=M;if(A&&this.addFeatureDashes(M,w),this.hasPattern){const $=Gx("line",this.layers,M,this.zoom,this.pixelRatio,i);this.patternFeatures.push($)}else this.addFeature(M,L,k,a,w.positions,i.availableImages,i.brightness,i.elevationFeatures);E.insert(e[k].feature,L,k,F,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(c.kind!=="constant"||d.kind!=="constant")i=!0;else{const f=d.value,_=c.value;if(!_)continue;e.addDash(_,f)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,f=c.layout.get("line-cap").value;if(d.kind==="constant"&&f.kind==="constant")continue;let _,x;if(d.kind==="constant"){if(_=d.value,!_)continue}else _=d.evaluate({zoom:a},e);x=f.kind==="constant"?f.value:f.evaluate({zoom:a},e),i.addDash(_,x),e.patterns[c.id]=[i.getKey(_,x)]}}update(e,i,a,c,d,f,_){this.programConfigurations.updatePaintArrays(e,i,d,a,c,f,_)}addFeatures(e,i,a,c,d,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,a,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,AL)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,ML)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,SL.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,EL),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,a,c,d,f,_,x){const w=this.layers[0].layout,E=w.get("line-join").evaluate(e,{}),A=w.get("line-cap").evaluate(e,{}),M=w.get("line-miter-limit"),L=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=w.get("line-z-offset").value;const k=this.layers[0].paint.get("line-width").value;if(k.kind!=="constant"&&k.isLineProgressConstant===!1&&(this.variableWidthValue=k),this.elevationType==="road"){const F=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,c,x,E,A,M,L)){const[$,q]=this.clipRuntimeLinesToTile(i,1);for(let ee=0;ee<$.length;ee++){const K=$[ee],B=q[ee],Z={progress:{min:B.progress.min,max:B.progress.max},nextDir:this.computeSegNextDir(B,K),prevDir:this.computeSegPrevDir(B,K)};this.addLine(K,e,c,E,A,M,L,Z)}this.fillNonElevatedRoadSegment(F)}}else for(const F of i)this.addLine(F,e,c,E,A,M,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,f,c,_)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return Sy(e,-i,-i,vt+i,vt+i)}clipRuntimeLinesToTile(e,i){const a=[];return[Sy(e,-i,-i,vt+i,vt+i,a),a]}addElevatedRoadFeature(e,i,a,c,d,f,_,x){const w=[],E=Zx.getElevationFeature(e,c);if(E){const A=this.clipLinesToTile(i,1),M=this.prepareElevatedLines(A,E,a);for(const L of M)w.push({geometry:L,elevation:E,elevationTileID:a,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(w.length===0)return!1;for(const A of w){const M=this.layoutVertexArray.length;this.addLine(A.geometry,e,a,d,f,_,x);const L=new H2(a,A.elevationTileID);if(A.elevation)for(let k=M;k<this.layoutVertexArray.length;k++){const F=new gt(this.layoutVertexArray.int16[6*k]>>1,this.layoutVertexArray.int16[6*k+1]>>1),$=L.pointElevation(F,A.elevation,.05);this.updateHeightRange($),this.zOffsetVertexArray.emplaceBack($,0,0)}else this.fillNonElevatedRoadSegment(M)}return!0}prepareElevatedLines(e,i,a){if(i.constantHeight!=null)return e;const c=[],d=1/ke(a);for(const f of e)wL(f,new $2(i,d),0,c);return c}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,a,c,d,f,_,x){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const w=c==="none";this.patternJoinNone=this.hasPattern&&w,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const E=x&&x.progress.min>0,A=x&&x.progress.max<1;if(this.lineClips){let _e={min:this.lineClips.start,max:this.lineClips.end},Se=1;if(x){const qe=this.lineClips.end-this.lineClips.start;_e=function(rt,Je,nt){return{min:Ar(rt.min,Je,nt),max:Ar(rt.max,Je,nt)}}(x.progress,{min:0,max:1},_e),qe>0&&(Se=(_e.max-_e.min)/qe)}const Ae=+i.properties.mapbox_clip_feature_len,De=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Ae)||Number.isNaN(De)){for(let rt=0;rt<e.length-1;rt++)this.totalDistance+=e[rt].dist(e[rt+1]);const qe=this.totalDistance/(_e.max-_e.min);this.totalFeatureLength=Number.isFinite(qe)?qe:0,this.lineClips.start=_e.min,this.lineClips.end=_e.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ae,this.distance=De*Se,this.lineClips.start=_e.min,this.lineClips.end=_e.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const M=PL[i.type]==="Polygon";let L=e.length;for(;L>=2&&e[L-1].equals(e[L-2]);)L--;let k=0;for(;k<L-1&&e[k].equals(e[k+1]);)k++;if(L<(M?3:2))return;c==="bevel"&&(f=1.05);const F=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let $,q,ee,K,B,Z,J,oe;x&&x.prevDir&&(Z=x.prevDir.perp()),x&&x.nextDir&&(J=x.nextDir.perp()),this.e1=this.e2=-1,M&&($=e[L-2],B=e[k].sub($)._unit()._perp());for(let _e=k;_e<L;_e++){if(ee=_e===L-1?M?e[k+1]:void 0:e[_e+1],ee&&e[_e].equals(ee))continue;B&&(K=B),$&&(q=$),$=e[_e],oe=this.evaluateLineProgressFeatures(q?q.dist($):0),B=ee?ee.sub($)._unit()._perp():K,K=K||B;const Se=q&&ee;let Ae=Se?c:M||w?"butt":d;const De=K.x*B.x+K.y*B.y;if(w){const je=function(He){if(He.patternJoinNone){const ut=He.segmentPoints.length/2,ht=He.lineSoFar-He.segmentStart;for(let Ft=0;Ft<ut;++Ft){const Mt=He.segmentPoints[2*Ft+1],bt=Math.round(He.segmentPoints[2*Ft])+.5+.25*Mt;He.patternVertexArray.emplaceBack(bt,ht,He.segmentStart),He.patternVertexArray.emplaceBack(bt,ht,He.segmentStart)}He.segmentPoints.length=0}He.e1=He.e2=-1};if(Se&&De<zL){this.updateDistance(q,$),this.addCurrentVertex($,K,1,1,F,oe),je(this),this.addCurrentVertex($,B,-1,-1,F,oe);continue}if(q){if(!ee){this.updateDistance(q,$),this.addCurrentVertex($,K,1,1,F,oe),je(this);continue}Ae="miter"}}let qe=K.add(B);qe.x===0&&qe.y===0||qe._unit();const rt=qe.x*B.x+qe.y*B.y,Je=rt!==0?1/rt:1/0,nt=2*Math.sqrt(2-2*rt),lt=rt<RL&&q&&ee,$e=K.x*B.y-K.y*B.x>0,it=this.overscaling<=16?15*vt/(512*this.overscaling):0;if(Se&&Ae==="round"){if(Je<_)Ae="miter";else if(Je<=2){const je=o1($,-10,vt+10);Ae=this.elevationType==="offset"&&(je||this.hasCrossSlope)?"miter":"fakeround"}}if(Ae==="miter"&&Je>f&&(Ae="bevel"),Ae==="bevel"&&(Je>2&&(Ae="flipbevel"),Je<f&&(Ae="miter")),q&&!(Ae==="miter"&&lt)&&this.updateDistance(q,$),Ae==="miter")if(lt){const je=$.dist(q);if(je>2*it){const ut=$.sub($.sub(q)._mult(it/je)._round());this.updateDistance(q,ut),this.addCurrentVertex(ut,K,0,0,F,oe),q=ut}this.updateDistance(q,$),qe._mult(Je),this.addCurrentVertex($,qe,0,0,F,oe);const He=$.dist(ee);if(He>2*it){const ut=$.add(ee.sub($)._mult(it/He)._round());this.updateDistance($,ut),this.addCurrentVertex(ut,B,0,0,F,oe),$=ut}}else qe._mult(Je),this.addCurrentVertex($,qe,0,0,F,oe);else if(Ae==="flipbevel"){if(Je>100)qe=B.mult(-1);else{const je=Je*K.add(B).mag()/K.sub(B).mag();qe._perp()._mult(je*($e?-1:1))}this.addCurrentVertex($,qe,0,0,F,oe),this.addCurrentVertex($,qe.mult(-1),0,0,F,oe)}else if(Ae==="bevel"||Ae==="fakeround"){oe!=null&&q&&this.addCurrentVertex($,J||K,-1,-1,F,oe);const je=$.dist(q)<=2*it&&Ae!=="bevel",He=qe.mult($e?1:-1);He._mult(Je);const ut=B.mult($e?-1:1),ht=K.mult($e?-1:1),Ft=this.evaluateLineProgressFeatures(this.distance);if(oe==null&&(this.addHalfVertex($,He.x,He.y,!1,!$e,0,F,Ft),je||this.addHalfVertex($,He.x+2*ht.x,He.y+2*ht.y,!1,$e,0,F,Ft)),Ae==="fakeround"){const Mt=Math.round(180*nt/Math.PI/20);this.addHalfVertex($,ht.x,ht.y,!1,$e,0,F,Ft);for(let bt=0;bt<Mt;bt++){let ct=bt/Mt;if(ct!==.5){const Dt=ct-.5;ct+=ct*Dt*(ct-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*Dt*Dt+(.848013+De*(.215638*De-1.06021)))}const ri=ut.sub(ht)._mult(ct)._add(ht)._unit();this.addHalfVertex($,ri.x,ri.y,!1,$e,0,F,Ft)}this.addHalfVertex($,ut.x,ut.y,!1,$e,0,F,Ft)}je||oe!=null||this.addHalfVertex($,He.x+2*ut.x,He.y+2*ut.y,!1,$e,0,F,Ft),oe!=null&&ee&&this.addCurrentVertex($,Z||B,1,1,F,oe)}else if(Ae==="butt")this.addCurrentVertex($,qe,0,0,F,oe);else if(Ae==="square"){if(!q){const je=E?0:-1;this.addCurrentVertex($,qe,je,je,F,oe)}if(this.addCurrentVertex($,qe,0,0,F,oe),q){const je=A?0:1;this.addCurrentVertex($,qe,je,je,F,oe)}}else if(Ae==="round"){if(q){const je=!Se&&J?J:K;this.addCurrentVertex($,je,0,0,F,oe),!Se&&A||this.addCurrentVertex($,je,1,1,F,oe,!0)}if(ee){const je=!Se&&Z?Z:B;!Se&&E||this.addCurrentVertex($,je,-1,-1,F,oe,!0),this.addCurrentVertex($,je,0,0,F,oe)}}}}addVerticesTo(e,i,a,c,d,f,_,x,w,E){const A=(i.w-e.w)/this.tessellationStep|0;let M=0;const L=this.scaledDistance;if(A>1){this.lineSoFar=e.w;const F=(i.x-e.x)/A,$=(i.y-e.y)/A,q=(i.z-e.z)/A,ee=(i.w-e.w)/A;for(let K=1;K<A;++K){e.x+=F,e.y+=$,e.z+=q,this.lineSoFar+=ee,M+=ee;const B=this.evaluateLineProgressFeatures(this.prevDistance+M);this.scaledDistance=(this.prevDistance+M)/this.totalDistance,this.addHalfVertex(e,a,c,E,!1,_,w,B),this.addHalfVertex(e,d,f,E,!0,-x,w,B)}}this.lineSoFar=i.w,this.scaledDistance=L;const k=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,a,c,E,!1,_,w,k),this.addHalfVertex(i,d,f,E,!0,-x,w,k)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Ci(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,a,c,d,f,_=!1){const x=i.x+i.y*a,w=i.y-i.x*a,E=i.y*c-i.x,A=-i.y-i.x*c;if(f!=null){const M=this.elevationType==="offset",L=-10,k=vt+10,F=f.zOffset,$=new ES(e.x,e.y,F,this.lineSoFar),q=!!M&&o1(e,L,k),ee=this.lineSoFar,K=this.distance;if(this.currentVertex)if(q){const B=this.currentVertexIsOutside,Z=this.currentVertex,J=new ES(e.x,e.y,F,this.lineSoFar);if(AS(Z,J,L,k),!o1(J,L,k)){if(B){this.e1=this.e2=-1,this.distance-=Z.dist($),this.lineSoFar=Z.w;const oe=this.evaluateLineProgressFeatures(Z.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Z,x,w,_,!1,a,d,oe),this.addHalfVertex(Z,E,A,_,!0,-c,d,oe),this.prevDistance=this.distance}this.distance=this.prevDistance+Z.dist(J),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Z,J,x,w,E,A,a,c,d,_),this.distance=K,this.scaledDistance=this.distance/this.totalDistance}}else{const B=this.currentVertex;if(this.currentVertexIsOutside){AS(B,$,L,k),this.e1=this.e2=-1,this.distance-=B.dist($),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=B.w;const Z=this.evaluateLineProgressFeatures(B.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(B,x,w,_,!1,a,d,Z),this.addHalfVertex(B,E,A,_,!0,-c,d,Z),this.prevDistance=this.distance,this.distance=K,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(B,$,x,w,E,A,a,c,d,_)}else q||(this.addHalfVertex(e,x,w,_,!1,a,d,f),this.addHalfVertex(e,E,A,_,!0,-c,d,f));this.currentVertex=$,this.currentVertexIsOutside=q,this.lineSoFar=ee}else this.addHalfVertex(e,x,w,_,!1,a,d,f),this.addHalfVertex(e,E,A,_,!0,-c,d,f)}addHalfVertex({x:e,y:i},a,c,d,f,_,x,w){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,_)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const A=qt(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,A)}const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),x.primitiveLength++),f?this.e2=E:this.e1=E,w!=null&&this.zOffsetVertexArray.emplaceBack(w.zOffset,w.variableWidth,w.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function o1(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let zS,DS;function LS(n,e,i){return e*(vt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}At(r1,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const kS=(n,e,i)=>(1-i)*n+i*e;function OS(n,e){return 1/LS(n,1,e.tileZoom)}function FS(n,e,i,a){return n.translatePosMatrix(a||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const BS=n=>{const e=[];NS(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=n.layout.get("line-join").constantOr("miter")==="none",c=!!n.paint.get("line-pattern").constantOr(1);return a&&c&&e.push("LINE_JOIN_NONE"),e};function NS(n){const e=n.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let s1;const jS=()=>s1||(s1={layout:zS||(zS=new Hn({"line-cap":new It(Oe.layout_line["line-cap"]),"line-join":new It(Oe.layout_line["line-join"]),"line-miter-limit":new pt(Oe.layout_line["line-miter-limit"]),"line-round-limit":new pt(Oe.layout_line["line-round-limit"]),"line-sort-key":new It(Oe.layout_line["line-sort-key"]),"line-z-offset":new It(Oe.layout_line["line-z-offset"]),"line-elevation-reference":new pt(Oe.layout_line["line-elevation-reference"]),"line-cross-slope":new pt(Oe.layout_line["line-cross-slope"]),visibility:new pt(Oe.layout_line.visibility),"line-width-unit":new pt(Oe.layout_line["line-width-unit"])})),paint:DS||(DS=new Hn({"line-opacity":new It(Oe.paint_line["line-opacity"]),"line-color":new It(Oe.paint_line["line-color"]),"line-translate":new pt(Oe.paint_line["line-translate"]),"line-translate-anchor":new pt(Oe.paint_line["line-translate-anchor"]),"line-width":new It(Oe.paint_line["line-width"]),"line-gap-width":new It(Oe.paint_line["line-gap-width"]),"line-offset":new It(Oe.paint_line["line-offset"]),"line-blur":new It(Oe.paint_line["line-blur"]),"line-dasharray":new It(Oe.paint_line["line-dasharray"]),"line-pattern":new It(Oe.paint_line["line-pattern"]),"line-pattern-cross-fade":new pt(Oe.paint_line["line-pattern-cross-fade"]),"line-gradient":new Dl(Oe.paint_line["line-gradient"]),"line-trim-offset":new pt(Oe.paint_line["line-trim-offset"]),"line-trim-fade-range":new pt(Oe.paint_line["line-trim-fade-range"]),"line-trim-color":new pt(Oe.paint_line["line-trim-color"]),"line-emissive-strength":new pt(Oe.paint_line["line-emissive-strength"]),"line-border-width":new It(Oe.paint_line["line-border-width"]),"line-border-color":new It(Oe.paint_line["line-border-color"]),"line-occlusion-opacity":new pt(Oe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},s1);class DL extends It{possiblyEvaluate(e,i){return i=new en(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,a,c){return i=Ne({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,a,c)}}let Cm;function VS(n,e){return e>0?e+2*n:n}const LL=Gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kL=Gi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),OL=Gi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const FL=Gi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),BL=Gi([{name:"a_texb",components:2,type:"Uint16"}]),NL=Gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),jL=Gi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Gi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const US=Gi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),VL=Gi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Gi([{name:"triangle",components:3,type:"Uint16"}]),Gi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Gi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Gi([{type:"Float32",name:"offsetX"}]),Gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Mr=24;function UL(n,e,i){return n.sections.forEach(a=>{a.text=function(c,d,f){const _=d.layout.get("text-transform").evaluate(f,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),is.applyArabicShaping&&(c=is.applyArabicShaping(c)),c}(a.text,e,i)}),n}const Mm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function GL(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function $L(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}var GS,a1,$S,l1={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function HL(){return GS||(GS=1,l1.read=function(n,e,i,a,c){var d,f,_=8*c-a-1,x=(1<<_)-1,w=x>>1,E=-7,A=i?c-1:0,M=i?-1:1,L=n[e+A];for(A+=M,d=L&(1<<-E)-1,L>>=-E,E+=_;E>0;d=256*d+n[e+A],A+=M,E-=8);for(f=d&(1<<-E)-1,d>>=-E,E+=a;E>0;f=256*f+n[e+A],A+=M,E-=8);if(d===0)d=1-w;else{if(d===x)return f?NaN:1/0*(L?-1:1);f+=Math.pow(2,a),d-=w}return(L?-1:1)*f*Math.pow(2,d-a)},l1.write=function(n,e,i,a,c,d){var f,_,x,w=8*d-c-1,E=(1<<w)-1,A=E>>1,M=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=a?0:d-1,k=a?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,f=E):(f=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-f))<1&&(f--,x*=2),(e+=f+A>=1?M/x:M*Math.pow(2,1-A))*x>=2&&(f++,x/=2),f+A>=E?(_=0,f=E):f+A>=1?(_=(e*x-1)*Math.pow(2,c),f+=A):(_=e*Math.pow(2,A-1)*Math.pow(2,c),f=0));c>=8;n[i+L]=255&_,L+=k,_/=256,c-=8);for(f=f<<c|_,w+=c;w>0;n[i+L]=255&f,L+=k,f/=256,w-=8);n[i+L-k]|=128*F}),l1}function HS(){if($S)return a1;$S=1,a1=e;var n=HL();function e(B){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(B)?B:new Uint8Array(B||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,a=1/i,c=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function d(B){return B.type===e.Bytes?B.readVarint()+B.pos:B.pos+1}function f(B,Z,J){return J?4294967296*Z+(B>>>0):4294967296*(Z>>>0)+(B>>>0)}function _(B,Z,J){var oe=Z<=16383?1:Z<=2097151?2:Z<=268435455?3:Math.floor(Math.log(Z)/(7*Math.LN2));J.realloc(oe);for(var _e=J.pos-1;_e>=B;_e--)J.buf[_e+oe]=J.buf[_e]}function x(B,Z){for(var J=0;J<B.length;J++)Z.writeVarint(B[J])}function w(B,Z){for(var J=0;J<B.length;J++)Z.writeSVarint(B[J])}function E(B,Z){for(var J=0;J<B.length;J++)Z.writeFloat(B[J])}function A(B,Z){for(var J=0;J<B.length;J++)Z.writeDouble(B[J])}function M(B,Z){for(var J=0;J<B.length;J++)Z.writeBoolean(B[J])}function L(B,Z){for(var J=0;J<B.length;J++)Z.writeFixed32(B[J])}function k(B,Z){for(var J=0;J<B.length;J++)Z.writeSFixed32(B[J])}function F(B,Z){for(var J=0;J<B.length;J++)Z.writeFixed64(B[J])}function $(B,Z){for(var J=0;J<B.length;J++)Z.writeSFixed64(B[J])}function q(B,Z){return(B[Z]|B[Z+1]<<8|B[Z+2]<<16)+16777216*B[Z+3]}function ee(B,Z,J){B[J]=Z,B[J+1]=Z>>>8,B[J+2]=Z>>>16,B[J+3]=Z>>>24}function K(B,Z){return(B[Z]|B[Z+1]<<8|B[Z+2]<<16)+(B[Z+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(B,Z,J){for(J=J||this.length;this.pos<J;){var oe=this.readVarint(),_e=oe>>3,Se=this.pos;this.type=7&oe,B(_e,Z,this),this.pos===Se&&this.skip(oe)}return Z},readMessage:function(B,Z){return this.readFields(B,Z,this.readVarint()+this.pos)},readFixed32:function(){var B=q(this.buf,this.pos);return this.pos+=4,B},readSFixed32:function(){var B=K(this.buf,this.pos);return this.pos+=4,B},readFixed64:function(){var B=q(this.buf,this.pos)+q(this.buf,this.pos+4)*i;return this.pos+=8,B},readSFixed64:function(){var B=q(this.buf,this.pos)+K(this.buf,this.pos+4)*i;return this.pos+=8,B},readFloat:function(){var B=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,B},readDouble:function(){var B=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,B},readVarint:function(B){var Z,J,oe=this.buf;return Z=127&(J=oe[this.pos++]),J<128?Z:(Z|=(127&(J=oe[this.pos++]))<<7,J<128?Z:(Z|=(127&(J=oe[this.pos++]))<<14,J<128?Z:(Z|=(127&(J=oe[this.pos++]))<<21,J<128?Z:function(_e,Se,Ae){var De,qe,rt=Ae.buf;if(De=(112&(qe=rt[Ae.pos++]))>>4,qe<128||(De|=(127&(qe=rt[Ae.pos++]))<<3,qe<128)||(De|=(127&(qe=rt[Ae.pos++]))<<10,qe<128)||(De|=(127&(qe=rt[Ae.pos++]))<<17,qe<128)||(De|=(127&(qe=rt[Ae.pos++]))<<24,qe<128)||(De|=(1&(qe=rt[Ae.pos++]))<<31,qe<128))return f(_e,De,Se);throw new Error("Expected varint not more than 10 bytes")}(Z|=(15&(J=oe[this.pos]))<<28,B,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var B=this.readVarint();return B%2==1?(B+1)/-2:B/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var B=this.readVarint()+this.pos,Z=this.pos;return this.pos=B,B-Z>=12&&c?function(J,oe,_e){return c.decode(J.subarray(oe,_e))}(this.buf,Z,B):function(J,oe,_e){for(var Se="",Ae=oe;Ae<_e;){var De,qe,rt,Je=J[Ae],nt=null,lt=Je>239?4:Je>223?3:Je>191?2:1;if(Ae+lt>_e)break;lt===1?Je<128&&(nt=Je):lt===2?(192&(De=J[Ae+1]))==128&&(nt=(31&Je)<<6|63&De)<=127&&(nt=null):lt===3?(qe=J[Ae+2],(192&(De=J[Ae+1]))==128&&(192&qe)==128&&((nt=(15&Je)<<12|(63&De)<<6|63&qe)<=2047||nt>=55296&&nt<=57343)&&(nt=null)):lt===4&&(qe=J[Ae+2],rt=J[Ae+3],(192&(De=J[Ae+1]))==128&&(192&qe)==128&&(192&rt)==128&&((nt=(15&Je)<<18|(63&De)<<12|(63&qe)<<6|63&rt)<=65535||nt>=1114112)&&(nt=null)),nt===null?(nt=65533,lt=1):nt>65535&&(nt-=65536,Se+=String.fromCharCode(nt>>>10&1023|55296),nt=56320|1023&nt),Se+=String.fromCharCode(nt),Ae+=lt}return Se}(this.buf,Z,B)},readBytes:function(){var B=this.readVarint()+this.pos,Z=this.buf.subarray(this.pos,B);return this.pos=B,Z},readPackedVarint:function(B,Z){if(this.type!==e.Bytes)return B.push(this.readVarint(Z));var J=d(this);for(B=B||[];this.pos<J;)B.push(this.readVarint(Z));return B},readPackedSVarint:function(B){if(this.type!==e.Bytes)return B.push(this.readSVarint());var Z=d(this);for(B=B||[];this.pos<Z;)B.push(this.readSVarint());return B},readPackedBoolean:function(B){if(this.type!==e.Bytes)return B.push(this.readBoolean());var Z=d(this);for(B=B||[];this.pos<Z;)B.push(this.readBoolean());return B},readPackedFloat:function(B){if(this.type!==e.Bytes)return B.push(this.readFloat());var Z=d(this);for(B=B||[];this.pos<Z;)B.push(this.readFloat());return B},readPackedDouble:function(B){if(this.type!==e.Bytes)return B.push(this.readDouble());var Z=d(this);for(B=B||[];this.pos<Z;)B.push(this.readDouble());return B},readPackedFixed32:function(B){if(this.type!==e.Bytes)return B.push(this.readFixed32());var Z=d(this);for(B=B||[];this.pos<Z;)B.push(this.readFixed32());return B},readPackedSFixed32:function(B){if(this.type!==e.Bytes)return B.push(this.readSFixed32());var Z=d(this);for(B=B||[];this.pos<Z;)B.push(this.readSFixed32());return B},readPackedFixed64:function(B){if(this.type!==e.Bytes)return B.push(this.readFixed64());var Z=d(this);for(B=B||[];this.pos<Z;)B.push(this.readFixed64());return B},readPackedSFixed64:function(B){if(this.type!==e.Bytes)return B.push(this.readSFixed64());var Z=d(this);for(B=B||[];this.pos<Z;)B.push(this.readSFixed64());return B},skip:function(B){var Z=7&B;if(Z===e.Varint)for(;this.buf[this.pos++]>127;);else if(Z===e.Bytes)this.pos=this.readVarint()+this.pos;else if(Z===e.Fixed32)this.pos+=4;else{if(Z!==e.Fixed64)throw new Error("Unimplemented type: "+Z);this.pos+=8}},writeTag:function(B,Z){this.writeVarint(B<<3|Z)},realloc:function(B){for(var Z=this.length||16;Z<this.pos+B;)Z*=2;if(Z!==this.length){var J=new Uint8Array(Z);J.set(this.buf),this.buf=J,this.length=Z}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(B){this.realloc(4),ee(this.buf,B,this.pos),this.pos+=4},writeSFixed32:function(B){this.realloc(4),ee(this.buf,B,this.pos),this.pos+=4},writeFixed64:function(B){this.realloc(8),ee(this.buf,-1&B,this.pos),ee(this.buf,Math.floor(B*a),this.pos+4),this.pos+=8},writeSFixed64:function(B){this.realloc(8),ee(this.buf,-1&B,this.pos),ee(this.buf,Math.floor(B*a),this.pos+4),this.pos+=8},writeVarint:function(B){(B=+B||0)>268435455||B<0?function(Z,J){var oe,_e;if(Z>=0?(oe=Z%4294967296|0,_e=Z/4294967296|0):(_e=~(-Z/4294967296),4294967295^(oe=~(-Z%4294967296))?oe=oe+1|0:(oe=0,_e=_e+1|0)),Z>=18446744073709552e3||Z<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");J.realloc(10),function(Se,Ae,De){De.buf[De.pos++]=127&Se|128,Se>>>=7,De.buf[De.pos++]=127&Se|128,Se>>>=7,De.buf[De.pos++]=127&Se|128,Se>>>=7,De.buf[De.pos++]=127&Se|128,De.buf[De.pos]=127&(Se>>>=7)}(oe,0,J),function(Se,Ae){var De=(7&Se)<<4;Ae.buf[Ae.pos++]|=De|((Se>>>=3)?128:0),Se&&(Ae.buf[Ae.pos++]=127&Se|((Se>>>=7)?128:0),Se&&(Ae.buf[Ae.pos++]=127&Se|((Se>>>=7)?128:0),Se&&(Ae.buf[Ae.pos++]=127&Se|((Se>>>=7)?128:0),Se&&(Ae.buf[Ae.pos++]=127&Se|((Se>>>=7)?128:0),Se&&(Ae.buf[Ae.pos++]=127&Se)))))}(_e,J)}(B,this):(this.realloc(4),this.buf[this.pos++]=127&B|(B>127?128:0),B<=127||(this.buf[this.pos++]=127&(B>>>=7)|(B>127?128:0),B<=127||(this.buf[this.pos++]=127&(B>>>=7)|(B>127?128:0),B<=127||(this.buf[this.pos++]=B>>>7&127))))},writeSVarint:function(B){this.writeVarint(B<0?2*-B-1:2*B)},writeBoolean:function(B){this.writeVarint(!!B)},writeString:function(B){B=String(B),this.realloc(4*B.length),this.pos++;var Z=this.pos;this.pos=function(oe,_e,Se){for(var Ae,De,qe=0;qe<_e.length;qe++){if((Ae=_e.charCodeAt(qe))>55295&&Ae<57344){if(!De){Ae>56319||qe+1===_e.length?(oe[Se++]=239,oe[Se++]=191,oe[Se++]=189):De=Ae;continue}if(Ae<56320){oe[Se++]=239,oe[Se++]=191,oe[Se++]=189,De=Ae;continue}Ae=De-55296<<10|Ae-56320|65536,De=null}else De&&(oe[Se++]=239,oe[Se++]=191,oe[Se++]=189,De=null);Ae<128?oe[Se++]=Ae:(Ae<2048?oe[Se++]=Ae>>6|192:(Ae<65536?oe[Se++]=Ae>>12|224:(oe[Se++]=Ae>>18|240,oe[Se++]=Ae>>12&63|128),oe[Se++]=Ae>>6&63|128),oe[Se++]=63&Ae|128)}return Se}(this.buf,B,this.pos);var J=this.pos-Z;J>=128&&_(Z,J,this),this.pos=Z-1,this.writeVarint(J),this.pos+=J},writeFloat:function(B){this.realloc(4),n.write(this.buf,B,this.pos,!0,23,4),this.pos+=4},writeDouble:function(B){this.realloc(8),n.write(this.buf,B,this.pos,!0,52,8),this.pos+=8},writeBytes:function(B){var Z=B.length;this.writeVarint(Z),this.realloc(Z);for(var J=0;J<Z;J++)this.buf[this.pos++]=B[J]},writeRawMessage:function(B,Z){this.pos++;var J=this.pos;B(Z,this);var oe=this.pos-J;oe>=128&&_(J,oe,this),this.pos=J-1,this.writeVarint(oe),this.pos+=oe},writeMessage:function(B,Z,J){this.writeTag(B,e.Bytes),this.writeRawMessage(Z,J)},writePackedVarint:function(B,Z){Z.length&&this.writeMessage(B,x,Z)},writePackedSVarint:function(B,Z){Z.length&&this.writeMessage(B,w,Z)},writePackedBoolean:function(B,Z){Z.length&&this.writeMessage(B,M,Z)},writePackedFloat:function(B,Z){Z.length&&this.writeMessage(B,E,Z)},writePackedDouble:function(B,Z){Z.length&&this.writeMessage(B,A,Z)},writePackedFixed32:function(B,Z){Z.length&&this.writeMessage(B,L,Z)},writePackedSFixed32:function(B,Z){Z.length&&this.writeMessage(B,k,Z)},writePackedFixed64:function(B,Z){Z.length&&this.writeMessage(B,F,Z)},writePackedSFixed64:function(B,Z){Z.length&&this.writeMessage(B,$,Z)},writeBytesField:function(B,Z){this.writeTag(B,e.Bytes),this.writeBytes(Z)},writeFixed32Field:function(B,Z){this.writeTag(B,e.Fixed32),this.writeFixed32(Z)},writeSFixed32Field:function(B,Z){this.writeTag(B,e.Fixed32),this.writeSFixed32(Z)},writeFixed64Field:function(B,Z){this.writeTag(B,e.Fixed64),this.writeFixed64(Z)},writeSFixed64Field:function(B,Z){this.writeTag(B,e.Fixed64),this.writeSFixed64(Z)},writeVarintField:function(B,Z){this.writeTag(B,e.Varint),this.writeVarint(Z)},writeSVarintField:function(B,Z){this.writeTag(B,e.Varint),this.writeSVarint(Z)},writeStringField:function(B,Z){this.writeTag(B,e.Bytes),this.writeString(Z)},writeFloatField:function(B,Z){this.writeTag(B,e.Fixed32),this.writeFloat(Z)},writeDoubleField:function(B,Z){this.writeTag(B,e.Fixed64),this.writeDouble(Z)},writeBooleanField:function(B,Z){this.writeVarintField(B,!!Z)}},a1}var Ey=Sn(HS());const c1=3;function qL(n,e,i){e.glyphs=[],n===1&&i.readMessage(WL,e)}function WL(n,e,i){if(n===3){const{id:a,bitmap:c,width:d,height:f,left:_,top:x,advance:w}=i.readMessage(ZL,{});e.glyphs.push({id:a,bitmap:new Bc({width:d+2*c1,height:f+2*c1},c),metrics:{width:d,height:f,left:_,top:x,advance:w}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function ZL(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const qS=c1,jo={horizontal:1,vertical:2,horizontalOnly:3};class Pm{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const a=new Pm;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new Pm;return i.image=e,i}}class nf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,a){const c=new nf;for(let d=0;d<e.sections.length;d++){const f=e.sections[d];f.image?c.addImageSection(f,a):c.addTextSection(f,i)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,a){let c="";for(let d=0;d<i.length;d++){const f=i.charCodeAt(d+1)||null,_=i.charCodeAt(d-1)||null;c+=!a&&(f&&V_(f)&&!Mm[i[d+1]]||_&&V_(_)&&!Mm[i[d-1]])||!Mm[i[d]]?i[d]:Mm[i[d]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&Iy[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Iy[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new nf;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Pm.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e,i){const a=e.image?e.image.getPrimary():null;if(!a)return void Ci("Can't add FormattedSection with an empty image.");a.scaleSelf(i);const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(Pm.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Ci("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function u1(n,e,i,a,c,d,f,_,x,w,E,A,M,L,k,F=1){const $=nf.fromFeature(n,c,F);A===jo.vertical&&$.verticalizePunctuation(M);let q=[];const ee=function(oe,_e,Se,Ae,De,qe){if(!oe)return[];const rt=[],Je=function(it,je,He,ut,ht,Ft){let Mt=0;for(let bt=0;bt<it.length();bt++){const ct=it.getSection(bt);Mt+=WS(it.getCodePoint(bt),ct,ut,ht,je,Ft)}return Mt/Math.max(1,Math.ceil(Mt/He))}(oe,_e,Se,Ae,De,qe),nt=oe.text.indexOf("")>=0;let lt=0;for(let it=0;it<oe.length();it++){const je=oe.getSection(it),He=oe.getCodePoint(it);if(Iy[He]||(lt+=WS(He,je,Ae,De,_e,qe)),it<oe.length()-1){const ut=!(($e=He)<11904||!(Wt["Bopomofo Extended"]($e)||Wt.Bopomofo($e)||Wt["CJK Compatibility Forms"]($e)||Wt["CJK Compatibility Ideographs"]($e)||Wt["CJK Compatibility"]($e)||Wt["CJK Radicals Supplement"]($e)||Wt["CJK Strokes"]($e)||Wt["CJK Symbols and Punctuation"]($e)||Wt["CJK Unified Ideographs Extension A"]($e)||Wt["CJK Unified Ideographs"]($e)||Wt["Enclosed CJK Letters and Months"]($e)||Wt["Halfwidth and Fullwidth Forms"]($e)||Wt.Hiragana($e)||Wt["Ideographic Description Characters"]($e)||Wt["Kangxi Radicals"]($e)||Wt["Katakana Phonetic Extensions"]($e)||Wt.Katakana($e)||Wt["Vertical Forms"]($e)||Wt["Yi Radicals"]($e)||Wt["Yi Syllables"]($e)));(XL[He]||ut||je.image)&&rt.push(XS(it+1,lt,Je,rt,YL(He,oe.getCodePoint(it+1),ut&&nt),!1))}}var $e;return YS(XS(oe.length(),lt,Je,rt,0,!0))}($,w,d,e,a,L),{processBidirectionalText:K,processStyledBidirectionalText:B}=is;if(K&&$.sections.length===1){const oe=K($.toString(),ee);for(const _e of oe){const Se=new nf;Se.text=_e,Se.sections=$.sections;for(let Ae=0;Ae<_e.length;Ae++)Se.sectionIndex.push(0);q.push(Se)}}else if(B){const oe=B($.text,$.sectionIndex,ee);for(const _e of oe){const Se=new nf;Se.text=_e[0],Se.sectionIndex=_e[1],Se.sections=$.sections,q.push(Se)}}else q=function(oe,_e){const Se=[],Ae=oe.text;let De=0;for(const qe of _e)Se.push(oe.substring(De,qe)),De=qe;return De<Ae.length&&Se.push(oe.substring(De,Ae.length)),Se}($,ee);const Z=[],J={positionedLines:Z,text:$.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(oe,_e,Se,Ae,De,qe,rt,Je,nt,lt,$e,it){let je=0,He=0,ut=0;const ht=Je==="right"?1:Je==="left"?0:.5;let Ft=!1;for(const Lt of De){const Kt=Lt.getSections();for(const di of Kt){if(di.image)continue;const pi=_e[di.fontStack];if(pi&&(Ft=pi.ascender!==void 0&&pi.descender!==void 0,!Ft))break}if(!Ft)break}let Mt=0;for(const Lt of De){Lt.trim();const Kt=Lt.getMaxScale(),di=(Kt-1)*Mr,pi={positionedGlyphs:[],lineOffset:0};oe.positionedLines[Mt]=pi;const Si=pi.positionedGlyphs;let yi=0;if(!Lt.length()){He+=qe,++Mt;continue}let gi=0,sn=0;for(let ie=0;ie<Lt.length();ie++){const se=Lt.getSection(ie),Ze=Lt.getSectionIndex(ie),mt=Lt.getCodePoint(ie);let St=se.scale,Tt=null,kt=null,Yt=null,Ri=Mr,zi=0;nt===jo.vertical&&((bt=mt)===12312||bt===12313||bt===12316||bt===12540||bt===12448)&&(nt=jo.horizontal);const _i=!(nt===jo.horizontal||!$e&&!th(mt)||$e&&(Iy[mt]||wx(mt)));if(se.image){const Ki=Ae.get(se.image.toString());if(!Ki)continue;Yt=se.image,oe.iconsInText=oe.iconsInText||!0,kt=Ki.paddedRect;const un=Ki.displaySize;St=St*Mr/it,Tt={width:un[0],height:un[1],left:0,top:-qS,advance:_i?un[1]:un[0],localGlyph:!1},zi=Ft?-Tt.height*St:Kt*Mr-17-un[1]*St,Ri=Tt.advance;const Di=(_i?un[0]:un[1])*St-Mr*Kt;Di>0&&Di>yi&&(yi=Di)}else{const Ki=Se[se.fontStack];if(!Ki)continue;Ki[mt]&&(kt=Ki[mt]);const un=_e[se.fontStack];if(!un)continue;const Di=un.glyphs[mt];if(!Di)continue;if(Tt=Di.metrics,Ri=mt!==8203?Mr:0,Ft){const On=un.ascender!==void 0?Math.abs(un.ascender):0,_n=un.descender!==void 0?Math.abs(un.descender):0,Zi=(On+_n)*St;gi<Zi&&(gi=Zi,sn=(On-_n)/2*St),zi=-On*St}else zi=(Kt-St)*Mr-17}_i?(oe.verticalizable=!0,Si.push({glyph:mt,image:Yt,x:je,y:He+zi,vertical:_i,scale:St,localGlyph:Tt.localGlyph,fontStack:se.fontStack,sectionIndex:Ze,metrics:Tt,rect:kt}),je+=Ri*St+lt):(Si.push({glyph:mt,image:Yt,x:je,y:He+zi,vertical:_i,scale:St,localGlyph:Tt.localGlyph,fontStack:se.fontStack,sectionIndex:Ze,metrics:Tt,rect:kt}),je+=Tt.advance*St+lt)}Si.length!==0&&(ut=Math.max(je-lt,ut),Ft?KS(Si,ht,yi,sn,qe*Kt/2):KS(Si,ht,yi,0,qe/2)),je=0;const gn=qe*Kt+yi;pi.lineOffset=Math.max(yi,di),He+=gn,++Mt}var bt;const ct=He,{horizontalAlign:ri,verticalAlign:Dt}=h1(rt);(function(Lt,Kt,di,pi,Si,yi){const gi=(Kt-di)*Si,sn=-yi*pi;for(const gn of Lt)for(const ie of gn.positionedGlyphs)ie.x+=gi,ie.y+=sn})(oe.positionedLines,ht,ri,Dt,ut,ct),oe.top+=-Dt*ct,oe.bottom=oe.top+ct,oe.left+=-ri*ut,oe.right=oe.left+ut,oe.hasBaseline=Ft}(J,e,i,a,q,f,_,x,A,w,M,k),!function(oe){for(const _e of oe)if(_e.positionedGlyphs.length!==0)return!1;return!0}(Z))return J}const Iy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},XL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function WS(n,e,i,a,c,d){if(e.image){const f=a.get(e.image.toString());return f?f.displaySize[0]*e.scale*Mr/d+c:0}{const f=i[e.fontStack],_=f&&f.glyphs[n];return _?_.metrics.advance*e.scale+c:0}}function ZS(n,e,i,a){const c=Math.pow(n-e,2);return a?n<e?c/2:2*c:c+Math.abs(i)*i}function YL(n,e,i){let a=0;return n===10&&(a-=1e4),i&&(a+=150),n!==40&&n!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function XS(n,e,i,a,c,d){let f=null,_=ZS(e,i,c,d);for(const x of a){const w=ZS(e-x.x,i,c,d)+x.badness;w<=_&&(f=x,_=w)}return{index:n,x:e,priorBreak:f,badness:_}}function YS(n){return n?YS(n.priorBreak).concat(n.index):[]}function h1(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function KS(n,e,i,a,c){if(!(e||i||a||c))return;const d=n.length-1,f=n[d],_=(f.x+f.metrics.advance*f.scale)*e;for(let x=0;x<=d;x++)n[x].x-=_,n[x].y+=i+a+c}function QS(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function KL(n,e,i,a){const{horizontalAlign:c,verticalAlign:d}=h1(a),f=i[0]-n.displaySize[0]*c,_=i[1]-n.displaySize[1]*d;return{imagePrimary:n,imageSecondary:e,top:_,bottom:_+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function JS(n,e,i,a,c,d){const f=n.imagePrimary;let _;if(f.content){const $=f.content,q=f.pixelRatio||1;_=[$[0]/q,$[1]/q,f.displaySize[0]-$[2]/q,f.displaySize[1]-$[3]/q]}const x=e.left*d,w=e.right*d;let E,A,M,L;i==="width"||i==="both"?(L=c[0]+x-a[3],A=c[0]+w+a[1]):(L=c[0]+(x+w-f.displaySize[0])/2,A=L+f.displaySize[0]);const k=e.top*d,F=e.bottom*d;return i==="height"||i==="both"?(E=c[1]+k-a[0],M=c[1]+F+a[2]):(E=c[1]+(k+F-f.displaySize[1])/2,M=E+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:E,right:A,bottom:M,left:L,collisionPadding:_}}function eE(n){return!n.imagePrimary.stretchX}function tE(n){return!n.imagePrimary.stretchY}function iE(n){return{width:n.right-n.left,height:n.bottom-n.top}}const Qa=128;function nE(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new en(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:c}=i;let d=0;for(;d<a.length&&a[d]<=n;)d++;d=Math.max(0,d-1);let f=d;for(;f<a.length&&a[f]<n+1;)f++;f=Math.min(a.length-1,f);const _=a[d],x=a[f];return i.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:x,minSize:i.evaluate(new en(_)),maxSize:i.evaluate(new en(x)),interpolationType:c}}}function d1(n,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:c}){return n.kind==="source"?a/Qa:n.kind==="composite"?qt(a/Qa,c/Qa,i):e}function Rm(n,e,i=1){let a=0,c=0;if(n.kind==="constant")c=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:d,minZoom:f,maxZoom:_}=n,x=d?Me(_o.interpolationFactor(d,e,f,_),0,1):0;n.kind==="camera"?c=qt(n.minSize,n.maxSize,x)*i:a=x*i}return{uSizeT:a,uSize:c}}class Vl extends gt{constructor(e,i,a,c,d){super(e,i),this.angle=c,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new Vl(this.x,this.y,this.z,this.angle,this.segment)}}function rE(n,e,i,a,c){if(e.segment===void 0)return!0;let d=e,f=e.segment+1,_=0;for(;_>-i/2;){if(f--,f<0)return!1;_-=n[f].dist(d),d=n[f]}_+=n[f].dist(n[f+1]),f++;const x=[];let w=0;for(;_<i/2;){const E=n[f],A=n[f+1];if(!A)return!1;let M=n[f-1].angleTo(E)-E.angleTo(A);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:M}),w+=M;_-x[0].distance>a;)w-=x.shift().angleDelta;if(w>c)return!1;f++,_+=E.dist(A)}return!0}function oE(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function sE(n,e,i){return n?.6*e*i:0}function aE(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function QL(n,e,i,a,c,d){const f=sE(i,c,d),_=aE(i,a)*d;let x=0;const w=oE(n)/2;for(let E=0;E<n.length-1;E++){const A=n[E],M=n[E+1],L=A.dist(M);if(x+L>w){const k=(w-x)/L,F=qt(A.x,M.x,k),$=qt(A.y,M.y,k),q=new Vl(F,$,0,M.angleTo(A),E);return!f||rE(n,q,_,f,e)?q:void 0}x+=L}}function JL(n,e,i,a,c,d,f,_,x){const w=sE(a,d,f),E=aE(a,c),A=E*f,M=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-A<e/4&&(e=A+e/4),lE(n,M?e/2*_%e:(E/2+2*d)*f*_%e,e,w,i,A,M,!1,x)}function lE(n,e,i,a,c,d,f,_,x){const w=d/2,E=oE(n);let A=0,M=e-i,L=[];for(let k=0;k<n.length-1;k++){const F=n[k],$=n[k+1],q=F.dist($),ee=$.angleTo(F);for(;M+i<A+q;){M+=i;const K=(M-A)/q,B=qt(F.x,$.x,K),Z=qt(F.y,$.y,K);if(B>=0&&B<x&&Z>=0&&Z<x&&M-w>=0&&M+w<=E){const J=new Vl(B,Z,0,ee,k);a&&!rE(n,J,d,a,c)||L.push(J)}}A+=q}return _||L.length||f||(L=lE(n,A/2,i,a,c,d,f,!0,x)),L}function cE(n){let e=0,i=0;for(const f of n)e+=f.w*f.h,i=Math.max(i,f.w);n.sort((f,_)=>_.h-f.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,d=0;for(const f of n)for(let _=a.length-1;_>=0;_--){const x=a[_];if(!(f.w>x.w||f.h>x.h)){if(f.x=x.x,f.y=x.y,d=Math.max(d,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===x.w&&f.h===x.h){const w=a.pop();_<a.length&&(a[_]=w)}else f.h===x.h?(x.x+=f.w,x.w-=f.w):f.w===x.w?(x.y+=f.h,x.h-=f.h):(a.push({x:x.x+f.w,y:x.y,w:x.w-f.w,h:f.h}),x.y+=f.h,x.h-=f.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}At(Vl,"Anchor");const xh=1;class zm{static getImagePositionScale(e,i,a){if(i&&e&&e.options&&e.options.transform){const c=e.options.transform;return{x:c.a,y:c.d}}return{x:a,y:a}}constructor(e,i,a,c){this.paddedRect=e;const{pixelRatio:d,version:f,stretchX:_,stretchY:x,content:w,sdf:E,usvg:A}=i;this.pixelRatio=d,this.stretchX=_,this.stretchY=x,this.content=w,this.version=f,this.padding=a,this.sdf=E,this.scale=zm.getImagePositionScale(c,A,d)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function f1(n,e,i){const a=_s.parse(n),c=function(d,f,_=[1,1]){return{x:0,y:0,w:(d.data?d.data.width:d.width*_[0])+2*f,h:(d.data?d.data.height:d.height*_[1])+2*f}}(e,i,[a.options.transform.a,a.options.transform.d]);return{bin:c,imagePosition:new zm(c,e,i,a),imageVariant:a}}class uE{constructor(e,i,a){const c=new Map,d=new Map;this.haveRenderCallbacks=[];const f=[];this.addImages(e,c,xh,f),this.addImages(i,d,2,f);const{w:_,h:x}=cE(f),w=new Br({width:_||1,height:x||1});for(const[E,A]of e.entries()){const M=c.get(E).paddedRect;Br.copy(A.data,w,{x:0,y:0},{x:M.x+xh,y:M.y+xh},A.data,a,A.sdf)}for(const[E,A]of i.entries()){const M=d.get(E),L=M.paddedRect;let k=M.padding;const F=L.x+k,$=L.y+k,q=A.data.width,ee=A.data.height;k=k>1?k-1:k,Br.copy(A.data,w,{x:0,y:0},{x:F,y:$},A.data,a),Br.copy(A.data,w,{x:0,y:ee-k},{x:F,y:$-k},{width:q,height:k},a),Br.copy(A.data,w,{x:0,y:0},{x:F,y:$+ee},{width:q,height:k},a),Br.copy(A.data,w,{x:q-k,y:0},{x:F-k,y:$},{width:k,height:ee},a),Br.copy(A.data,w,{x:0,y:0},{x:F+q,y:$},{width:k,height:ee},a),Br.copy(A.data,w,{x:q-k,y:ee-k},{x:F-k,y:$-k},{width:k,height:k},a),Br.copy(A.data,w,{x:0,y:ee-k},{x:F+q,y:$-k},{width:k,height:k},a),Br.copy(A.data,w,{x:0,y:0},{x:F+q,y:$+ee},{width:k,height:k},a),Br.copy(A.data,w,{x:q-k,y:0},{x:F-k,y:$+ee},{width:k,height:k},a)}this.lut=a,this.image=w,this.iconPositions=c,this.patternPositions=d}addImages(e,i,a,c){for(const[d,f]of e.entries()){const{bin:_,imagePosition:x,imageVariant:w}=f1(d,f,a);i.set(d,x),c.push(_),f.hasRenderCallback&&this.haveRenderCallbacks.push(w.id)}}patchUpdatedImages(e,i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const c of e.getUpdatedImages(a)){for(const d of this.iconPositions.keys()){const f=_s.parse(d);if(Eo.isEqual(f.id,c)){const _=e.getImage(c,a);this.patchUpdatedImage(this.iconPositions.get(d),_,i)}}for(const d of this.patternPositions.keys()){const f=_s.parse(d);if(Eo.isEqual(f.id,c)){const _=e.getImage(c,a);this.patchUpdatedImage(this.patternPositions.get(d),_,i)}}}}patchUpdatedImage(e,i,a){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,d]=e.tl,f=e.sdf;if(this.lut||f){const _={width:i.data.width,height:i.data.height},x=new Br(_);Br.copy(i.data,x,{x:0,y:0},{x:0,y:0},_,this.lut,f),a.update(x,{position:{x:c,y:d}})}else a.update(i.data,{position:{x:c,y:d}})}}At(zm,"ImagePosition"),At(uE,"ImageAtlas");const Dm=1e20;function hE(n,e,i,a,c,d,f,_,x){for(let w=e;w<e+a;w++)dE(n,i*d+w,d,c,f,_,x);for(let w=i;w<i+c;w++)dE(n,w*d+e,1,a,f,_,x)}function dE(n,e,i,a,c,d,f){d[0]=0,f[0]=-Dm,f[1]=Dm,c[0]=n[e];for(let _=1,x=0,w=0;_<a;_++){c[_]=n[e+_*i];const E=_*_;do{const A=d[x];w=(c[_]-c[A]+E-A*A)/(_-A)/2}while(w<=f[x]&&--x>-1);x++,d[x]=_,f[x]=w,f[x+1]=Dm}for(let _=0,x=0;_<a;_++){for(;f[x+1]<_;)x++;const w=d[x],E=_-w;n[e+_*i]=c[w]+E*E}}const ga=2,p1={none:0,ideographs:1,all:2};class rf{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,a){const c=[],d=this.urls[i]||Fr.GLYPHS_URL;for(const f in e)for(const _ of e[f])c.push({stack:f,id:_});Ye(c,({stack:f,id:_},x)=>{let w=this.entries[f];w||(w=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=w.glyphs[_];if(E!==void 0)return void x(null,{stack:f,id:_,glyph:E});if(E=this._tinySDF(w,f,_),E)return w.glyphs[_]=E,void x(null,{stack:f,id:_,glyph:E});const A=Math.floor(_/256);if(256*A>65535)return Ci("glyphs > 65535 not supported"),void x(null,{stack:f,id:_,glyph:E});if(w.ranges[A])return void x(null,{stack:f,id:_,glyph:E});let M=w.requests[A];M||(M=w.requests[A]=[],rf.loadGlyphRange(f,A,d,this.requestManager,(L,k)=>{if(k){w.ascender=k.ascender,w.descender=k.descender;for(const F in k.glyphs)this._doesCharSupportLocalGlyph(+F)||(w.glyphs[+F]=k.glyphs[+F]);w.ranges[A]=!0}for(const F of M)F(L,k);delete w.requests[A]})),M.push((L,k)=>{L?x(L):k&&x(null,{stack:f,id:_,glyph:k.glyphs[_]||null})})},(f,_)=>{if(f)a(f);else if(_){const x={};for(const{stack:w,id:E,glyph:A}of _)x[w]===void 0&&(x[w]={}),x[w].glyphs===void 0&&(x[w].glyphs={}),x[w].glyphs[E]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},x[w].ascender=this.entries[w].ascender,x[w].descender=this.entries[w].descender;a(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==p1.none&&(this.localGlyphMode===p1.all?!!this.localFontFamily:!!this.localFontFamily&&(Wt["CJK Unified Ideographs"](e)||Wt["Hangul Syllables"](e)||Wt.Hiragana(e)||Wt.Katakana(e)||Wt["CJK Symbols and Punctuation"](e)||Wt["CJK Unified Ideographs Extension A"](e)||Wt["CJK Unified Ideographs Extension B"](e)||Wt.Osage(e)))}_tinySDF(e,i,a){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let F="400";/bold/i.test(i)?F="900":/medium/i.test(i)?F="500":/light/i.test(i)&&(F="200"),d=e.tinySDF=new rf.TinySDF({fontFamily:c,fontWeight:F,fontSize:24*ga,buffer:3*ga,radius:8*ga}),d.fontWeight=F}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];const f=String.fromCodePoint(a),{data:_,width:x,height:w,glyphWidth:E,glyphHeight:A,glyphLeft:M,glyphTop:L,glyphAdvance:k}=d.draw(f);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new Bc({width:x,height:w},_),metrics:{width:E/ga,height:A/ga,left:M/ga,top:L/ga-27,advance:k/ga,localGlyph:!0}}}}rf.loadGlyphRange=function(n,e,i,a,c){const d=256*e,f=d+255,_=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${d}-${f}`),td.Glyphs);oc(_,(x,w)=>{if(x)c(x);else if(w){const E={},A=function(M){return new Ey(M).readFields(qL,{})}(w);for(const M of A.glyphs)E[M.id]=M;c(null,{glyphs:E,ascender:A.ascender,descender:A.descender})}})},rf.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=i;const _=this.size=n+4*e,x=this._createCanvas(_),w=this.ctx=x.getContext("2d",{willReadFrequently:!0});w.font=`${f} ${d} ${n}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(n),f=Math.ceil(i),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),x=Math.min(this.size-this.buffer,f+Math.ceil(a)),w=_+2*this.buffer,E=x+2*this.buffer,A=Math.max(w*E,0),M=new Uint8ClampedArray(A),L={data:M,width:w,height:E,glyphWidth:_,glyphHeight:x,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(_===0||x===0)return L;const{ctx:k,buffer:F,gridInner:$,gridOuter:q}=this;k.clearRect(F,F,_,x),k.fillText(n,F,F+f);const ee=k.getImageData(F,F,_,x);q.fill(Dm,0,A),$.fill(0,0,A);for(let K=0;K<x;K++)for(let B=0;B<_;B++){const Z=ee.data[4*(K*_+B)+3]/255;if(Z===0)continue;const J=(K+F)*w+B+F;if(Z===1)q[J]=0,$[J]=Dm;else{const oe=.5-Z;q[J]=oe>0?oe*oe:0,$[J]=oe<0?oe*oe:0}}hE(q,0,0,w,E,w,this.f,this.v,this.z),hE($,F,F,_,x,w,this.f,this.v,this.z);for(let K=0;K<A;K++){const B=Math.sqrt(q[K])-Math.sqrt($[K]);M[K]=Math.round(255-255*(B/this.radius+this.cutoff))}return L}};const Vc=xh;function fE(n,e){return n+e[1]-e[0]}function pE(n,e,i,a,c=1){const d=[],f=n.imagePrimary,_=f.pixelRatio,x=f.paddedRect.w-2*Vc,w=f.paddedRect.h-2*Vc,E=(n.right-n.left)*c,A=(n.bottom-n.top)*c,M=f.stretchX||[[0,x]],L=f.stretchY||[[0,w]],k=M.reduce(fE,0),F=L.reduce(fE,0),$=x-k,q=w-F;let ee=0,K=k,B=0,Z=F,J=0,oe=$,_e=0,Se=q;if(f.content&&a){const De=f.content;ee=Ay(M,0,De[0]),B=Ay(L,0,De[1]),K=Ay(M,De[0],De[2]),Z=Ay(L,De[1],De[3]),J=De[0]-ee,_e=De[1]-B,oe=De[2]-De[0]-K,Se=De[3]-De[1]-Z}const Ae=(De,qe,rt,Je)=>{const nt=Cy(De.stretch-ee,K,E,n.left*c),lt=My(De.fixed-J,oe,De.stretch,k),$e=Cy(qe.stretch-B,Z,A,n.top*c),it=My(qe.fixed-_e,Se,qe.stretch,F),je=Cy(rt.stretch-ee,K,E,n.left*c),He=My(rt.fixed-J,oe,rt.stretch,k),ut=Cy(Je.stretch-B,Z,A,n.top*c),ht=My(Je.fixed-_e,Se,Je.stretch,F),Ft=new gt(nt,$e),Mt=new gt(je,$e),bt=new gt(je,ut),ct=new gt(nt,ut),ri=new gt(lt/_,it/_),Dt=new gt(He/_,ht/_),Lt=e*Math.PI/180;if(Lt){const gi=Math.sin(Lt),sn=Math.cos(Lt),gn=[sn,-gi,gi,sn];Ft._matMult(gn),Mt._matMult(gn),ct._matMult(gn),bt._matMult(gn)}const Kt=De.stretch+De.fixed,di=rt.stretch+rt.fixed,pi=qe.stretch+qe.fixed,Si=Je.stretch+Je.fixed,yi=n.imageSecondary;return{tl:Ft,tr:Mt,bl:ct,br:bt,texPrimary:{x:f.paddedRect.x+Vc+Kt,y:f.paddedRect.y+Vc+pi,w:di-Kt,h:Si-pi},texSecondary:yi?{x:yi.paddedRect.x+Vc+Kt,y:yi.paddedRect.y+Vc+pi,w:di-Kt,h:Si-pi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ri,pixelOffsetBR:Dt,minFontScaleX:oe/_/E,minFontScaleY:Se/_/A,isSDF:i}};if(a&&(f.stretchX||f.stretchY)){const De=mE(M,$,k),qe=mE(L,q,F);for(let rt=0;rt<De.length-1;rt++){const Je=De[rt],nt=De[rt+1];for(let lt=0;lt<qe.length-1;lt++)d.push(Ae(Je,qe[lt],nt,qe[lt+1]))}}else d.push(Ae({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return d}function Ay(n,e,i){let a=0;for(const c of n)a+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return a}function mE(n,e,i){const a=[{fixed:-Vc,stretch:0}];for(const[c,d]of n){const f=a[a.length-1];a.push({fixed:c-f.stretch,stretch:f.stretch}),a.push({fixed:c-f.stretch,stretch:f.stretch+(d-c)})}return a.push({fixed:e+Vc,stretch:i}),a}function Cy(n,e,i,a){return n/e*i+a}function My(n,e,i,a){return n-e*i/a}function ek(n,e,i,a){const c=e+n.positionedLines[a].lineOffset;return a===0?i+c/2:i+(c+(e+n.positionedLines[a-1].lineOffset))/2}function tk(n,e=1,i=!1){let a=1/0,c=1/0,d=-1/0,f=-1/0;const _=n[0];for(let L=0;L<_.length;L++){const k=_[L];(!L||k.x<a)&&(a=k.x),(!L||k.y<c)&&(c=k.y),(!L||k.x>d)&&(d=k.x),(!L||k.y>f)&&(f=k.y)}const x=Math.min(d-a,f-c);let w=x/2;const E=new dd([],ik);if(x===0)return new gt(a,c);for(let L=a;L<d;L+=x)for(let k=c;k<f;k+=x)E.push(new of(L+w,k+w,w,n));let A=function(L){let k=0,F=0,$=0;const q=L[0];for(let ee=0,K=q.length,B=K-1;ee<K;B=ee++){const Z=q[ee],J=q[B],oe=Z.x*J.y-J.x*Z.y;F+=(Z.x+J.x)*oe,$+=(Z.y+J.y)*oe,k+=3*oe}return new of(F/k,$/k,0,L)}(n),M=E.length;for(;E.length;){const L=E.pop();(L.d>A.d||!A.d)&&(A=L,i&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,M)),L.max-A.d<=e||(w=L.h/2,E.push(new of(L.p.x-w,L.p.y-w,w,n)),E.push(new of(L.p.x+w,L.p.y-w,w,n)),E.push(new of(L.p.x-w,L.p.y+w,w,n)),E.push(new of(L.p.x+w,L.p.y+w,w,n)),M+=4)}return i&&(console.log(`num probes: ${M}`),console.log(`best distance: ${A.d}`)),A.p}function ik(n,e){return e.max-n.max}class of{constructor(e,i,a,c){this.p=new gt(e,i),this.h=a,this.d=function(d,f){let _=!1,x=1/0;for(let w=0;w<f.length;w++){const E=f[w];for(let A=0,M=E.length,L=M-1;A<M;L=A++){const k=E[A],F=E[L];k.y>d.y!=F.y>d.y&&d.x<(F.x-k.x)*(d.y-k.y)/(F.y-k.y)+k.x&&(_=!_),x=Math.min(x,ki(d,k,F))}}return(_?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const nk=Object.keys,m1=Number.POSITIVE_INFINITY,rk=Math.sqrt(2);function gE(n,[e,i]){let a=0,c=0;if(i===m1){e<0&&(e=0);const d=e/rk;switch(n){case"top-right":case"top-left":c=d-7;break;case"bottom-right":case"bottom-left":c=7-d;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(n){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":c=i-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-i}switch(n){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function Py(n,e,i,a,c,d,f,_,x){if(!e||!e.usvg)return;const w=iE(a),E=iE(c),A=d!=="both"&&d!=="width"||!eE(a)?1:Math.max(1,E.width/w.width),M=d!=="both"&&d!=="height"||!tE(a)?1:Math.max(1,E.height/w.height);i.scaleSelf(A,M);const L=i.toString();f.set(L,i),_.set(L,e);const{imagePosition:k}=f1(L,e,xh);x.set(L,k)}function _E(n,e,i,a,c,d,f,_){if(!n)return;const x=function(w,E,A,M,L){if(w.kind==="camera")return w.maxSize;if(w.kind==="composite"){const k=E.possiblyEvaluate(new en(w.maxZoom),A).evaluate(L,{},A),F=E.possiblyEvaluate(new en(w.minZoom),A).evaluate(L,{},A);return Math.max(k,F)}return E.possiblyEvaluate(new en(M)).evaluate(L,{},A)}(e,i,a,c,d);return n.scaleSelf(x*_*f)}function yE(n,e,i,a,c,d,f,_){return{iconPrimary:_E(n.getPrimary(),e,i,a,c,d,f,_),iconSecondary:_E(n.getSecondary(),e,i,a,c,d,f,_)}}function vE(n,e,i,a){if(!n)return;const c=e.get(i.toString());if(n.imagePrimary=c,a){const d=e.get(a.toString());n.imageSecondary=d}}function ok(n,e){for(const i in n.horizontal)xE(n.horizontal[i],e);xE(n.vertical,e)}function xE(n,e){if(n){for(const i of n.positionedLines)for(const a of i.positionedGlyphs)if(a.image!==null){const c=a.image.toString();a.rect=e.get(c).paddedRect}}}function g1(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sk(n,e,i,a,c,d,f,_,x){const w=_1(d.horizontal)||d.vertical,E=i.get("icon-text-fit-padding").evaluate(a,{},c);let A,M=e;return e&&x!=="none"&&(n.allowVerticalPlacement&&d.vertical&&(A=JS(e,d.vertical,x,E,_,f)),w&&(M=JS(e,w,x,E,_,f))),{defaultShapedIcon:M,verticallyShapedIcon:A}}function ak(n,e,i,a,c,d,f,_,x,w,E,A,M,L,k,F,$,q,ee,K){let B=f.textMaxSize.evaluate(e,{},M);B===void 0?B=_*f.textScaleFactor:B*=f.textScaleFactor;const Z=n.layers[0].layout,J=_1(i.horizontal)||i.vertical,oe=L.name==="globe",_e=Mr,Se=n.tilePixelRatio*B/_e,Ae=(lt=n.overscaling,n.zoom>18&&lt>2&&(lt>>=1),Math.max(vt/(512*lt),1)*Z.get("symbol-spacing")),De=Z.get("text-padding")*n.tilePixelRatio,qe=Z.get("icon-padding")*n.tilePixelRatio,rt=G(Z.get("text-max-angle")),Je=Z.get("icon-rotation-alignment")==="map"&&K!=="point",nt=Ae/2;var lt;n.hasAnyIconTextFit===!1&&$!=="none"&&(n.hasAnyIconTextFit=!0);const $e=e.properties?+e.properties[gh]:null,it=$e&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get($e):65535,je=(He,ut,ht)=>{if(ut.x<0||ut.x>=vt||ut.y<0||ut.y>=vt)return;let Ft=null;if(oe){const{x:Mt,y:bt,z:ct}=L.projectTilePoint(ut.x,ut.y,ht);Ft={anchor:new Vl(Mt,bt,ct,0,void 0),up:L.upVector(ht,ut.x,ut.y)}}(function(Mt,bt,ct,ri,Dt,Lt,Kt,di,pi,Si,yi,gi,sn,gn,ie,se,Ze,mt,St,Tt,kt,Yt,Ri,zi,_i,Ki,un,Di,On){const _n=Mt.addToLineVertexArray(bt,ri);let Zi,Wn,bn,hn,yn,Qi,wi,rn=0,Fn=0,Xt=0,Fi=0,wn=-1,Gn=-1;const Cn={};let ar=So("");const an=ct?ct.anchor:bt,rr=Di!=="none";let Co=0,Nr=0;if(pi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const lr=pi.layout.get("text-offset").evaluate(kt,{},_i);Co=lr[0]*Mr,Nr=lr[1]*Mr}else Co=pi.layout.get("text-radial-offset").evaluate(kt,{},_i)*Mr,Nr=m1;if(Mt.allowVerticalPlacement&&Dt.vertical){const lr=Dt.vertical;if(ie)Qi=y1(lr),di&&(wi=y1(di));else{const gr=pi.layout.get("text-rotate").evaluate(kt,{},_i)+90;bn=Ry(Si,an,bt,yi,gi,sn,lr,gn,gr,se),di&&(hn=Ry(Si,an,bt,yi,gi,sn,di,mt,gr))}}if(Lt){const lr=Mt.iconSizeData,gr=pi.layout.get("icon-rotate").evaluate(kt,{},_i),jr=pE(Lt,gr,Ri,rr,Yt.iconScaleFactor),co=di?pE(di,gr,Ri,rr,Yt.iconScaleFactor):void 0;Wn=Ry(Si,an,bt,yi,gi,sn,Lt,mt,gr,null),rn=4*jr.length;let Yr=null;lr.kind==="source"?(Yr=[Qa*pi.layout.get("icon-size").evaluate(kt,{},_i)*Yt.iconScaleFactor],Yr[0]>Uc&&Ci(`${Mt.layerIds[0]}: Value for "icon-size" is >= ${Lm}. Reduce your "icon-size".`)):lr.kind==="composite"&&(Yr=[Qa*Yt.compositeIconSizes[0].evaluate(kt,{},_i)*Yt.iconScaleFactor,Qa*Yt.compositeIconSizes[1].evaluate(kt,{},_i)*Yt.iconScaleFactor],(Yr[0]>Uc||Yr[1]>Uc)&&Ci(`${Mt.layerIds[0]}: Value for "icon-size" is >= ${Lm}. Reduce your "icon-size".`)),Mt.addSymbols(Mt.icon,jr,Yr,Tt,St,kt,void 0,ct,bt,_n.lineStartIndex,_n.lineLength,-1,zi,_i,Ki,un),wn=Mt.icon.placedSymbolArray.length-1,co&&(Fn=4*co.length,Mt.addSymbols(Mt.icon,co,Yr,Tt,St,kt,jo.vertical,ct,bt,_n.lineStartIndex,_n.lineLength,-1,zi,_i,Ki,un),Gn=Mt.icon.placedSymbolArray.length-1)}for(const lr in Dt.horizontal){const gr=lr,jr=Dt.horizontal[gr];Zi||(ar=So(jr.text),ie?yn=y1(jr):Zi=Ry(Si,an,bt,yi,gi,sn,jr,gn,pi.layout.get("text-rotate").evaluate(kt,{},_i),se));const co=jr.positionedLines.length===1;if(Xt+=bE(Mt,ct,bt,jr,Kt,pi,ie,kt,se,_n,Dt.vertical?jo.horizontal:jo.horizontalOnly,co?nk(Dt.horizontal):[gr],Cn,wn,Yt,zi,_i,Ki),co)break}Dt.vertical&&(Fi+=bE(Mt,ct,bt,Dt.vertical,Kt,pi,ie,kt,se,_n,jo.vertical,["vertical"],Cn,Gn,Yt,zi,_i,Ki));let Lr=-1;const Mo=(lr,gr)=>lr?Math.max(lr,gr):gr;Lr=Mo(yn,Lr),Lr=Mo(Qi,Lr),Lr=Mo(wi,Lr);const Ja=Lr>-1?1:0;Mt.glyphOffsetArray.length>=65535&&Ci("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),kt.sortKey!==void 0&&Mt.addToSortKeyRanges(Mt.symbolInstances.length,kt.sortKey),Mt.symbolInstances.emplaceBack(bt.x,bt.y,an.x,an.y,an.z,Cn.right>=0?Cn.right:-1,Cn.center>=0?Cn.center:-1,Cn.left>=0?Cn.left:-1,Cn.vertical>=0?Cn.vertical:-1,wn,Gn,ar,Zi!==void 0?Zi:Mt.collisionBoxArray.length,Zi!==void 0?Zi+1:Mt.collisionBoxArray.length,bn!==void 0?bn:Mt.collisionBoxArray.length,bn!==void 0?bn+1:Mt.collisionBoxArray.length,Wn!==void 0?Wn:Mt.collisionBoxArray.length,Wn!==void 0?Wn+1:Mt.collisionBoxArray.length,hn||Mt.collisionBoxArray.length,hn?hn+1:Mt.collisionBoxArray.length,yi,Xt,Fi,rn,Fn,Ja,0,Co,Nr,Lr,0,rr?1:0,On)})(n,ut,Ft,He,i,a,d,c,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,De,ee,w,0,qe,Je,q,e,f,E,A,M,k,F,$,it)};if(K==="line")for(const He of Sy(e.geometry,0,0,vt,vt)){const ut=JL(He,Ae,rt,i.vertical||J,a,_e,Se,n.overscaling,vt);for(const ht of ut)J&&lk(n,J.text,nt,ht)||je(He,ht,M)}else if(K==="line-center"){for(const He of e.geometry)if(He.length>1){const ut=QL(He,rt,i.vertical||J,a,_e,Se);ut&&je(He,ut,M)}}else if(e.type==="Polygon")for(const He of _y(e.geometry,0)){const ut=tk(He,16);je(He[0],new Vl(ut.x,ut.y,0,0,void 0),M)}else if(e.type==="LineString")for(const He of e.geometry)je(He,new Vl(He[0].x,He[0].y,0,0,void 0),M);else if(e.type==="Point")for(const He of e.geometry)for(const ut of He)je([ut],new Vl(ut.x,ut.y,0,0,void 0),M)}const Lm=255,Uc=Lm*Qa;function bE(n,e,i,a,c,d,f,_,x,w,E,A,M,L,k,F,$,q){const ee=function(Z,J,oe,_e,Se,Ae,De,qe){const rt=[];if(J.positionedLines.length===0)return rt;const Je=_e.layout.get("text-rotate").evaluate(Ae,{})*Math.PI/180,nt=function(He){const ut=He[0],ht=He[1],Ft=ut*ht;return Ft>0?[ut,-ht]:Ft<0?[-ut,ht]:ut===0?[ht,ut]:[ht,-ut]}(oe);let lt=Math.abs(J.top-J.bottom);for(const He of J.positionedLines)lt-=He.lineOffset;const $e=J.positionedLines.length,it=lt/$e;let je=J.top-oe[1];for(let He=0;He<$e;++He){const ut=J.positionedLines[He];je=ek(J,it,je,He);for(const ht of ut.positionedGlyphs){if(!ht.rect)continue;const Ft=ht.rect||{};let Mt=qS+1,bt=!0,ct=1,ri=0;if(ht.image){const kt=De.get(ht.image.toString());if(!kt)continue;if(kt.sdf){Ci("SDF images are not supported in formatted text and will be ignored.");continue}bt=!1,ct=kt.pixelRatio,Mt=xh/ct}const Dt=(Se||qe)&&ht.vertical,Lt=ht.metrics.advance*ht.scale/2,Kt=ht.metrics,di=ht.rect;if(di===null)continue;qe&&J.verticalizable&&(ri=ht.image?Lt-ht.metrics.width*ht.scale/2:0);const pi=Se?[ht.x+Lt,ht.y]:[0,0];let Si=[0,0],yi=[0,0],gi=!1;Se||(Dt?(yi=[ht.x+Lt+nt[0],ht.y+nt[1]-ri],gi=!0):Si=[ht.x+Lt+oe[0],ht.y+oe[1]-ri]);const sn=di.w*ht.scale/(ct*(ht.localGlyph?ga:1)),gn=di.h*ht.scale/(ct*(ht.localGlyph?ga:1));let ie,se,Ze,mt;if(Dt){const kt=ht.y-je,Yt=new gt(-Lt,Lt-kt),Ri=-Math.PI/2,zi=new gt(...yi);ie=new gt(-Lt+Si[0],Si[1]),ie._rotateAround(Ri,Yt)._add(zi),ie.x+=-kt+Lt,ie.y-=(Kt.left-Mt)*ht.scale;const _i=ht.image?Kt.advance*ht.scale:Mr*ht.scale,Ki=String.fromCodePoint(ht.glyph);GL(Ki)?ie.x+=(1-Mt)*ht.scale:$L(Ki)?ie.x+=_i-Kt.height*ht.scale+(-Mt-1)*ht.scale:ie.x+=ht.image||Kt.width+2*Mt===di.w&&Kt.height+2*Mt===di.h?(_i-gn)/2:(_i-(Kt.height+2*Mt)*ht.scale)/2,se=new gt(ie.x,ie.y-sn),Ze=new gt(ie.x+gn,ie.y),mt=new gt(ie.x+gn,ie.y-sn)}else{const kt=(Kt.left-Mt)*ht.scale-Lt+Si[0],Yt=(-Kt.top-Mt)*ht.scale+Si[1],Ri=kt+sn,zi=Yt+gn;ie=new gt(kt,Yt),se=new gt(Ri,Yt),Ze=new gt(kt,zi),mt=new gt(Ri,zi)}if(Je){let kt;kt=Se?new gt(0,0):gi?new gt(nt[0],nt[1]):new gt(oe[0],oe[1]),ie._rotateAround(Je,kt),se._rotateAround(Je,kt),Ze._rotateAround(Je,kt),mt._rotateAround(Je,kt)}const St=new gt(0,0),Tt=new gt(0,0);rt.push({tl:ie,tr:se,bl:Ze,br:mt,texPrimary:Ft,texSecondary:void 0,writingMode:J.writingMode,glyphOffset:pi,sectionIndex:ht.sectionIndex,isSDF:bt,pixelOffsetTL:St,pixelOffsetBR:Tt,minFontScaleX:0,minFontScaleY:0})}}return rt}(0,a,x,d,f,_,c,n.allowVerticalPlacement),K=n.textSizeData;let B=null;K.kind==="source"?(B=[Qa*d.layout.get("text-size").evaluate(_,{},$)*k.textScaleFactor],B[0]>Uc&&Ci(`${n.layerIds[0]}: Value for "text-size" is >= ${Lm}. Reduce your "text-size".`)):K.kind==="composite"&&(B=[Qa*k.compositeTextSizes[0].evaluate(_,{},$)*k.textScaleFactor,Qa*k.compositeTextSizes[1].evaluate(_,{},$)*k.textScaleFactor],(B[0]>Uc||B[1]>Uc)&&Ci(`${n.layerIds[0]}: Value for "text-size" is >= ${Lm}. Reduce your "text-size".`)),n.addSymbols(n.text,ee,B,x,f,_,E,e,i,w.lineStartIndex,w.lineLength,L,F,$,q,!1);for(const Z of A)M[Z]=n.text.placedSymbolArray.length-1;return 4*ee.length}function _1(n){for(const e in n)return n[e];return null}function Ry(n,e,i,a,c,d,f,_,x,w){let E=f.top,A=f.bottom,M=f.left,L=f.right;if(QS(f)&&f.collisionPadding){const k=f.collisionPadding;M-=k[0],E-=k[1],L+=k[2],A+=k[3]}if(x){const k=new gt(M,E),F=new gt(L,E),$=new gt(M,A),q=new gt(L,A),ee=G(x);let K=new gt(0,0);w&&(K=new gt(w[0],w[1])),k._rotateAround(ee,K),F._rotateAround(ee,K),$._rotateAround(ee,K),q._rotateAround(ee,K),M=Math.min(k.x,F.x,$.x,q.x),L=Math.max(k.x,F.x,$.x,q.x),E=Math.min(k.y,F.y,$.y,q.y),A=Math.max(k.y,F.y,$.y,q.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,M,E,L,A,_,a,c,d),n.length-1}function y1(n){QS(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function lk(n,e,i,a){const c=n.compareText;if(e in c){const d=c[e];for(let f=d.length-1;f>=0;f--)if(a.dist(d[f])<i)return!0}else c[e]=[];return c[e].push(a),!1}function wE(n,e){const i=n.fovAboveCenter,a=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,c=(n._camera.position[2]*n.worldSize-a)/Math.cos(n._pitch),d=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let f=Math.sin(n._pitch)*d+c;const _=c*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let x=Math.max(n.zoom-17,0);n.isOrthographic&&(x/=10),f*=1+x}return Math.min(1.01*f,_)}function km(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),a=n.x*i,c=(n.x+1)*i,d=n.y*i,f=(n.y+1)*i,_=ye(a),x=ye(c),w=be(d),E=be(f),A=e.project(_,w),M=e.project(x,w),L=e.project(x,E),k=e.project(_,E);let F=Math.min(A.x,M.x,L.x,k.x),$=Math.min(A.y,M.y,L.y,k.y),q=Math.max(A.x,M.x,L.x,k.x),ee=Math.max(A.y,M.y,L.y,k.y);const K=i/16;function B(J,oe,_e,Se,Ae,De){const qe=(_e+Ae)/2,rt=(Se+De)/2,Je=e.project(ye(qe),be(rt)),nt=Math.max(0,F-Je.x,$-Je.y,Je.x-q,Je.y-ee);F=Math.min(F,Je.x),q=Math.max(q,Je.x),$=Math.min($,Je.y),ee=Math.max(ee,Je.y),nt>K&&(B(J,Je,_e,Se,qe,rt),B(Je,oe,qe,rt,Ae,De))}B(A,M,a,d,c,d),B(M,L,c,d,c,f),B(L,k,c,f,a,f),B(k,A,a,f,a,d),F-=K,$-=K,q+=K,ee+=K;const Z=1/Math.max(q-F,ee-$);return{scale:Z,x:F*Z,y:$*Z,x2:q*Z,y2:ee*Z,projection:e}}function TE(n,{x:e,y:i},a=0){return new gt(((e-a)*n.scale-n.x)*vt,(i*n.scale-n.y)*vt)}const ck=me(new Float32Array(16));class Gc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new U(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a,c=!0){return e._coordinatePoint(e.locationCoordinate(i,a),c)}pixelsPerMeter(e,i){return le(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return wE(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,c){const d=e.horizonLineFromTop(!1),f=new gt(i,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,c))}pointCoordinate3D(e,i,a){const c=new gt(i,a);if(e.elevation)return e.elevation.pointCoordinate(c);{const d=this.pointCoordinate(e,c.x,c.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return ck}createTileMatrix(e,i,a){let c,d,f;const _=a.canonical,x=me(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=km(_,this);c=1,d=w.x+a.wrap*w.scale,f=w.y,we(x,x,[c/w.scale,c/w.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(_.z),d=(_.x+Math.pow(2,_.z)*a.wrap)*c,f=_.y*c;return pe(x,x,[d,f,0]),we(x,x,[c/vt,c/vt,1]),x}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class uk extends Gc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(G(i));this.n=(c+Math.sin(G(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c,r0:d}=this,f=G(e-this.center[0]),_=G(i),x=Math.sqrt(c-2*a*Math.sin(_))/a;return{x:x*Math.sin(f*a),y:x*Math.cos(f*a)-d,z:0}}unproject(e,i){const{n:a,c,r0:d}=this,f=d+i;let _=Math.atan2(e,Math.abs(f))*Math.sign(f);f*a<0&&(_-=Math.PI*Math.sign(e)*Math.sign(f));const x=G(this.center[0])*a;_=Ve(_,-Math.PI-x,Math.PI-x);const w=Me(X(_/a)+this.center[0],-180,180),E=Math.asin(Me((c-(e*e+f*f)*a*a)/(2*a),-1,1)),A=Me(X(E),-Le,Le);return new U(w,A)}}const Om=1.340264,Fm=-.081106,Bm=893e-6,Nm=.003796,zy=Math.sqrt(3)/2;class hk extends Gc{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(zy*Math.sin(i)),c=a*a,d=c*c*c;return{x:.5*(e*Math.cos(a)/(zy*(Om+3*Fm*c+d*(7*Bm+9*Nm*c)))/Math.PI+.5),y:1-.5*(a*(Om+Fm*c+d*(Bm+Nm*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,c=a*a,d=c*c*c;for(let E,A,M,L=0;L<12&&(A=a*(Om+Fm*c+d*(Bm+Nm*c))-i,M=Om+3*Fm*c+d*(7*Bm+9*Nm*c),E=A/M,a=Me(a-E,-Math.PI/3,Math.PI/3),c=a*a,d=c*c*c,!(Math.abs(E)<1e-12));++L);const f=zy*e*(Om+3*Fm*c+d*(7*Bm+9*Nm*c))/Math.cos(a),_=Math.asin(Math.sin(a)/zy),x=Me(180*f/Math.PI,-180,180),w=Me(180*_/Math.PI,-Le,Le);return new U(x,w)}}class dk extends Gc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),c=Me(360*(.5-i),-Le,Le);return new U(a,c)}}const sf=Math.PI/2;function Dy(n){return Math.tan((sf+n)/2)}class fk extends Gc{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let c=G(i),d=G(a);this.southernCenter=c+d<0,this.southernCenter&&(c=-c,d=-d);const f=Math.cos(c),_=Dy(c);this.n=c===d?Math.sin(c):Math.log(f/Math.cos(d))/Math.log(Dy(d)/_),this.f=f*Math.pow(Dy(c),this.n)/this.n}project(e,i){i=G(i),this.southernCenter&&(i=-i),e=G(e-this.center[0]);const a=1e-6,{n:c,f:d}=this;d>0?i<-sf+a&&(i=-sf+a):i>sf-a&&(i=sf-a);const f=d/Math.pow(Dy(i),c);let _=f*Math.sin(c*e),x=d-f*Math.cos(c*e);return _=.5*(_/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:_,y:this.southernCenter?x:1-x,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:c}=this,d=c-i,f=Math.sign(d),_=Math.sign(a)*Math.sqrt(e*e+d*d);let x=Math.atan2(e,Math.abs(d))*f;d*a<0&&(x-=Math.PI*Math.sign(e)*f);const w=Me(X(x/a)+this.center[0],-180,180),E=Me(X(2*Math.atan(Math.pow(c/_,1/a))-sf),-Le,Le);return new U(w,this.southernCenter?-E:E)}}class SE extends Gc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:de(e),y:fe(i),z:0}}unproject(e,i){const a=ye(e),c=be(i);return new U(a,c)}}const EE=G(Le);class pk extends Gc{project(e,i){const a=(i=G(i))*i,c=a*a;return{x:.5*((e=G(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,c=25,d=0,f=a*a;do{f=a*a;const w=f*f;d=(a*(1.007226+f*(.015085+w*(.028874*f-.044475-.005916*w)))-i)/(1.007226+f*(.045255+w*(.259866*f-.311325-.005916*11*w))),a=Me(a-d,-EE,EE)}while(Math.abs(d)>1e-6&&--c>0);f=a*a;const _=Me(X(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=X(a);return new U(_,x)}}const IE=G(Le);class mk extends Gc{project(e,i){i=G(i),e=G(e);const a=Math.cos(i),c=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),f=Math.sin(d)/d,_=.5*(e*c+2*a*Math.sin(e/2)/f)||0,x=.5*(i+Math.sin(i)/f)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,d=25;const f=1e-6;let _=0,x=0;do{const w=Math.cos(c),E=Math.sin(c),A=2*E*w,M=E*E,L=w*w,k=Math.cos(a/2),F=Math.sin(a/2),$=2*k*F,q=F*F,ee=1-L*k*k,K=ee?1/ee:0,B=ee?Math.acos(w*k)*Math.sqrt(1/ee):0,Z=.5*(2*B*w*F+2*a/Math.PI)-e,J=.5*(B*E+c)-i,oe=.5*K*(L*q+B*w*k*M)+1/Math.PI,_e=K*($*A/4-B*E*F),Se=.125*K*(A*F-B*E*L*$),Ae=.5*K*(M*k+B*q*w)+.5,De=_e*Se-Ae*oe;_=(J*_e-Z*Ae)/De,x=(Z*Se-J*oe)/De,a=Me(a-_,-Math.PI,Math.PI),c=Me(c-x,-IE,IE)}while((Math.abs(_)>f||Math.abs(x)>f)&&--d>0);return new U(X(a),X(c))}}class AE extends Gc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(G(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:c}=this;return{x:G(e)*c*a+.5,y:-Math.sin(G(i))/c*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:c}=this,d=-(i-.5)/a,f=Me(X((e-.5)/a)/c,-180,180),_=Math.asin(Me(d*c,-1,1)),x=Me(X(_),-Le,Le);return new U(f,x)}}class gk extends SE{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){const c=_m(e,i,a);return fn(c,c,py(Ya(a))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,i,a){const c=V(i.lat,i.lng),d=$i([],c),f=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;ii(c,c,d,le(1,0)*vt*f);const _=me(new Float64Array(16));return he(_,e.pixelMatrix,e.globeMatrix),fn(c,c,_),new gt(c[0],c[1])}pixelsPerMeter(e,i){return le(1,0)*i}pixelSpaceConversion(e,i,a){const c=le(1,e)*i,d=qt(le(1,45)*i,c,a);return this.pixelsPerMeter(e,i)/d}createTileMatrix(e,i,a){const c=Ox(Ya(a.canonical));return he(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:a}=e,c=py(Ya(i));return tt(c,c,G(a.lng)),Ue(c,c,G(a.lat)),we(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,i,a,c){return u2(e,i,a,!0)||new Be(0,0)}pointCoordinate3D(e,i,a){const c=this.pointCoordinate(e,i,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!u2(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(c,d){const f=c.cameraToCenterDistance,_=c._centerAltitude*d,x=c._camera,w=c._camera.forward(),E=vi([],Gt([],w,-f),[0,0,_]),A=c.worldSize/(2*Math.PI),M=[0,0,-A],L=c.width/c.height,k=Math.tan(c.fovAboveCenter),F=Gt([],x.up(),k),$=Gt([],x.right(),k*L),q=$i([],vi([],vi([],w,F),$)),ee=[];let K;if(new Ss(E,q).closestPointOnSphere(M,A,ee)){const B=vi([],ee,M),Z=Tn([],B,E);K=Math.cos(c.fovAboveCenter)*Pi(Z)}else{const B=Tn([],E,M),Z=Tn([],M,E);$i(Z,Z);const J=Pi(B)-A;K=Math.sqrt(J*(J+2*A));const oe=Math.acos(K/(A+J))-Math.acos(Ei(w,Z));K*=Math.cos(oe)}return 1.01*K}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Fc(e.zoom);if(a>0){const c=wE(e,le(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return qt(i,c+d*(1-Math.cos(f)),Math.pow(a,10))}return i}upVector(e,i,a){return _m(i,a,e,1)}upVectorScale(e){return{metersToTile:Oc(fy(Ya(e)))}}}function CE(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new SE(n);case"equirectangular":return new dk(n);case"naturalEarth":return new pk(n);case"equalEarth":return new hk(n);case"winkelTripel":return new mk(n);case"albers":return i?new AE(n):new uk(n);case"lambertConformalConic":return i?new AE(n):new fk(n);case"globe":return new gk(n)}throw new Error(`Invalid projection name: ${n.name}`)}const _k=Nc.VectorTileFeature.types,yk=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ly(n,e,i,a,c,d,f,_,x,w,E,A,M){const L=_?Math.min(Uc,Math.round(_[0])):0,k=_?Math.min(Uc,Math.round(_[1])):0;n.emplaceBack(e,i,Math.round(32*a),Math.round(32*c),d,f,(L<<1)+(x?1:0),k,16*w,16*E,256*A,256*M)}function ky(n,e,i){n.emplaceBack(e,i)}function Oy(n,e,i,a,c,d,f){n.emplaceBack(e,i,a,c,d,f)}function Fy(n,e,i,a,c){n.emplaceBack(e,i,a,c),n.emplaceBack(e,i,a,c),n.emplaceBack(e,i,a,c),n.emplaceBack(e,i,a,c)}function vk(n){for(const e of n.sections)if(Sx(e.text))return!0;return!1}class v1{constructor(e){this.layoutVertexArray=new Pc,this.indexArray=new vr,this.programConfigurations=e,this.segments=new kn,this.dynamicLayoutVertexArray=new Us,this.opacityVertexArray=new sm,this.placedSymbolArray=new J_,this.iconTransitioningVertexArray=new Wa,this.globeExtVertexArray=new yo,this.zOffsetVertexArray=new Cc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,a,c,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,LL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,OL.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,yk,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,BL.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,kL.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,FL.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}At(v1,"SymbolBuffers");class x1{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new kn,this.collisionVertexArray=new lm,this.collisionVertexArrayExt=new Us}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,NL.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,jL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}At(x1,"CollisionBuffers");class By{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=me([]),this.placementViewportMatrix=me([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=nE(this.zoom,i["text-size"]),this.iconSizeData=nE(this.zoom,i["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(f=>jo[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new v1(new Bl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new v1(new Bl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new pm,this.lineVertexArray=new iy,this.symbolInstances=new ty}calculateGlyphDependencies(e,i,a,c,d){for(const f of e){const _=f.codePointAt(0);if(_===void 0)break;if(i[_]=!0,c&&d&&_<=65535){const x=Mm[f];x&&(i[x.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!e1(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,i,a,c){const d=this.layers[0],f=d.layout,_=this.projection.name==="globe",x=f.get("text-font"),w=f.get("text-field"),E=f.get("icon-image"),[A,M]=f.get("icon-size-scale-range"),L=Me(i.scaleFactor||1,A,M),k=(w.value.kind!=="constant"||w.value.value instanceof ro&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),F=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,$=f.get("symbol-sort-key");if(this.features=[],!k&&!F)return;const q=i.iconDependencies,ee=i.glyphDependencies,K=i.availableImages,B=new en(this.zoom);for(const{feature:Z,id:J,index:oe,sourceLayerIndex:_e}of e){const Se=d._featureFilter.needGeometry,Ae=Nt(Z,Se);if(!d._featureFilter.filter(B,Ae,a))continue;if(Se||(Ae.geometry=Pt(Z,a,c)),_&&Z.type!==1&&a.z<=5){const nt=Ae.geometry,lt=.98078528056,$e=(it,je)=>Ei(_m(it.x,it.y,a,1),_m(je.x,je.y,a,1))<lt;for(let it=0;it<nt.length;it++)nt[it]=ot(nt[it],$e)}let De,qe;if(k){const nt=d.getValueAndResolveTokens("text-field",Ae,a,K),lt=ro.factory(nt);vk(lt)&&(this.hasRTLText=!0),(!this.hasRTLText||Ec()==="unavailable"||this.hasRTLText&&is.isParsed())&&(De=UL(lt,d,Ae))}if(F){const nt=d.getValueAndResolveTokens("icon-image",Ae,a,K);qe=typeof nt=="string"?go.build(nt):nt}if(!De&&!qe)continue;const rt=this.sortFeaturesByKey?$.evaluate(Ae,{},a):void 0,Je={id:J,text:De,icon:qe,index:oe,sourceLayerIndex:_e,geometry:Ae.geometry,properties:Z.properties,type:_k[Z.type],sortKey:rt};if(this.features.push(Je),qe){const nt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:lt,iconSecondary:$e}=yE(qe,this.iconSizeData,nt["icon-size"],a,this.zoom,Je,this.pixelRatio,L),it=lt.id.toString();if(q.has(it)?q.get(it).push(lt):q.set(it,[lt]),$e){const je=$e.id.toString();q.has(je)?q.get(je).push($e):q.set(je,[$e])}}if(De){const nt=x.evaluate(Ae,{},a).join(","),lt=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(jo.vertical)>=0;for(const $e of De.sections)if($e.image){const it=$e.image.getPrimary().scaleSelf(this.pixelRatio),je=it.id.toString(),He=q.get(je)||[];He.push(it),q.set(je,He)}else{const it=Zp(De.toString()),je=$e.fontStack||nt,He=ee[je]=ee[je]||{};this.calculateGlyphDependencies($e.text,He,lt,this.allowVerticalPlacement,it)}}}if(f.get("symbol-placement")==="line"&&(this.features=function(Z){const J={},oe={},_e=[];let Se=0;function Ae(Je){_e.push(Z[Je]),Se++}function De(Je,nt,lt){const $e=oe[Je];return delete oe[Je],oe[nt]=$e,_e[$e].geometry[0].pop(),_e[$e].geometry[0]=_e[$e].geometry[0].concat(lt[0]),$e}function qe(Je,nt,lt){const $e=J[nt];return delete J[nt],J[Je]=$e,_e[$e].geometry[0].shift(),_e[$e].geometry[0]=lt[0].concat(_e[$e].geometry[0]),$e}function rt(Je,nt,lt){const $e=lt?nt[0][nt[0].length-1]:nt[0][0];return`${Je}:${$e.x}:${$e.y}`}for(let Je=0;Je<Z.length;Je++){const nt=Z[Je],lt=nt.geometry,$e=nt.text?nt.text.toString():null;if(!$e){Ae(Je);continue}const it=rt($e,lt),je=rt($e,lt,!0);if(it in oe&&je in J&&oe[it]!==J[je]){const He=qe(it,je,lt),ut=De(it,je,_e[He].geometry);delete J[it],delete oe[je],oe[rt($e,_e[ut].geometry,!0)]=ut,_e[He].geometry=null}else it in oe?De(it,je,lt):je in J?qe(it,je,lt):(Ae(Je),J[it]=Se-1,oe[je]=Se-1)}return _e.filter(Je=>Je.geometry)}(this.features)),f.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Z of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Z.id,this.elevationFeatures.length),this.elevationFeatures.push(Z)}}else f.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Z,J)=>Z.sortKey-J.sortKey)}update(e,i,a,c,d,f,_){this.text.programConfigurations.updatePaintArrays(e,i,d,a,c,f,_),this.icon.programConfigurations.updatePaintArrays(e,i,d,a,c,f,_)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);if(a.elevationFeatureIndex===65535)continue;const c=this.elevationFeatures[a.elevationFeatureIndex];if(c){const d=.05+c.pointElevation(new gt(a.tileAnchorX,a.tileAnchorY));a.zOffset!==d&&(e=!0,a.zOffset=d)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(d,f,_)=>{a+=f,a>d.length&&d.resize(a);for(let x=-f;x<0;x++)d.emplace(x+a,_)},i=(d,f,_)=>{c+=f,c>d.length&&d.resize(c);for(let x=-f;x<0;x++)d.emplace(x+c,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,c=0;for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:x,numIconVertices:w}=f,E=f.zOffset,A=w>0;if((_>0||x>0)&&(e(this.text.zOffsetVertexArray,_,E),e(this.text.zOffsetVertexArray,x,E)),A){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:L}=f;M>=0&&i(this.icon.zOffsetVertexArray,w,E),L>=0&&i(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,E)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=CE(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:d}of i)this.lineVertexArray.emplaceBack(c,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,c,d,f,_,x,w,E,A,M,L,k,F,$){const q=e.indexArray,ee=e.layoutVertexArray,K=e.globeExtVertexArray,B=e.segments.prepareSegment(4*i.length,ee,q,this.canOverlap?f.sortKey:void 0),Z=this.glyphOffsetArray.length,J=B.vertexLength,oe=this.allowVerticalPlacement&&_===jo.vertical?Math.PI/2:0,_e=f.text&&f.text.sections;for(let Ae=0;Ae<i.length;Ae++){const{tl:De,tr:qe,bl:rt,br:Je,texPrimary:nt,texSecondary:lt,pixelOffsetTL:$e,pixelOffsetBR:it,minFontScaleX:je,minFontScaleY:He,glyphOffset:ut,isSDF:ht,sectionIndex:Ft}=i[Ae],Mt=B.vertexLength,bt=ut[1];if(Ly(ee,w.x,w.y,De.x,bt+De.y,nt.x,nt.y,a,ht,$e.x,$e.y,je,He),Ly(ee,w.x,w.y,qe.x,bt+qe.y,nt.x+nt.w,nt.y,a,ht,it.x,$e.y,je,He),Ly(ee,w.x,w.y,rt.x,bt+rt.y,nt.x,nt.y+nt.h,a,ht,$e.x,it.y,je,He),Ly(ee,w.x,w.y,Je.x,bt+Je.y,nt.x+nt.w,nt.y+nt.h,a,ht,it.x,it.y,je,He),x){const{x:ct,y:ri,z:Dt}=x.anchor,[Lt,Kt,di]=x.up;Oy(K,ct,ri,Dt,Lt,Kt,di),Oy(K,ct,ri,Dt,Lt,Kt,di),Oy(K,ct,ri,Dt,Lt,Kt,di),Oy(K,ct,ri,Dt,Lt,Kt,di),Fy(e.dynamicLayoutVertexArray,ct,ri,Dt,oe)}else Fy(e.dynamicLayoutVertexArray,w.x,w.y,w.z,oe);if($){const ct=lt||nt;ky(e.iconTransitioningVertexArray,ct.x,ct.y),ky(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y),ky(e.iconTransitioningVertexArray,ct.x,ct.y+ct.h),ky(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y+ct.h)}q.emplaceBack(Mt,Mt+1,Mt+2),q.emplaceBack(Mt+1,Mt+2,Mt+3),B.vertexLength+=4,B.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ut[0]),Ae!==i.length-1&&Ft===i[Ae+1].sectionIndex||e.programConfigurations.populatePaintArrays(ee.length,f,f.index,{},L,k,F,_e&&_e[Ft])}const Se=x?x.anchor:w;e.placedSymbolArray.emplaceBack(Se.x,Se.y,Se.z,w.x,w.y,Z,this.glyphOffsetArray.length-Z,J,E,A,w.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],_,0,0,0,M,0)}_commitLayoutVertex(e,i,a,c,d,f,_){e.emplaceBack(i,a,c,d,f,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,i,a,c,d,f,_){const x=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),w=x.vertexLength,E=_.tileAnchorX,A=_.tileAnchorY;for(let L=0;L<4;L++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,i,e.padding,_.zOffset),this._commitLayoutVertex(a.layoutVertexArray,c,d,f,E,A,new gt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,d,f,E,A,new gt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,d,f,E,A,new gt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,d,f,E,A,new gt(e.x1,e.y2)),x.vertexLength+=4;const M=a.indexArray;M.emplaceBack(w,w+1),M.emplaceBack(w+1,w+2),M.emplaceBack(w+2,w+3),M.emplaceBack(w+3,w),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,c,d,f){for(let _=c;_<d;_++){const x=a.get(_),w=this.getSymbolInstanceTextSize(e,f,i,_);this._addCollisionDebugVertices(x,w,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,a,c,d,f){for(let _=c;_<d;_++){const x=a.get(_),w=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._addCollisionDebugVertices(x,w,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new x1(Hd,US.members,Wa),this.iconCollisionBox=new x1(Hd,US.members,Wa);const c=Rm(this.iconSizeData,e),d=Rm(this.textSizeData,e,a);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(d,e,i,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(d,e,i,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,e,i,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,e,i,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,i,a,c){const d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),f=d1(this.textSizeData,e,d)/Mr;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,a){const c=this.icon.placedSymbolArray.get(a),d=d1(this.iconSizeData,e,c);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,i,a,c){e.emplaceBack(i,-a,-a,c),e.emplaceBack(i,a,-a,c),e.emplaceBack(i,a,a,c),e.emplaceBack(i,-a,a,c)}_updateTextDebugCollisionBoxes(e,i,a,c,d,f,_){for(let x=c;x<d;x++){const w=a.get(x),E=this.getSymbolInstanceTextSize(e,f,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,i,a,c,d,f,_){for(let x=c;x<d;x++){const w=a.get(x),E=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding,f.zOffset)}}updateCollisionDebugBuffers(e,i,a,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=Rm(this.iconSizeData,e,c),f=Rm(this.textSizeData,e,a);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(f,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x,a),this._updateTextDebugCollisionBoxes(f,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x,a),this._updateIconDebugCollisionBoxes(d,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x,c),this._updateIconDebugCollisionBoxes(d,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x,c)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,c,d,f,_,x,w){const E={};if(i<a){const{x1:A,y1:M,x2:L,y2:k,padding:F,projectedAnchorX:$,projectedAnchorY:q,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:B,featureIndex:Z}=e.get(i);E.textBox={x1:A,y1:M,x2:L,y2:k,padding:F,projectedAnchorX:$,projectedAnchorY:q,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:B},E.textFeatureIndex=Z}if(c<d){const{x1:A,y1:M,x2:L,y2:k,padding:F,projectedAnchorX:$,projectedAnchorY:q,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:B,featureIndex:Z}=e.get(c);E.verticalTextBox={x1:A,y1:M,x2:L,y2:k,padding:F,projectedAnchorX:$,projectedAnchorY:q,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:B},E.verticalTextFeatureIndex=Z}if(f<_){const{x1:A,y1:M,x2:L,y2:k,padding:F,projectedAnchorX:$,projectedAnchorY:q,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:B,featureIndex:Z}=e.get(f);E.iconBox={x1:A,y1:M,x2:L,y2:k,padding:F,projectedAnchorX:$,projectedAnchorY:q,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:B},E.iconFeatureIndex=Z}if(x<w){const{x1:A,y1:M,x2:L,y2:k,padding:F,projectedAnchorX:$,projectedAnchorY:q,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:B,featureIndex:Z}=e.get(x);E.verticalIconBox={x1:A,y1:M,x2:L,y2:k,padding:F,projectedAnchorX:$,projectedAnchorY:q,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:B},E.verticalIconFeatureIndex=Z}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),c=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),c=[],d=[],f=[];for(let _=0;_<this.symbolInstances.length;++_){f.push(_);const x=this.symbolInstances.get(_);c.push(0|Math.round(i*x.tileAnchorX+a*x.tileAnchorY)),d.push(x.featureIndex)}return f.sort((_,x)=>c[_]-c[x]||d[x]-d[_]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:w}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&f!==d&&f!==c&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ME,PE,b1;At(By,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),By.addDynamicAttributes=Fy;class RE{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:La,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}At(RE,"FormatSectionOverride",{omit:["defaultValue"]});const w1=()=>b1||(b1={layout:ME||(ME=new Hn({"symbol-placement":new pt(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new pt(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pt(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new It(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pt(Oe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new pt(Oe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new pt(Oe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new pt(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new pt(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new pt(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pt(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new It(Oe.layout_symbol["icon-size"]),"icon-size-scale-range":new pt(Oe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new It(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new It(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new It(Oe.layout_symbol["icon-image"]),"icon-rotate":new It(Oe.layout_symbol["icon-rotate"]),"icon-padding":new pt(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new pt(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new It(Oe.layout_symbol["icon-offset"]),"icon-anchor":new It(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pt(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pt(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pt(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new It(Oe.layout_symbol["text-field"]),"text-font":new It(Oe.layout_symbol["text-font"]),"text-size":new It(Oe.layout_symbol["text-size"]),"text-size-scale-range":new pt(Oe.layout_symbol["text-size-scale-range"]),"text-max-width":new It(Oe.layout_symbol["text-max-width"]),"text-line-height":new It(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new It(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new It(Oe.layout_symbol["text-justify"]),"text-radial-offset":new It(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pt(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new It(Oe.layout_symbol["text-anchor"]),"text-max-angle":new pt(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new pt(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new It(Oe.layout_symbol["text-rotate"]),"text-padding":new pt(Oe.layout_symbol["text-padding"]),"text-keep-upright":new pt(Oe.layout_symbol["text-keep-upright"]),"text-transform":new It(Oe.layout_symbol["text-transform"]),"text-offset":new It(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new pt(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new pt(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new pt(Oe.layout_symbol["text-optional"]),visibility:new pt(Oe.layout_symbol.visibility)})),paint:PE||(PE=new Hn({"icon-opacity":new It(Oe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new It(Oe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new It(Oe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new It(Oe.paint_symbol["text-emissive-strength"]),"icon-color":new It(Oe.paint_symbol["icon-color"]),"icon-halo-color":new It(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new It(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new It(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new pt(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new pt(Oe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new pt(Oe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new It(Oe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new It(Oe.paint_symbol["text-occlusion-opacity"]),"text-color":new It(Oe.paint_symbol["text-color"],{runtimeType:mo,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new It(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new It(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new It(Oe.paint_symbol["text-halo-blur"]),"text-translate":new pt(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new pt(Oe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new pt(Oe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new pt(Oe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new pt(Oe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new pt(Oe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new It(Oe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},b1);class Ny extends lo{constructor(e,i,a,c){super(e,w1(),i,a,c),this._colorAdjustmentMatrix=me([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const d of a)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,a,c){return this._saturation===e&&this._contrast===i&&this._brightnessMin===a&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(d,f,_,x){d=Zr(d),f=Wr(f);const w=Ie(),E=d/3,A=1-2*E,M=[A,E,E,0,E,A,E,0,E,E,A,0,0,0,0,1],L=.5-.5*f,k=x-_;return he(w,[k,0,0,0,0,k,0,0,0,0,k,0,_,_,_,1],[f,0,0,0,0,f,0,0,0,0,f,0,L,L,L,1]),he(w,w,M),w}(e,i,a,c),this._saturation=e,this._contrast=i,this._brightnessMin=a,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,a,c){const d=this.layout.get(e).evaluate(i,{},a,c),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Dd(f.value)||!d?d:function(_,x){return x.replace(/{([^{}]+)}/g,(w,E)=>E in _?String(_[E]):"")}(i.properties,d)}createBucket(e){return new By(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of w1().paint.overridableProperties){if(!Ny.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new RE(i),c=new Hp(a,i.property.specification,this.scope,this.options);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new Ml("source",c):new Tc("composite",c,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Ic(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&Ny.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),c=w1().paint.properties[i];let d=!1;const f=_=>{for(const x of _)if(c.overrides&&c.overrides.hasOverride(x))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ro)f(a.value.value.sections);else if(a.value.kind==="source"){const _=w=>{d||(w instanceof bi&&mr(w.value)===Fu?f(w.value.sections):w instanceof xl?f(w.sections):w.eachChild(_))},x=a.value;x._styleExpression&&_(x._styleExpression.expression)}return d}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,a){return{config:new Xa(this,{zoom:i,lut:a}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let zE,DE,LE,kE;var T1=Gi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function S1(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function E1(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class I1{constructor(e,i,a,c){this.context=e,this.format=a,this.useMipmap=c&&c.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:c&&c.premultiply})}update(e,i){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,c=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:d}=this,{gl:f}=d,{x:_,y:x}=i&&i.position?i.position:{x:0,y:0},w=_+a,E=x+c;!this.size||this.size[0]===w&&this.size[1]===E||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!i||i.premultiply!==!1));const A=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&w>0&&E>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(w,E)))+1:1;f.texStorage2D(f.TEXTURE_2D,M,this.format,w,E),this.size=[w,E]}if(this.size)if(A)f.texSubImage2D(f.TEXTURE_2D,0,_,x,S1(this.format),E1(this.format),e);else{const M=e.data;M&&f.texSubImage2D(f.TEXTURE_2D,0,_,x,a,c,S1(this.format),E1(this.format),M)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,i,a=!1){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,a,c){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),this.wrapS=a),c!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class jy{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Vy(n,e,i,a,c,d,f,_){const x=[n,e,1,i,a,1,c,d,1],w=[f,_,1],E=Y([],x),[A,M,L]=po(w,w,E);return Ee(x,x,[A,0,0,0,M,0,0,0,L])}function OE(n,e,i,a,c,d,f,_){const x=function(w,E,A,M,L,k,F,$){const q=Vy(0,0,1,0,1,1,0,1),ee=Vy(w,E,A,M,L,k,F,$);return Ee(ee,ee,Y([],q))}(n,e,i,a,c,d,f,_);return[x[2]/x[8]/vt,x[5]/x[8]/vt]}function Uy(n){return[n[0],Math.min(Math.max(n[1],-Le),Le)]}class FE extends _l{constructor(e,i,a,c){super(),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Da("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=sc(this.map._requestManager.transformRequest(this.url,td.Image),(a,c)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new mp(a)):c&&(this.image=c instanceof HTMLImageElement?ps.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new jy(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Da("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof jy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],a=e[0][1];for(const d of e)d[1]>a&&(a=d[1]),d[1]<i&&(i=d[1]);const c=(a+i)/2;if(c>Le?this.onNorthPole=!0:c<-Le&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=e.map(Be.fromLngLat);this.tileID=function(f){let _=1/0,x=1/0,w=-1/0,E=-1/0;for(const F of f)_=Math.min(_,F.x),x=Math.min(x,F.y),w=Math.max(w,F.x),E=Math.max(E,F.y);const A=Math.max(w-_,E-x),M=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),L=Math.pow(2,M);let k=Math.floor((_+w)/2*L);return k>1&&(k-=1),new mn(M,k,Math.floor((x+E)/2*L))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Da("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const q in this.tiles){const ee=this.tiles[q];ee.state!=="loaded"&&(ee.state="loaded",ee.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=km(new mn(0,0,0),this.map.transform.projection),a=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(q){const ee=q[1].x-q[0].x,K=q[1].y-q[0].y,B=q[2].x-q[1].x,Z=q[2].y-q[1].y,J=q[3].x-q[2].x,oe=q[3].y-q[2].y,_e=q[0].x-q[3].x,Se=q[0].y-q[3].y,Ae=ee*Z-B*K,De=B*oe-J*Z,qe=J*Se-_e*oe,rt=_e*K-ee*Se;return Ae>0&&De>0&&qe>0&&rt>0||Ae<0&&De<0&&qe<0&&rt<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=km(this.tileID,this.map.transform.projection),[d,f,_,x]=this.coordinates.map(q=>{const ee=c.projection.project(q[0],q[1]);return TE(c,ee)._round()});this.perspectiveTransform=OE(d.x,d.y,f.x,f.y,_.x,_.y,x.x,x.y);const w=this._boundsArray=new kl;w.emplaceBack(d.x,d.y,0,0),w.emplaceBack(f.x,f.y,vt,0),w.emplaceBack(x.x,x.y,0,vt),w.emplaceBack(_.x,_.y,vt,vt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,T1.members),this.boundsSegments=kn.simpleSegment(0,0,4,2);const E=[],A=[Uy((M=this.coordinates)[0]),Uy(M[1]),Uy(M[2]),Uy(M[3])];var M;const[L,k,F,$]=function(q){let ee=q[0][0],K=ee,B=q[0][1],Z=B;for(let J=1;J<q.length;J++)q[J][0]<ee?ee=q[J][0]:q[J][0]>K&&(K=q[J][0]),q[J][1]<B?B=q[J][1]:q[J][1]>Z&&(Z=q[J][1]);return[ee,B,K-ee,Z-B]}(A);{const q=new kl,[ee,K,B,Z]=function($e){let it=$e[0].x,je=it,He=$e[0].y,ut=He;for(let ht=1;ht<$e.length;ht++)$e[ht].x<it?it=$e[ht].x:$e[ht].x>je&&(je=$e[ht].x),$e[ht].y<He?He=$e[ht].y:$e[ht].y>ut&&(ut=$e[ht].y);return[it,He,je-it,ut-He]}(a),J=$e=>[($e.x-ee)/B,($e.y-K)/Z],[oe,_e,Se,Ae]=a.map(J),De=function($e,it,je,He,ut,ht,Ft,Mt){const bt=Vy(0,0,1,0,1,1,0,1);return Ee(bt,bt,Y([],Vy($e,it,je,He,ut,ht,Ft,Mt)))}(oe[0],oe[1],_e[0],_e[1],Se[0],Se[1],Ae[0],Ae[1]);this.elevatedGlobePerspectiveTransform=OE(oe[0],oe[1],_e[0],_e[1],Se[0],Se[1],Ae[0],Ae[1]);const qe=($e,it)=>{E.push($e.lng);const je=Math.round(($e.lng-L)/F*vt),He=Math.round(($e.lat-k)/$*vt),ut=J(it),ht=po([],[ut[0],ut[1],1],De),Ft=Math.round(ht[0]/ht[2]*vt),Mt=Math.round(ht[1]/ht[2]*vt);q.emplaceBack(je,He,Ft,Mt)},rt=a[3].x-a[0].x,Je=a[3].y-a[0].y,nt=a[2].x-a[1].x,lt=a[2].y-a[1].y;for(let $e=0;$e<65;$e++){const it=$e/64,je=[a[0].x+it*rt,a[0].y+it*Je],He=[a[1].x+it*nt,a[1].y+it*lt],ut=He[0]-je[0],ht=He[1]-je[1];for(let Ft=0;Ft<65;Ft++){const Mt=Ft/64,bt={x:je[0]+ut*Mt,y:je[1]+ht*Mt,z:0};qe(i.projection.unproject(bt.x,bt.y),bt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(q,T1.members)}{this.maxLongitudeTriangleSize=0;let q=[],ee=new vr;const K=(B,Z,J)=>{ee.emplaceBack(B,Z,J);const oe=E[B],_e=E[Z],Se=E[J],Ae=Math.min(Math.min(oe,_e),Se),De=Math.max(Math.max(oe,_e),Se)-Ae;De>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=De),q.push(Ae+De/2)};for(let B=0;B<64;B++)for(let Z=0;Z<64;Z++){const J=65*B+Z,oe=J+1,_e=J+65,Se=_e+1;K(J,_e,oe),K(oe,_e,Se)}[q,ee]=function(B,Z){const J=Array.from({length:B.length},(Se,Ae)=>Ae);J.sort((Se,Ae)=>B[Se]-B[Ae]);const oe=[],_e=new vr;for(let Se=0;Se<J.length;Se++){const Ae=J[Se];oe.push(B[Ae]);const De=3*Ae,qe=De+1;_e.emplaceBack(Z.uint16[De],Z.uint16[qe],Z.uint16[qe+1])}return[oe,_e]}(q,ee),this.elevatedGlobeTrianglesCenterLongitudes=q,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ee)}this.elevatedGlobeSegments=kn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,F/vt,0,$/vt,0,0,k,L,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,a=i.gl;!this._dirty||this.texture instanceof jy||(this.texture?this.texture.update(this.image):(this.texture=new I1(i,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let c=(d=e+180)+360*Math.round((a[0]-d)/360);var d;const f=new kn,_=(A,M)=>{f.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:i.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},x=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-c)<=x){const A=oa(a,0,a.length,c+x);return A===a.length||_(A,zr(a,A+1,a.length,c+360-x)-A),f}c<a[0]&&(c+=360);const w=zr(a,0,a.length,c-x);if(w===a.length)return _(0,a.length),f;_(0,w-0);const E=oa(a,w+1,a.length,c+x);return E!==a.length&&_(E,a.length-E),f}}const xk=(Math.pow(256,2)-1)/16907520;class BE extends lo{constructor(e,i,a,c){super(e,{layout:LE||(LE=new Hn({visibility:new pt(Oe.layout_raster.visibility)})),paint:kE||(kE=new Hn({"raster-opacity":new pt(Oe.paint_raster["raster-opacity"]),"raster-color":new Dl(Oe.paint_raster["raster-color"]),"raster-color-mix":new pt(Oe.paint_raster["raster-color-mix"]),"raster-color-range":new pt(Oe.paint_raster["raster-color-range"]),"raster-hue-rotate":new pt(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pt(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pt(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new pt(Oe.paint_raster["raster-saturation"]),"raster-contrast":new pt(Oe.paint_raster["raster-contrast"]),"raster-resampling":new pt(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new pt(Oe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new pt(Oe.paint_raster["raster-emissive-strength"]),"raster-array-band":new pt(Oe.paint_raster["raster-array-band"]),"raster-elevation":new pt(Oe.paint_raster["raster-elevation"]),"raster-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},i,a,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof FE&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[a,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(c)||a===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=ym({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,c])}}let NE,jE,VE,UE,GE;class $E extends lo{constructor(e,i,a,c){super(e,{layout:NE||(NE=new Hn({visibility:new pt(Oe["layout_raster-particle"].visibility)})),paint:jE||(jE=new Hn({"raster-particle-array-band":new pt(Oe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new pt(Oe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Dl(Oe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new pt(Oe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new pt(Oe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new pt(Oe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new pt(Oe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new pt(Oe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},i,a,c),this._updateColorRamp(),this.lastInvalidatedAt=ps.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=ym({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ps.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class bk extends lo{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function A1(n,e,i){const a=[0,0,1],c=Fs([]);return Xo(c,c,i?-G(n)+Math.PI:G(n)),hs(c,c,-G(e)),Oo(a,a,c),$i(a,a)}function HE(n,e){const i=Gy(n.projection,n.zoom,n.width,n.height),a=function(d,f,_,x,w){const E=new U(_.lng-180*$c,_.lat),A=new U(_.lng+180*$c,_.lat),M=d.project(E.lng,E.lat),L=d.project(A.lng,A.lat),k=-Math.atan2(L.y-M.y,L.x-M.x),F=Be.fromLngLat(_);F.y=Me(F.y,-1+$c,1-$c);const $=F.toLngLat(),q=d.project($.lng,$.lat),ee=Be.fromLngLat($);ee.x+=$c;const K=ee.toLngLat(),B=d.project(K.lng,K.lat),Z=WE(B.x-q.x,B.y-q.y,k),J=Be.fromLngLat($);J.y+=$c;const oe=J.toLngLat(),_e=d.project(oe.lng,oe.lat),Se=WE(_e.x-q.x,_e.y-q.y,k),Ae=Math.abs(Z.x)/Math.abs(Se.y),De=me([]);_t(De,De,-k*(1-(w?0:x)));const qe=me([]);return we(qe,qe,[1,1-(1-Ae)*x,1]),qe[4]=-Se.x/Se.y*x,_t(qe,qe,k),he(qe,De,qe),qe}(n.projection,0,n.center,i,e),c=qE(n);return we(a,a,[c,c,1]),a}function qE(n){const e=n.projection,i=Gy(n.projection,n.zoom,n.width,n.height),a=C1(e,n.center),c=C1(e,U.convert(e.center));return Math.pow(2,a*i+(1-i)*c)}function Gy(n,e,i,a,c=1/0){const d=n.range;if(!d)return 0;const f=Math.min(c,Math.max(i,a)),_=Math.log(f/1024)/Math.LN2;return Re(d[0]+_,d[1]+_,e)}const $c=1/4e4;function C1(n,e){const i=Me(e.lat,-Le,Le),a=new U(e.lng-180*$c,i),c=new U(e.lng+180*$c,i),d=n.project(a.lng,i),f=n.project(c.lng,i),_=Be.fromLngLat(a),x=Be.fromLngLat(c),w=f.x-d.x,E=f.y-d.y,A=x.x-_.x,M=x.y-_.y,L=Math.sqrt((A*A+M*M)/(w*w+E*E));return Math.log(L)/Math.LN2}function WE(n,e,i){const a=Math.cos(i),c=Math.sin(i);return{x:n*a-e*c,y:n*c+e*a}}function ZE(n,e,i){me(n),_t(n,n,G(e[2])),Ue(n,n,G(e[0])),tt(n,n,G(e[1])),we(n,n,i),he(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function $y(n,e,i,a,c,d,f,_){const x=[i[0]-e[0],i[1]-e[1],0],w=[a[0]-e[0],a[1]-e[1],0];if(Pi(x)<1e-12||Pi(w)<1e-12)return Fs(n);const E=xn([],x,w);$i(E,E),ai(w,a,e),x[2]=(d-c)*_,w[2]=(f-c)*_;const A=x;return xn(A,x,w),$i(A,A),Yo(n,E,A)}function M1(n,e,i=!1){const a=Fc(e.zoom),c=function(d,f,_){const x=f.worldSize,w=[d[12],d[13],d[14]],E=be(w[1]/x),A=ye(w[0]/x),M=me([]),L=le(1,E)*x,k=le(1,0)*x*Xe(E,f.zoom),F=1/Fx(x);let $=k*F;if(_){const B=Gy(f.projection,f.zoom,f.width,f.height,1024);$=F*f.projection.pixelSpaceConversion(f.center.lat,x,B)}const q=V(E,A);vi(q,q,Gt([],$i([],q),L*$*w[2]));const ee=function(B){const Z=[B[0],B[1],B[2]];let J=[0,1,0];const oe=xn([],J,Z);return xn(J,Z,oe),Ji(J)===0&&(J=[0,1,0],xn(oe,Z,J)),$i(oe,oe),$i(J,J),$i(Z,Z),[oe[0],oe[1],oe[2],0,J[0],J[1],J[2],0,Z[0],Z[1],Z[2],0,B[0],B[1],B[2],1]}(q);we(M,M,[$,$,$*L]),pe(M,M,[-w[0],-w[1],-w[2]]);const K=he([],f.globeMatrix,ee);return he(K,K,M),he(K,K,d),K}(n,e,i);if(a>0){const d=function(f,_){const x=_.worldSize,w=le(1,0)*x*Xe(_.center.lat,_.zoom)/Fx(x),E=le(1,_.center.lat)*x,A=me([]);return tt(A,A,G(_.center.lng)),Ue(A,A,G(_.center.lat)),pe(A,A,[0,0,g]),we(A,A,[w,w,w*E]),pe(A,A,[_.point.x-.5*x,_.point.y-.5*x,0]),he(A,A,f),he(A,_.globeMatrix,A)}(n,e);return function(f,_,x){const w=(k,F,$)=>{const q=Pi(k),ee=Pi(F),K=jl(k,F,$);return Gt(K,K,1/Pi(K)*qt(q,ee,$))},E=w([f[0],f[1],f[2]],[_[0],_[1],_[2]],x),A=w([f[4],f[5],f[6]],[_[4],_[5],_[6]],x),M=w([f[8],f[9],f[10]],[_[8],_[9],_[10]],x),L=jl([f[12],f[13],f[14]],[_[12],_[13],_[14]],x);return[E[0],E[1],E[2],0,A[0],A[1],A[2],0,M[0],M[1],M[2],0,L[0],L[1],L[2],1]}(c,d,a)}return c}function XE(n,e,i,a){const c=An.projectAabbCorners(a,i);let d=Number.MAX_VALUE,f=-1;for(let w=0;w<c.length;++w){const E=c[w];E[0]=(.5*E[0]+.5)*e.width,E[1]=(.5-.5*E[1])*e.height,E[2]<d&&(f=w,d=E[2])}const _=w=>new gt(c[w][0],c[w][1]);let x;switch(f){case 0:case 6:x=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:x=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:x=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:x=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(Zt(n,x))return d}const wk=Gi([{name:"a_pos_3f",components:3,type:"Float32"}]),Tk=Gi([{name:"a_color_3f",components:3,type:"Float32"}]),Sk=Gi([{name:"a_color_4f",components:4,type:"Float32"}]),Ek=Gi([{name:"a_uv_2f",components:2,type:"Float32"}]),Ik=Gi([{name:"a_normal_3f",components:3,type:"Float32"}]),Ak=Gi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Ck=Gi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),YE={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Hy{constructor(e,i,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function P1(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class KE{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class QE{constructor(){this.instancedDataArray=new Rc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class R1{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,a,c){this.tileToMeter=ke(a);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:_,index:x,sourceLayerIndex:w}of e){const E=_??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),A=Nt(f,d);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),A,a))continue;const M={id:E,sourceLayerIndex:w,index:x,geometry:d?A.geometry:Pt(f,a,c),properties:f.properties,type:f.type,patterns:{}},L=this.addFeature(M,M.geometry,A);L&&i.featureIndex.insert(f,M.geometry,x,w,this.index,this.instancesPerModel[L].instancedDataArray.length,vt/32)}this.lookup=null}update(e,i,a,c){for(const d in this.instancesPerModel){const f=this.instancesPerModel[d];for(const _ in e)f.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(f.features[f.idToFeaturesIndex[_]],e[_],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];for(const c of a.features){const d=this.layers[0],f=c.feature,_=this.canonical,x=d.paint.get("model-rotation").evaluate(f,{},_),w=d.paint.get("model-scale").evaluate(f,{},_),E=d.paint.get("model-translation").evaluate(f,{},_);Ir(c.rotation,x)&&Ir(c.scale,w)&&Ir(c.translation,E)||(this.evaluate(c,c.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,i,a,c){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const d=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(e1(this.activeReplacements,d))return!1;this.activeReplacements=d;let f=!1;for(const _ in this.instancesPerModel){const x=this.instancesPerModel[_],w=x.instancedDataArray;for(const E of x.features){const A=E.instancedDataOffset,M=E.instancedDataCount;for(let L=0;L<M;L++){const k=16*(L+A);let F=w.float32[k+0];const $=F>vt;F=$?F-vt:F;const q=Math.floor(F),ee=w.float32[k+1];let K=!1;for(const B of this.activeReplacements)if(!iS(B,a,YE.Model,c)&&!(B.min.x>q||q>B.max.x||B.min.y>ee||ee>B.max.y)&&(K=lS(aS(q,ee,e.canonical,B.footprintTileId.canonical),B.footprint),K))break;w.float32[k]=K?F+vt:F,f=f||K!==$}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,Ak.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,a){const c=this.layers[0],d=c.layout.get("model-id").evaluate(a,{},this.canonical);if(!d)return Ci(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),d;(P1(d,!1)||this.styleDefinedModelURLs[d]!==void 0)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new QE);const f=this.instancesPerModel[d],_=f.instancedDataArray,x=new KE(a,_.length);for(const w of i)for(const E of w){if(E.x<0||E.x>=vt||E.y<0||E.y>=vt)continue;const A=(this.lookupDim-1)/vt,M=this.lookupDim*(E.y*A|0)+E.x*A|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const L=_.length;_.resize(L+1),f.instancesEvaluatedElevation.push(0),_.float32[16*L]=E.x,_.float32[16*L+1]=E.y}return x.instancedDataCount=f.instancedDataArray.length-x.instancedDataOffset,x.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(x),this.evaluate(x,{},f,!1)),d}getModelUris(){return this.modelUris}evaluate(e,i,a,c){const d=this.layers[0],f=e.feature,_=this.canonical,x=e.rotation=d.paint.get("model-rotation").evaluate(f,i,_),w=e.scale=d.paint.get("model-scale").evaluate(f,i,_),E=e.translation=d.paint.get("model-translation").evaluate(f,i,_),A=d.paint.get("model-color").evaluate(f,i,_);A.a=d.paint.get("model-color-mix-intensity").evaluate(f,i,_);const M=[];this.maxVerticalOffset<E[2]&&(this.maxVerticalOffset=E[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),ZE(M,x,w);const L=Math.round(100*A.a)+A.b/1.05;for(let k=0;k<e.instancedDataCount;++k){const F=e.instancedDataOffset+k,$=16*F,q=a.instancedDataArray.float32;let ee=0;c&&(ee=q[$+6]-a.instancesEvaluatedElevation[F]);const K=0|q[$+1];q[$]=(0|q[$])+A.r/1.05,q[$+1]=K+A.g/1.05,q[$+2]=L,q[$+3]=1/(_.z>10?this.tileToMeter:ke(_,K)),q[$+4]=E[0],q[$+5]=E[1],q[$+6]=E[2]+ee,q[$+7]=M[0],q[$+8]=M[1],q[$+9]=M[2],q[$+10]=M[4],q[$+11]=M[5],q[$+12]=M[6],q[$+13]=M[8],q[$+14]=M[9],q[$+15]=M[10],a.instancesEvaluatedElevation[F]=E[2]}}}let JE,eI;At(R1,"ModelBucket",{omit:["layers"]}),At(QE,"PerModelAttributes"),At(KE,"ModelFeature");const bh=64,af={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function tI(n,e,i,a,c,d,f,_,x,w=!1){const E=i.zoom,A=i.project(a),M=Xe(a.lat,E),L=1/M;me(n),pe(n,n,[A.x+f[0]*L,A.y+f[1]*L,f[2]]);let k=1,F=1;const $=i.worldSize;if(w){if(i.projection.name==="mercator"){let B=0;i.elevation&&(B=i.elevation.getAtPointOrZero(new Be(A.x/$,A.y/$),0));const Z=Bn([],[A.x,A.y,B,1],i.projMatrix)[3]/i.cameraToCenterDistance;k=Z,F=Z*Xe(i.center.lat,E)}else if(i.projection.name==="globe"){const B=M1(n,i),Z=[0,0,0,1];Bn(Z,Z,he([],i.projMatrix,B));const J=Z[3]/i.cameraToCenterDistance,oe=Fc(E),_e=i.projection.pixelsPerMeter(a.lat,$)*Xe(a.lat,E),Se=i.projection.pixelsPerMeter(i.center.lat,$)*Xe(i.center.lat,E);k=J/qt(_e,Ke(i.center.lat),oe),F=J*M/_e,k*=Se,F*=Se}}else k=L;we(n,n,[k,k,F]);const q=[...n],ee=e.orientation,K=[];if(ZE(K,[ee[0]+c[0],ee[1]+c[1],ee[2]+c[2]],d),he(n,q,K),_&&i.elevation){let B=0;const Z=[];if(x&&i.elevation){B=function(oe,_e,Se,Ae,De){const qe=_e.elevation;if(!qe)return 0;const rt=An.projectAabbCorners(Se,Ae),Je=le(1,De.lat)*_e.worldSize,nt=function(ct,ri){const Dt=[0,0,1],Lt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Kt of Lt){const di=ct[Kt.corners[0]],pi=ct[Kt.corners[1]],Si=ct[Kt.corners[2]],yi=[pi[0]-di[0],pi[1]-di[1],ri*(pi[2]-di[2])],gi=xn(yi,yi,[Si[0]-di[0],Si[1]-di[1],ri*(Si[2]-di[2])]);$i(gi,gi),Kt.dotProductWithUp=Ei(gi,Dt)}return Lt.sort((Kt,di)=>Kt.dotProductWithUp-di.dotProductWithUp),Lt[0].corners}(rt,Je),lt=rt[nt[0]],$e=rt[nt[1]],it=rt[nt[2]],je=rt[nt[3]],He=qe.getAtPointOrZero(new Be(lt[0]/_e.worldSize,lt[1]/_e.worldSize),0),ut=qe.getAtPointOrZero(new Be($e[0]/_e.worldSize,$e[1]/_e.worldSize),0),ht=qe.getAtPointOrZero(new Be(it[0]/_e.worldSize,it[1]/_e.worldSize),0),Ft=qe.getAtPointOrZero(new Be(je[0]/_e.worldSize,je[1]/_e.worldSize),0),Mt=(He+Ft)/2,bt=(ut+ht)/2;return Mt>bt?ut<ht?$y(oe,$e,je,lt,ut,Ft,He,Je):$y(oe,it,lt,je,ht,He,Ft,Je):He<Ft?$y(oe,lt,$e,it,He,ut,ht,Je):$y(oe,je,it,$e,Ft,ht,ut,Je),Math.max(Mt,bt)}(Z,i,e.aabb,n,a);const J=he([],ci([],Z),K);he(n,q,J)}else B=i.elevation.getAtPointOrZero(new Be(A.x/$,A.y/$),0);B!==0&&(n[14]+=B)}}function jm(n,e,i=!1){n.uploaded||(n.gfxTexture=new I1(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function Mk(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,wk.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,Ik.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,Ek.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?Tk:Sk).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,Ck.members,!0)),n.segments=kn.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const a=n.material;a.pbrMetallicRoughness.baseColorTexture&&jm(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&jm(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&jm(a.normalTexture,e),a.occlusionTexture&&jm(a.occlusionTexture,e,i),a.emissionTexture&&jm(a.emissionTexture,e)}function z1(n,e,i){if(n.meshes)for(const a of n.meshes)Mk(a,e,i);if(n.children)for(const a of n.children)z1(a,e,i)}function qy(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)qy(e)}function D1(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)D1(i)}class lf{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const c=a||e.findDEMTileFor(i);if(!c||!c.dem)return;const d=c.dem,f=c.tileID,_=1<<i.canonical.z-f.canonical.z;return new lf(c,d.dim/vt/_,[(i.canonical.x/_-f.canonical.x)*d.dim,(i.canonical.y/_-f.canonical.y)*d.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(a);return new gt(c,d)}getElevationAt(e,i,a,c){const d=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],_=Math.floor(d),x=Math.floor(f),w=this._dem;return c=!!c,a?qt(qt(w.get(_,x,c),w.get(_,x+1,c),f-x),qt(w.get(_+1,x,c),w.get(_+1,x+1,c),f-x),d-_):w.get(_,x,c)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*le(1,e)*this._dem.stride}}const L1=new Float32Array(262144),wh=new Uint8Array(262144);function iI(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,iI(i));return e}function nI(n,e,i){if(n.meshes)for(const a of n.meshes){if(a.aabb.min[0]===1/0)continue;const c=An.applyTransform(a.aabb,n.matrix);i.insert(e,c.min[0],c.min[1],c.max[0],c.max[1])}if(n.children)for(const a of n.children)nI(a,e,i)}const rI=["","wall","door","roof","window","lamp","logo"];class oI{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:iI(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=An.applyTransformFast(a.aabb,this.node.matrix),i.encapsulate(a.transformedAabb)),e++;this.aabb=i}return this.aabb}}class Wy{constructor(e,i,a,c,d,f,_){this.id=a,this.layers=e,this.layerIds=this.layers.map(x=>x.fqid),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.modelTraits|=af.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=af.HasMapboxMeshFeatures),d&&(this.modelTraits|=af.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const x of i)this.nodesInfo.push(new oI(x)),nI(x,_.featureIndexArray.length,_.grid),_.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,_.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const a of this.getNodesInfo()){const c=a.node;c.footprint&&i.push({footprint:c.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const a=i?this.stateDependentLayers:this.layers;if(!ra(e,this.states))for(const c of a)this.evaluate(c,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const a of i){const c=a.node;this.uploaded?this.updatePbrBuffer(c):z1(c,e,!0)}for(const a of i)qy(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),i=!0);return i}needsReEvaluation(e,i,a){const c=e.transform.projectionOptions,d=e.style.getBrightness(),f=this.brightness!==d;if(!this.uploaded||this.dirty||c.name!==this.projection.name||Vm(a.paint.get("model-color").value,f)||Vm(a.paint.get("model-color-mix-intensity").value,f)||Vm(a.paint.get("model-roughness").value,f)||Vm(a.paint.get("model-emissive-strength").value,f)||Vm(a.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=c,this.brightness=d;const _=this.getNodesInfo();for(const x of _)x.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),c=this.id.canonical;for(const d of a){const f=d.feature;d.evaluatedScale=i.paint.get("model-scale").evaluate(f,{},c)}}evaluate(e,i){const a=this.getNodesInfo();for(const c of a){if(!c.node.meshes)continue;const d=c.feature,f=i&&i[d.id];if(ra(f,c.state))continue;c.state=structuredClone(f);const _=c.node.meshes&&c.node.meshes[0].featureData,x=c.evaluatedColor[2],w=c.evaluatedRMEA[2],E=this.id.canonical;if(c.hasTranslucentParts=!1,_){for(let A=0;A<rI.length;A++){const M=rI[A];M.length&&(d.properties.part=M);const L=e.paint.get("model-color").evaluate(d,f,E).toRenderColor(null),k=e.paint.get("model-color-mix-intensity").evaluate(d,f,E);c.evaluatedColor[A]=[L.r,L.g,L.b,k],c.evaluatedRMEA[A][0]=e.paint.get("model-roughness").evaluate(d,f,E),c.evaluatedRMEA[A][2]=e.paint.get("model-emissive-strength").evaluate(d,f,E),c.evaluatedRMEA[A][3]=L.a,c.emissionHeightBasedParams[A]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,f,E),!c.hasTranslucentParts&&L.a<1&&(c.hasTranslucentParts=!0)}delete d.properties.part,Rk(c,x!==c.evaluatedColor[2]||w!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(d,f,E);c.evaluatedScale=e.paint.get("model-scale").evaluate(d,f,E),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,a,c){const d=e.findDEMTileFor(a);if(d&&(d.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const f=lf.create(e,a,d);if(!f)return;this.modelTraits&af.HasMapboxMeshFeatures&&this.updateDEM(e,f,a,c);for(const _ of this.getNodesInfo()){const x=_.node;if(!x.footprint||!x.footprint.vertices||!x.footprint.vertices.length)continue;const w=x.footprint.vertices;let E=f.getElevationAt(w[0].x,w[0].y,!0,!0);for(let A=1;A<w.length;A++)E=Math.min(E,f.getElevationAt(w[A].x,w[A].y,!0,!0));x.elevation=E}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,a,c){let d=i._dem._modifiedForSources[c];if(d===void 0&&(i._dem._modifiedForSources[c]=[],d=i._dem._modifiedForSources[c]),d.includes(a.canonical))return;const f=i._dem.dim;d.push(a.canonical);let _=!1;for(const x of this.getNodesInfo()){const w=x.node;if(!w.footprint||!w.footprint.grid)continue;const E=w.footprint.grid,A=i.tileCoordToPixel(E.min.x,E.min.y),M=i.tileCoordToPixel(E.max.x,E.max.y),L=Math.min(Math.min(f-M.y,A.x),Math.min(A.y,f-M.x));if(L<0)continue;const k=Me(L,2,5);let F=Math.max(0,A.x-k),$=Math.max(0,A.y-k),q=Math.min(M.x+k,f-1),ee=Math.min(M.y+k,f-1);for(let J=$;J<=ee;++J)for(let oe=F;oe<=q;++oe)wh[J*f+oe]=255;let K=0,B=0;for(let J=0;J<E.cellsY;++J)for(let oe=0;oe<E.cellsX;++oe){if(!E.cells[J*E.cellsX+oe])continue;const _e=i.tileCoordToPixel(E.min.x+oe/E.xScale,E.min.y+J/E.yScale),Se=i.tileCoordToPixel(E.min.x+(oe+1)/E.xScale,E.min.y+(J+1)/E.yScale);for(let Ae=_e.y;Ae<=Math.min(Se.y+1,f-1);++Ae)for(let De=_e.x;De<=Math.min(Se.x+1,f-1);++De)wh[Ae*f+De]===255&&(wh[Ae*f+De]=0,K+=i.getElevationAtPixel(De,Ae),B++)}const Z=K/B;F=Math.max(1,A.x-k),$=Math.max(1,A.y-k),q=Math.min(M.x+k,f-2),ee=Math.min(M.y+k,f-2),_=!0;for(let J=$;J<=ee;++J)for(let oe=F;oe<=q;++oe)wh[J*f+oe]===0&&(L1[J*f+oe]=i._dem.set(oe,J,Z));for(let J=1;J<k;++J){F=Math.max(1,A.x-J),$=Math.max(1,A.y-J),q=Math.min(M.x+J,f-2),ee=Math.min(M.y+J,f-2);for(let oe=$;oe<=ee;++oe)for(let _e=F;_e<=q;++_e){const Se=oe*f+_e;if(wh[Se]===255){let Ae=0,De=0,qe=-1,rt=-1;for(let Je=-1;Je<=1;++Je)for(let nt=-1;nt<=1;++nt){const lt=(oe+Je)*f+_e+nt;if(wh[lt]>=J)continue;const $e=L1[lt],it=Math.abs($e);it>De&&(Ae=$e,De=it,qe=nt,rt=Je)}if(De>.1){const Je=1-(J+.5*Math.abs(qe*rt))/k;let nt=i._dem.get(_e,oe)+Ae*Je;const lt=i._dem.get(_e+qe,oe+rt),$e=i._dem.get(_e-qe,oe-rt,!0);(nt-lt)*(nt-$e)>0&&(nt=(lt+$e)/2),L1[Se]=i._dem.set(_e,oe,nt),wh[Se]=J}}}}}_&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ps.now())}setFilter(e){this.filter=e?Jp(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new en(this.id.overscaledZ),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)qy(i.node),D1(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const f=c[d].node;c[d].hiddenByReplacement=!!f.footprint&&!a.find(_=>_.footprint===f.footprint)}}getHeightAtTileCoord(e,i){const a=this.getNodesInfo(),c=[],d=[0,0,0],f=me([]);for(let _=0;_<this.nodesInfo.length;_++){const x=a[_],w=x.node.meshes[0],E=w.transformedAabb;if(e<E.min[0]||i<E.min[1]||e>E.max[0]||i>E.max[1])continue;if(x.node.hidden===!0)return{height:1/0,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};Pe(f,x.node.matrix),d[0]=e,d[1]=i,fn(d,d,f);const A=(d[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*bh|0,M=Math.min(63,(d[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*bh|0)*bh+Math.min(63,A),L=w.heightmap[M];if(!(L<0&&x.node.footprint))return x.hiddenByReplacement?void 0:{height:L,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};if(x.node.footprint.grid.query(new gt(e,i),new gt(e,i),c),c.length>0)return{height:void 0,maxHeight:x.feature.properties.height,hidden:x.hiddenByReplacement,verticalScale:x.evaluatedScale[2]}}}}function Vm(n,e){return n instanceof Ml&&!n.isLightConstant&&e}function Pk(n,e,i,a,c,d,f,_){let x=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,E=240&e|(240&e)>>4;i[3]>0&&(x=qt(x,255*i[0],i[3]),w=qt(w,255*i[1],i[3]),E=qt(E,255*i[2],i[3]));const A=x<<8|w,M=E<<8|Math.floor(255*a[3]),L=function(J){const oe=Me(J,0,2);return Math.min(Math.round(.5*oe*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],k=Me(c[0],0,1),F=Me(c[1],0,1),$=Me(c[2],0,1),q=Me(c[3],0,1);let ee,K,B,Z;if(k!==F&&f!==d&&F!==k){const J=f-d;K=1/(J*(F-k)),B=-(d+J*k)/(J*(F-k));const oe=Me(c[4],-1,1);Z=Math.pow(10,oe),ee=255*$<<8|255*q}else ee=65535,K=0,B=1,Z=1;if(n.emplaceBack(A,M,L,ee,K,B,Z),_){const J=_.length;_.clear();for(let oe=0;oe<J;oe++)_.emplaceBack(A,M,L,ee,K,B,Z)}}function Rk(n,e,i){const a=n.node;let c=0;const d=i&af.HasMeshoptCompression;for(const f of a.meshes){if(a.lights&&a.lightMeshIndex===c||!f.featureData)continue;f.featureArray=new lh,f.featureArray.reserve(f.featureData.length);let _=e;for(const x of f.featureData){const w=d?65535&x:x>>16&65535,E=d?x>>16&65535:65535&x,A=(15&E)<8?15&E:0,M=n.evaluatedRMEA[A],L=n.evaluatedColor[A],k=n.emissionHeightBasedParams[A];let F;if(_&&A===2&&a.lights&&(F=new lh,F.resize(10*a.lights.length)),Pk(f.featureArray,w,L,M,k,f.aabb.min[2],f.aabb.max[2],F),F&&_){_=!1;const $=a.meshes[a.lightMeshIndex];$.featureArray=F,$.featureArray._trim()}}f.featureArray._trim(),c++}}function sI(n,e,i,a){const c=1<<n.z;e.lat=be((a/vt+n.y)/c),e.lng=ye((i/vt+n.x)/c)}At(Wy,"Tiled3dModelBucket",{omit:["layers"]}),At(oI,"Tiled3dModelFeature");const zk={circle:class extends lo{constructor(n,e,i,a){super(n,{layout:qi||(qi=new Hn({"circle-sort-key":new It(Oe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new pt(Oe.layout_circle["circle-elevation-reference"]),visibility:new pt(Oe.layout_circle.visibility)})),paint:Rn||(Rn=new Hn({"circle-radius":new It(Oe.paint_circle["circle-radius"]),"circle-color":new It(Oe.paint_circle["circle-color"]),"circle-blur":new It(Oe.paint_circle["circle-blur"]),"circle-opacity":new It(Oe.paint_circle["circle-opacity"]),"circle-translate":new pt(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new pt(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pt(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pt(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new It(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new It(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new It(Oe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new pt(Oe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}createBucket(n){return new zt(n)}queryRadius(n){const e=n;return mi("circle-radius",this,e)+mi("circle-stroke-width",this,e)+En(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,a,c,d,f,_){const x=In(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return v2(n,a,d,f,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const a=y2(this);return{config:new Xa(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends lo{createBucket(n){return new b2(n)}constructor(n,e,i,a){super(n,{layout:w2||(w2=new Hn({visibility:new pt(Oe.layout_heatmap.visibility)})),paint:T2||(T2=new Hn({"heatmap-radius":new It(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new It(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pt(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Dl(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pt(Oe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ym({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return mi("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,a,c,d,f,_){const x=this.paint.get("heatmap-radius").evaluate(e,i);return v2(n,a,d,f,_,!0,!0,new gt(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new Xa(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends lo{constructor(n,e,i,a){super(n,{layout:S2||(S2=new Hn({visibility:new pt(Oe.layout_hillshade.visibility)})),paint:E2||(E2=new Hn({"hillshade-illumination-direction":new pt(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pt(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pt(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pt(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pt(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pt(Oe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new pt(Oe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends lo{constructor(n,e,i,a){super(n,{layout:K2||(K2=new Hn({"fill-sort-key":new It(Oe.layout_fill["fill-sort-key"]),visibility:new pt(Oe.layout_fill.visibility),"fill-elevation-reference":new pt(Oe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new It(Oe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Q2||(Q2=new Hn({"fill-antialias":new pt(Oe.paint_fill["fill-antialias"]),"fill-opacity":new It(Oe.paint_fill["fill-opacity"]),"fill-color":new It(Oe.paint_fill["fill-color"]),"fill-outline-color":new It(Oe.paint_fill["fill-outline-color"]),"fill-translate":new pt(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new pt(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new It(Oe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new pt(Oe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new pt(Oe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new It(Oe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new It(Oe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new It(Oe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new Xa(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Kx(n)}queryRadius(){return En(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,a,c,d){return!n.queryGeometry.isAboveHorizon&&Ai(Bi(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends lo{constructor(n,e,i,a){super(n,{layout:TS||(TS=new Hn({visibility:new pt(Oe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new pt(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:SS||(SS=new Hn({"fill-extrusion-opacity":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new It(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new It(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new It(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new It(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new It(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new It(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new It(Oe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new It(Oe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new pt(Oe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Ty(n)}queryRadius(){return En(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,a,c,d,f,_,x){const w=In(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,i),A=this.paint.get("fill-extrusion-base").evaluate(e,i),M=[0,0],L=_&&d.elevation,k=d.elevation?d.elevation.exaggeration():1,F=n.tile.getBucket(this);if(L&&F instanceof Ty){const B=F.centroidVertexArray,Z=x+1;Z<B.length&&(M[0]=B.geta_centroid_pos0(Z),M[1]=B.geta_centroid_pos1(Z))}if(M[0]===0&&M[1]===1)return!1;d.projection.name==="globe"&&(a=wS([a],[new gt(0,0),new gt(vt,vt)],n.tileID.canonical).map(B=>B.polygon).flat());const $=L?_:null,[q,ee]=function(B,Z,J,oe,_e,Se,Ae,De,qe,rt,Je){return B.projection.name==="globe"?function(nt,lt,$e,it,je,He,ut,ht,Ft,Mt,bt){const ct=[],ri=[],Dt=nt.projection.upVectorScale(bt,nt.center.lat,nt.worldSize).metersToTile,Lt=[0,0,0,1],Kt=[0,0,0,1],di=(Si,yi,gi,sn)=>{Si[0]=yi,Si[1]=gi,Si[2]=sn,Si[3]=1},pi=bS();$e>0&&($e+=pi),it+=pi;for(const Si of lt){const yi=[],gi=[];for(const sn of Si){const gn=sn.x+je.x,ie=sn.y+je.y,se=nt.projection.projectTilePoint(gn,ie,bt),Ze=nt.projection.upVector(bt,sn.x,sn.y);let mt=$e,St=it;if(ut){const Tt=PS(gn,ie,$e,it,ut,ht,Ft,Mt);mt+=Tt.base,St+=Tt.top}$e!==0?di(Lt,se.x+Ze[0]*Dt*mt,se.y+Ze[1]*Dt*mt,se.z+Ze[2]*Dt*mt):di(Lt,se.x,se.y,se.z),di(Kt,se.x+Ze[0]*Dt*St,se.y+Ze[1]*Dt*St,se.z+Ze[2]*Dt*St),fn(Lt,Lt,He),fn(Kt,Kt,He),yi.push(new vh(Lt[0],Lt[1],Lt[2])),gi.push(new vh(Kt[0],Kt[1],Kt[2]))}ct.push(yi),ri.push(gi)}return[ct,ri]}(B,Z,J,oe,_e,Se,Ae,De,qe,rt,Je):Ae?function(nt,lt,$e,it,je,He,ut,ht,Ft){const Mt=[],bt=[],ct=[0,0,0,1];for(const ri of nt){const Dt=[],Lt=[];for(const Kt of ri){const di=Kt.x+it.x,pi=Kt.y+it.y,Si=PS(di,pi,lt,$e,He,ut,ht,Ft);ct[0]=di,ct[1]=pi,ct[2]=Si.base,ct[3]=1,Bn(ct,ct,je),ct[3]=Math.max(ct[3],1e-5);const yi=new vh(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);ct[0]=di,ct[1]=pi,ct[2]=Si.top,ct[3]=1,Bn(ct,ct,je),ct[3]=Math.max(ct[3],1e-5);const gi=new vh(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);Dt.push(yi),Lt.push(gi)}Mt.push(Dt),bt.push(Lt)}return[Mt,bt]}(Z,J,oe,_e,Se,Ae,De,qe,rt):function(nt,lt,$e,it,je){const He=[],ut=[],ht=je[8]*lt,Ft=je[9]*lt,Mt=je[10]*lt,bt=je[11]*lt,ct=je[8]*$e,ri=je[9]*$e,Dt=je[10]*$e,Lt=je[11]*$e;for(const Kt of nt){const di=[],pi=[];for(const Si of Kt){const yi=Si.x+it.x,gi=Si.y+it.y,sn=je[0]*yi+je[4]*gi+je[12],gn=je[1]*yi+je[5]*gi+je[13],ie=je[2]*yi+je[6]*gi+je[14],se=je[3]*yi+je[7]*gi+je[15],Ze=sn+ht,mt=gn+Ft,St=ie+Mt,Tt=Math.max(se+bt,1e-5),kt=sn+ct,Yt=gn+ri,Ri=ie+Dt,zi=Math.max(se+Lt,1e-5);di.push(new vh(Ze/Tt,mt/Tt,St/Tt)),pi.push(new vh(kt/zi,Yt/zi,Ri/zi))}He.push(di),ut.push(pi)}return[He,ut]}(Z,J,oe,_e,Se)}(d,a,A,E,w,f,$,M,k,d.center.lat,n.tileID.canonical),K=n.queryGeometry;return function(B,Z,J){let oe=1/0;Ai(J,Z)&&(oe=MS(J,Z[0]));for(let _e=0;_e<Z.length;_e++){const Se=Z[_e],Ae=B[_e];for(let De=0;De<Se.length-1;De++){const qe=Se[De],rt=[qe,Se[De+1],Ae[De+1],Ae[De],qe];Zt(J,rt)&&(oe=Math.min(oe,MS(J,rt)))}}return oe!==1/0&&oe}(q,ee,K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends lo{constructor(n,e,i,a){const c=jS();super(n,c,e,i,a),c.layout&&(this.layout=new zl(c.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof qu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(Cm)return Cm;const i=jS();return Cm=new DL(i.paint.properties["line-width"].specification),Cm.useIntegerZoom=!0,Cm})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new r1(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const a=BS(this);return{config:new Xa(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}queryRadius(n){const e=n,i=VS(mi("line-width",this,e),mi("line-gap-width",this,e)),a=mi("line-offset",this,e);return i/2+Math.abs(a)+En(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,a,c,d){if(n.queryGeometry.isAboveHorizon)return!1;const f=Bi(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),_=n.pixelToTileUnitsFactor/2*VS(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),x=this.paint.get("line-offset").evaluate(e,i);return x&&(a=function(w,E){const A=[],M=new gt(0,0);for(let L=0;L<w.length;L++){const k=w[L],F=[];for(let $=0;$<k.length;$++){const q=k[$],ee=k[$+1],K=$===0?M:q.sub(k[$-1])._unit()._perp(),B=$===k.length-1?M:ee.sub(q)._unit()._perp(),Z=K._add(B)._unit();Z._mult(1/(Z.x*B.x+Z.y*B.y)),F.push(Z._mult(E)._add(q))}A.push(F)}return A}(a,x*n.pixelToTileUnitsFactor)),function(w,E,A){for(let M=0;M<E.length;M++){const L=E[M];if(w.length>=3){for(let k=0;k<L.length;k++)if(nn(w,L[k]))return!0}if(tn(w,L,A))return!0}return!1}(f,a,_)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Ny,background:class extends lo{constructor(n,e,i,a){super(n,{layout:zE||(zE=new Hn({visibility:new pt(Oe.layout_background.visibility)})),paint:DE||(DE=new Hn({"background-pitch-alignment":new pt(Oe.paint_background["background-pitch-alignment"]),"background-color":new pt(Oe.paint_background["background-color"]),"background-pattern":new pt(Oe.paint_background["background-pattern"]),"background-opacity":new pt(Oe.paint_background["background-opacity"]),"background-emissive-strength":new pt(Oe.paint_background["background-emissive-strength"]),"background-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:BE,"raster-particle":$E,sky:class extends lo{constructor(n,e,i,a){super(n,{layout:VE||(VE=new Hn({visibility:new pt(Oe.layout_sky.visibility)})),paint:UE||(UE=new Hn({"sky-type":new pt(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new pt(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new pt(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new pt(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new pt(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Dl(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new pt(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new pt(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new pt(Oe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ym({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),c=!a,d=n.style.light,f=d.properties.get("position");return c&&d.properties.get("anchor")==="viewport"&&Ci("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?A1(f.azimuthal,90-f.polar,e):A1(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return A1(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends lo{constructor(n,e,i,a){super(n,{paint:GE||(GE=new Hn({}))},e,null)}},model:class extends lo{constructor(n,e,i,a){super(n,{layout:JE||(JE=new Hn({visibility:new pt(Oe.layout_model.visibility),"model-id":new It(Oe.layout_model["model-id"])})),paint:eI||(eI=new Hn({"model-opacity":new It(Oe.paint_model["model-opacity"]),"model-rotation":new It(Oe.paint_model["model-rotation"]),"model-scale":new It(Oe.paint_model["model-scale"]),"model-translation":new It(Oe.paint_model["model-translation"]),"model-color":new It(Oe.paint_model["model-color"]),"model-color-mix-intensity":new It(Oe.paint_model["model-color-mix-intensity"]),"model-type":new pt(Oe.paint_model["model-type"]),"model-cast-shadows":new pt(Oe.paint_model["model-cast-shadows"]),"model-receive-shadows":new pt(Oe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new pt(Oe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new It(Oe.paint_model["model-emissive-strength"]),"model-roughness":new It(Oe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new It(Oe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new pt(Oe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new pt(Oe.paint_model["model-front-cutoff"]),"model-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new R1(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof Wy?vt-1:0}queryIntersectsFeature(n,e,i,a,c,d){if(!this.modelManager)return!1;const f=this.modelManager,_=n.tile.getBucket(this);if(!(_&&_ instanceof R1))return!1;for(const x in _.instancesPerModel){const w=_.instancesPerModel[x],E=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(w.idToFeaturesIndex.hasOwnProperty(E)){const A=w.features[w.idToFeaturesIndex[E]],M=f.getModel(x,this.scope);if(!M)return!1;let L=Ie();const k=new U(0,0),F=_.canonical;let $=Number.MAX_VALUE;for(let q=0;q<A.instancedDataCount;++q){const ee=16*(A.instancedDataOffset+q),K=w.instancedDataArray.float32,B=[K[ee+4],K[ee+5],K[ee+6]];sI(F,k,K[ee],0|K[ee+1]),tI(L,M,d,k,A.rotation,A.scale,B,!1,!1,!1),d.projection.name==="globe"&&(L=M1(L,d));const Z=he([],d.projMatrix,L),J=n.queryGeometry,oe=XE(J.isPointQuery()?J.screenBounds:J.screenGeometry,d,Z,M.aabb);oe!=null&&($=Math.min(oe,$))}return $!==Number.MAX_VALUE&&$}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Tc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends lo{constructor(n,e,i,a){super(n,{layout:J2||(J2=new Hn({"clip-layer-types":new pt(Oe.layout_clip["clip-layer-types"]),"clip-layer-scope":new pt(Oe.layout_clip["clip-layer-scope"])})),paint:eS||(eS=new Hn({}))},e,i,a)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new tS(n)}is3D(n){return!0}}};class Dk{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Lk{constructor(){this.tasks={},this.taskQueue=[],li(["process"],this),this.invoker=new Dk(this.process),this.nextId=0}add(e,i){const a=this.nextId++,c=function({type:d,isSymbolTile:f,zoom:_}){return _=_||0,d==="message"?0:d!=="maybePrepare"||f?d!=="parseTile"||f?d==="parseTile"&&f?300-_:d==="maybePrepare"&&f?400-_:500:200-_:100-_}(i);if(c===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:i,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const d=this.tasks[this.taskQueue[c]];d.priority<i&&(i=d.priority,e=c)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class aI{constructor(e,i,a){this.target=e,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},li(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Lk}send(e,i,a,c,d=!1,f){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=f,this.callbacks[_]=a);const x=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!a,targetMapId:c,mustQueue:d,sourceMapId:this.mapId,data:Ua(i,x)},x),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(i.mustQueue||pn(self)){const c=this.callbacks[a],d=this.scheduler.add(()=>this.processTask(a,i),c&&c.metadata||{type:"message"});d&&(this.cancelCallbacks[a]=d)}else this.processTask(a,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(i.error?a(Ga(i.error)):a(null,Ga(i.data)))}else{const a=new Set,c=i.hasCallback?(f,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?Ua(f):null,data:Ua(_,a)},a)}:()=>{},d=Ga(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,d,c);else if(this.parent.getWorkerSource){const f=i.type.split("."),{source:_,scope:x}=d;this.parent.getWorkerSource(i.sourceMapId,f[0],_,x)[f[1]](d,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Um={workerUrl:"",workerClass:null,workerParams:void 0};const k1="mapboxgl_preloaded_worker_pool";class Th{constructor(){this.active={}}acquire(e,i=Th.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Um.workerClass!=null?new Um.workerClass:new self.Worker(Um.workerUrl,Um.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[k1]}numActive(){return Object.keys(this.active).length}}Th.workerCount=2;class cf{constructor(e,i,a="Worker",c=Th.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Et();const d=this.workerPool.acquire(this.id,c);for(let f=0;f<d.length;f++){const _=new cf.Actor(d[f],i,this.id);_.name=`${a} ${f}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,a){Ye(this.actors,(c,d)=>{c.send(e,i,d)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Gm,O1;function Zy(){return Gm||(Gm=new Th),Gm}cf.Actor=aI;const F1=new Hi(0,0,0),B1={PATH_RULE_UNSPECIFIED:0,PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},N1={LINE_CAP_UNSPECIFIED:0,LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Xy={LINE_JOIN_UNSPECIFIED:0,LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},kk={PAINT_ORDER_UNSPECIFIED:0,PAINT_ORDER_FILL_AND_STROKE:1,PAINT_ORDER_STROKE_AND_FILL:2},$m={PATH_COMMAND_UNSPECIFIED:0,PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},lI={MASK_TYPE_UNSPECIFIED:0,MASK_TYPE_LUMINANCE:1,MASK_TYPE_ALPHA:2};function Ok(n,e,i){n===1&&e.icons.push(function(a,c){return function(d){if(d.usvg_tree.height||(d.usvg_tree.height=d.usvg_tree.width),!d.metadata)return d;const{metadata:f}=d;if(f.content_area){const{content_area:_}=f;_.top==null&&(_.top=_.left),_.width==null&&(_.width=d.usvg_tree.width),_.height==null&&(_.height=_.width)}return f.stretch_x&&f.stretch_x.length&&cI(f,"x"),f.stretch_y&&f.stretch_y.length&&cI(f,"y"),d}(a.readFields(Fk,{name:void 0},c))}(i,i.readVarint()+i.pos))}function cI(n,e){const i=[],a=n[`stretch_${e}`];let c=null;for(let d=0;d<a.length;d++)c===null?c=i.length===0?a[0]:i[i.length-1][1]+a[d]:(i.push([c,c+a[d]]),c=null);n[`stretch_${e}_areas`]=i}function Fk(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=function(a,c){return a.readFields(Bk,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},c)}(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=function(a,c){return a.readFields(Vk,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},c)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function Bk(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=function(a,c){return a.readFields(Nk,{left:0},c)}(i,i.readVarint()+i.pos):n===4&&e.variables.push(function(a,c){return a.readFields(jk,{name:void 0},c)}(i,i.readVarint()+i.pos))}function Nk(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function jk(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=Qy(i.readVarint()),e.value="rgb_color")}function Vk(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(Yy(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push(function(a,c){return a.readFields(Zk,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},c)}(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push(function(a,c){return a.readFields(Yk,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},c)}(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push(function(a,c){return a.readFields(Kk,{children:[]},c)}(i,i.readVarint()+i.pos)):n===8&&e.masks.push(function(a,c){const d=a.readFields(Qk,{left:0,width:20,mask_type:lI.MASK_TYPE_LUMINANCE,children:[]},c);return d.height==null&&(d.height=d.width),d.top==null&&(d.top=d.left),d}(i,i.readVarint()+i.pos))}function Yy(n,e){return n.readFields(Uk,{},e)}function Uk(n,e,i){n===1?(e.group=function(a,c){return a.readFields(Gk,{opacity:255,children:[]},c)}(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=function(a,c){return a.readFields(Hk,{paint_order:1,commands:[],step:1,diffs:[],rule:B1.PATH_RULE_NON_ZERO},c)}(i,i.readVarint()+i.pos),e.node="path")}function Gk(n,e,i){n===1?e.transform=Ky(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(Yy(i,i.readVarint()+i.pos))}function Ky(n,e){return n.readFields($k,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function $k(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function Hk(n,e,i){n===1?e.fill=function(a,c){return a.readFields(qk,{rgb_color:F1,paint:"rgb_color",opacity:255},c)}(i,i.readVarint()+i.pos):n===2?e.stroke=function(a,c){return a.readFields(Wk,{rgb_color:F1,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},c)}(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function qk(n,e,i){n===1?(e.rgb_color=Qy(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function Qy(n){return new Hi((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function Wk(n,e,i){n===1?(e.rgb_color=Qy(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function Zk(n,e,i){n===1?e.transform=Ky(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(uI(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function uI(n,e){return n.readFields(Xk,{offset:0,opacity:255,rgb_color:F1},e)}function Xk(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=Qy(i.readVarint()))}function Yk(n,e,i){n===1?e.transform=Ky(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(uI(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function Kk(n,e,i){n===1?e.transform=Ky(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(Yy(i,i.readVarint()+i.pos))}function Qk(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(Yy(i,i.readVarint()+i.pos))}class Jk{static calculate(e={},i=[]){const a=new Map,c=new Map;if(Object.keys(e).length===0)return a;i.forEach(d=>{c.set(d.name,d.rgb_color||new Hi(0,0,0))});for(const[d,f]of Object.entries(e))c.has(d)?a.set(c.get(d).toStringPremultipliedAlpha(),f):console.warn(`Ignoring unknown image variable "${d}"`);return a}}function uf(n,e=255,i){const a=e/255,c=n.toStringPremultipliedAlpha(),d=i.has(c)?i.get(c).clone():n.clone();return d.a*=a,d.toString()}function Hm(n,e){if(!cp()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function e3(n,e){const i=Jk.calculate(e.params,n.metadata?n.metadata.variables:[]),a=n.usvg_tree,c=a.width,d=a.height,f=e.transform?e.transform:new DOMMatrix,_=Math.max(1,Math.round(c*f.a)),x=Math.max(1,Math.round(d*f.d)),w=new DOMMatrix([_/c,0,0,x/d,0,0]),E=Hm(_,x).getContext("2d");return j1(E,w,a,a,i),E.getImageData(0,0,_,x)}function j1(n,e,i,a,c){for(const d of a.children)hI(n,e,i,d,c)}function hI(n,e,i,a,c){a.group?(n.save(),function(d,f,_,x,w){const E=x.mask_idx!=null?_.masks[x.mask_idx]:null,A=x.clip_path_idx!=null?_.clip_paths[x.clip_path_idx]:null;if(x.transform&&(f=Jy(x.transform).preMultiplySelf(f)),!function(k,F,$){return k.opacity!==255||F||$}(x,A!=null,E!=null))return void j1(d,f,_,x,w);const M=Hm(d.canvas.width,d.canvas.height),L=M.getContext("2d");j1(L,f,_,x,w),A&&yI(L,f,_,A),E&&vI(L,f,_,E,w),d.globalAlpha=x.opacity/255,d.drawImage(M,0,0)}(n,e,i,a.group,c),n.restore()):a.path&&(n.save(),function(d,f,_,x,w){const E=xI(x);d.setTransform(f),x.paint_order===kk.PAINT_ORDER_FILL_AND_STROKE?(dI(d,_,x,E,w),pI(d,_,x,E,w)):(pI(d,_,x,E,w),dI(d,_,x,E,w))}(n,e,i,a.path,c),n.restore())}function dI(n,e,i,a,c){const d=i.fill;if(!d)return;const f=d.opacity/255;switch(d.paint){case"rgb_color":n.fillStyle=uf(d.rgb_color,d.opacity,c);break;case"linear_gradient_idx":n.fillStyle=mI(n,e.linear_gradients[d.linear_gradient_idx],f,c);break;case"radial_gradient_idx":n.fillStyle=gI(n,e.radial_gradients[d.radial_gradient_idx],f,c)}n.fill(a,fI(i))}function fI(n){return n.rule===B1.PATH_RULE_NON_ZERO?"nonzero":n.rule===B1.PATH_RULE_EVEN_ODD?"evenodd":void 0}function pI(n,e,i,a,c){const d=i.stroke;if(!d)return;n.lineWidth=d.width,n.miterLimit=d.miterlimit,n.setLineDash(d.dasharray),n.lineDashOffset=d.dashoffset;const f=d.opacity/255;switch(d.paint){case"rgb_color":n.strokeStyle=uf(d.rgb_color,d.opacity,c);break;case"linear_gradient_idx":n.strokeStyle=mI(n,e.linear_gradients[d.linear_gradient_idx],f,c);break;case"radial_gradient_idx":n.strokeStyle=gI(n,e.radial_gradients[d.radial_gradient_idx],f,c)}switch(d.linejoin){case Xy.LINE_JOIN_MITER_CLIP:case Xy.LINE_JOIN_MITER:n.lineJoin="miter";break;case Xy.LINE_JOIN_ROUND:n.lineJoin="round";break;case Xy.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(d.linecap){case N1.LINE_CAP_BUTT:n.lineCap="butt";break;case N1.LINE_CAP_ROUND:n.lineCap="round";break;case N1.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(a)}function mI(n,e,i,a){if(e.stops.length===1){const M=e.stops[0];return uf(M.rgb_color,M.opacity*i,a)}const c=Jy(e.transform),{x1:d,y1:f,x2:_,y2:x}=e,w=c.transformPoint(new DOMPoint(d,f)),E=c.transformPoint(new DOMPoint(_,x)),A=n.createLinearGradient(w.x,w.y,E.x,E.y);for(const M of e.stops)A.addColorStop(M.offset,uf(M.rgb_color,M.opacity*i,a));return A}function gI(n,e,i,a){if(e.stops.length===1){const M=e.stops[0];return uf(M.rgb_color,M.opacity*i,a)}const c=Jy(e.transform),{fx:d,fy:f,cx:_,cy:x}=e,w=c.transformPoint(new DOMPoint(d,f)),E=c.transformPoint(new DOMPoint(_,x)),A=n.createRadialGradient(w.x,w.y,0,E.x,E.y,e.r*((c.a+c.d)/2));for(const M of e.stops)A.addColorStop(M.offset,uf(M.rgb_color,M.opacity*i,a));return A}function _I(n,e,i,a){const c=a.transform?Jy(a.transform).preMultiplySelf(e):e,d=Hm(n.canvas.width,n.canvas.height),f=d.getContext("2d");for(const x of a.children)if(x.group)_I(f,c,i,x.group);else if(x.path){const w=x.path,E=new Path2D;E.addPath(xI(w),c),f.fill(E,fI(w))}const _=a.clip_path_idx!=null?i.clip_paths[a.clip_path_idx]:null;_&&yI(f,c,i,_),n.globalCompositeOperation="source-over",n.drawImage(d,0,0)}function yI(n,e,i,a){const c=Hm(n.canvas.width,n.canvas.height);_I(c.getContext("2d"),e,i,a),n.globalCompositeOperation="destination-in",n.drawImage(c,0,0)}function vI(n,e,i,a,c){if(a.children.length===0)return;const d=a.mask_idx!=null?i.masks[a.mask_idx]:null;d&&vI(n,e,i,d,c);const f=n.canvas.width,_=n.canvas.height,x=Hm(f,_),w=x.getContext("2d"),E=a.width,A=a.height,M=a.left,L=a.top,k=new Path2D,F=new Path2D;F.rect(M,L,E,A),k.addPath(F,e),w.clip(k);for(const ee of a.children)hI(w,e,i,ee,c);const $=w.getImageData(0,0,f,_),q=$.data;if(a.mask_type===lI.MASK_TYPE_LUMINANCE)for(let ee=0;ee<q.length;ee+=4)q[ee+3]=q[ee+3]/255*(.2126*q[ee]+.7152*q[ee+1]+.0722*q[ee+2]);w.putImageData($,0,0),n.globalCompositeOperation="destination-in",n.drawImage(x,0,0)}function Jy(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function xI(n){const e=new Path2D,i=n.step;let a=n.diffs[0]*i,c=n.diffs[1]*i;e.moveTo(a,c);for(let d=0,f=2;d<n.commands.length;d++)switch(n.commands[d]){case $m.PATH_COMMAND_MOVE:a+=n.diffs[f++]*i,c+=n.diffs[f++]*i,e.moveTo(a,c);break;case $m.PATH_COMMAND_LINE:a+=n.diffs[f++]*i,c+=n.diffs[f++]*i,e.lineTo(a,c);break;case $m.PATH_COMMAND_QUAD:{const _=a+n.diffs[f++]*i,x=c+n.diffs[f++]*i;a=_+n.diffs[f++]*i,c=x+n.diffs[f++]*i,e.quadraticCurveTo(_,x,a,c);break}case $m.PATH_COMMAND_CUBIC:{const _=a+n.diffs[f++]*i,x=c+n.diffs[f++]*i,w=_+n.diffs[f++]*i,E=x+n.diffs[f++]*i;a=w+n.diffs[f++]*i,c=E+n.diffs[f++]*i,e.bezierCurveTo(_,x,w,E,a,c);break}case $m.PATH_COMMAND_CLOSE:e.closePath()}return e}class e0{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}At(e0,"LRUCache");class V1{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Br(e,e.data)}getFromCache(e,i,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new e0(150)),this.cacheMap.get(a).get(Ll(e.toString(),i))}setInCache(e,i,a,c){this.cacheDependenciesMap.has(c)||this.cacheDependenciesMap.set(c,new Map),this.cacheMap.has(c)||this.cacheMap.set(c,new e0(150));const d=this.cacheDependenciesMap.get(c),f=Ll(e.id.toString(),a);d.get(f)||d.set(f,new Set);const _=this.cacheMap.get(c),x=e.toString();d.get(f).add(x),_.put(Ll(e.toString(),a),i)}removeImagesFromCacheByIds(e,i,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const c=this.cacheMap.get(a),d=this.cacheDependenciesMap.get(a);for(const f of e){const _=Ll(f.toString(),i);if(d.has(_)){for(const x of d.get(_))c.delete(x);d.delete(_)}}}rasterize(e,i,a,c,d=e3){const f=this.getFromCache(e,a,c);if(f)return f.clone();const _=d(i.icon,e.options),x=V1._getImage(_);return this.setInCache(e,x,a,c),x.clone()}}class bI{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function wI(n,e,i,a){let c=0,d=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(a[f])<1e-15){if(i[f]<n[f]||i[f]>e[f])return null}else{const _=1/a[f];let x=(n[f]-i[f])*_,w=(e[f]-i[f])*_;if(x>w){const E=x;x=w,w=E}if(x>c&&(c=x),w<d&&(d=w),c>d)return null}return c}function TI(n,e,i,a,c,d,f,_,x,w,E){const A=a-n,M=c-e,L=d-i,k=f-n,F=_-e,$=x-i,q=E[1]*$-E[2]*F,ee=E[2]*k-E[0]*$,K=E[0]*F-E[1]*k,B=A*q+M*ee+L*K;if(Math.abs(B)<1e-15)return null;const Z=1/B,J=w[0]-n,oe=w[1]-e,_e=w[2]-i,Se=(J*q+oe*ee+_e*K)*Z;if(Se<0||Se>1)return null;const Ae=oe*L-_e*M,De=_e*A-J*L,qe=J*M-oe*A,rt=(E[0]*Ae+E[1]*De+E[2]*qe)*Z;return rt<0||Se+rt>1?null:(k*Ae+F*De+$*qe)*Z}function SI(n,e,i){return(n-e)/(i-e)}function EI(n,e,i,a,c,d,f,_,x){const w=1<<i,E=d-a,A=f-c,M=(n+1)/w*E+a,L=(e+0)/w*A+c,k=(e+1)/w*A+c;_[0]=(n+0)/w*E+a,_[1]=L,x[0]=M,x[1]=k}class II{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(d){const f=Math.ceil(Math.log2(d.dim/8)),_=[];let x=Math.ceil(Math.pow(2,f));const w=1/x,E=(L,k,F,$,q)=>{const ee=$?1:0,K=(L+1)*F-ee,B=k*F,Z=(k+1)*F-ee;q[0]=L*F,q[1]=B,q[2]=K,q[3]=Z};let A=new bI(x);const M=[];for(let L=0;L<x*x;L++){E(L%x,Math.floor(L/x),w,!1,M);const k=Hc(M[0],M[1],d),F=Hc(M[2],M[1],d),$=Hc(M[2],M[3],d),q=Hc(M[0],M[3],d);A.minimums.push(Math.min(k,F,$,q)),A.maximums.push(Math.max(k,F,$,q)),A.leaves.push(1)}for(_.push(A),x/=2;x>=1;x/=2){const L=_[_.length-1];A=new bI(x);for(let k=0;k<x*x;k++){E(k%x,Math.floor(k/x),2,!0,M);const F=L.getElevation(M[0],M[1]),$=L.getElevation(M[2],M[1]),q=L.getElevation(M[2],M[3]),ee=L.getElevation(M[0],M[3]),K=L.isLeaf(M[0],M[1]),B=L.isLeaf(M[2],M[1]),Z=L.isLeaf(M[2],M[3]),J=L.isLeaf(M[0],M[3]),oe=Math.min(F.min,$.min,q.min,ee.min),_e=Math.max(F.max,$.max,q.max,ee.max),Se=K&&B&&Z&&J;A.maximums.push(_e),A.minimums.push(oe),A.leaves.push(_e-oe<=5&&Se?1:0)}_.push(A)}return _}(this.dem),a=i.length-1,c=i[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,c,d,f,_=1){return wI([e,i,-100],[a,c,this.maximums[0]*_],d,f)}raycast(e,i,a,c,d,f,_=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,i,a,c,d,f,_);if(x==null)return null;const w=[],E=[],A=[],M=[],L=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:k,t:F,nodex:$,nodey:q,depth:ee}=L.pop();if(this.leaves[k]){EI($,q,ee,e,i,a,c,A,M);const B=1<<ee,Z=($+0)/B,J=($+1)/B,oe=(q+0)/B,_e=(q+1)/B,Se=Hc(Z,oe,this.dem)*_,Ae=Hc(J,oe,this.dem)*_,De=Hc(J,_e,this.dem)*_,qe=Hc(Z,_e,this.dem)*_,rt=TI(A[0],A[1],Se,M[0],A[1],Ae,M[0],M[1],De,d,f),Je=TI(M[0],M[1],De,A[0],M[1],qe,A[0],A[1],Se,d,f),nt=Math.min(rt!==null?rt:Number.MAX_VALUE,Je!==null?Je:Number.MAX_VALUE);if(nt!==Number.MAX_VALUE)return nt;{const lt=ii([],d,f,F);if(AI(Se,Ae,qe,De,SI(lt[0],A[0],M[0]),SI(lt[1],A[1],M[1]))>=lt[2])return F}continue}let K=0;for(let B=0;B<this._siblingOffset.length;B++){EI(($<<1)+this._siblingOffset[B][0],(q<<1)+this._siblingOffset[B][1],ee+1,e,i,a,c,A,M),A[2]=-100,M[2]=this.maximums[this.childOffsets[k]+B]*_;const Z=wI(A,M,d,f);if(Z!=null){const J=Z;w[B]=J;let oe=!1;for(let _e=0;_e<K&&!oe;_e++)J>=w[E[_e]]&&(E.splice(_e,0,B),oe=!0);oe||(E[K]=B),K++}}for(let B=0;B<K;B++){const Z=E[B];L.push({idx:this.childOffsets[k]+Z,t:w[Z],nodex:($<<1)+this._siblingOffset[Z][0],nodey:(q<<1)+this._siblingOffset[Z][1],depth:ee+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,c,d){if(e[c].isLeaf(i,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const f=c-1,_=e[f];let x=0,w=0;for(let E=0;E<this._siblingOffset.length;E++){const A=2*i+this._siblingOffset[E][0],M=2*a+this._siblingOffset[E][1],L=_.getElevation(A,M),k=_.isLeaf(A,M),F=this._addNode(L.min,L.max,k);k&&(x|=1<<E),w||(w=F)}for(let E=0;E<this._siblingOffset.length;E++)x&1<<E||this._construct(e,2*i+this._siblingOffset[E][0],2*a+this._siblingOffset[E][1],f,w+E)}}function AI(n,e,i,a,c,d){return qt(qt(n,i,d),qt(e,a,d),c)}function Hc(n,e,i){const a=i.dim,c=Me(n*a-.5,0,a-1),d=Me(e*a-.5,0,a-1),f=Math.floor(c),_=Math.floor(d),x=Math.min(f+1,a-1),w=Math.min(_+1,a-1);return AI(i.get(f,_),i.get(x,_),i.get(f,w),i.get(x,w),c-f,d-_)}const t3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function i3(n,e,i){return(256*n*256+256*e+i)/10-1e4}function n3(n,e,i){return 256*n+e+i/256-32768}class t0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void Ci(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const d=this.dim=i.height-2,f=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let x=0;x<d;x++)f[this._idx(-1,x)]=f[this._idx(0,x)],f[this._idx(d,x)]=f[this._idx(d-1,x)],f[this._idx(x,-1)]=f[this._idx(x,0)],f[this._idx(x,d)]=f[this._idx(x,d-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(d,-1)]=f[this._idx(d-1,0)],f[this._idx(-1,d)]=f[this._idx(0,d-1)],f[this._idx(d,d)]=f[this._idx(d-1,d-1)]}const _=a==="terrarium"?n3:i3;for(let x=0;x<f.length;++x){const w=4*x;this.floatView[x]=_(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=ps.now()}_buildQuadTree(){this._tree=new II(this)}get(e,i,a=!1){a&&(e=Me(e,-1,this.dim),i=Me(i,-1,this.dim));const c=this._idx(e,i);return this.floatView[c]}set(e,i,a){const c=this._idx(e,i),d=this.floatView[c];return this.floatView[c]=a,a-d}static getUnpackVector(e){return t3[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const a=[0,0,0,0],c=t0.getUnpackVector(i);let d=Math.floor((e+c[3])/c[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new C2({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,d=i*this.dim+this.dim,f=a*this.dim,_=a*this.dim+this.dim;switch(i){case-1:c=d-1;break;case 1:d=c+1}switch(a){case-1:f=_-1;break;case 1:_=f+1}const x=-i*this.dim,w=-a*this.dim;for(let E=f;E<_;E++)for(let A=c;A<d;A++){const M=4*this._idx(A,E),L=4*this._idx(A+x,E+w);this.pixels[M+0]=e.pixels[L+0],this.pixels[M+1]=e.pixels[L+1],this.pixels[M+2]=e.pixels[L+2],this.pixels[M+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function r3(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push(function(a,c){return a.readFields(c3,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},c)}(i,i.readVarint()+i.pos))}function o3(n,e,i){n===1?(e.delta_filter=function(a,c){return a.readFields(s3,{blockSize:0},c)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function s3(n,e,i){n===1&&(e.blockSize=i.readVarint())}function a3(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function l3(n,e,i){let a=0,c=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push(function(d,f){return d.readFields(o3,{},f)}(i,i.readVarint()+i.pos)):n===4?e.codec=function(d,f){return d.readFields(a3,{},f)}(i,i.readVarint()+i.pos):n===5?c=i.readFloat():n===6?a=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=c),e.scale===0&&(e.scale=a)}function c3(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push(function(a,c){return a.readFields(l3,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},c)}(i,i.readVarint()+i.pos))}function u3(n,e,i){if(n===2)(function(a,c,d){a.readFields(h3,d,c)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function h3(n,e,i){if(n===1){let a=0;const c=i.readVarint()+i.pos;for(;i.pos<c;)e[a++]=i.readVarint()}}function d3(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let a=2;a>=1;a--){const c=a===1?1:0,d=a===2?1:0;for(let f=0;f<e[0];f++){const _=e[1]*f;for(let x=c;x<e[1];x++){const w=e[2]*(x+_);for(let E=d;E<e[2];E++){const A=e[3]*(E+w);for(let M=0;M<e[3];M++){const L=A+M;n[L]+=n[L-i]}}}}i*=e[a]}return n}function f3(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function p3(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const a=n[i],c=n[i+1];n[i]=(240&a)>>4|(61440&a)>>8|(240&c)<<4|61440&c,n[i+1]=15&a|(3840&a)>>4|(15&c)<<8|(3840&c)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const a=n[i],c=n[i+1],d=n[i+2],f=n[i+3];n[i+0]=(192&a)>>6|(192&c)>>4|(192&d)>>2|192&f,n[i+1]=(48&a)>>4|(48&c)>>2|48&d|(48&f)<<2,n[i+2]=(12&a)>>2|12&c|(12&d)<<2|(12&f)<<4,n[i+3]=3&a|(3&c)<<2|(3&d)<<4|(3&f)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}At(t0,"DEMData"),At(II,"DemMinMaxQuadTree",{omit:["dem"]});var Es=Uint8Array,qm=Uint16Array,m3=Int32Array,CI=new Es([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),MI=new Es([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),g3=new Es([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),PI=function(n,e){for(var i=new qm(31),a=0;a<31;++a)i[a]=e+=1<<n[a-1];var c=new m3(i[30]);for(a=1;a<30;++a)for(var d=i[a];d<i[a+1];++d)c[d]=d-i[a]<<5|a;return{b:i,r:c}},RI=PI(CI,2),zI=RI.b,_3=RI.r;zI[28]=258,_3[258]=28;for(var y3=PI(MI,0).b,DI=new qm(32768),hr=0;hr<32768;++hr){var hf=(43690&hr)>>1|(21845&hr)<<1;DI[hr]=((65280&(hf=(61680&(hf=(52428&hf)>>2|(13107&hf)<<2))>>4|(3855&hf)<<4))>>8|(255&hf)<<8)>>1}var Wm=function(n,e,i){for(var a=n.length,c=0,d=new qm(e);c<a;++c)n[c]&&++d[n[c]-1];var f,_=new qm(e);for(c=1;c<e;++c)_[c]=_[c-1]+d[c-1]<<1;f=new qm(1<<e);var x=15-e;for(c=0;c<a;++c)if(n[c])for(var w=c<<4|n[c],E=e-n[c],A=_[n[c]-1]++<<E,M=A|(1<<E)-1;A<=M;++A)f[DI[A]>>x]=w;return f},Zm=new Es(288);for(hr=0;hr<144;++hr)Zm[hr]=8;for(hr=144;hr<256;++hr)Zm[hr]=9;for(hr=256;hr<280;++hr)Zm[hr]=7;for(hr=280;hr<288;++hr)Zm[hr]=8;var LI=new Es(32);for(hr=0;hr<32;++hr)LI[hr]=5;var v3=Wm(Zm,9),x3=Wm(LI,5),U1=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},_a=function(n,e,i){var a=e/8|0;return(n[a]|n[a+1]<<8)>>(7&e)&i},G1=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},b3=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ya=function(n,e,i){var a=new Error(e||b3[n]);if(a.code=n,Error.captureStackTrace&&Error.captureStackTrace(a,ya),!i)throw a;return a},w3=new Es(0),T3=typeof TextDecoder<"u"&&new TextDecoder;try{T3.decode(w3,{stream:!0})}catch{}const S3={gzip_data:"gzip"};class qs extends Error{constructor(e){super(e),this.name="MRTError"}}const E3={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},kI={uint32:1,uint16:2,uint8:4},I3={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let $1;class i0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new qs(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),a=new DataView(e);if(i[0]!==13)throw new qs("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),a=this.getHeaderLength(e);if(i.length<a)throw new qs(`Expected header with length >= ${a} but got buffer of length ${i.length}`);const c=function(d,f){return d.readFields(r3,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new $1(i.subarray(0,a)));if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new qs(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const d of c.layers)this.layers[d.name]=new OI(d,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],a=this.getLayer(e.layerName);for(let c of e.blockIndices){const d=a.dataIndex[c],f=d.firstByte-e.firstByte,_=d.lastByte-e.firstByte;if(a._blocksInProgress.has(c))continue;const x={layerName:a.name,firstByte:f,lastByte:_,pixelFormat:a.pixelFormat,blockIndex:c,blockShape:[d.bands.length].concat(a.bandShape),buffer:a.buffer,codec:d.codec.codec,filters:d.filters.map(w=>w.filter)};a._blocksInProgress.add(c),i.push(x)}return new FI(i,()=>{i.forEach(c=>a._blocksInProgress.delete(c.blockIndex))},(c,d)=>{if(i.forEach(f=>a._blocksInProgress.delete(f.blockIndex)),c)throw c;d.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class OI{constructor({version:e,name:i,units:a,tileSize:c,pixelFormat:d,buffer:f,dataIndex:_},x){if(this.version=e,this.version!==1)throw new qs(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=a,this.tileSize=c,this.buffer=f,this.pixelFormat=E3[d],this.dataIndex=_,this.bandShape=[c+2*f,c+2*f,kI[this.pixelFormat]],this._decodedBlocks=new e0(x?x.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return kI[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[a,c]of this.dataIndex.entries()){for(const[d,f]of c.bands.entries())if(f===e)return{bandIndex:i+d,blockIndex:a,blockBandIndex:d};i+=c.bands.length}break;case"number":for(const[a,c]of this.dataIndex.entries()){if(e>=i&&e<i+c.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-i};i+=c.bands.length}break;default:throw new qs(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,a=-1/0;const c=[],d=new Set;for(const f of e){const{blockIndex:_}=this.getBlockForBand(f);if(_<0)throw new qs(`Invalid band: ${JSON.stringify(f)}`);const x=this.dataIndex[_];c.includes(_)||c.push(_),d.add(_),i=Math.min(i,x.firstByte),a=Math.max(a,x.lastByte)}if(d.size>this.cacheSize)throw new qs(`Number of blocks to decode (${d.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:a,blockIndices:c}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:a}=this.getBlockForBand(e);if(i<0)throw new qs(`Band not found: ${JSON.stringify(e)}`);const c=this._decodedBlocks.get(i.toString());if(!c)throw new qs(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[i],f=this.bandShape.reduce((w,E)=>w*E,1),_=a*f,x=c.subarray(_,_+f);return{data:x,bytes:new Uint8Array(x.buffer).subarray(x.byteOffset,x.byteOffset+x.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:d.offset,scale:d.scale}}}i0.setPbf=function(n){$1=n};class FI{constructor(e,i,a){this.tasks=e,this._onCancel=i,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}i0.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map(a=>{const{layerName:c,firstByte:d,lastByte:f,pixelFormat:_,blockShape:x,blockIndex:w,filters:E,codec:A}=a,M=i.subarray(d,f+1),L=new Uint32Array(x[0]*x[1]*x[2]);let k;if(A!=="gzip_data")throw new qs(`Unhandled codec: ${A}`);return k=function(F,$){if(!globalThis.DecompressionStream&&$==="gzip_data")return Promise.resolve(((B=function(oe){oe[0]==31&&oe[1]==139&&oe[2]==8||ya(6,"invalid gzip data");var _e=oe[3],Se=10;4&_e&&(Se+=2+(oe[10]|oe[11]<<8));for(var Ae=(_e>>3&1)+(_e>>4&1);Ae>0;Ae-=!oe[Se++]);return Se+(2&_e)}(K=F))+8>K.length&&ya(6,"invalid gzip data"),function(oe,_e,Se,Ae){var De=oe.length;if(!De||_e.f&&!_e.l)return Se||new Es(0);var qe=!Se,rt=qe||_e.i!=2,Je=_e.i;qe&&(Se=new Es(3*De));var nt,lt,$e=function(Wn){var bn=Se.length;if(Wn>bn){var hn=new Es(Math.max(2*bn,Wn));hn.set(Se),Se=hn}},it=_e.f||0,je=_e.p||0,He=_e.b||0,ut=_e.l,ht=_e.d,Ft=_e.m,Mt=_e.n,bt=8*De;do{if(!ut){it=_a(oe,je,1);var ct=_a(oe,je+1,3);if(je+=3,!ct){var ri=oe[(ie=4+((je+7)/8|0))-4]|oe[ie-3]<<8,Dt=ie+ri;if(Dt>De){Je&&ya(0);break}rt&&$e(He+ri),Se.set(oe.subarray(ie,Dt),He),_e.b=He+=ri,_e.p=je=8*Dt,_e.f=it;continue}if(ct==1)ut=v3,ht=x3,Ft=9,Mt=5;else if(ct==2){var Lt=_a(oe,je,31)+257,Kt=_a(oe,je+10,15)+4,di=Lt+_a(oe,je+5,31)+1;je+=14;for(var pi=new Es(di),Si=new Es(19),yi=0;yi<Kt;++yi)Si[g3[yi]]=_a(oe,je+3*yi,7);je+=3*Kt;var gi=U1(Si),sn=(1<<gi)-1,gn=Wm(Si,gi);for(yi=0;yi<di;){var ie,se=gn[_a(oe,je,sn)];if(je+=15&se,(ie=se>>4)<16)pi[yi++]=ie;else{var Ze=0,mt=0;for(ie==16?(mt=3+_a(oe,je,3),je+=2,Ze=pi[yi-1]):ie==17?(mt=3+_a(oe,je,7),je+=3):ie==18&&(mt=11+_a(oe,je,127),je+=7);mt--;)pi[yi++]=Ze}}var St=pi.subarray(0,Lt),Tt=pi.subarray(Lt);Ft=U1(St),Mt=U1(Tt),ut=Wm(St,Ft),ht=Wm(Tt,Mt)}else ya(1);if(je>bt){Je&&ya(0);break}}rt&&$e(He+131072);for(var kt=(1<<Ft)-1,Yt=(1<<Mt)-1,Ri=je;;Ri=je){var zi=(Ze=ut[G1(oe,je)&kt])>>4;if((je+=15&Ze)>bt){Je&&ya(0);break}if(Ze||ya(2),zi<256)Se[He++]=zi;else{if(zi==256){Ri=je,ut=null;break}var _i=zi-254;zi>264&&(_i=_a(oe,je,(1<<(Di=CI[yi=zi-257]))-1)+zI[yi],je+=Di);var Ki=ht[G1(oe,je)&Yt],un=Ki>>4;if(Ki||ya(3),je+=15&Ki,Tt=y3[un],un>3){var Di=MI[un];Tt+=G1(oe,je)&(1<<Di)-1,je+=Di}if(je>bt){Je&&ya(0);break}rt&&$e(He+131072);var On=He+_i;if(He<Tt){var _n=0-Tt,Zi=Math.min(Tt,On);for(_n+He<0&&ya(3);He<Zi;++He)Se[He]=(void 0)[_n+He]}for(;He<On;++He)Se[He]=Se[He-Tt]}}_e.l=ut,_e.p=Ri,_e.b=He,_e.f=it,ut&&(it=1,_e.m=Ft,_e.d=ht,_e.n=Mt)}while(!it);return He!=Se.length&&qe?(nt=Se,((lt=He)==null||lt>nt.length)&&(lt=nt.length),new Es(nt.subarray(0,lt))):Se.subarray(0,He)}(K.subarray(B,-8),{i:2},new Es(((q=K)[(ee=q.length)-4]|q[ee-3]<<8|q[ee-2]<<16|q[ee-1]<<24)>>>0))));var q,ee,K,B;const Z=S3[$];if(!Z)throw new Error(`Unhandled codec: ${$}`);const J=new globalThis.DecompressionStream(Z);return new Response(new Blob([F]).stream().pipeThrough(J)).arrayBuffer().then(oe=>new Uint8Array(oe))}(M,A).then(F=>(function($,q){$.readFields(u3,q)}(new $1(F),L),new I3[_](L.buffer))),k.then(F=>{for(let $=E.length-1;$>=0;$--)switch(E[$]){case"delta_filter":d3(F,x);break;case"zigzag_filter":f3(F);break;case"bitshuffle_filter":p3(F,_);break;default:throw new qs(`Unhandled filter "${E[$]}"`)}return{layerName:c,blockIndex:w,data:F}}).catch(F=>{throw F})}))},At(FI,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),At(i0,"MapboxRasterTile"),At(OI,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let Xm,H1,va,df,q1,ff=null;function BI(){return pn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:H1||Fr.DRACO_URL}function NI(){if(pn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(df)return df;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return df=WebAssembly.validate(n)?Fr.MESHOPT_SIMD_URL:Fr.MESHOPT_URL,df}const n0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},A3={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ym={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function jI(n,e,i){const a=i.json.bufferViews.length,c=i.buffers.length;e.bufferView=a,i.json.bufferViews[a]={buffer:c,byteLength:n.byteLength},i.buffers[c]=n}const W1="KHR_draco_mesh_compression";function C3(n,e){const i=n.extensions&&n.extensions[W1];if(!i)return;const a=new va.Decoder,c=$I(e,i.bufferView),d=new va.Mesh;if(!a.DecodeArrayToMesh(c,c.byteLength,d))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[n.indices],_=n0[f.componentType],x=f.count*_.BYTES_PER_ELEMENT,w=va._malloc(x);_===Uint16Array?a.GetTrianglesUInt16Array(d,x,w):a.GetTrianglesUInt32Array(d,x,w),jI(va.memory.buffer.slice(w,w+x),f,e),va._free(w);for(const E of Object.keys(i.attributes)){const A=a.GetAttributeByUniqueId(d,i.attributes[E]),M=e.json.accessors[n.attributes[E]],L=A3[M.componentType],k=M.count*Ym[M.type]*n0[M.componentType].BYTES_PER_ELEMENT,F=va._malloc(k);a.GetAttributeDataArrayForAllPoints(d,A,va[L],k,F),jI(va.memory.buffer.slice(F,F+k),M,e),va._free(F)}a.destroy(),d.destroy(),delete n.extensions[W1]}const r0="EXT_meshopt_compression";function M3(n,e){if(!n.extensions||!n.extensions[r0])return;const i=n.extensions[r0],a=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),c=new Uint8Array(i.count*i.byteStride);q1.decodeGltfBuffer(c,i.count,i.byteStride,a,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=c.buffer,delete n.extensions[r0]}const VI=1179937895,UI=new TextDecoder("utf8");function GI(n,e){return new URL(n,e).href}function P3(n,e,i,a){return fetch(GI(n.uri,a)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[i]=c})}function $I(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function R3(n,e,i,a){if(n.uri){const c=GI(n.uri,a);return fetch(c).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[i]=d})}if(n.bufferView!==void 0){const c=$I(e,n.bufferView),d=new Blob([c],{type:n.mimeType});return createImageBitmap(d).then(f=>{e.images[i]=f})}}function HI(n,e=0,i){const a={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===VI){const E=new Uint32Array(n,e);let A=2;const M=(E[A++]>>2)-3,L=E[A++]>>2;if(A++,a.json=JSON.parse(UI.decode(E.subarray(A,A+L))),A+=L,A<M){const k=E[A++];A++;const F=e+(A<<2);a.buffers[0]=n.slice(F,F+k)}}else a.json=JSON.parse(UI.decode(new Uint8Array(n,e)));const{buffers:c,images:d,meshes:f,extensionsUsed:_,bufferViews:x}=a.json;let w=Promise.resolve();if(c){const E=[];for(let A=0;A<c.length;A++){const M=c[A];M.uri?E.push(P3(M,a,A,i)):a.buffers[A]||(a.buffers[A]=null)}w=Promise.all(E)}return w.then(()=>{const E=[],A=_&&_.includes(W1),M=_&&_.includes(r0);if(A&&E.push(function(){if(!va)return Xm??(Xm=function(L){let k,F=null;function $(){k=new Uint8Array(F.buffer)}function q(){throw new Error("Unexpected Draco error.")}const ee={a:{a:q,d:function(K,B,Z){return k.copyWithin(K,B,B+Z)},c:function(K){const B=k.length,Z=Math.max(K>>>0,Math.ceil(1.2*B)),J=Math.ceil((Z-B)/65536);try{return F.grow(J),$(),!0}catch{return!1}},b:q}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(L,ee):L.then(K=>K.arrayBuffer()).then(K=>WebAssembly.instantiate(K,ee))).then(K=>{const{Rb:B,Qb:Z,P:J,T:oe,X:_e,Ja:Se,La:Ae,Qa:De,Va:qe,Wa:rt,eb:Je,jb:nt,f:lt,e:$e,yb:it,zb:je,Ab:He,Bb:ut,Db:ht,Gb:Ft}=K.instance.exports;F=$e;const Mt=(()=>{let bt=0,ct=0,ri=0,Dt=0;return Lt=>{ri&&(B(Dt),B(bt),ct+=ri,ri=bt=0),bt||(ct+=128,bt=Z(ct));const Kt=Lt.length+7&-8;let di=bt;Kt>=ct&&(ri=Kt,di=Dt=Z(Kt));for(let pi=0;pi<Lt.length;pi++)k[di+pi]=Lt[pi];return di}})();return $(),lt(),{memory:$e,_free:B,_malloc:Z,Mesh:class{constructor(){this.ptr=J()}destroy(){oe(this.ptr)}},Decoder:class{constructor(){this.ptr=Se()}destroy(){nt(this.ptr)}DecodeArrayToMesh(bt,ct,ri){const Dt=Mt(bt),Lt=Ae(this.ptr,Dt,ct,ri.ptr);return!!_e(Lt)}GetAttributeByUniqueId(bt,ct){return{ptr:De(this.ptr,bt.ptr,ct)}}GetTrianglesUInt16Array(bt,ct,ri){qe(this.ptr,bt.ptr,ct,ri)}GetTrianglesUInt32Array(bt,ct,ri){rt(this.ptr,bt.ptr,ct,ri)}GetAttributeDataArrayForAllPoints(bt,ct,ri,Dt,Lt){Je(this.ptr,bt.ptr,ct.ptr,ri,Dt,Lt)}},DT_INT8:it(),DT_UINT8:je(),DT_INT16:He(),DT_UINT16:ut(),DT_UINT32:ht(),DT_FLOAT32:Ft()}})}(fetch(BI())),Xm.then(L=>{va=L,Xm=void 0}))}()),M&&E.push(function(){if(q1)return;const L=function(k){let F;const $=WebAssembly.instantiateStreaming(k,{}).then(K=>{F=K.instance,F.exports.__wasm_call_ctors()}),q={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ee={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:$,supported:!0,decodeGltfBuffer(K,B,Z,J,oe,_e){(function(Se,Ae,De,qe,rt,Je,nt){const lt=Se.exports.sbrk,$e=qe+3&-4,it=lt($e*rt),je=lt(Je.length),He=new Uint8Array(Se.exports.memory.buffer);He.set(Je,je);const ut=Ae(it,qe,rt,je,Je.length);if(ut===0&&nt&&nt(it,$e,rt),De.set(He.subarray(it,it+qe*rt)),lt(it-lt(0)),ut!==0)throw new Error(`Malformed buffer data: ${ut}`)})(F,F.exports[ee[oe]],K,B,Z,J,F.exports[q[_e]])}}}(fetch(NI()));return L.ready.then(()=>{q1=L})}()),d)for(let L=0;L<d.length;L++)E.push(R3(d[L],a,L,i));return(E.length?Promise.all(E):Promise.resolve()).then(()=>{if(A&&f)for(const{primitives:L}of f)for(const k of L)C3(k,a);if(M&&f&&x)for(const L of x)M3(L,a);return a})})}function Sh(n,e){const i=n.json.bufferViews[e.bufferView],a=n0[e.componentType];return new a(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Ym[e.type]*a.BYTES_PER_ELEMENT?i.byteStride/a.BYTES_PER_ELEMENT:Ym[e.type]))}function Z1(n,e,i,a){const c=n0[e.componentType],d=function(E){switch(E){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),f=n.json.bufferViews[e.bufferView],_=f.byteStride?f.byteStride/c.BYTES_PER_ELEMENT:Ym[e.type],x=i.float32,w=x.length/i.capacity;for(let E=0,A=0;E<e.count*_;E+=_,A+=w)for(let M=0;M<w;M++)x[A+M]=a[E+M]*d;i._trim()}function z3(n,e,i){const a=n.indices,c=n.attributes,d={};d.indexArray=new vr;const f=e.json.accessors[a],_=f.count/3;d.indexArray.reserve(_);const x=Sh(e,f);for(let M=0;M<_;M++)d.indexArray.emplaceBack(x[3*M],x[3*M+1],x[3*M+2]);d.indexArray._trim(),d.vertexArray=new Vs;const w=e.json.accessors[c.POSITION];d.vertexArray.reserve(w.count);const E=Sh(e,w);for(let M=0;M<w.count;M++)d.vertexArray.emplaceBack(E[3*M],E[3*M+1],E[3*M+2]);if(d.vertexArray._trim(),d.aabb=new An(w.min,w.max),d.centroid=function(M,L){const k=[0,0,0],F=M.length;if(F>0){for(let $=0;$<F;$++){const q=3*M[$];k[0]+=L[q],k[1]+=L[q+1],k[2]+=L[q+2]}k[0]/=F,k[1]/=F,k[2]/=F}return k}(x,E),c.COLOR_0!==void 0){const M=e.json.accessors[c.COLOR_0],L=Ym[M.type],k=Sh(e,M);d.colorArray=L===3?new Vs:new Us,d.colorArray.resize(M.count),Z1(e,M,d.colorArray,k)}if(c.NORMAL!==void 0){d.normalArray=new Vs;const M=e.json.accessors[c.NORMAL];d.normalArray.resize(M.count);const L=Sh(e,M);Z1(e,M,d.normalArray,L)}if(c.TEXCOORD_0!==void 0&&i.length>0){d.texcoordArray=new Fl;const M=e.json.accessors[c.TEXCOORD_0];d.texcoordArray.resize(M.count);const L=Sh(e,M);Z1(e,M,d.texcoordArray,L)}if(c._FEATURE_ID_RGBA4444!==void 0){const M=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=Sh(e,M))}c._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(Sh(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const A=n.material;return d.material=function(M,L){const{emissiveFactor:k=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:$=.5,normalTexture:q,occlusionTexture:ee,emissiveTexture:K,doubleSided:B}=M,{baseColorFactor:Z=[1,1,1,1],metallicFactor:J=1,roughnessFactor:oe=1,baseColorTexture:_e,metallicRoughnessTexture:Se}=M.pbrMetallicRoughness||{},Ae=ee?L[ee.index]:void 0;if(ee&&ee.extensions&&ee.extensions.KHR_texture_transform&&Ae){const De=ee.extensions.KHR_texture_transform;Ae.offsetScale=[De.offset[0],De.offset[1],De.scale[0],De.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Hi(...Z),metallicFactor:J,roughnessFactor:oe,baseColorTexture:_e?L[_e.index]:void 0,metallicRoughnessTexture:Se?L[Se.index]:void 0},doubleSided:B,emissiveFactor:k,alphaMode:F,alphaCutoff:$,normalTexture:q?L[q.index]:void 0,occlusionTexture:Ae,emissionTexture:K?L[K.index]:void 0,defined:M.defined===void 0}}(A!==void 0?e.json.materials[A]:{defined:!1},i),d}function qI(n,e,i){const{matrix:a,rotation:c,translation:d,scale:f,mesh:_,extras:x,children:w}=n,E={};if(E.matrix=a||function(A,M,L,k){var F=M[0],$=M[1],q=M[2],ee=M[3],K=F+F,B=$+$,Z=q+q,J=F*K,oe=F*B,_e=F*Z,Se=$*B,Ae=$*Z,De=q*Z,qe=ee*K,rt=ee*B,Je=ee*Z,nt=k[0],lt=k[1],$e=k[2];return A[0]=(1-(Se+De))*nt,A[1]=(oe+Je)*nt,A[2]=(_e-rt)*nt,A[3]=0,A[4]=(oe-Je)*lt,A[5]=(1-(J+De))*lt,A[6]=(Ae+qe)*lt,A[7]=0,A[8]=(_e+rt)*$e,A[9]=(Ae-qe)*$e,A[10]=(1-(J+Se))*$e,A[11]=0,A[12]=L[0],A[13]=L[1],A[14]=L[2],A[15]=1,A}([],c||[0,0,0,1],d||[0,0,0],f||[1,1,1]),_!==void 0){E.meshes=i[_];const A=E.anchor=[0,0];for(const M of E.meshes){const{min:L,max:k}=M.aabb;A[0]+=L[0]+k[0],A[1]+=L[1]+k[1]}A[0]=Math.floor(A[0]/E.meshes.length/2),A[1]=Math.floor(A[1]/E.meshes.length/2)}if(x&&(x.id&&(E.id=x.id),x.lights&&(E.lights=function(A){if(!A.length)return[];const M=function(q){const ee=atob(q),K=new Uint8Array(ee.length);for(let B=0;B<ee.length;B++)K[B]=ee.codePointAt(B);return K}(A),L=[],k=M.length/24,F=new Uint16Array(M.buffer),$=new Float32Array(M.buffer);for(let q=0;q<k;q++){const ee=F[2*q*6]/30,K=F[2*q*6+1]/30,B=F[2*q*6+10]/100,Z=$[6*q+1],J=$[6*q+2],oe=$[6*q+3],_e=$[6*q+4],Se=oe-Z,Ae=_e-J,De=Math.hypot(Se,Ae);L.push({pos:[Z+.5*Se,J+.5*Ae,K],normal:[Ae/De,-Se/De,0],width:De,height:ee,depth:B,points:[Z,J,oe,_e]})}return L}(x.lights))),w){const A=[];for(const M of w)A.push(qI(e.json.nodes[M],e,i));E.children=A}return E}function D3(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new Qx(n.vertices,n.indices,8,256),[i,a]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:a}}function L3(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const a=[];for(const f of i){if(!Array.isArray(f)||f.length!==2)continue;const _=f[0],x=f[1];typeof _=="number"&&typeof x=="number"&&a.push(new gt(_,x))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let c=0;for(let f=0;f<a.length;f++){const _=a[f],x=a[(f+1)%a.length],w=a[(f+2)%a.length];c+=(_.x-x.x)*(w.y-x.y)-(w.x-x.x)*(_.y-x.y)}c>0&&a.reverse();const d=vm(a.flatMap(f=>[f.x,f.y]),[]);return d.length===0?null:{vertices:a,indices:d}}function k3(n,e){const i=[],a=[];let c=0;const d=[];for(const f of n){c=i.length;const _=f.vertexArray.float32,x=f.indexArray.uint16;for(let w=0;w<f.vertexArray.length;w++)d[0]=_[3*w+0],d[1]=_[3*w+1],d[2]=_[3*w+2],fn(d,d,e),i.push(new gt(d[0],d[1]));for(let w=0;w<3*f.indexArray.length;w++)a.push(x[w]+c)}if(a.length%3!=0)return null;for(let f=0;f<a.length;f+=3){const _=i[a[f+0]],x=i[a[f+1]],w=i[a[f+2]];(_.x-x.x)*(w.y-x.y)-(w.x-x.x)*(_.y-x.y)>0&&([a[f+1],a[f+2]]=[a[f+2],a[f+1]])}return{vertices:i,indices:a}}function WI(n){const e=function(x,w){const E=[],A=WebGL2RenderingContext;if(x.json.textures)for(const M of x.json.textures){const L={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};M.sampler!==void 0&&Object.assign(L,x.json.samplers[M.sampler]),E.push({image:w[M.source],sampler:L,uploaded:!1})}return E}(n,n.images),i=function(x,w){const E=[];for(const A of x.json.meshes){const M=[];for(const L of A.primitives)M.push(z3(L,x,w));E.push(M)}return E}(n,e),{scenes:a,scene:c,nodes:d}=n.json,f=a?a[c||0].nodes:d,_=[];for(const x of f)_.push(qI(d[x],n,i));return function(x,w,E){const A={},M=new Set;for(let L=0;L<x.length;L++){const k=E[w[L]];if(!k.extras)continue;const F=k.extras["mapbox:footprint:version"],$=k.extras["mapbox:footprint:id"];(F||$)&&M.add(L),F==="1.0.0"&&$&&(A[$]=L)}for(let L=0;L<x.length;L++){if(M.has(L))continue;const k=x[L],F=E[w[L]];if(!F.extras)continue;let $=null;k.id in A&&($=k3(x[A[k.id]].meshes,k.matrix)),$||($=L3(F)),$&&(k.footprint=D3($))}if(M.size>0){const L=Array.from(M.values()).sort((k,F)=>k-F);for(let k=L.length-1;k>=0;k--)x.splice(L[k],1)}}(_,f,n.json.nodes),_}function O3(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,a=n.aabb.min[1]-1,c=bh/(n.aabb.max[0]-i+2),d=bh/(n.aabb.max[1]-a+2);for(let f=0;f<e.length;f+=3){const _=e[f+2],x=(e[f+0]-i)*c|0,w=(e[f+1]-a)*d|0;_>n.heightmap[w*bh+x]&&(n.heightmap[w*bh+x]=_)}}function F3(n,e){const i={};i.indexArray=new vr,i.indexArray.reserve(4*n.length),i.vertexArray=new Vs,i.vertexArray.reserve(10*n.length),i.colorArray=new Us,i.vertexArray.reserve(10*n.length);let a=0;for(const f of n){const _=Math.min(10,Math.max(4,1.3*f.height))*e,x=[-f.normal[1],f.normal[0],0],w=Math.min(.29,.1*f.width/f.depth),E=f.width-2*f.depth*e*(w+.01),A=ii([],f.pos,x,E/2),M=ii([],f.pos,x,-E/2),L=[A[0],A[1],A[2]+f.height],k=[M[0],M[1],M[2]+f.height],F=ii([],f.normal,x,w);Gt(F,F,_);const $=ii([],f.normal,x,-w);Gt($,$,_),vi(F,A,F),vi($,M,$),A[2]+=.1,M[2]+=.1,i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack($[0],$[1],$[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(L[0],L[1],L[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack($[0],$[1],$[2]);const q=E/_/2;i.colorArray.emplaceBack(-q-w,-1,q,.8),i.colorArray.emplaceBack(q+w,-1,q,.8),i.colorArray.emplaceBack(-q,0,q,1.3),i.colorArray.emplaceBack(q,0,q,1.3),i.colorArray.emplaceBack(q+w,-.8,q,.7),i.colorArray.emplaceBack(q+w,-.8,q,.7),i.colorArray.emplaceBack(0,0,q,1.3),i.colorArray.emplaceBack(0,0,q,1.3),i.colorArray.emplaceBack(q+w,-1.2,q,.8),i.colorArray.emplaceBack(q+w,-1.2,q,.8),i.indexArray.emplaceBack(6+a,4+a,8+a),i.indexArray.emplaceBack(7+a,9+a,5+a),i.indexArray.emplaceBack(0+a,1+a,2+a),i.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const c={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=Hi.white,c.pbrMetallicRoughness=d,i.material=c,i.aabb=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class ZI{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const B3=["id","tile","layer","source","sourceLayer","state"];class pf{constructor(e,i,a,c,d){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=c,this.properties=e.properties,this.id=d}clone(){const e=new pf(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of B3)this[i]!==void 0&&(e[i]=this[i]);return e}}class XI{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Sc(vt,16,0),this.featureIndexArray=new ry,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,a,c,d,f=0,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,d,f);const w=this.grid;for(let E=0;E<i.length;E++){const A=i[E],M=[1/0,1/0,-1/0,-1/0];for(let L=0;L<A.length;L++){const k=A[L];M[0]=Math.min(M[0],k.x),M[1]=Math.min(M[1],k.y),M[2]=Math.max(M[2],k.x),M[3]=Math.max(M[3],k.y)}_!==0&&(M[0]-=_,M[1]-=_,M[2]+=_,M[3]+=_),M[0]<vt&&M[1]<vt&&M[2]>=0&&M[3]>=0&&w.insert(x,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Nc.VectorTile(new Ey(this.rawTileData)).layers,this.sourceLayerCoder=new ZI(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:a,transform:c,tileTransform:d,pixelPosMatrix:f,availableImages:_}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const x=a.bufferedTilespaceBounds,w=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(L,k,F,$)=>nr(a.bufferedTilespaceGeometry,L,k,F,$));w.sort(N3);let E=null;c.elevation&&w.length>0&&(E=lf.create(c.elevation,this.tileID));const A={};let M;for(let L=0;L<w.length;L++){const k=w[L];if(k===M)continue;M=k;const F=this.featureIndexArray.get(k);let $=null;this.is3DTile?this.loadMatchingModelFeature(A,F,e,a,c):this.loadMatchingFeature(A,F,e,_,(q,ee,K,B=0)=>($||($=Pt(q,this.tileID.canonical,d)),ee.queryIntersectsFeature(a,q,K,$,this.z,c,f,E,B)))}return A}loadMatchingFeature(e,i,a,c,d){const{featureIndex:f,bucketIndex:_,sourceLayerIndex:x,layoutVertexArrayOffset:w}=i,E=this.bucketLayerIDs[_],A=a.layers,M=Object.keys(A);if(M.length&&!function(q,ee){for(let K=0;K<q.length;K++)if(ee.indexOf(q[K])>=0)return!0;return!1}(M,E))return;const L=a.sourceCache,k=this.sourceLayerCoder.decode(x),F=this.vtLayers[k].feature(f),$=this.getId(F,k);for(let q=0;q<E.length;q++){const ee=E[q];if(!A[ee])continue;const{styleLayer:K,targets:B}=A[ee];let Z={};$!==void 0&&(Z=L.getFeatureState(K.sourceLayer,$));const J=!d||d(F,K,Z,w);if(!J)continue;const oe=new pf(F,this.z,this.x,this.y,$);oe.tile=this.tileID.canonical,oe.state=Z;let _e=this.serializedLayersCache.get(ee);_e||(_e=K.serialize(),_e.id=ee,this.serializedLayersCache.set(ee,_e)),oe.source=_e.source,oe.sourceLayer=_e["source-layer"],oe.layer=Ne({},_e),oe.layer.paint=YI(_e.paint,K.paint,F,Z,c),oe.layer.layout=YI(_e.layout,K.layout,F,Z,c);let Se=!1;for(const Ae of B){this.updateFeatureProperties(oe,Ae);const{filter:De}=Ae;if(De){if(F.properties=oe.properties,De.needGeometry){const qe=Nt(F,!0);if(!De.filter(new en(this.tileID.overscaledZ),qe,this.tileID.canonical))continue}else if(!De.filter(new en(this.tileID.overscaledZ),F))continue}Se=!0,Ae.targetId&&this.addFeatureVariant(oe,Ae)}Se&&this.appendToResult(e,ee,f,oe,J)}}loadMatchingModelFeature(e,i,a,c,d){const f=this.bucketLayerIDs[0][0],_=a.layers;if(!_[f])return;const{styleLayer:x,targets:w}=_[f];if(x.type!=="model")return;const E=c.tile,A=i.featureIndex,M=E.getBucket(x);if(!(M&&M instanceof Wy))return;const L=function(_e,Se,Ae,De){const qe=_e.getNodesInfo()[Se];if(qe.hiddenByReplacement||!qe.node.meshes)return;let rt=Number.MAX_VALUE;const Je=qe.node,nt=Ae.tile,lt=De.calculatePosMatrix(nt.tileID.toUnwrapped(),De.worldSize),$e=qe.evaluatedScale;let it=0;De.elevation&&Je.elevation&&(it=Je.elevation*De.elevation.exaggeration()),pe(lt,lt,[(Je.anchor?Je.anchor[0]:0)*($e[0]-1),(Je.anchor?Je.anchor[1]:0)*($e[1]-1),it]),we(lt,lt,$e);const je=Ae.queryGeometry,He=je.isPointQuery()?je.screenBounds:je.screenGeometry,ut=function(Ft){const Mt=he([],lt,Ft.matrix);he(Mt,De.expandedFarZProjMatrix,Mt);for(let bt=0;bt<Ft.meshes.length;++bt){const ct=Ft.meshes[bt];if(bt===Ft.lightMeshIndex)continue;const ri=XE(He,De,Mt,ct.aabb);ri!=null&&(rt=Math.min(ri,rt))}if(Ft.children)for(const bt of Ft.children)ut(bt)};if(ut(Je),rt===Number.MAX_VALUE)return;const ht=new U(0,0);return sI(nt.tileID.canonical,ht,qe.node.anchor[0],qe.node.anchor[1]),{intersectionZ:rt,position:ht,feature:qe.feature}}(M,A,c,d);if(!L)return;const{z:k,x:F,y:$}=E.tileID.canonical,{feature:q,intersectionZ:ee,position:K}=L;let B={};q.id!==void 0&&(B=a.sourceCache.getFeatureState(x.sourceLayer,q.id));const Z=new pf({},k,F,$,q.id);Z.tile=this.tileID.canonical,Z.state=B,Z.properties=q.properties,Z.geometry={type:"Point",coordinates:[K.lng,K.lat]};let J=this.serializedLayersCache.get(f);J||(J=x.serialize(),J.id=f,this.serializedLayersCache.set(f,J)),Z.source=J.source,Z.sourceLayer=J["source-layer"],Z.layer=Ne({},J);let oe=!1;for(const _e of w){this.updateFeatureProperties(Z,_e);const{filter:Se}=_e;if(Se){if(q.properties=Z.properties,Se.needGeometry){if(!Se.filter(new en(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!Se.filter(new en(this.tileID.overscaledZ),q))continue}oe=!0,_e.targetId&&this.addFeatureVariant(Z,_e)}oe&&this.appendToResult(e,f,A,Z,ee)}updateFeatureProperties(e,i,a){if(i.properties){const c={};for(const d in i.properties){const f=i.properties[d].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);f!=null&&(c[d]=f)}e.properties=c}}addFeatureVariant(e,i,a){const c={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(c.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(c)}appendToResult(e,i,a,c,d){let f=e[i];f===void 0&&(f=e[i]=[]),f.push({featureIndex:a,feature:c,intersectionZ:d})}lookupSymbolFeatures(e,i,a,c,d){const f={};this.loadVTLayers();for(const _ of e)this.loadMatchingFeature(f,{bucketIndex:i,sourceLayerIndex:a,featureIndex:_,layoutVertexArrayOffset:0},c,d);return f}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(a),d=this.vtFeatures[c];if(d[i])return d[i];const f=this.vtLayers[c].feature(i);return d[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const c=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(c!=null)if(Array.isArray(c)){if(!this.promoteIdExpression){const d=wc(c);if(d.result!=="success"){const f=d.value.map(_=>`${_.key}: ${_.message}`).join(", ");return void Ci(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=d.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new cd),a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[c];typeof a=="boolean"&&(a=Number(a))}return a}}function YI(n,e,i,a,c){return fi(n,(d,f)=>{const _=e instanceof zl?e.get(f):null;return _&&_.evaluate?_.evaluate(i,a,void 0,c):_})}function N3(n,e){return e-n}At(XI,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const KI=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class X1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const d=KI[15&a];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new X1(_,f,d,e)}constructor(e,i=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=KI.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+_+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=i,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Y1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:_}=this,x=[0,d.length-1,0],w=[];for(;x.length;){const E=x.pop()||0,A=x.pop()||0,M=x.pop()||0;if(A-M<=_){for(let $=M;$<=A;$++){const q=f[2*$],ee=f[2*$+1];q>=e&&q<=a&&ee>=i&&ee<=c&&w.push(d[$])}continue}const L=M+A>>1,k=f[2*L],F=f[2*L+1];k>=e&&k<=a&&F>=i&&F<=c&&w.push(d[L]),(E===0?e<=k:i<=F)&&(x.push(M),x.push(L-1),x.push(1-E)),(E===0?a>=k:c>=F)&&(x.push(L+1),x.push(A),x.push(1-E))}return w}within(e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:f}=this,_=[0,c.length-1,0],x=[],w=a*a;for(;_.length;){const E=_.pop()||0,A=_.pop()||0,M=_.pop()||0;if(A-M<=f){for(let $=M;$<=A;$++)JI(d[2*$],d[2*$+1],e,i)<=w&&x.push(c[$]);continue}const L=M+A>>1,k=d[2*L],F=d[2*L+1];JI(k,F,e,i)<=w&&x.push(c[L]),(E===0?e-a<=k:i-a<=F)&&(_.push(M),_.push(L-1),_.push(1-E)),(E===0?e+a>=k:i+a>=F)&&(_.push(L+1),_.push(A),_.push(1-E))}return x}}function Y1(n,e,i,a,c,d){if(c-a<=i)return;const f=a+c>>1;QI(n,e,f,a,c,d),Y1(n,e,i,a,f-1,1-d),Y1(n,e,i,f+1,c,1-d)}function QI(n,e,i,a,c,d){for(;c>a;){if(c-a>600){const w=c-a+1,E=i-a+1,A=Math.log(w),M=.5*Math.exp(2*A/3),L=.5*Math.sqrt(A*M*(w-M)/w)*(E-w/2<0?-1:1);QI(n,e,i,Math.max(a,Math.floor(i-E*M/w+L)),Math.min(c,Math.floor(i+(w-E)*M/w+L)),d)}const f=e[2*i+d];let _=a,x=c;for(Km(n,e,a,i),e[2*c+d]>f&&Km(n,e,a,c);_<x;){for(Km(n,e,_,x),_++,x--;e[2*_+d]<f;)_++;for(;e[2*x+d]>f;)x--}e[2*a+d]===f?Km(n,e,a,x):(x++,Km(n,e,x,c)),x<=i&&(a=x+1),i<=x&&(c=x-1)}}function Km(n,e,i,a){K1(n,i,a),K1(e,2*i,2*a),K1(e,2*i+1,2*a+1)}function K1(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}function JI(n,e,i,a){const c=n-i,d=e-a;return c*c+d*d}o.$=Xr,o.A=Da,o.B=_s,o.C=Ll,o.D=cf,o.E=_l,o.F=2,o.G=zm,o.H=cE,o.I=Eo,o.J=class extends Hy{},o.K=Jt,o.L=Ou,o.M=vs,o.N=Pd,o.O=Md,o.P=gt,o.Q=$p,o.R=td,o.S=Dd,o.T=I1,o.U=Bd,o.V=Hy,o.W=Ku,o.X=wc,o.Y=_d,o.Z=_c,o._=Hu,o.a=function(n){return Fr.API_CDN_URL_REGEX.test(n)},o.a$=Et,o.a0=ku,o.a1=Nd,o.a2=Rd,o.a3=F_,o.a4=function(n){const e=n.value;let i=[];if(!e)return i;const a=Jt(e);return a!=="string"?(i=i.concat([new Hy(n.key,e,`string expected, "${a}" found`)]),i):(P1(e,!0)||(i=i.concat([new Hy(n.key,e,`invalid url "${e}"`)])),i)},o.a5=Oe,o.a6=$_,o.a7=Hn,o.a8=pt,o.a9=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return cn(n.expression.evaluate(e))}interpolate(n,e,i){return{x:qt(n.x,e.x,i),y:qt(n.y,e.y,i),z:qt(n.z,e.z,i),azimuthal:qt(n.azimuthal,e.azimuthal,i),polar:qt(n.polar,e.polar,i)}}},o.aA=Bn,o.aB=nn,o.aC=et,o.aD=Me,o.aE=g,o.aF=function(n,e){const i={};for(let a=0;a<e.length;a++){const c=e[a];c in n&&(i[c]=n[c])}return i},o.aG=Q,o.aH=fe,o.aI=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,a){const c=this.entries[n]=this.entries[n]||{callbacks:[]};if(c.result){const[d,f]=c.result;return this.scheduler?this.scheduler.add(()=>{a(d,f)},e):a(d,f),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=i((d,f)=>{c.result=[d,f];for(const _ of c.callbacks)this.scheduler?this.scheduler.add(()=>{_(d,f)},e):_(d,f);setTimeout(()=>delete this.entries[n],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(d=>d!==a),c.callbacks.length||(c.cancel(),delete this.entries[n]))}}},o.aJ=function(n,e,i){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},c=>{const d=oc(n.request,(f,_,x,w)=>{f?c(f):_&&c(null,{vectorTile:i?void 0:new Nc.VectorTile(new Ey(_)),rawData:_,cacheControl:x,expires:w})});return()=>{d.cancel(),c()}},e)},o.aK=function(n){zu++,zu>gs&&(n.getActor().send("enforceCacheSizeLimit",sa),zu=0)},o.aL=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},o.aM=Yn,o.aN=BE,o.aO=$E,o.aP=FE,o.aQ=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<n.length;a++){const c=document.createElement("source");tx(n[a])||(i.crossOrigin="Anonymous"),c.src=n[a],i.appendChild(c)}return{cancel:()=>{}}},o.aR=jy,o.aS=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>HI(e,0,n))},o.aT=WI,o.aU=class{constructor(n,e,i,a){this.id=n,this.position=e!=null?new U(e[0],e[1]):new U(0,0),this.orientation=i??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(he(n.matrix,e,n.matrix),n.meshes)for(const i of n.meshes){const a=An.applyTransformFast(i.aabb,n.matrix);this.aabb.encapsulate(a)}if(n.children)for(const i of n.children)this._applyTransformations(i,n.matrix)}computeBoundsAndApplyParent(){const n=me([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,i,a,c,d,f=!1){tI(this.matrix,this,n.transform,this.position,e,i,a,c,d,f)}upload(n){if(!this.uploaded){for(const e of this.nodes)z1(e,n);for(const e of this.nodes)qy(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)D1(n)}},o.aV=li,o.aW=km,o.aX=ye,o.aY=be,o.aZ=kl,o.a_=vr,o.aa=en,o.ab=Tc,o.ac=Be,o.ad=fn,o.ae=Pi,o.af=Re,o.ag=zl,o.ah=Fc,o.ai=qt,o.aj=vt,o.ak=h_,o.al=G,o.am=Hi,o.an=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([i,a]){const c=cn([1,i,a]);return{x:c.x,y:c.y,z:c.z}}(n.expression.evaluate(e))}interpolate(n,e,i){return{x:qt(n.x,e.x,i),y:qt(n.y,e.y,i),z:qt(n.z,e.z,i)}}},o.ao=function(n,e,i=0,a=!0){const c=new gt(i,i),d=n.sub(c),f=e.add(c),_=[d,new gt(f.x,d.y),f,new gt(d.x,f.y)];return a&&_.push(d.clone()),_},o.ap=function(n,e){const i=[];for(let a=0;a<n.length;a++){const c=Ve(a-1,-1,n.length-1),d=Ve(a+1,-1,n.length-1),f=n[a],_=n[d],x=n[c].sub(f).unit(),w=_.sub(f).unit(),E=w.angleWithSep(x.x,x.y),A=x.add(w).unit().mult(-1*e/Math.sin(E/2));i.push(f.add(A))}return i},o.aq=TE,o.ar=nr,o.as=function(n,e,i=0){return Vt(((e.x-i)*n.scale-n.x)*vt,(e.y*n.scale-n.y)*vt,Fe(e.z,e.y))},o.at=Tn,o.au=$i,o.av=Ss,o.aw=LS,o.ax=function(n){let e=1/0,i=1/0,a=-1/0,c=-1/0;for(const d of n)e=Math.min(e,d.x),i=Math.min(i,d.y),a=Math.max(a,d.x),c=Math.max(c,d.y);return{min:new gt(e,i),max:new gt(a,c)}},o.ay=de,o.az=he,o.b=function(n){return Fr.API_FONTS_REGEX.test(n)},o.b$=Gt,o.b0=Zd,o.b1=By,o.b2=function(){is.isLoading()||is.isLoaded()||Ec()!=="deferred"||G_()},o.b3=Jp,o.b4=Nt,o.b5=pf,o.b6=Zn,o.b7=r1,o.b8=Kx,o.b9=Pt,o.bA=function(n,e){const{x:i,y:a}=n.point,c=m2(i,a,n.worldSize/n._pixelsPerMercatorPixel,0,0);return he(c,c,Ox(Ya(e)))},o.bB=re,o.bC=function(n){return n[0]=0,n[1]=0,n[2]=0,n},o.bD=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},o.bE=Ei,o.bF=ii,o.bG=xn,o.bH=Rm,o.bI=jo,o.bJ=d1,o.bK=function(n,e,i,a,c){const d=5*e+2;n.float32[d+0]=i,n.float32[d+1]=a,n.float32[d+2]=c},o.bL=Fy,o.bM=Sy,o.bN=Zt,o.bO=Mr,o.bP=iS,o.bQ=YE,o.bR=aS,o.bS=lS,o.bT=g1,o.bU=gE,o.bV=h1,o.bW=X1,o.bX=Ve,o.bY=Fs,o.bZ=function(n,e,i){i*=.5;var a=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(i),x=Math.cos(i);return n[0]=a*x+c*_,n[1]=c*x-a*_,n[2]=d*x+f*_,n[3]=f*x-d*_,n},o.b_=hs,o.ba=da,o.bb=ah,o.bc=$s,o.bd=kn,o.be=vm,o.bf=T1,o.bg=function(n,e){const i=Fc(e.zoom);if(i===0)return Ya(n);const a=dy(n),c=kx(a),d=de(a.getWest())*e.worldSize,f=de(a.getEast())*e.worldSize,_=fe(a.getNorth())*e.worldSize,x=fe(a.getSouth())*e.worldSize,w=[d,_,0],E=[f,_,0],A=[d,x,0],M=[f,x,0],L=Pe([],e.globeMatrix);return fn(w,w,L),fn(E,E,L),fn(A,A,L),fn(M,M,L),c[0]=jl(c[0],A,i),c[1]=jl(c[1],M,i),c[2]=jl(c[2],E,i),c[3]=jl(c[3],w,i),An.fromPoints(c)},o.bh=py,o.bi=Pe,o.bj=_m,o.bk=jl,o.bl=Ud,o.bm=rs,o.bn=wt,o.bo=pe,o.bp=i0,o.bq=Ey,o.br=oc,o.bs=function(n,e){const i=[];for(const a in n)a in e||i.push(a);return i},o.bt=Ye,o.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bv=ra,o.bw=function(n){var e=new W(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},o.bx=me,o.by=_t,o.bz=Ie,o.c=fl,o.c$=function(n){return n({pluginStatus:Io,pluginURL:$a}),Fd.on("pluginStateChange",n),n},o.c0=Wo,o.c1=yr,o.c2=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},o.c3=ci,o.c4=function(n,e,i,a,c){var d,f=1/Math.tan(e/2);return n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0?(n[10]=(c+a)*(d=1/(a-c)),n[14]=2*c*a*d):(n[10]=-1,n[14]=-2*a),n},o.c5=function(n,e,i,a,c,d,f){var _=1/(e-i),x=1/(a-c),w=1/(d-f);return n[0]=-2*_,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*w,n[11]=0,n[12]=(e+i)*_,n[13]=(c+a)*x,n[14]=(f+d)*w,n[15]=1,n},o.c6=le,o.c7=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},o.c8=hh,o.c9=xs,o.cA=Gy,o.cB=ti,o.cC=HE,o.cD=function(n){const e=HE(n,!0);return re([],[e[0],e[1],e[4],e[5]])},o.cE=we,o.cF=kc,o.cG=Ue,o.cH=function(n){const{x:e,y:i}=n.point,{lng:a,lat:c}=n._center;return m2(e,i,n.worldSize,a,c)},o.cI=Vi,o.cJ=X,o.cK=Dr,o.cL=v,o.cM=function(n,e,i){let a=0;for(let c=0;c<2;++c)n[c]>0&&(a+=(n[c]-0)*(n[c]-0)),e[c]<0&&(a+=(0-e[c])*(0-e[c]));return a},o.cN=45,o.cO=sd,o.cP=ge,o.cQ=Kd,o.cR=function(n,e,i){const a=Math.sqrt(n*n+e*e+i*i),c=a>0?Math.acos(i/a)*We:0;let d=n!==0||e!==0?Math.atan2(-e,-n)*We+90:0;return d<0&&(d+=360),[a,d,c]},o.cS=Vt,o.cT=ke,o.cU=vi,o.cV=An,o.cW=cn,o.cX=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},o.cY=ai,o.cZ=P1,o.c_=function(n,e){return n.readFields(Ok,{icons:[]},e)},o.ca=uh,o.cb=er,o.cc=Yd,o.cd=U,o.ce=CE,o.cf=function(){var n=new W(4);return W!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},o.cg=function(n,e,i){var a=e[0],c=e[1],d=e[2],f=e[3],_=Math.sin(i),x=Math.cos(i);return n[0]=a*x+d*_,n[1]=c*x+f*_,n[2]=a*-_+d*x,n[3]=c*-_+f*x,n},o.ch=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},o.ci=Ir,o.cj=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},o.ck=Hr,o.cl=Oo,o.cm=Cr,o.cn=ph,o.co=qE,o.cp=mn,o.cq=d2,o.cr=function(n,e,i,a,c,d,f,_,x){if(x.name==="globe")return d2(n,e,new mn(i,a,c),!1);const w=km({z:i,x:a,y:c},x);return new An([(d+w.x/w.scale)*e,e*(w.y/w.scale),f],[(d+w.x2/w.scale)*e,e*(w.y2/w.scale),_])},o.cs=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},o.ct=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},o.cu=function(n){const e=Math.round((n+45+360)%360/90)%4;return ue[e]},o.cv=Le,o.cw=Fo,o.cx=b,o.cy=function(n){const e=me(new Float64Array(16));he(e,n.pixelMatrix,n.globeMatrix);const i=[0,D,0],a=[0,z,0];return fn(i,i,e),fn(a,a,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!Bx(n,new U(n.center.lat,90)),a[0]>0&&a[0]<=n.width&&a[1]>0&&a[1]<=n.height&&!Bx(n,new U(n.center.lat,-90))]},o.cz=function(n,e){const{scale:i}=n.tileTransform,a=i*vt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(c,d,f){var _=d[1],x=d[2],w=d[3],E=f[0],A=f[1];return c[0]=d[0]*E,c[1]=_*E,c[2]=x*A,c[3]=w*A,c}(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},o.d=function(n){return Fr.API_TILEJSON_REGEX.test(n)},o.d$=fm,o.d0=Zy,o.d1=rf,o.d2=p1,o.d3=Ni,o.d4=Rl,o.d5=To,o.d6=So,o.d7=Ii,o.d8=function(n){const e=n.indexOf(nh);return e>=0?n.slice(0,e):n},o.d9=function(n){return n.indexOf(nh)>=0},o.dA=p2,o.dB=Zr,o.dC=Wr,o.dD=256,o.dE=function(n,e){const i=[0,0,0];return fn(i,i,py(Ya(e.canonical))),fn(i,i,n),i},o.dF=n=>({u_camera_to_center_distance:new er(n),u_extrude_scale:new ns(n),u_device_pixel_ratio:new er(n),u_matrix:new hh(n),u_inv_rot_matrix:new hh(n),u_merc_center:new xs(n),u_tile_id:new uh(n),u_zoom_transition:new er(n),u_up_dir:new uh(n),u_emissive_strength:new er(n)}),o.dG=n=>({u_matrix:new hh(n),u_pixels_to_tile_units:new ns(n),u_device_pixel_ratio:new er(n),u_width_scale:new er(n),u_floor_width_scale:new er(n),u_units_to_pixels:new xs(n),u_dash_image:new Yd(n),u_gradient_image:new Yd(n),u_image_height:new er(n),u_texsize:new xs(n),u_tile_units_to_pixels:new er(n),u_alpha_discard_threshold:new er(n),u_trim_offset:new xs(n),u_trim_fade_range:new xs(n),u_trim_color:new Kd(n),u_emissive_strength:new er(n),u_zbias_factor:new er(n),u_tile_to_meter:new er(n),u_ground_shadow_factor:new uh(n)}),o.dH=n=>({u_matrix:new hh(n),u_texsize:new xs(n),u_pixels_to_tile_units:new ns(n),u_device_pixel_ratio:new er(n),u_width_scale:new er(n),u_floor_width_scale:new er(n),u_image:new Yd(n),u_units_to_pixels:new xs(n),u_tile_units_to_pixels:new er(n),u_alpha_discard_threshold:new er(n),u_trim_offset:new xs(n),u_trim_fade_range:new xs(n),u_trim_color:new Kd(n),u_emissive_strength:new er(n),u_zbias_factor:new er(n),u_tile_to_meter:new er(n),u_ground_shadow_factor:new uh(n),u_pattern_transition:new er(n)}),o.dI=oh,o.dJ=VL,o.dK=y2,o.dL=(n,e,i,a,c,d)=>{const f=n.transform,_=f.projection.name==="globe";let x;if(d.paint.get("circle-pitch-alignment")==="map")if(_){const E=p2(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;x=Float32Array.from([E,0,0,E])}else x=f.calculatePixelsToTileUnitsMatrix(i);else x=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const w={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(f.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ps.devicePixelRatio,u_extrude_scale:x,u_inv_rot_matrix:OD,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(_){w.u_inv_rot_matrix=a,w.u_merc_center=c,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=Fc(f.zoom);const E=c[0]*vt,A=c[1]*vt;w.u_up_dir=f.projection.upVector(new mn(0,0,0),E,A)}return w},o.dM=BS,o.dN=go,o.dO=(n,e,i,a,c,d,f,_,x,w)=>{const E=n.transform,A=E.pitch<15?kS(.07,.7,Me((14-E.zoom)/5,0,1)):.07,M=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:FS(n,e,i,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_width_scale:d,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:OS(e,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:_,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(M?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:A,u_tile_to_meter:ke(e.tileID.canonical,0),u_ground_shadow_factor:x,u_pattern_transition:w}},o.dP=(n,e,i,a,c,d,f,_,x,w)=>{const E=n.transform,A=E.calculatePixelsToTileUnitsMatrix(e),M=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",L=E.pitch<15?kS(.07,.7,Me((14-E.zoom)/5,0,1)):.07;return{u_matrix:FS(n,e,i,a),u_pixels_to_tile_units:A,u_device_pixel_ratio:d,u_width_scale:f,u_floor_width_scale:_,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:NS(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:OS(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(M?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:L,u_tile_to_meter:ke(e.tileID.canonical,0),u_ground_shadow_factor:w}},o.dQ=Ot,o.dR=ym,o.dS=Fe,o.dT=bS,o.dU=Ts,o.dV=Ty,o.dW=jc,o.dX=450,o.dY=7,o.dZ=xk,o.d_=Gi,o.da=function(n){const e=n.lastIndexOf(nh);return e>=0?n.slice(e+1):""},o.db=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.dc=function(n,e,i,a){return n.type==="custom"?new bk(n,e):new zk[n.type](n,e,i,a)},o.dd=xi,o.de=function(n){const e=n.indexOf(nh);return e>=0?n.slice(e+1):""},o.df=class extends pf{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},o.dg=Fd,o.dh=rc,o.di=uy,o.dj=class extends Gs{constructor(n){super(n),this.current=hy}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.dk=Te,o.dl=function(n,e,i){const a=Fc(i.zoom),c=n.style.map._antialias,d=n.terrain&&n.terrain.exaggeration()>0;return a===0&&!c&&!d},o.dm=function(n){const e=n.pixelsPerMeter,i=e/le(1,n.center.lat),a=me(new Float64Array(16));return pe(a,a,[n.point.x,n.point.y,0]),we(a,a,[i,i,e]),Float32Array.from(a)},o.dn=dy,o.dp=function(n){const e=Le-5;n=Me(n,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(G(n))),3);return Math.round(i*(P.length-1))},o.dq=function(n,e,i,a){const c=e.getNorth(),d=e.getSouth(),f=e.getWest(),_=e.getEast(),x=1<<n.z,w=_-f,E=c-d,A=w/C,M=-E/P[i],L=[0,A,0,M,0,0,c,f,0];if(n.z>0){const k=180/a;Ee(L,L,[k/w+1,0,0,0,k/E+1,0,-.5*k/A,.5*k/M,1])}return L[2]=x,L[5]=n.x,L[8]=n.y,L},o.dr=Ya,o.ds=function(n,e,i){const a=me(new Float64Array(16)),c=(e/(1<<n)-.5)*Math.PI*2;return tt(a,i.globeMatrix,c),Float32Array.from(a)},o.dt=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,c=Math.floor(n.x),d=Math.floor((n.x-c)*a),f=Math.floor(n.y*a),_=this.findDEMTileFor(new Yn(i,c,i,d,f));return!(!_||!_.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||n.y<0||n.y>1)return e;const c=a.getSource().maxzoom,d=1<<c,f=Math.floor(n.x),_=n.x-f,x=new Yn(c,f,c,Math.floor(_*d),Math.floor(n.y*d)),w=this.findDEMTileFor(x);if(!w||!w.dem)return e;const E=w.dem,A=1<<w.tileID.canonical.z,M=(_*A-w.tileID.canonical.x)*E.dim,L=(n.y*A-w.tileID.canonical.y)*E.dim,k=Math.floor(M),F=Math.floor(L);return(i?this.exaggeration():1)*qt(qt(E.get(k,F),E.get(k,F+1),L-F),qt(E.get(k+1,F),E.get(k+1,F+1),L-F),M-k)}getAtTileOffset(n,e,i){const a=1<<n.canonical.z;return this.getAtPointOrZero(new Be(n.wrap+(n.canonical.x+e/vt)/a,(n.canonical.y+i/vt)/a))}getAtTileOffsetFunc(n,e,i,a){return c=>{const d=this.getAtTileOffset(n,c.x,c.y),f=a.upVector(n.canonical,c.x,c.y);return Gt(f,f,d*a.upVectorScale(n.canonical,e,i).metersToTile),f}}getForTilePoints(n,e,i,a){if(this.isUsingMockSource())return!1;const c=lf.create(this,n,a);return!!c&&(e.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,c=1<<n.canonical.z-a.canonical.z;let d=n.canonical.x/c-a.canonical.x,f=n.canonical.y/c-a.canonical.y,_=0;for(let x=0;x<n.canonical.z-a.canonical.z&&!i.leaves[_];x++){d*=2,f*=2;const w=2*Math.floor(f)+Math.floor(d);_=i.childOffsets[_]+w,d%=1,f%=1}return{min:this.exaggeration()*i.minimums[_],max:this.exaggeration()*i.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const c of n){const d=this.getMinMaxForTile(c.tileID);d&&(i=Math.min(i,d.min),a=Math.max(a,d.max),e=!0)}return e?{min:i,max:a}:null}},o.du=C2,o.dv=Oc,o.dw=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},o.dx=te,o.dy=function(n,e){var i=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=i,n[2]=0,n[3]=-i,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},o.dz=po,o.e=Fr,o.e$=ZI,o.e0=256,o.e1=Ox,o.e2=Vs,o.e3=tt,o.e4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},o.e5=Za,o.e6=sh,o.e7=function(n,e,i,a,c){return Me((n-e)/(i-e)*(c-a)+a,a,c)},o.e8=Xo,o.e9=function(n,e){var i=e[0],a=e[1],c=e[2],d=e[3],f=e[4],_=e[5],x=e[6],w=e[7],E=e[8],A=E*f-_*w,M=-E*d+_*x,L=w*d-f*x,k=i*A+a*M+c*L;return k?(n[0]=A*(k=1/k),n[1]=(-E*a+c*w)*k,n[2]=(_*a-c*f)*k,n[3]=M*k,n[4]=(E*i-c*x)*k,n[5]=(-_*i+c*d)*k,n[6]=L*k,n[7]=(-w*i+a*x)*k,n[8]=(f*i-a*d)*k,n):null},o.eA=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},o.eB=ea,o.eC=V,o.eD=Ji,o.eE=function(n,e,i,a){return n[0]=e,n[1]=i,n[2]=a,n},o.eF=function([n,e,i]){const a=Math.hypot(n,e,i),c=Math.atan2(n,i),d=.5*Math.PI-Math.acos(-e/a);return new U(X(c),X(d))},o.eG=Zo,o.eH=C1,o.eI=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(i){if(or==null){const a=i.navigator?i.navigator.userAgent:null;or=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return or}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.eJ=function(n,e){sa=n,gs=e},o.eK=Bx,o.eL=g2,o.eM=function(n){const e=[0,0,0],i=me(new Float64Array(16));return he(i,n.pixelMatrix,n.globeMatrix),fn(e,e,i),new gt(e[0],e[1])},o.eN=function(n,e,i=!1){if(Io===Xp||Io===Yp||Io===Kp)throw new Error("setRTLTextPlugin cannot be called multiple times.");$a=ps.resolveURL(n),Io=Xp,Qp=e,Od(),i||G_()},o.eO=Ec,o.eP=function(){Zy().acquire(k1)},o.eQ=function(){const n=Gm;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(k1),Gm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.eR=Th,o.eS=function(n){const e=hp();if(!e)return;const i=e.delete(ms);n&&i.then(()=>n()).catch(n)},o.eT=Um,o.eU=BI,o.eV=function(n){H1=ps.resolveURL(n),ff||(ff=new cf(Zy(),new _l)),ff.broadcast("setDracoUrl",H1)},o.eW=NI,o.eX=function(n){df=ps.resolveURL(n),ff||(ff=new cf(Zy(),new _l)),ff.broadcast("setMeshoptUrl",df)},o.eY=At,o.eZ=Bc,o.e_=ga,o.ea=D_,o.eb=Vn,o.ec=Xe,o.ed=class{constructor(n,e,i,a){this.context=n,this.format=a,this.size=i,this.texture=n.gl.createTexture();const[c,d,f]=this.size,{gl:_}=n;_.bindTexture(_.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),_.texImage3D(_.TEXTURE_3D,0,this.format,c,d,f,0,S1(this.format),E1(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_3D,this.texture),n!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,n),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},o.ee=function(n,e){if(n===e){var i=e[1],a=e[2],c=e[3],d=e[6],f=e[7],_=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=a,n[9]=d,n[11]=e[14],n[12]=c,n[13]=f,n[14]=_}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},o.ef=M1,o.eg=ni,o.eh=[1,1,1],o.ei=function(n,e,i,a){var c=new W(4);return c[0]=n,c[1]=e,c[2]=i,c[3]=a,c},o.ej=ir,o.ek=function(n,e,i,a){var c=e[0],d=e[1],f=e[2],_=e[3];return n[0]=c+a*(i[0]-c),n[1]=d+a*(i[1]-d),n[2]=f+a*(i[2]-f),n[3]=_+a*(i[3]-_),n},o.el=lf,o.em=af,o.en=Wa,o.eo=Fl,o.ep=function(n,e,i,a,c,d,f,_,x,w,E,A,M,L,k,F){var $=new W(16);return $[0]=n,$[1]=e,$[2]=i,$[3]=a,$[4]=c,$[5]=d,$[6]=f,$[7]=_,$[8]=x,$[9]=w,$[10]=E,$[11]=A,$[12]=M,$[13]=L,$[14]=k,$[15]=F,$},o.eq=N,o.er=qd,o.es=hm,o.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new gt(1/0,1/0),max:new gt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=rS(new gt(0,0),new gt(vt,vt),n),a=[];if(e&&!Jx(i,this._globalClipBounds))return a;for(const c of this._activeRegions){if(c.hiddenByOverlap||!Jx(i,c))continue;const d=fL(c.min,c.max,n);a.push({min:d.min,max:d.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask,clipScope:c.clipScope})}return a}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const a of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(a).buckets[e.layer];c&&c.updateFootprints(a.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),a=n.getClipMask(),c=n.getClipScope();for(const d of e){if(!d.footprint)continue;const f=rS(d.footprint.min,d.footprint.max,d.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:d.id,footprint:d.footprint,order:i,clipMask:a,clipScope:c})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||by(e.min,i.min)||by(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(a,c){const d=(f,_)=>f+_;return a.length-c.length||a.reduce(d,"").localeCompare(c.reduce(d,""))}(e.clipScope,i.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],a=this._prevRegions[e];n=i.priority!==a.priority||!nS(i,a)||i.order!==a.order||i.clipMask!==a.clipMask||!ra(i.clipScope,a.clipScope),++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==xy&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const a=this._activeRegions;if(i>=a.length)return i;const c=a[i].priority;for(;i<a.length&&a[i].priority===c;)++i;return i};if(this._sourceIds.length>1){let i=0,a=e(i);for(;i!==a;){let c=i;const d=i;for(;c!==a;){const f=this._activeRegions[c];f.hiddenByOverlap=!1;for(let _=0;_<d;_++){const x=this._activeRegions[_];if(!x.hiddenByOverlap&&f.order===xy&&Jx(f,x)&&(f.hiddenByOverlap=sS(f.footprint,f.tileId,x.footprint,x.tileId),f.hiddenByOverlap))break}++c}i=a,a=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},o.eu=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new da,a=new vr,c=[],d=n+1+2,f=e[0]+1,_=e[0]+1+(1+e.length),x=(w,E,A)=>{let M=w===d-1?w-2:w===0?w:w-1;return M+=A?24575:0,[M,E]};for(let w=0;w<d;++w)i.emplaceBack(...x(w,0,!0));for(let w=0;w<f;++w)for(let E=0;E<d;++E)i.emplaceBack(...x(E,w,(E===0||E===d-1)&&!0));for(let w=0;w<e.length;++w){const E=e[w];for(let A=0;A<d;++A)i.emplaceBack(...x(A,E,!0))}for(let w=0;w<e.length;++w){const E=a.length,A=e[w]+1+2,M=new vr;for(let F=0;F<A-1;F++){const $=F===A-2,q=$?d*(_-e.length+w-F):d;for(let ee=0;ee<d-1;ee++){const K=F*d+ee;F===0||$||ee===0||ee===d-2?(M.emplaceBack(K+1,K,K+q),M.emplaceBack(K+q,K+q+1,K+1)):(a.emplaceBack(K+1,K,K+q),a.emplaceBack(K+q,K+q+1,K+1))}}const L=kn.simpleSegment(0,E,i.length,a.length-E);for(let F=0;F<M.uint16.length;F+=3)a.emplaceBack(M.uint16[F],M.uint16[F+1],M.uint16[F+2]);const k=kn.simpleSegment(0,E,i.length,a.length-E);c.push({withoutSkirts:L,withSkirts:k})}return{vertices:i,indices:a,segments:c}}_createGrid(n){const e=this._fillGridMeshWithLods(C,P);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,$s.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new vr;for(let f=0;f<=C;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Za,a=new Za,c=new Za,d=new Za;this._poleSegments=[];for(let f=0,_=0;f<v;f++){const x=360/(1<<f);i.emplaceBack(0,-g,0,.5,0),a.emplaceBack(0,-g,0,.5,1),c.emplaceBack(0,-g,0,.5,.5),d.emplaceBack(0,-g,0,.5,.5);for(let w=0;w<=C;w++){let E=w/C,A=0;const M=qt(0,x,E),[L,k,F]=O(LD,kD,M,g);i.emplaceBack(L,k,F,E,A),a.emplaceBack(L,k,F,E,1-A);const $=G(M);E=.5+.5*Math.sin($),A=.5+.5*Math.cos($),c.emplaceBack(L,k,F,E,A),d.emplaceBack(L,k,F,E,1-A)}this._poleSegments.push(kn.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Ao,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(a,Ao,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(c,Ao,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(d,Ao,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},o.ev=xy,o.ew=ve,o.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.ey=Ce,o.ez=dt,o.f=function(n){return n.indexOf("mapbox:")===0},o.f0=XI,o.f1=RS,o.f2=gh,o.f3="hd_road_elevation",o.f4=Zx,o.f5=fi,o.f6=yh,o.f7=f1,o.f8=xh,o.f9=function(n,e,i,a,c,d,f,_=1,x,w){n.createArrays(),n.tilePixelRatio=vt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const E=n.layers[0].layout,A=n.layers[0]._unevaluatedLayout._values,M={};M.scaleFactor=_,M.textSizeScaleRange=E.get("text-size-scale-range"),M.iconSizeScaleRange=E.get("icon-size-scale-range");const[L,k]=M.textSizeScaleRange,[F,$]=M.iconSizeScaleRange;M.textScaleFactor=Me(M.scaleFactor,L,k),M.iconScaleFactor=Me(M.scaleFactor,F,$);const q=A["text-size"],ee=A["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:_e,maxZoom:Se}=n.textSizeData;M.compositeTextSizes=[q.possiblyEvaluate(new en(_e),d),q.possiblyEvaluate(new en(Se),d)]}if(n.iconSizeData.kind==="composite"){const{minZoom:_e,maxZoom:Se}=n.iconSizeData;M.compositeIconSizes=[ee.possiblyEvaluate(new en(_e),d),ee.possiblyEvaluate(new en(Se),d)]}M.layoutTextSize=q.possiblyEvaluate(new en(f+1),d),M.layoutIconSize=ee.possiblyEvaluate(new en(f+1),d),M.textMaxSize=q.possiblyEvaluate(new en(18),d);const K=E.get("symbol-placement"),B=E.get("text-rotation-alignment")==="map"&&K!=="point",Z=E.get("text-size");let J=!1;const oe=[];for(const _e of n.features){const Se=E.get("text-font").evaluate(_e,{},d).join(","),Ae=Z.evaluate(_e,{},d)*M.textScaleFactor,De=M.layoutTextSize.evaluate(_e,{},d)*M.textScaleFactor,qe=M.layoutIconSize.evaluate(_e,{},d)*M.iconScaleFactor,rt={horizontal:{},vertical:void 0},Je=_e.text;let nt,lt=[0,0];if(Je){const Lt=Je.toString(),Kt=E.get("text-letter-spacing").evaluate(_e,{},d)*Mr,di=E.get("text-line-height").evaluate(_e,{},d)*Mr,pi=bx(Lt)?Kt:0,Si=E.get("text-anchor").evaluate(_e,{},d),yi=E.get("text-variable-anchor");if(!yi){const se=E.get("text-radial-offset").evaluate(_e,{},d);if(se)lt=gE(Si,[se*Mr,m1]);else{const Ze=E.get("text-offset").evaluate(_e,{},d);lt=[Ze[0]*Mr,Ze[1]*Mr]}}let gi=B?"center":E.get("text-justify").evaluate(_e,{},d);const sn=K==="point",gn=sn?E.get("text-max-width").evaluate(_e,{},d)*Mr:1/0,ie=se=>{n.allowVerticalPlacement&&Zp(Lt)&&(rt.vertical=u1(Je,e,i,c,Se,gn,di,Si,se,pi,lt,jo.vertical,!0,De,Ae,x))};if(!B&&yi){const se=gi==="auto"?yi.map(mt=>g1(mt)):[gi];let Ze=!1;for(let mt=0;mt<se.length;mt++){const St=se[mt];if(!rt.horizontal[St])if(Ze)rt.horizontal[St]=rt.horizontal[0];else{const Tt=u1(Je,e,i,c,Se,gn,di,"center",St,pi,lt,jo.horizontal,!1,De,Ae,x);Tt&&(rt.horizontal[St]=Tt,Ze=Tt.positionedLines.length===1)}}ie("left")}else{if(gi==="auto"&&(gi=g1(Si)),sn||E.get("text-writing-mode").indexOf("horizontal")>=0||!Zp(Lt)){const se=u1(Je,e,i,c,Se,gn,di,Si,gi,pi,lt,jo.horizontal,!1,De,Ae,x);se&&(rt.horizontal[gi]=se)}ie(sn?"left":gi)}}let $e,it,je,He,ut,ht,Ft,Mt=!1;if(_e.icon&&_e.icon.hasPrimary()){const Lt=yE(_e.icon,n.iconSizeData,A["icon-size"],d,n.zoom,_e,x,M.iconScaleFactor);$e=Lt.iconPrimary,je=Lt.iconSecondary;const Kt=$e.toString();if(it=a.get(Kt),it&&(ut=E.get("icon-offset").evaluate(_e,{},d),ht=E.get("icon-anchor").evaluate(_e,{},d),Ft=E.get("icon-text-fit").evaluate(_e,{},d),nt=KL(c.get(Kt),je?c.get(je.toString()):void 0,ut,ht),Mt=it.sdf,n.sdfIcons===void 0?n.sdfIcons=it.sdf:n.sdfIcons!==it.sdf&&Ci("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(it.pixelRatio!==n.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),je){const di=je.toString();He=a.get(di)}}J=J||!(!_e.icon||!_e.icon.hasSecondary());const bt=_1(rt.horizontal)||rt.vertical;n.iconsInText||(n.iconsInText=!!bt&&bt.iconsInText);const ct=De*M.textScaleFactor/Mr,{defaultShapedIcon:ri,verticallyShapedIcon:Dt}=sk(n,nt,E,_e,d,rt,ct,ut,Ft);Ft!=="none"&&nt&&(eE(nt)||tE(nt))&&(Py(0,it,$e,nt,ri,Ft,w,a,c),Py(0,He,je,nt,ri,Ft,w,a,c),Dt&&(Py(0,it,$e,nt,Dt,Ft,w,a,c),Py(0,He,je,nt,Dt,Ft,w,a,c))),nt=ri,oe.push({feature:_e,shapedTextOrientations:rt,shapedText:bt,shapedIcon:nt,iconPrimary:$e,iconSecondary:je,iconOffset:ut,iconAnchor:ht,verticallyShapedIcon:Dt,layoutTextSize:De,layoutIconSize:qe,textOffset:lt,isSDFIcon:Mt,iconTextFit:Ft})}return{featureData:oe,sizes:M,hasAnySecondaryIcon:J,textAlongLine:B,symbolPlacement:K}},o.fa=uE,o.fb=function(n,e,i,a,c,d,f,_,x,w){const{featureData:E,hasAnySecondaryIcon:A,sizes:M,textAlongLine:L,symbolPlacement:k}=e;for(const F of E){const{shapedIcon:$,verticallyShapedIcon:q,feature:ee,shapedTextOrientations:K,shapedText:B,layoutTextSize:Z,textOffset:J,isSDFIcon:oe,iconPrimary:_e,iconSecondary:Se,iconTextFit:Ae,iconOffset:De}=F;vE($,w.iconPositions,_e,Se),vE(q,w.iconPositions,_e,Se),ok(K,w.iconPositions),(B||$)&&ak(n,ee,K,$,q,x,M,Z,0,J,oe,a,c,f,_,A,Ae,De,L,k)}i&&n.generateCollisionDebugBuffers(d,n.collisionBoxArray,M.textScaleFactor)},o.fc=Nc,o.fd=t0,o.fe=dl,o.ff=V2,o.fg=HS,o.fh=Sn,o.fi=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==VI){const i=new Uint32Array(n,0,7),[,,a,c,d,f]=i;e=i.byteLength+c+d+f+d,(a!==n.byteLength||e>=n.byteLength)&&Ci("Invalid b3dm header information.")}return HI(n,e)},o.fj=function(n,e){const i=WI(n);for(const a of i){for(const c of a.meshes)O3(c);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(F3(a.lights,e)))}return i},o.fk=Wy,o.fl=pn,o.fm=aI,o.fn=is,o.fo=function(n){la(),Qo!=null&&Qo.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-n;a++)e.delete(i[a]).catch(c=>Ci(c.message))}).catch(i=>Ci(i.message))}).catch(e=>Ci(e.message))},o.g=function(n,e){return rc(Ne(n,{method:"GET"}),e)},o.h=Ns,o.i=function(n){return Fr.API_STYLE_REGEX.test(n)&&!fl(n)},o.j=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.k=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},o.l=Ne,o.m=dp,o.n=function(n,e){return rc(Ne(n,{type:"json"}),e)},o.o=sc,o.p=function(n,e){return rc(Ne(n,{method:"POST"}),e)},o.q=ps,o.r=Br,o.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=cp,o.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},o.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},o.w=Ci,o.x=function(){return O1||(O1=new Th),O1},o.y=V1,o.z=mp}),I(["./shared"],function(o){function j(We){const G=We?We.url.toString():void 0;return G?performance.getEntriesByName(G):[]}function W(We){if(typeof We=="number"||typeof We=="boolean"||typeof We=="string"||We==null)return JSON.stringify(We);if(Array.isArray(We)){let X="[";for(const ue of We)X+=`${W(ue)},`;return`${X}]`}let G="{";for(const X of Object.keys(We).sort())G+=`${X}:${W(We[X])},`;return`${G}}`}function re(We){let G="";for(const X of o.bu)(We.type!=="model"||X!=="minzoom"&&X!=="maxzoom")&&(G+=`/${W(We[X])}`);return G}class te{constructor(G){this.keyCache={},this._layers={},this._layerConfigs={},G&&this.replace(G)}replace(G,X){this._layerConfigs={},this._layers={},this.update(G,[],X)}update(G,X,ue){this._options=ue;for(const ve of G)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=o.dc(ve,this.scope,null,this._options)).compileFilter(ue),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(const ve of X)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const Te=function(ve,Ce){const Me={};for(let Ve=0;Ve<ve.length;Ve++){const Ye=ve[Ve];let Ne=Ce&&Ce[Ye.id];Ne||(Ye.type==="symbol"?Ne=Ye.id:(Ne=re(Ye),Ye.type==="line"&&Ye.paint&&function Et(Ot){return typeof Ot=="string"&&Ot==="line-progress"||(Array.isArray(Ot)?Ot.some(Et):!(!Ot||typeof Ot!="object")&&Object.values(Ot).some(Et))}(Ye.paint["line-width"])&&(Ne+=`/${W(Ye.paint["line-width"])}`))),Ce&&(Ce[Ye.id]=Ne);let yt=Me[Ne];yt||(yt=Me[Ne]=[]),yt.push(Ye)}const Re=[];for(const Ve in Me)Re.push(Me[Ve]);return Re}(Object.values(this._layerConfigs),this.keyCache);for(const ve of Te){const Ce=ve.map(yt=>this._layers[yt.id]),Me=Ce[0];if(Me.visibility==="none")continue;const Re=Me.source||"";let Ve=this.familiesBySource[Re];Ve||(Ve=this.familiesBySource[Re]={});const Ye=Me.sourceLayer||"_geojsonTileLayer";let Ne=Ve[Ye];Ne||(Ne=Ve[Ye]=[]),Ne.push(Ce)}}}const Y=1*o.e_;class Ee{constructor(G){const X={},ue=[];for(const Me in G){const Re=G[Me],Ve=X[Me]={};for(const Ye in Re.glyphs){const Ne=Re.glyphs[+Ye];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const yt=Ne.metrics.localGlyph?Y:1,Et={x:0,y:0,w:Ne.bitmap.width+2*yt,h:Ne.bitmap.height+2*yt};ue.push(Et),Ve[Ye]=Et}}const{w:Te,h:ve}=o.H(ue),Ce=new o.eZ({width:Te||1,height:ve||1});for(const Me in G){const Re=G[Me];for(const Ve in Re.glyphs){const Ye=Re.glyphs[+Ve];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const Ne=X[Me][Ve],yt=Ye.metrics.localGlyph?Y:1;o.eZ.copy(Ye.bitmap,Ce,{x:0,y:0},{x:Ne.x+yt,y:Ne.y+yt},Ye.bitmap)}}this.image=Ce,this.positions=X}}o.eY(Ee,"GlyphAtlas");class Ie{constructor(G){this.tileID=new o.aM(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.lut=G.lut,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.scope=G.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.request&&G.request.collectResourceTiming,this.promoteId=G.promoteId,this.isSymbolTile=G.isSymbolTile,this.tileTransform=o.aW(G.tileID.canonical,G.projection),this.projection=G.projection,this.worldview=G.worldview,this.localizableLayerIds=G.localizableLayerIds,this.brightness=G.brightness,this.extraShadowCaster=!!G.extraShadowCaster,this.tessellationStep=G.tessellationStep,this.scaleFactor=G.scaleFactor}parse(G,X,ue,Te,ve,Ce){this.status="parsing",this.data=G,this.collisionBoxArray=new o.b0;const Me=new o.e$(Object.keys(G.layers).sort()),Re=new o.f0(this.tileID,this.promoteId);Re.bucketLayerIDs=[];const Ve={},Ye=new o.f1(256,256),Ne={featureIndex:Re,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ye,availableImages:ue,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},yt=X.familiesBySource[this.source];for(const Ui in yt){const cn=G.layers[Ui];if(!cn)continue;let pn=!1,Zn=!1,or=!1;for(const Wr of yt[Ui])Wr[0].type==="symbol"?pn=!0:Zn=!0,Wr[0].is3D()&&Wr[0].type!=="model"&&(or=!0);if(this.extraShadowCaster&&!or||this.isSymbolTile===!0&&!pn||this.isSymbolTile===!1&&!Zn)continue;cn.version===1&&o.w(`Vector tile source "${this.source}" layer "${Ui}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yr=Me.encode(Ui),zr=[];let oa=!1;for(let Wr=0,Zr=0;Wr<cn.length;Wr++){const Ar=cn.feature(Wr),Fr=Re.getId(Ar,Ui);if(this.localizableLayerIds&&this.localizableLayerIds.has(Ui)){const Ns=Ar.properties?Ar.properties.worldview:null;if(this.worldview&&typeof Ns=="string")if(Ns==="all")Ar.properties.$localized=!0;else{if(!Ns.split(",").includes(this.worldview))continue;Ar.properties.$localized=!0,Ar.properties.worldview=this.worldview}}!oa&&Ar.properties&&Ar.properties.hasOwnProperty(o.f2)&&(oa=!0),zr.push({feature:Ar,id:Fr,index:Zr,sourceLayerIndex:yr}),Zr++}oa&&!Ne.elevationFeatures&&G.layers.hasOwnProperty(o.f3)&&(Ne.elevationFeatures=o.f4.parseFrom(G.layers[o.f3],this.canonical));for(const Wr of yt[Ui]){const Zr=Wr[0];(!this.extraShadowCaster||Zr.is3D()&&Zr.type!=="model")&&(this.isSymbolTile!==void 0&&Zr.type==="symbol"!==this.isSymbolTile||Zr.minzoom&&this.zoom<Math.floor(Zr.minzoom)||Zr.maxzoom&&this.zoom>=Zr.maxzoom||Zr.visibility!=="none"&&(me(Wr,this.zoom,Ne.brightness,ue),(Ve[Zr.id]=Zr.createBucket({index:Re.bucketLayerIDs.length,layers:Wr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Te})).populate(zr,Ne,this.tileID.canonical,this.tileTransform),Re.bucketLayerIDs.push(Wr.map(Ar=>o.C(Ar.id,Ar.scope)))))}}let Et,Ot,li,fi,xi,Ii;Ye.trim();const Nn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ci=()=>{if(Et)return this.status="done",Ce(Et);if(this.extraShadowCaster)this.status="done",Ce(null,{buckets:Object.values(Ve).filter(Ui=>!Ui.isEmpty()),featureIndex:Re,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ne.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ot&&li&&fi){const Ui=new Ee(Ot),cn=new Map;for(const[or,yr]of li.entries()){const{imagePosition:zr}=o.f7(or,yr,o.f8);cn.set(or,zr)}const pn={};for(const or in Ve){const yr=Ve[or];yr instanceof o.b1&&(me(yr.layers,this.zoom,Ne.brightness,ue),pn[or]=o.f9(yr,Ot,Ui.positions,li,cn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,xi))}const Zn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ve,li,xi,()=>{Zn.iconsPending=!1,ln(pn,Ui,Zn)}),this.rasterizeIfNeeded(ve,fi,Ii,()=>{Zn.patternsPending=!1,ln(pn,Ui,Zn)})}},ln=(Ui,cn,pn,Zn)=>{if(pn.iconsPending||pn.patternsPending)return;const or=new o.fa(li,fi,this.lut);for(const yr in Ve){const zr=Ve[yr];if(yr in Ui)o.fb(zr,Ui[yr],this.showCollisionBoxes,ue,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,li,or);else if(zr.hasPattern&&(zr instanceof o.b7||zr instanceof o.b8||zr instanceof o.dV)){me(zr.layers,this.zoom,Ne.brightness,ue);const oa=Object.fromEntries(or.patternPositions);zr.addFeatures(Ne,this.tileID.canonical,oa,ue,this.tileTransform,this.brightness)}}this.status="done",Ce(null,{buckets:Object.values(Ve).filter(yr=>!yr.isEmpty()),featureIndex:Re,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:cn.image,lineAtlas:Ye,imageAtlas:or,brightness:Ne.brightness})};if(!this.extraShadowCaster){const Ui=o.f5(Ne.glyphDependencies,Zn=>Object.keys(Zn).map(Number));Object.keys(Ui).length?ve.send("getGlyphs",{uid:this.uid,stacks:Ui,scope:this.scope},(Zn,or)=>{Et||(Et=Zn,Ot=or,Ci())},void 0,!1,Nn):Ot={};const cn=Array.from(Ne.iconDependencies.keys()).map(Zn=>o.I.parse(Zn));cn.length?ve.send("getImages",{images:cn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Zn,or)=>{Et||(Et=Zn,li=new Map,xi=this.updateImageMapAndGetImageTaskQueue(li,or,Ne.iconDependencies),Ci())},void 0,!1,Nn):(li=new Map,xi=new Map);const pn=Array.from(Ne.patternDependencies.keys()).map(Zn=>o.I.parse(Zn));pn.length?ve.send("getImages",{images:pn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Zn,or)=>{Et||(Et=Zn,fi=new Map,Ii=this.updateImageMapAndGetImageTaskQueue(fi,or,Ne.patternDependencies),Ci())},void 0,!1,Nn):(fi=new Map,Ii=new Map)}if(Ne.elevationFeatures&&Ne.elevationFeatures.length>0){const Ui=[];for(const pn of Object.values(Ve))if(pn instanceof o.b8){const Zn=pn.getUnevaluatedPortalGraph();Zn&&Ui.push(Zn)}const cn=o.f6.evaluate(Ui);for(const pn of Object.values(Ve))pn instanceof o.b8&&pn.setEvaluatedPortalGraph(cn)}Ci()}rasterizeIfNeeded(G,X,ue,Te){Array.from(X.values()).some(ve=>ve.usvg)?this.rasterize(G,X,ue,Te):Te()}updateImageMapAndGetImageTaskQueue(G,X,ue){const Te=new Map;for(const ve of X.keys()){const Ce=ue.get(ve)||[];for(const Me of Ce){const Re=Me.toString(),Ve=X.get(Me.id.toString());Ve.usvg?Te.has(Re)||(Te.set(Re,Me),G.set(Re,Object.assign({},Ve))):G.set(Re,Ve)}}return Te}rasterize(G,X,ue,Te){this.rasterizeTask=G.send("rasterizeImages",{scope:this.scope,tasks:ue},(ve,Ce)=>{if(!ve)for(const[Me,Re]of Ce.entries()){const Ve=Object.assign(X.get(Me),{data:Re});X.set(Me,Ve)}Te()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function me(We,G,X,ue){const Te=new o.aa(G,{brightness:X});for(const ve of We)ve.recalculate(Te,ue)}class Pe extends o.E{constructor(G,X,ue,Te,ve,Ce,Me){super(),this.actor=G,this.layerIndex=X,this.availableImages=ue,this.availableModels=Te,this.loadVectorData=Ce||o.aJ,this.loading={},this.loaded={},this.deduped=new o.aI(G.scheduler),this.isSpriteLoaded=ve,this.scheduler=G.scheduler,this.brightness=Me}loadTile(G,X){const ue=G.uid,Te=G&&G.request,ve=Te&&Te.collectResourceTiming,Ce=this.loading[ue]=new Ie(G);Ce.abort=this.loadVectorData(G,(Me,Re)=>{const Ve=!this.loading[ue];if(delete this.loading[ue],Ce.cancelRasterize(),Ve||Me||!Re)return Ce.status="done",Ve||(this.loaded[ue]=Ce),X(Me);const Ye=Re.rawData,Ne={};Re.expires&&(Ne.expires=Re.expires),Re.cacheControl&&(Ne.cacheControl=Re.cacheControl),Ce.vectorTile=Re.vectorTile||new o.fc.VectorTile(new o.bq(Ye));const yt=()=>{Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Et,Ot)=>{if(Et||!Ot)return X(Et);const li={};if(ve){const fi=j(Te);fi.length>0&&(li.resourceTiming=JSON.parse(JSON.stringify(fi)))}X(null,o.l({rawTileData:Ye.slice(0)},Ot,Ne,li))})};this.isSpriteLoaded?yt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(yt,{type:"parseTile",isSymbolTile:G.isSymbolTile,zoom:G.tileZoom}):yt()}),this.loaded=this.loaded||{},this.loaded[ue]=Ce})}reloadTile(G,X){const ue=this.loaded,Te=G.uid;if(ue&&ue[Te]){const ve=ue[Te];ve.scaleFactor=G.scaleFactor,ve.showCollisionBoxes=G.showCollisionBoxes,ve.projection=G.projection,ve.brightness=G.brightness,ve.tileTransform=o.aW(G.tileID.canonical,G.projection),ve.extraShadowCaster=G.extraShadowCaster,ve.lut=G.lut;const Ce=(Me,Re)=>{const Ve=ve.reloadCallback;Ve&&(delete ve.reloadCallback,ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ve)),X(Me,Re)};ve.status==="parsing"?ve.reloadCallback=Ce:ve.status==="done"&&(ve.vectorTile?ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ce):Ce())}else X(null,void 0)}abortTile(G,X){const ue=G.uid,Te=this.loading[ue];Te&&(Te.abort&&Te.abort(),delete this.loading[ue]),X()}removeTile(G,X){const ue=this.loaded,Te=G.uid;ue&&ue[Te]&&delete ue[Te],X()}}class he{loadTile(G,X){const{uid:ue,encoding:Te,rawImageData:ve,padding:Ce}=G,Me=ImageBitmap&&ve instanceof ImageBitmap?this.getImageData(ve,Ce):ve;X(null,new o.fd(ue,Me,Te,Ce<1))}reloadTile(G,X){X(null,null)}abortTile(G,X){X()}removeTile(G,X){X()}getImageData(G,X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);const ue=this.offscreenCanvasContext.getImageData(-X,-X,G.width+2*X,G.height+2*X);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ue}}o.bp.setPbf(o.bq);class pe{constructor(G){this._mrt=new o.bp(G.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=G.uid,this.tileID=G.tileID,this.source=G.source}parse(G,X){const ue=this._mrt;this.status="parsing",this._entireBuffer=G;try{ue.parseHeader(G),this._isHeaderLoaded=!0;const Te=[];for(const ve in ue.layers){const Ce=ue.getLayer(ve),Me=Ce.getDataRange(Ce.getBandList()),Re=ue.createDecodingTask(Me),Ve=G.slice(Me.firstByte,Me.lastByte+1),Ye=o.bp.performDecoding(Ve,Re).then(Ne=>Re.complete(null,Ne)).catch(Ne=>Re.complete(Ne,null));Te.push(Ye)}Promise.allSettled(Te).then(()=>X(null,ue)).catch(ve=>X(ve))}catch(Te){X(Te)}}}class we{constructor(G){this.actor=G,this.loading={},this.loaded={}}loadTile(G,X){const ue=G.uid,Te=G.request,ve=this.loading[ue]=new pe(G),{cancel:Ce}=o.br(Te,(Me,Re,Ve,Ye)=>{const Ne=!this.loading[ue];if(delete this.loading[ue],Ne||Me||!Re)return ve.status="done",Ne||(this.loaded[ue]=ve),X(Me);ve.parse(Re,(yt,Et)=>{if(yt||!Et)return X(yt);X(null,Et,Ve,Ye)}),this.loaded[ue]=ve});ve.abort=Ce}reloadTile(G,X){X(null,void 0)}abortTile(G,X){const ue=G.uid,Te=this.loading[ue];Te&&(Te.abort&&Te.abort(),delete this.loading[ue]),X()}removeTile(G,X){const ue=G.uid;this.loaded[ue]&&delete this.loaded[ue],X()}decodeRasterArray(G,X){o.bp.performDecoding(G.buffer,G.task).then(ue=>X(null,ue)).catch(ue=>X(ue))}}const Ue=o.fc.VectorTileFeature.prototype.toGeoJSON;class tt{constructor(G){this._feature=G,this.extent=o.aj,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))}loadGeometry(){if(this._feature.type===1){const G=[];for(const X of this._feature.geometry)G.push([new o.P(X[0],X[1])]);return G}{const G=[];for(const X of this._feature.geometry){const ue=[];for(const Te of X)ue.push(new o.P(Te[0],Te[1]));G.push(ue)}return G}}toGeoJSON(G,X,ue){return Ue.call(this,G,X,ue)}}class _t{constructor(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.aj,this.length=G.length,this._features=G}feature(G){return new tt(this._features[G])}}const wt=64/4096,xt=128;class ci{constructor(){this.features=new Map}clear(){this.features.clear()}load(G=[],X){for(const ue of G){const Te=ue.id;if(Te==null)continue;let ve=this.features.get(Te);ve&&this.updateCache(ve,X),ue.geometry?(ve=ni(ue),this.updateCache(ve,X),this.features.set(Te,ve)):this.features.delete(Te),this.updateCache(ve,X)}}updateCache(G,X){for(const{canonical:ue,uid:Te}of Object.values(X)){const{z:ve,x:Ce,y:Me}=ue;ti(G,Math.pow(2,ve),Ce,Me)&&delete X[Te]}}getTile(G,X,ue){const Te=Math.pow(2,G),ve=[];for(const Ce of this.features.values())ti(Ce,Te,X,ue)&&ve.push(vi(Ce,Te,X,ue));return{features:ve}}getFeatures(){return[...this.features.values()]}}function ti({minX:We,minY:G,maxX:X,maxY:ue},Te,ve,Ce){return We<(ve+1+wt)/Te&&G<(Ce+1+wt)/Te&&X>(ve-wt)/Te&&ue>(Ce-wt)/Te}function ni(We){const{id:G,geometry:X,properties:ue}=We;if(!X)return;if(X.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Te,coordinates:ve}=X,Ce={id:G,type:1,geometry:[],tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Me=Ce.geometry;if(Te==="Point")ui(ve,Me,Ce);else if(Te==="MultiPoint")for(const Re of ve)ui(Re,Me,Ce);else if(Te==="LineString")Ce.type=2,Pi(ve,Me,Ce);else if(Te==="MultiLineString")Ce.type=2,Vt(ve,Me,Ce);else if(Te==="Polygon")Ce.type=3,Vt(ve,Me,Ce,!0);else{if(Te!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ce.type=3;for(const Re of ve)Vt(Re,Me,Ce,!0)}return Ce}function ui([We,G],X,ue){const Te=o.ay(We);let ve=o.aH(G);ve=ve<0?0:ve>1?1:ve,X.push(Te,ve),ue.minX=Math.min(ue.minX,Te),ue.minY=Math.min(ue.minY,ve),ue.maxX=Math.max(ue.maxX,Te),ue.maxY=Math.max(ue.maxY,ve)}function Pi(We,G,X,ue=!1,Te=!1){const ve=[];for(const Ce of We)ui(Ce,ve,X);G.push(ve),ue&&function(Ce,Me){let Re=0;for(let Ve=0,Ye=Ce.length,Ne=Ye-2;Ve<Ye;Ne=Ve,Ve+=2)Re+=(Ce[Ve]-Ce[Ne])*(Ce[Ve+1]+Ce[Ne+1]);if(Re>0===Me)for(let Ve=0,Ye=Ce.length;Ve<Ye/2;Ve+=2){const Ne=Ce[Ve],yt=Ce[Ve+1];Ce[Ve]=Ce[Ye-2-Ve],Ce[Ve+1]=Ce[Ye-1-Ve],Ce[Ye-2-Ve]=Ne,Ce[Ye-1-Ve]=yt}}(ve,Te)}function Vt(We,G,X,ue=!1){for(let Te=0;Te<We.length;Te++)Pi(We[Te],G,X,ue,Te===0)}function vi(We,G,X,ue){const{id:Te,type:ve,geometry:Ce,tags:Me}=We,Re=[];if(ve===1)(function(Ve,Ye,Ne,yt,Et){for(let Ot=0;Ot<Ve.length;Ot+=2){const li=Math.round(o.aj*(Ve[Ot+0]*Ye-Ne)),fi=Math.round(o.aj*(Ve[Ot+1]*Ye-yt));Et.push([li,fi])}})(Ce,G,X,ue,Re);else for(const Ve of Ce)ai(Ve,G,X,ue,Re);return{id:Te,type:ve,geometry:Re,tags:Me}}function ai(We,G,X,ue,Te){const ve=-xt,Ce=o.aj+xt;let Me;for(let Re=0;Re<We.length-2;Re+=2){let Ve=Math.round(o.aj*(We[Re+0]*G-X)),Ye=Math.round(o.aj*(We[Re+1]*G-ue)),Ne=Math.round(o.aj*(We[Re+2]*G-X)),yt=Math.round(o.aj*(We[Re+3]*G-ue));const Et=Ne-Ve,Ot=yt-Ye;Ve<ve&&Ne<ve||(Ve<ve?(Ye+=Math.round(Ot*((ve-Ve)/Et)),Ve=ve):Ne<ve&&(yt=Ye+Math.round(Ot*((ve-Ve)/Et)),Ne=ve),Ye<ve&&yt<ve||(Ye<ve?(Ve+=Math.round(Et*((ve-Ye)/Ot)),Ye=ve):yt<ve&&(Ne=Ve+Math.round(Et*((ve-Ye)/Ot)),yt=ve),Ve>=Ce&&Ne>=Ce||(Ve>=Ce?(Ye+=Math.round(Ot*((Ce-Ve)/Et)),Ve=Ce):Ne>=Ce&&(yt=Ye+Math.round(Ot*((Ce-Ve)/Et)),Ne=Ce),Ye>=Ce&&yt>=Ce||(Ye>=Ce?(Ve+=Math.round(Et*((Ce-Ye)/Ot)),Ye=Ce):yt>=Ce&&(Ne=Ve+Math.round(Et*((Ce-Ye)/Ot)),yt=Ce),Me&&Ve===Me[Me.length-1][0]&&Ye===Me[Me.length-1][1]||(Me=[[Ve,Ye]],Te.push(Me)),Me.push([Ne,yt])))))}}var Vi,ft,$t,Gt={exports:{}},ii=function(){if($t)return Gt.exports;$t=1;var We=o.fg(),G=function(){if(ft)return Vi;ft=1;var Ye=o.fe(),Ne=o.ff().VectorTileFeature;function yt(Ot,li){this.options=li||{},this.features=Ot,this.length=Ot.length}function Et(Ot,li){this.id=typeof Ot.id=="number"?Ot.id:void 0,this.type=Ot.type,this.rawGeometry=Ot.type===1?[Ot.geometry]:Ot.geometry,this.properties=Ot.tags,this.extent=li||4096}return Vi=yt,yt.prototype.feature=function(Ot){return new Et(this.features[Ot],this.options.extent)},Et.prototype.loadGeometry=function(){var Ot=this.rawGeometry;this.geometry=[];for(var li=0;li<Ot.length;li++){for(var fi=Ot[li],xi=[],Ii=0;Ii<fi.length;Ii++)xi.push(new Ye(fi[Ii][0],fi[Ii][1]));this.geometry.push(xi)}return this.geometry},Et.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ot=this.geometry,li=1/0,fi=-1/0,xi=1/0,Ii=-1/0,Nn=0;Nn<Ot.length;Nn++)for(var Ci=Ot[Nn],ln=0;ln<Ci.length;ln++){var Ui=Ci[ln];li=Math.min(li,Ui.x),fi=Math.max(fi,Ui.x),xi=Math.min(xi,Ui.y),Ii=Math.max(Ii,Ui.y)}return[li,xi,fi,Ii]},Et.prototype.toGeoJSON=Ne.prototype.toGeoJSON,Vi}();function X(Ye){var Ne=new We;return function(yt,Et){for(var Ot in yt.layers)Et.writeMessage(3,ue,yt.layers[Ot])}(Ye,Ne),Ne.finish()}function ue(Ye,Ne){var yt;Ne.writeVarintField(15,Ye.version||1),Ne.writeStringField(1,Ye.name||""),Ne.writeVarintField(5,Ye.extent||4096);var Et={keys:[],values:[],keycache:{},valuecache:{}};for(yt=0;yt<Ye.length;yt++)Et.feature=Ye.feature(yt),Ne.writeMessage(2,Te,Et);var Ot=Et.keys;for(yt=0;yt<Ot.length;yt++)Ne.writeStringField(3,Ot[yt]);var li=Et.values;for(yt=0;yt<li.length;yt++)Ne.writeMessage(4,Ve,li[yt])}function Te(Ye,Ne){var yt=Ye.feature;yt.id!==void 0&&Ne.writeVarintField(1,yt.id),Ne.writeMessage(2,ve,Ye),Ne.writeVarintField(3,yt.type),Ne.writeMessage(4,Re,yt)}function ve(Ye,Ne){var yt=Ye.feature,Et=Ye.keys,Ot=Ye.values,li=Ye.keycache,fi=Ye.valuecache;for(var xi in yt.properties){var Ii=yt.properties[xi],Nn=li[xi];if(Ii!==null){Nn===void 0&&(Et.push(xi),li[xi]=Nn=Et.length-1),Ne.writeVarint(Nn);var Ci=typeof Ii;Ci!=="string"&&Ci!=="boolean"&&Ci!=="number"&&(Ii=JSON.stringify(Ii));var ln=Ci+":"+Ii,Ui=fi[ln];Ui===void 0&&(Ot.push(Ii),fi[ln]=Ui=Ot.length-1),Ne.writeVarint(Ui)}}}function Ce(Ye,Ne){return(Ne<<3)+(7&Ye)}function Me(Ye){return Ye<<1^Ye>>31}function Re(Ye,Ne){for(var yt=Ye.loadGeometry(),Et=Ye.type,Ot=0,li=0,fi=yt.length,xi=0;xi<fi;xi++){var Ii=yt[xi],Nn=1;Et===1&&(Nn=Ii.length),Ne.writeVarint(Ce(1,Nn));for(var Ci=Et===3?Ii.length-1:Ii.length,ln=0;ln<Ci;ln++){ln===1&&Et!==1&&Ne.writeVarint(Ce(2,Ci-1));var Ui=Ii[ln].x-Ot,cn=Ii[ln].y-li;Ne.writeVarint(Me(Ui)),Ne.writeVarint(Me(cn)),Ot+=Ui,li+=cn}Et===3&&Ne.writeVarint(Ce(7,1))}}function Ve(Ye,Ne){var yt=typeof Ye;yt==="string"?Ne.writeStringField(1,Ye):yt==="boolean"?Ne.writeBooleanField(7,Ye):yt==="number"&&(Ye%1!=0?Ne.writeDoubleField(3,Ye):Ye<0?Ne.writeSVarintField(6,Ye):Ne.writeVarintField(5,Ye))}return Gt.exports=X,Gt.exports.fromVectorTileJs=X,Gt.exports.fromGeojsonVt=function(Ye,Ne){Ne=Ne||{};var yt={};for(var Et in Ye)yt[Et]=new G(Ye[Et].features,Ne),yt[Et].name=Et,yt[Et].version=Ne.version,yt[Et].extent=Ne.extent;return X({layers:yt})},Gt.exports.GeoJSONWrapper=G,Gt.exports}(),Li=o.fh(ii);const Ji={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:We=>We},Vn=Math.fround||($i=new Float32Array(1),We=>($i[0]=+We,$i[0]));var $i;const Ei=3,xn=5,fo=6;class fn{constructor(G){this.options=Object.assign(Object.create(Ji),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:X,minZoom:ue,maxZoom:Te}=this.options;X&&console.time("total time");const ve=`prepare ${G.length} points`;X&&console.time(ve),this.points=G;const Ce=[];for(let Re=0;Re<G.length;Re++){const Ve=G[Re];if(!Ve.geometry)continue;const[Ye,Ne]=Ve.geometry.coordinates,yt=Vn(Ir(Ye)),Et=Vn(Tn(Ne));Ce.push(yt,Et,1/0,Re,-1,1),this.options.reduce&&Ce.push(0)}let Me=this.trees[Te+1]=this._createTree(Ce);X&&console.timeEnd(ve);for(let Re=Te;Re>=ue;Re--){const Ve=+Date.now();Me=this.trees[Re]=this._createTree(this._cluster(Me,Re)),X&&console.log("z%d: %d clusters in %dms",Re,Me.numItems,+Date.now()-Ve)}return X&&console.timeEnd("total time"),this}getClusters(G,X){let ue=((G[0]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,G[1]));let ve=G[2]===180?180:((G[2]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ue=-180,ve=180;else if(ue>ve){const Ne=this.getClusters([ue,Te,180,Ce],X),yt=this.getClusters([-180,Te,ve,Ce],X);return Ne.concat(yt)}const Me=this.trees[this._limitZoom(X)],Re=Me.range(Ir(ue),Tn(Ce),Ir(ve),Tn(Te)),Ve=Me.data,Ye=[];for(const Ne of Re){const yt=this.stride*Ne;Ye.push(Ve[yt+xn]>1?po(Ve,yt,this.clusterProps):this.points[Ve[yt+Ei]])}return Ye}getChildren(G){const X=this._getOriginId(G),ue=this._getOriginZoom(G),Te="No cluster with the specified id.",ve=this.trees[ue];if(!ve)throw new Error(Te);const Ce=ve.data;if(X*this.stride>=Ce.length)throw new Error(Te);const Me=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),Re=ve.within(Ce[X*this.stride],Ce[X*this.stride+1],Me),Ve=[];for(const Ye of Re){const Ne=Ye*this.stride;Ce[Ne+4]===G&&Ve.push(Ce[Ne+xn]>1?po(Ce,Ne,this.clusterProps):this.points[Ce[Ne+Ei]])}if(Ve.length===0)throw new Error(Te);return Ve}getLeaves(G,X,ue){const Te=[];return this._appendLeaves(Te,G,X=X||10,ue=ue||0,0),Te}getTile(G,X,ue){const Te=this.trees[this._limitZoom(G)],ve=Math.pow(2,G),{extent:Ce,radius:Me}=this.options,Re=Me/Ce,Ve=(ue-Re)/ve,Ye=(ue+1+Re)/ve,Ne={features:[]};return this._addTileFeatures(Te.range((X-Re)/ve,Ve,(X+1+Re)/ve,Ye),Te.data,X,ue,ve,Ne),X===0&&this._addTileFeatures(Te.range(1-Re/ve,Ve,1,Ye),Te.data,ve,ue,ve,Ne),X===ve-1&&this._addTileFeatures(Te.range(0,Ve,Re/ve,Ye),Te.data,-1,ue,ve,Ne),Ne.features.length?Ne:null}getClusterExpansionZoom(G){let X=this._getOriginZoom(G)-1;for(;X<=this.options.maxZoom;){const ue=this.getChildren(G);if(X++,ue.length!==1)break;G=ue[0].properties.cluster_id}return X}_appendLeaves(G,X,ue,Te,ve){const Ce=this.getChildren(X);for(const Me of Ce){const Re=Me.properties;if(Re&&Re.cluster?ve+Re.point_count<=Te?ve+=Re.point_count:ve=this._appendLeaves(G,Re.cluster_id,ue,Te,ve):ve<Te?ve++:G.push(Me),G.length===ue)break}return ve}_createTree(G){const X=new o.bW(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ue=0;ue<G.length;ue+=this.stride)X.add(G[ue],G[ue+1]);return X.finish(),X.data=G,X}_addTileFeatures(G,X,ue,Te,ve,Ce){for(const Me of G){const Re=Me*this.stride,Ve=X[Re+xn]>1;let Ye,Ne,yt;if(Ve)Ye=Oo(X,Re,this.clusterProps),Ne=X[Re],yt=X[Re+1];else{const li=this.points[X[Re+Ei]];Ye=li.properties;const[fi,xi]=li.geometry.coordinates;Ne=Ir(fi),yt=Tn(xi)}const Et={type:1,geometry:[[Math.round(this.options.extent*(Ne*ve-ue)),Math.round(this.options.extent*(yt*ve-Te))]],tags:Ye};let Ot;Ot=Ve||this.options.generateId?X[Re+Ei]:this.points[X[Re+Ei]].id,Ot!==void 0&&(Et.id=Ot),Ce.features.push(Et)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,X){const{radius:ue,extent:Te,reduce:ve,minPoints:Ce}=this.options,Me=ue/(Te*Math.pow(2,X)),Re=G.data,Ve=[],Ye=this.stride;for(let Ne=0;Ne<Re.length;Ne+=Ye){if(Re[Ne+2]<=X)continue;Re[Ne+2]=X;const yt=Re[Ne],Et=Re[Ne+1],Ot=G.within(Re[Ne],Re[Ne+1],Me),li=Re[Ne+xn];let fi=li;for(const xi of Ot){const Ii=xi*Ye;Re[Ii+2]>X&&(fi+=Re[Ii+xn])}if(fi>li&&fi>=Ce){let xi,Ii=yt*li,Nn=Et*li,Ci=-1;const ln=(Ne/Ye<<5)+(X+1)+this.points.length;for(const Ui of Ot){const cn=Ui*Ye;if(Re[cn+2]<=X)continue;Re[cn+2]=X;const pn=Re[cn+xn];Ii+=Re[cn]*pn,Nn+=Re[cn+1]*pn,Re[cn+4]=ln,ve&&(xi||(xi=this._map(Re,Ne,!0),Ci=this.clusterProps.length,this.clusterProps.push(xi)),ve(xi,this._map(Re,cn)))}Re[Ne+4]=ln,Ve.push(Ii/fi,Nn/fi,1/0,ln,-1,fi),ve&&Ve.push(Ci)}else{for(let xi=0;xi<Ye;xi++)Ve.push(Re[Ne+xi]);if(fi>1)for(const xi of Ot){const Ii=xi*Ye;if(!(Re[Ii+2]<=X)){Re[Ii+2]=X;for(let Nn=0;Nn<Ye;Nn++)Ve.push(Re[Ii+Nn])}}}}return Ve}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,X,ue){if(G[X+xn]>1){const Ce=this.clusterProps[G[X+fo]];return ue?Object.assign({},Ce):Ce}const Te=this.points[G[X+Ei]].properties,ve=this.options.map(Te);return ue&&ve===Te?Object.assign({},ve):ve}}function po(We,G,X){return{type:"Feature",id:We[G+Ei],properties:Oo(We,G,X),geometry:{type:"Point",coordinates:[(ue=We[G],360*(ue-.5)),ea(We[G+1])]}};var ue}function Oo(We,G,X){const ue=We[G+xn],Te=ue>=1e4?`${Math.round(ue/1e3)}k`:ue>=1e3?Math.round(ue/100)/10+"k":ue,ve=We[G+fo],Ce=ve===-1?{}:Object.assign({},X[ve]);return Object.assign(Ce,{cluster:!0,cluster_id:We[G+Ei],point_count:ue,point_count_abbreviated:Te})}function Ir(We){return We/360+.5}function Tn(We){const G=Math.sin(We*Math.PI/180),X=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return X<0?0:X>1?1:X}function ea(We){const G=(180-360*We)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function Wo(We,G,X,ue){let Te=ue;const ve=G+(X-G>>1);let Ce,Me=X-G;const Re=We[G],Ve=We[G+1],Ye=We[X],Ne=We[X+1];for(let yt=G+3;yt<X;yt+=3){const Et=ir(We[yt],We[yt+1],Re,Ve,Ye,Ne);if(Et>Te)Ce=yt,Te=Et;else if(Et===Te){const Ot=Math.abs(yt-ve);Ot<Me&&(Ce=yt,Me=Ot)}}Te>ue&&(Ce-G>3&&Wo(We,G,Ce,ue),We[Ce+2]=Te,X-Ce>3&&Wo(We,Ce,X,ue))}function ir(We,G,X,ue,Te,ve){let Ce=Te-X,Me=ve-ue;if(Ce!==0||Me!==0){const Re=((We-X)*Ce+(G-ue)*Me)/(Ce*Ce+Me*Me);Re>1?(X=Te,ue=ve):Re>0&&(X+=Ce*Re,ue+=Me*Re)}return Ce=We-X,Me=G-ue,Ce*Ce+Me*Me}function Fo(We,G,X,ue){const Te={id:We??null,type:G,geometry:X,tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")Zo(Te,X);else if(G==="Polygon")Zo(Te,X[0]);else if(G==="MultiLineString")for(const ve of X)Zo(Te,ve);else if(G==="MultiPolygon")for(const ve of X)Zo(Te,ve[0]);return Te}function Zo(We,G){for(let X=0;X<G.length;X+=3)We.minX=Math.min(We.minX,G[X]),We.minY=Math.min(We.minY,G[X+1]),We.maxX=Math.max(We.maxX,G[X]),We.maxY=Math.max(We.maxY,G[X+1])}function Bn(We,G,X,ue){if(!G.geometry)return;const Te=G.geometry.coordinates;if(Te&&Te.length===0)return;const ve=G.geometry.type,Ce=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2);let Me=[],Re=G.id;if(X.promoteId?Re=G.properties[X.promoteId]:X.generateId&&(Re=ue||0),ve==="Point")Or(Te,Me);else if(ve==="MultiPoint")for(const Ve of Te)Or(Ve,Me);else if(ve==="LineString")Fs(Te,Me,Ce,!1);else if(ve==="MultiLineString"){if(X.lineMetrics){for(const Ve of Te)Me=[],Fs(Ve,Me,Ce,!1),We.push(Fo(Re,"LineString",Me,G.properties));return}hs(Te,Me,Ce,!1)}else if(ve==="Polygon")hs(Te,Me,Ce,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(const Ve of G.geometry.geometries)Bn(We,{id:Re,geometry:Ve,properties:G.properties},X,ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ve of Te){const Ye=[];hs(Ve,Ye,Ce,!0),Me.push(Ye)}}We.push(Fo(Re,ve,Me,G.properties))}function Or(We,G){G.push(Xo(We[0]),$r(We[1]),0)}function Fs(We,G,X,ue){let Te,ve,Ce=0;for(let Re=0;Re<We.length;Re++){const Ve=Xo(We[Re][0]),Ye=$r(We[Re][1]);G.push(Ve,Ye,0),Re>0&&(Ce+=ue?(Te*Ye-Ve*ve)/2:Math.sqrt(Math.pow(Ve-Te,2)+Math.pow(Ye-ve,2))),Te=Ve,ve=Ye}const Me=G.length-3;G[2]=1,Wo(G,0,Me,X),G[Me+2]=1,G.size=Math.abs(Ce),G.start=0,G.end=G.size}function hs(We,G,X,ue){for(let Te=0;Te<We.length;Te++){const ve=[];Fs(We[Te],ve,X,ue),G.push(ve)}}function Xo(We){return We/360+.5}function $r(We){const G=Math.sin(We*Math.PI/180),X=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return X<0?0:X>1?1:X}function Jr(We,G,X,ue,Te,ve,Ce,Me){if(ue/=G,ve>=(X/=G)&&Ce<ue)return We;if(Ce<X||ve>=ue)return null;const Re=[];for(const Ve of We){const Ye=Ve.geometry;let Ne=Ve.type;const yt=Te===0?Ve.minX:Ve.minY,Et=Te===0?Ve.maxX:Ve.maxY;if(yt>=X&&Et<ue){Re.push(Ve);continue}if(Et<X||yt>=ue)continue;let Ot=[];if(Ne==="Point"||Ne==="MultiPoint")ta(Ye,Ot,X,ue,Te);else if(Ne==="LineString")wo(Ye,Ot,X,ue,Te,!1,Me.lineMetrics);else if(Ne==="MultiLineString")Hr(Ye,Ot,X,ue,Te,!1);else if(Ne==="Polygon")Hr(Ye,Ot,X,ue,Te,!0);else if(Ne==="MultiPolygon")for(const li of Ye){const fi=[];Hr(li,fi,X,ue,Te,!0),fi.length&&Ot.push(fi)}if(Ot.length){if(Me.lineMetrics&&Ne==="LineString"){for(const li of Ot)Re.push(Fo(Ve.id,Ne,li,Ve.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(Ot.length===1?(Ne="LineString",Ot=Ot[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=Ot.length===3?"Point":"MultiPoint"),Re.push(Fo(Ve.id,Ne,Ot,Ve.tags))}}return Re.length?Re:null}function ta(We,G,X,ue,Te){for(let ve=0;ve<We.length;ve+=3){const Ce=We[ve+Te];Ce>=X&&Ce<=ue&&Yo(G,We[ve],We[ve+1],We[ve+2])}}function wo(We,G,X,ue,Te,ve,Ce){let Me=ia(We);const Re=Te===0?qr:Bs;let Ve,Ye,Ne=We.start;for(let fi=0;fi<We.length-3;fi+=3){const xi=We[fi],Ii=We[fi+1],Nn=We[fi+2],Ci=We[fi+3],ln=We[fi+4],Ui=Te===0?xi:Ii,cn=Te===0?Ci:ln;let pn=!1;Ce&&(Ve=Math.sqrt(Math.pow(xi-Ci,2)+Math.pow(Ii-ln,2))),Ui<X?cn>X&&(Ye=Re(Me,xi,Ii,Ci,ln,X),Ce&&(Me.start=Ne+Ve*Ye)):Ui>ue?cn<ue&&(Ye=Re(Me,xi,Ii,Ci,ln,ue),Ce&&(Me.start=Ne+Ve*Ye)):Yo(Me,xi,Ii,Nn),cn<X&&Ui>=X&&(Ye=Re(Me,xi,Ii,Ci,ln,X),pn=!0),cn>ue&&Ui<=ue&&(Ye=Re(Me,xi,Ii,Ci,ln,ue),pn=!0),!ve&&pn&&(Ce&&(Me.end=Ne+Ve*Ye),G.push(Me),Me=ia(We)),Ce&&(Ne+=Ve)}let yt=We.length-3;const Et=We[yt],Ot=We[yt+1],li=Te===0?Et:Ot;li>=X&&li<=ue&&Yo(Me,Et,Ot,We[yt+2]),yt=Me.length-3,ve&&yt>=3&&(Me[yt]!==Me[0]||Me[yt+1]!==Me[1])&&Yo(Me,Me[0],Me[1],Me[2]),Me.length&&G.push(Me)}function ia(We){const G=[];return G.size=We.size,G.start=We.start,G.end=We.end,G}function Hr(We,G,X,ue,Te,ve){for(const Ce of We)wo(Ce,G,X,ue,Te,ve,!1)}function Yo(We,G,X,ue){We.push(G,X,ue)}function qr(We,G,X,ue,Te,ve){const Ce=(ve-G)/(ue-G);return Yo(We,ve,X+(Te-X)*Ce,1),Ce}function Bs(We,G,X,ue,Te,ve){const Ce=(ve-X)/(Te-X);return Yo(We,G+(ue-G)*Ce,ve,1),Ce}function ds(We,G){const X=[];for(let ue=0;ue<We.length;ue++){const Te=We[ue],ve=Te.type;let Ce;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Ce=Ko(Te.geometry,G);else if(ve==="MultiLineString"||ve==="Polygon"){Ce=[];for(const Me of Te.geometry)Ce.push(Ko(Me,G))}else if(ve==="MultiPolygon"){Ce=[];for(const Me of Te.geometry){const Re=[];for(const Ve of Me)Re.push(Ko(Ve,G));Ce.push(Re)}}X.push(Fo(Te.id,ve,Ce,Te.tags))}return X}function Ko(We,G){const X=[];X.size=We.size,We.start!==void 0&&(X.start=We.start,X.end=We.end);for(let ue=0;ue<We.length;ue+=3)X.push(We[ue]+G,We[ue+1],We[ue+2]);return X}function fs(We,G){if(We.transformed)return We;const X=1<<We.z,ue=We.x,Te=We.y;for(const ve of We.features){const Ce=ve.geometry,Me=ve.type;if(ve.geometry=[],Me===1)for(let Re=0;Re<Ce.length;Re+=2)ve.geometry.push(eo(Ce[Re],Ce[Re+1],G,X,ue,Te));else for(let Re=0;Re<Ce.length;Re++){const Ve=[];for(let Ye=0;Ye<Ce[Re].length;Ye+=2)Ve.push(eo(Ce[Re][Ye],Ce[Re][Ye+1],G,X,ue,Te));ve.geometry.push(Ve)}}return We.transformed=!0,We}function eo(We,G,X,ue,Te,ve){return[Math.round(X*(We*ue-Te)),Math.round(X*(G*ue-ve))]}function hl(We,G,X,ue,Te){const ve=G===Te.maxZoom?0:Te.tolerance/((1<<G)*Te.extent),Ce={features:[],numPoints:0,numSimplified:0,numFeatures:We.length,source:null,x:X,y:ue,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Me of We)oi(Ce,Me,ve,Te);return Ce}function oi(We,G,X,ue){const Te=G.geometry,ve=G.type,Ce=[];if(We.minX=Math.min(We.minX,G.minX),We.minY=Math.min(We.minY,G.minY),We.maxX=Math.max(We.maxX,G.maxX),We.maxY=Math.max(We.maxY,G.maxY),ve==="Point"||ve==="MultiPoint")for(let Me=0;Me<Te.length;Me+=3)Ce.push(Te[Me],Te[Me+1]),We.numPoints++,We.numSimplified++;else if(ve==="LineString")Sn(Ce,Te,We,X,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(let Me=0;Me<Te.length;Me++)Sn(Ce,Te[Me],We,X,ve==="Polygon",Me===0);else if(ve==="MultiPolygon")for(let Me=0;Me<Te.length;Me++){const Re=Te[Me];for(let Ve=0;Ve<Re.length;Ve++)Sn(Ce,Re[Ve],We,X,!0,Ve===0)}if(Ce.length){let Me=G.tags||null;if(ve==="LineString"&&ue.lineMetrics){Me={};for(const Ve in G.tags)Me[Ve]=G.tags[Ve];Me.mapbox_clip_start=Te.start/Te.size,Me.mapbox_clip_end=Te.end/Te.size}const Re={geometry:Ce,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:Me};G.id!==null&&(Re.id=G.id),We.features.push(Re)}}function Sn(We,G,X,ue,Te,ve){const Ce=ue*ue;if(ue>0&&G.size<(Te?Ce:ue))return void(X.numPoints+=G.length/3);const Me=[];for(let Re=0;Re<G.length;Re+=3)(ue===0||G[Re+2]>Ce)&&(X.numSimplified++,Me.push(G[Re],G[Re+1])),X.numPoints++;Te&&function(Re,Ve){let Ye=0;for(let Ne=0,yt=Re.length,Et=yt-2;Ne<yt;Et=Ne,Ne+=2)Ye+=(Re[Ne]-Re[Et])*(Re[Ne+1]+Re[Et+1]);if(Ye>0===Ve)for(let Ne=0,yt=Re.length;Ne<yt/2;Ne+=2){const Et=Re[Ne],Ot=Re[Ne+1];Re[Ne]=Re[yt-2-Ne],Re[Ne+1]=Re[yt-1-Ne],Re[yt-2-Ne]=Et,Re[yt-1-Ne]=Ot}}(Me,ve),We.push(Me)}const Ln={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ur{constructor(G,X){const ue=(X=this.options=function(ve,Ce){for(const Me in Ce)ve[Me]=Ce[Me];return ve}(Object.create(Ln),X)).debug;if(ue&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let Te=function(ve,Ce){const Me=[];if(ve.type==="FeatureCollection")for(let Re=0;Re<ve.features.length;Re++)Bn(Me,ve.features[Re],Ce,Re);else Bn(Me,ve.type==="Feature"?ve:{geometry:ve},Ce);return Me}(G,X);this.tiles={},this.tileCoords=[],ue&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Te=function(ve,Ce){const Me=Ce.buffer/Ce.extent;let Re=ve;const Ve=Jr(ve,1,-1-Me,Me,0,-1,2,Ce),Ye=Jr(ve,1,1-Me,2+Me,0,-1,2,Ce);return(Ve||Ye)&&(Re=Jr(ve,1,-Me,1+Me,0,-1,2,Ce)||[],Ve&&(Re=ds(Ve,1).concat(Re)),Ye&&(Re=Re.concat(ds(Ye,-1)))),Re}(Te,X),Te.length&&this.splitTile(Te,0,0,0),ue&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,X,ue,Te,ve,Ce,Me){const Re=[G,X,ue,Te],Ve=this.options,Ye=Ve.debug;for(;Re.length;){Te=Re.pop(),ue=Re.pop(),X=Re.pop(),G=Re.pop();const Ne=1<<X,yt=to(X,ue,Te);let Et=this.tiles[yt];if(!Et&&(Ye>1&&console.time("creation"),Et=this.tiles[yt]=hl(G,X,ue,Te,Ve),this.tileCoords.push({z:X,x:ue,y:Te}),Ye)){Ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,ue,Te,Et.numFeatures,Et.numPoints,Et.numSimplified),console.timeEnd("creation"));const pn=`z${X}`;this.stats[pn]=(this.stats[pn]||0)+1,this.total++}if(Et.source=G,ve==null){if(X===Ve.indexMaxZoom||Et.numPoints<=Ve.indexMaxPoints)continue}else{if(X===Ve.maxZoom||X===ve)continue;if(ve!=null){const pn=ve-X;if(ue!==Ce>>pn||Te!==Me>>pn)continue}}if(Et.source=null,G.length===0)continue;Ye>1&&console.time("clipping");const Ot=.5*Ve.buffer/Ve.extent,li=.5-Ot,fi=.5+Ot,xi=1+Ot;let Ii=null,Nn=null,Ci=null,ln=null,Ui=Jr(G,Ne,ue-Ot,ue+fi,0,Et.minX,Et.maxX,Ve),cn=Jr(G,Ne,ue+li,ue+xi,0,Et.minX,Et.maxX,Ve);G=null,Ui&&(Ii=Jr(Ui,Ne,Te-Ot,Te+fi,1,Et.minY,Et.maxY,Ve),Nn=Jr(Ui,Ne,Te+li,Te+xi,1,Et.minY,Et.maxY,Ve),Ui=null),cn&&(Ci=Jr(cn,Ne,Te-Ot,Te+fi,1,Et.minY,Et.maxY,Ve),ln=Jr(cn,Ne,Te+li,Te+xi,1,Et.minY,Et.maxY,Ve),cn=null),Ye>1&&console.timeEnd("clipping"),Re.push(Ii||[],X+1,2*ue,2*Te),Re.push(Nn||[],X+1,2*ue,2*Te+1),Re.push(Ci||[],X+1,2*ue+1,2*Te),Re.push(ln||[],X+1,2*ue+1,2*Te+1)}}getTile(G,X,ue){G=+G,X=+X,ue=+ue;const Te=this.options,{extent:ve,debug:Ce}=Te;if(G<0||G>24)return null;const Me=1<<G,Re=to(G,X=X+Me&Me-1,ue);if(this.tiles[Re])return fs(this.tiles[Re],ve);Ce>1&&console.log("drilling down to z%d-%d-%d",G,X,ue);let Ve,Ye=G,Ne=X,yt=ue;for(;!Ve&&Ye>0;)Ye--,Ne>>=1,yt>>=1,Ve=this.tiles[to(Ye,Ne,yt)];return Ve&&Ve.source?(Ce>1&&(console.log("found parent tile z%d-%d-%d",Ye,Ne,yt),console.time("drilling down")),this.splitTile(Ve.source,Ye,Ne,yt,G,X,ue),Ce>1&&console.timeEnd("drilling down"),this.tiles[Re]?fs(this.tiles[Re],ve):null):null}}function to(We,G,X){return 32*((1<<We)*X+G)+We}function na(We,G){const X=We.tileID.canonical;if(!this._geoJSONIndex)return void G(null,null);const ue=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!ue)return void G(null,null);const Te=new _t(ue.features);let ve=Li(Te);ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),G(null,{vectorTile:Te,rawData:ve.buffer})}class dl extends Pe{constructor(G,X,ue,Te,ve,Ce,Me){super(G,X,ue,Te,ve,na,Me),Ce&&(this.loadGeoJSON=Ce),this._dynamicIndex=new ci}loadData(G,X){const ue=G&&G.request,Te=ue&&ue.collectResourceTiming;this.loadGeoJSON(G,(ve,Ce)=>{if(ve||!Ce)return X(ve);if(typeof Ce!="object")return X(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{try{if(G.filter){const Re=o.X(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Re.result==="error")throw new Error(Re.value.map(Ve=>`${Ve.key}: ${Ve.message}`).join(", "));Ce.features=Ce.features.filter(Ve=>Re.value.evaluate({zoom:0},Ve))}G.dynamic?(Ce.type==="Feature"&&(Ce={type:"FeatureCollection",features:[Ce]}),G.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ce.features,this.loaded),G.cluster&&(Ce.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=G.cluster?new fn(function({superclusterOptions:Re,clusterProperties:Ve}){if(!Ve||!Re)return Re;const Ye={},Ne={},yt={accumulated:null,zoom:0},Et={properties:null},Ot=Object.keys(Ve);for(const li of Ot){const[fi,xi]=Ve[li],Ii=o.X(xi),Nn=o.X(typeof fi=="string"?[fi,["accumulated"],["get",li]]:fi);Ye[li]=Ii.value,Ne[li]=Nn.value}return Re.map=li=>{Et.properties=li;const fi={};for(const xi of Ot)fi[xi]=Ye[xi].evaluate(yt,Et);return fi},Re.reduce=(li,fi)=>{Et.properties=fi;for(const xi of Ot)yt.accumulated=li[xi],li[xi]=Ne[xi].evaluate(yt,Et)},Re}(G)).load(Ce.features):G.dynamic?this._dynamicIndex:function(Re,Ve){return new ur(Re,Ve)}(Ce,G.geojsonVtOptions)}catch(Re){return X(Re)}const Me={};if(Te){const Re=j(ue);Re&&(Me.resourceTiming={},Me.resourceTiming[G.source]=JSON.parse(JSON.stringify(Re)))}X(null,Me)}})}reloadTile(G,X){const ue=this.loaded;return ue&&ue[G.uid]?G.partial?X(null,void 0):super.reloadTile(G,X):this.loadTile(G,X)}loadGeoJSON(G,X){if(G.request)o.n(G.request,X);else{if(typeof G.data!="string")return X(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return X(null,JSON.parse(G.data))}catch{return X(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,X){try{X(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(ue){X(ue)}}getClusterChildren(G,X){try{X(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(ue){X(ue)}}getClusterLeaves(G,X){try{X(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(ue){X(ue)}}}class gt{constructor(G,X){this.tileID=new o.aM(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=G.projection,this.brightness=X}parse(G,X,ue,Te){this.status="parsing";const ve=new o.aM(ue.tileID.overscaledZ,ue.tileID.wrap,ue.tileID.canonical.z,ue.tileID.canonical.x,ue.tileID.canonical.y),Ce=[],Me=X.familiesBySource[ue.source],Re=new o.f0(ve,ue.promoteId);Re.bucketLayerIDs=[],Re.is3DTile=!0,o.fi(G).then(Ve=>{if(!Ve)return Te(new Error("Could not parse tile"));const Ye=o.fj(Ve,1/o.cT(ue.tileID.canonical)),Ne=Ve.json.extensionsUsed&&Ve.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ve.json.asset.extras&&Ve.json.asset.extras.MAPBOX_mesh_features,yt=Ve.json.extensionsUsed&&Ve.json.extensionsUsed.includes("EXT_meshopt_compression"),Et=new o.aa(this.zoom,{brightness:this.brightness});for(const Ot in Me)for(const li of Me[Ot]){const fi=li[0];Re.bucketLayerIDs.push(li.map(Ii=>o.C(Ii.id,Ii.scope))),fi.recalculate(Et,[]);const xi=new o.fk(li,Ye,ve,Ne,yt,this.brightness,Re);Ne||(xi.needsUpload=!0),Ce.push(xi),xi.evaluate(fi)}this.status="done",Te(null,{buckets:Ce,featureIndex:Re,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ve=>Te(new Error(Ve.message)))}}class ra{constructor(G,X,ue,Te,ve,Ce,Me){this.actor=G,this.layerIndex=X,this.availableImages=ue,this.availableModels=Te,this.brightness=Me,this.loading={},this.loaded={}}loadTile(G,X){const ue=G.uid,Te=this.loading[ue]=new gt(G,this.brightness);o.br(G.request,(ve,Ce)=>{const Me=!this.loading[ue];return delete this.loading[ue],Me||ve?(Te.status="done",Me||(this.loaded[ue]=Te),X(ve)):Ce&&Ce.byteLength!==0?void Te.parse(Ce,this.layerIndex,G,(Re,Ve)=>{Te.status="done",this.loaded=this.loaded||{},this.loaded[ue]=Te,Re||!Ve?X(Re):X(null,Ve)}):(Te.status="done",this.loaded[ue]=Te,X())})}reloadTile(G,X){const ue=this.loaded,Te=G.uid;if(ue&&ue[Te]){const ve=ue[Te];ve.projection=G.projection,ve.brightness=G.brightness;const Ce=(Me,Re)=>{ve.reloadCallback&&(delete ve.reloadCallback,this.loadTile(G,X)),X(Me,Re)};ve.status==="parsing"?ve.reloadCallback=Ce:ve.status==="done"&&this.loadTile(G,X)}}abortTile(G,X){const ue=G.uid;this.loading[ue]&&delete this.loading[ue],X()}removeTile(G,X){const ue=this.loaded,Te=G.uid;ue&&ue[Te]&&delete ue[Te],X()}}class Kh{constructor(G){this.self=G,this.actor=new o.fm(G,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.y,this.projections={},this.defaultProjection=o.ce({name:"mercator"}),this.workerSourceTypes={vector:Pe,geojson:dl,"raster-dem":he,"raster-array":we,"batched-model":ra},this.workerSources={},this.self.registerWorkerSource=(X,ue)=>{if(this.workerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.workerSourceTypes[X]=ue},this.self.registerRTLTextPlugin=X=>{if(o.fn.isParsed())throw new Error("RTL text plugin already registered.");o.fn.applyArabicShaping=X.applyArabicShaping,o.fn.processBidirectionalText=X.processBidirectionalText,o.fn.processStyledBidirectionalText=X.processStyledBidirectionalText}}clearCaches(G,X,ue){delete this.layerIndexes[G],delete this.availableImages[G],delete this.availableModels[G],delete this.workerSources[G],ue()}checkIfReady(G,X,ue){ue()}setReferrer(G,X){this.referrer=X}spriteLoaded(G,X){this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={});const{scope:ue,isLoaded:Te}=X;if(this.isSpriteLoaded[G][ue]=Te,this.workerSources[G]&&this.workerSources[G][ue])for(const ve in this.workerSources[G][ue]){const Ce=this.workerSources[G][ue][ve];for(const Me in Ce){const Re=Ce[Me];Re instanceof Pe&&(Re.isSpriteLoaded=Te,Re.fire(new o.A("isSpriteLoaded")))}}}setImages(G,X,ue){this.availableImages[G]||(this.availableImages[G]={});const{scope:Te,images:ve}=X;if(this.availableImages[G][Te]=ve,this.workerSources[G]&&this.workerSources[G][Te]){for(const Ce in this.workerSources[G][Te]){const Me=this.workerSources[G][Te][Ce];for(const Re in Me)Me[Re].availableImages=ve}ue()}else ue()}setModels(G,{scope:X,models:ue},Te){if(this.availableModels[G]||(this.availableModels[G]={}),this.availableModels[G][X]=ue,this.workerSources[G]&&this.workerSources[G][X]){for(const ve in this.workerSources[G][X]){const Ce=this.workerSources[G][X][ve];for(const Me in Ce)Ce[Me].availableModels=ue}Te()}else Te()}setProjection(G,X){this.projections[G]=o.ce(X)}setBrightness(G,X,ue){this.brightness=X,ue()}setLayers(G,X,ue){this.getLayerIndex(G,X.scope).replace(X.layers,X.options),ue()}updateLayers(G,X,ue){this.getLayerIndex(G,X.scope).update(X.layers,X.removedIds,X.options),ue()}loadTile(G,X,ue){X.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,X.type,X.source,X.scope).loadTile(X,ue)}decodeRasterArray(G,X,ue){this.getWorkerSource(G,X.type,X.source,X.scope).decodeRasterArray(X,ue)}reloadTile(G,X,ue){X.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,X.type,X.source,X.scope).reloadTile(X,ue)}abortTile(G,X,ue){this.getWorkerSource(G,X.type,X.source,X.scope).abortTile(X,ue)}removeTile(G,X,ue){this.getWorkerSource(G,X.type,X.source,X.scope).removeTile(X,ue)}removeSource(G,X,ue){if(!(this.workerSources[G]&&this.workerSources[G][X.scope]&&this.workerSources[G][X.scope][X.type]&&this.workerSources[G][X.scope][X.type][X.source]))return;const Te=this.workerSources[G][X.scope][X.type][X.source];delete this.workerSources[G][X.scope][X.type][X.source],Te.removeSource!==void 0?Te.removeSource(X,ue):ue()}loadWorkerSource(G,X,ue){try{this.self.importScripts(X.url),ue()}catch(Te){ue(Te.toString())}}syncRTLPluginState(G,X,ue){try{o.fn.setState(X);const Te=o.fn.getPluginURL();if(o.fn.isLoaded()&&!o.fn.isParsed()&&Te!=null){this.self.importScripts(Te);const ve=o.fn.isParsed();ue(ve?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Te}`),ve)}}catch(Te){ue(Te.toString())}}setDracoUrl(G,X){this.dracoUrl=X}getAvailableImages(G,X){this.availableImages[G]||(this.availableImages[G]={});let ue=this.availableImages[G][X];return ue||(ue=[]),ue}getAvailableModels(G,X){this.availableModels[G]||(this.availableModels[G]={});let ue=this.availableModels[G][X];return ue||(ue={}),ue}getLayerIndex(G,X){this.layerIndexes[G]||(this.layerIndexes[G]={});let ue=this.layerIndexes[G][X];return ue||(ue=this.layerIndexes[G][X]=new te,ue.scope=X),ue}getWorkerSource(G,X,ue,Te){const ve=this.workerSources;return ve[G]||(ve[G]={}),ve[G][Te]||(ve[G][Te]={}),ve[G][Te][X]||(ve[G][Te][X]={}),this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),ve[G][Te][X][ue]||(ve[G][Te][X][ue]=new this.workerSourceTypes[X]({send:(Ce,Me,Re,Ve,Ye,Ne)=>this.actor.send(Ce,Me,Re,G,Ye,Ne),scheduler:this.actor.scheduler},this.getLayerIndex(G,Te),this.getAvailableImages(G,Te),this.getAvailableModels(G,Te),this.isSpriteLoaded[G][Te],void 0,this.brightness)),ve[G][Te][X][ue]}rasterizeImagesWorker(G,X,ue){const Te=new Map;for(const[ve,{image:Ce,imageVariant:Me}]of X.tasks.entries()){const Re=this.imageRasterizer.rasterize(Me,Ce,X.scope,G);Te.set(ve,Re)}ue(void 0,Te)}removeRasterizedImages(G,X,ue){this.imageRasterizer.removeImagesFromCacheByIds(X.imageIds,X.scope,G),ue()}enforceCacheSizeLimit(G,X){o.fo(X)}getWorkerPerformanceMetrics(G,X,ue){ue(void 0,void 0)}}return o.fl(self)&&(self.worker=new Kh(self)),Kh}),I(["./shared"],function(o){var j="3.12.0";const W={create:"create",load:"load",fullLoad:"fullLoad"},re={mark(u){performance.mark(u)},measure(u,t,s){performance.measure(u,t,s)}};function te(u){const t=u.name.split("?")[0];return o.a(t)&&t.includes("mapbox-gl.js")?"javascript":o.a(t)&&t.includes("mapbox-gl.css")?"css":o.b(t)?"fontRange":o.c(t)?"sprite":o.i(t)?"style":o.d(t)?"tilejson":"other"}var Y,Ee={},Ie=function(){if(Y)return Ee;function u(h){return!t(h)}function t(h){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,b=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(b);try{v=new Worker(S),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(S),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===g.width}()?(s[m=h&&h.failIfMajorPerformanceCaveat]===void 0&&(s[m]=function(g){var v,b=function(S){var C=document.createElement("canvas"),P=Object.create(u.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=S,C.getContext("webgl2",P)}(g);if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),b.getShaderParameter(v,b.COMPILE_STATUS)===!0)}(m)),s[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var m}Y=1,Ee.supported=u,Ee.notSupportedReason=t;var s={};return u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Ee}();function me(u,t,s){const h=document.createElement(u);return t!=null&&(h.className=t),s&&s.appendChild(h),h}function Pe(u,t,s){const h=document.createElementNS("http://www.w3.org/2000/svg",u);for(const m of Object.keys(t))h.setAttributeNS(null,m,String(t[m]));return s&&s.appendChild(h),h}const he=typeof document<"u"?document.documentElement&&document.documentElement.style:null,pe=he&&he.userSelect!==void 0?"userSelect":"WebkitUserSelect";let we;function Ue(){he&&pe&&(we=he[pe],he[pe]="none")}function tt(){he&&pe&&(he[pe]=we)}function _t(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",_t,!0)}function wt(){window.addEventListener("click",_t,!0),window.setTimeout(()=>{window.removeEventListener("click",_t,!0)},0)}function xt(u,t){const s=u.getBoundingClientRect();return ni(u,s,t)}function ci(u,t){const s=u.getBoundingClientRect(),h=[];for(let m=0;m<t.length;m++)h.push(ni(u,s,t[m]));return h}function ti(u){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&u.button===2&&u.ctrlKey?0:u.button}function ni(u,t,s){const h=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new o.P((s.clientX-t.left)*h,(s.clientY-t.top)*h)}const ui="01",Pi="NO_ACCESS_TOKEN";class Vt{constructor(t,s,h){this._transformRequestFn=t,this._customAccessToken=s,this._silenceAuthErrors=!!h,this._createSkuToken()}_createSkuToken(){const t=function(){let s="";for(let h=0;h<10;h++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ui,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeStyleURL(t,s){if(!o.f(t))return t;const h=ai(t);return h.params.push(`sdk=js-${j}`),h.path=`/styles/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeGlyphsURL(t,s){if(!o.f(t))return t;const h=ai(t);return h.path=`/fonts/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeModelURL(t,s){if(!o.f(t))return t;const h=ai(t);return h.path=`/models/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeSourceURL(t,s,h,m){if(!o.f(t))return t;const g=ai(t);return g.path=`/v4/${g.authority}.json`,g.params.push("secure"),h&&g.params.push(`language=${h}`),m&&g.params.push(`worldview=${m}`),this._makeAPIURL(g,this._customAccessToken||s)}normalizeIconsetURL(t,s){const h=ai(t);return o.f(t)?(h.path=`/styles/v1${h.path}/iconset.pbf`,this._makeAPIURL(h,this._customAccessToken||s)):Vi(h)}normalizeSpriteURL(t,s,h,m){const g=ai(t);return o.f(t)?(g.path=`/styles/v1${g.path}/sprite${s}${h}`,this._makeAPIURL(g,this._customAccessToken||m)):(g.path+=`${s}${h}`,Vi(g))}normalizeTileURL(t,s,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!o.f(t))return t;const m=ai(t);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||h&&m.authority!=="raster"&&h===512?"@2x":""}${o.m.supported?".webp":"$1"}`),m.authority==="raster"?m.path=`/${o.e.RASTER_URL_PREFIX}${m.path}`:m.authority==="rasterarrays"?m.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${m.path}`:m.authority==="3dtiles"?m.path=`/${o.e.TILES3D_URL_PREFIX}${m.path}`:(m.path=m.path.replace(/^.+\/v4\//,"/"),m.path=`/${o.e.TILE_URL_VERSION}${m.path}`);const g=this._customAccessToken||function(v){for(const b of v){const S=b.match(/^access_token=(.*)$/);if(S)return S[1]}return null}(m.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&m.params.push(`sku=${this._skuToken}`),this._makeAPIURL(m,g)}canonicalizeTileURL(t,s){const h=ai(t);if(!h.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!h.path.match(/\.[\w]+$/))return t;let m="mapbox://";h.path.match(/^\/raster\/v1\//)?m+=`raster/${h.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:h.path.match(/^\/rasterarrays\/v1\//)?m+=`rasterarrays/${h.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:m+=`tiles/${h.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let g=h.params;return s&&(g=g.filter(v=>!v.match(/^access_token=/))),g.length&&(m+=`?${g.join("&")}`),m}canonicalizeTileset(t,s){const h=!!s&&o.f(s),m=[];for(const g of t.tiles||[])o.h(g)?m.push(this.canonicalizeTileURL(g,h)):m.push(g);return m}_makeAPIURL(t,s){const h="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",m=ai(o.e.API_URL);if(t.protocol=m.protocol,t.authority=m.authority,t.protocol==="http"){const g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(m.path!=="/"&&(t.path=`${m.path}${t.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return Vi(t);if(s=s||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${h}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${h}`)}return t.params=t.params.filter(g=>g.indexOf("access_token")===-1),t.params.push(`access_token=${s||""}`),Vi(t)}}const vi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ai(u){const t=u.match(vi);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Vi(u){const t=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${t}`}const ft="mapbox.eventData";function $t(u){if(!u)return null;const t=u.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(o.j(t[1]))}catch{return null}}class Gt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=$t(o.e.ACCESS_TOKEN);let h="";return h=s&&s.u?o.k(s.u):o.e.ACCESS_TOKEN||"",t?`${ft}.${t}:${h}`:`${ft}:${h}`}fetchEventData(){const t=o.s("localStorage"),s=this.getStorageKey(),h=this.getStorageKey("uuid");if(t)try{const m=localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));const g=localStorage.getItem(h);g&&(this.anonId=g)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const t=o.s("localStorage"),s=this.getStorageKey(),h=this.getStorageKey("uuid"),m=this.anonId;if(t&&m)try{localStorage.setItem(h,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,h,m){if(!o.e.EVENTS_URL)return;const g=ai(o.e.EVENTS_URL);g.params.push(`access_token=${m||o.e.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(t).toISOString()},b=s?o.l(v,s):v,S={url:Vi(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=o.p(S,C=>{this.pendingRequest=null,h(C),this.saveEventData(),this.processRequests(m)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const ii=new class extends Gt{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,t){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(u)&&u.some(s=>o.f(s)||o.h(s))&&this.queueRequest(Date.now(),t)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=$t(o.e.ACCESS_TOKEN),s=t?t.u:o.e.ACCESS_TOKEN;let h=s!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),h=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),v=new Date(m),b=(m-this.eventData.lastSuccess)/864e5;h=h||b>=1||b<-1||g.getDate()!==v.getDate()}else h=!0;h?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:j,skuId:ui,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=m,this.eventData.tokenU=s)},u):this.processRequests()}},Li=ii.postTurnstileEvent.bind(ii),Ji=new class extends Gt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,t,s,h){this.skuToken=t,this.errorCb=h,o.e.EVENTS_URL&&(s||o.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},s):this.errorCb(new Error(Pi)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:j,skuId:ui,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},u))}remove(){this.errorCb=null}},Vn=Ji.postMapLoadEvent.bind(Ji),$i=new class extends Gt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(u){let t=this.mapInstanceIdMap.get(u);return t||(t=o.u(),this.mapInstanceIdMap.set(u,t)),t}getEventId(u){const t=this.eventIdPerMapInstanceMap.get(u)||0;return this.eventIdPerMapInstanceMap.set(u,t+1),t}postStyleLoadEvent(u,t){const{map:s,style:h,importedStyles:m}=t;if(!o.e.EVENTS_URL||!u&&!o.e.ACCESS_TOKEN)return;const g=this.getMapInstanceId(s),v={mapInstanceId:g,eventId:this.getEventId(g),style:h};m.length&&(v.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:v},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:s}=this.queue.shift();this.postEvent(t,s,()=>{},u)}},Ei=$i.postStyleLoadEvent.bind($i),xn=new class extends Gt{constructor(){super("gljs.performance")}postPerformanceEvent(u,t){o.e.EVENTS_URL&&(u||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:s}=this.queue.shift(),h=function(m){const g=performance.getEntriesByType("resource"),v=performance.getEntriesByType("mark"),b=function(O){const V={};if(O){for(const N in O)if(N!=="other")for(const H of O[N]){const U=`${N}ResolveRangeMin`,Q=`${N}ResolveRangeMax`,ne=`${N}RequestCount`,ae=`${N}RequestCachedCount`;V[U]=Math.min(V[U]||1/0,H.startTime),V[Q]=Math.max(V[Q]||-1/0,H.responseEnd);const ge=de=>{V[de]===void 0&&(V[de]=0),++V[de]};H.transferSize!==void 0&&H.transferSize===0&&ge(ae),ge(ne)}}return V}(function(O,V){const N={};if(O)for(const H of O){const U=V(H);N[U]===void 0&&(N[U]=[]),N[U].push(H)}return N}(g,te)),S=window.devicePixelRatio,C=navigator.connection||navigator.mozConnection||navigator.webkitConnection,P=C?C.effectiveType:void 0,D={counters:[],metadata:[],attributes:[]},z=(O,V,N)=>{N!=null&&O.push({name:V,value:N.toString()})};for(const O in b)z(D.counters,O,b[O]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(z(D.counters,"interactionRangeMin",m.interactionRange[0]),z(D.counters,"interactionRangeMax",m.interactionRange[1])),v)for(const O of Object.keys(W)){const V=W[O],N=v.find(H=>H.name===V);N&&z(D.counters,V,N.startTime)}return z(D.counters,"visibilityHidden",m.visibilityHidden),z(D.attributes,"style",function(O){if(O)for(const V of O){const N=V.name.split("?")[0];if(o.i(N)){const H=N.split("/").slice(-2);if(H.length===2)return`mapbox://styles/${H[0]}/${H[1]}`}}}(g)),z(D.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),z(D.attributes,"fogEnabled",m.fogEnabled?"true":"false"),z(D.attributes,"projection",m.projection),z(D.attributes,"zoom",m.zoom),z(D.metadata,"devicePixelRatio",S),z(D.metadata,"connectionEffectiveType",P),z(D.metadata,"navigatorUserAgent",navigator.userAgent),z(D.metadata,"screenWidth",window.screen.width),z(D.metadata,"screenHeight",window.screen.height),z(D.metadata,"windowWidth",window.innerWidth),z(D.metadata,"windowHeight",window.innerHeight),z(D.metadata,"mapWidth",m.width/S),z(D.metadata,"mapHeight",m.height/S),z(D.metadata,"webglRenderer",m.renderer),z(D.metadata,"webglVendor",m.vendor),z(D.metadata,"sdkVersion",j),z(D.metadata,"sdkIdentifier","mapbox-gl-js"),D}(s);for(const m of h.metadata);for(const m of h.counters);for(const m of h.attributes);this.postEvent(t,h,()=>{},u)}},fo=xn.postPerformanceEvent.bind(xn),fn=new class extends Gt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,t,s,h){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const m=ai(o.e.API_URL+o.e.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${h||o.e.ACCESS_TOKEN||""}`);const g={url:Vi(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(g,v=>{this.pendingRequest=null,s(v),this.saveEventData(),this.processRequests(h)})}getSessionAPI(u,t,s,h){this.skuToken=t,this.errorCb=h,o.e.SESSION_PATH&&o.e.API_URL&&(s||o.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},s):this.errorCb(new Error(Pi)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},u)}remove(){this.errorCb=null}},po=fn.getSessionAPI.bind(fn),Oo=new Set;function Ir(u,t){t?Oo.add(u):Oo.delete(u)}class Tn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,s){this._updatedSourceCaches[t]=s,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const s=t.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(t.id),this.setDirty()}removeLayer(t){const s=t.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][t.id]=t,this._updatedLayers[s].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const s in this._updatedLayers)t[s]=t[s]||{},t[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)t[s]=t[s]||{},t[s].removedIds=Object.keys(this._removedLayers[s]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,s){this._updatedImages[s]=this._updatedImages[s]||new Set,this._updatedImages[s].add(o.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function ea(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class Wo extends o.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&o.t()&&(this.imageRasterizerDispatcher=new o.D(o.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new o.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const s=this.atlasTexture.get(t);s&&(s.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,s){this.imageProviders.has(s)||this.imageProviders.set(s,new Map),this.imageProviders.get(s).set(t.id,t)}removeImageProvider(t,s){this.imageProviders.has(s)&&this.imageProviders.get(s).delete(t)}getPendingImageProviders(){const t=[];for(const s of this.imageProviders.values())for(const h of s.values())h.hasPendingRequests()&&t.push(h);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,s){if(this.loaded.get(s)!==t&&(this.loaded.set(s,t),t)){for(const{ids:h,callback:m}of this.requestors)this._notify(h,s,m);this.requestors=[]}}hasImage(t,s){return!!this.getImage(t,s)}getImage(t,s){return this.images.get(s).get(t.toString())}addImage(t,s,h){this._validate(t,h)&&this.images.get(s).set(t.toString(),h)}_validate(t,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new o.z(new Error(`Image "${t.name}" has invalid "content" value`))),h=!1),h}_validateStretch(t,s){if(!t)return!0;let h=0;for(const m of t){if(m[0]<h||m[1]<m[0]||s<m[1])return!1;h=m[1]}return!0}_validateContent(t,s){return t?t.length!==4||!s.usvg&&(t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,s,h){const m=this.images.get(s).get(t.toString());h.version=m.version+1,this.images.get(s).set(t.toString(),h),this.updatedImages.get(s).add(t),this.removeFromImageRasterizerCache(t,s)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,s){this.spriteFormat!=="raster"&&(o.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:s}):this.imageRasterizer.removeImagesFromCacheByIds([t],s))}removeImage(t,s){const h=this.images.get(s),m=h.get(t.toString());h.delete(t.toString()),this.patterns.get(s).delete(t.toString()),this.removeFromImageRasterizerCache(t,s),m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(s=>o.I.from(s))}getImages(t,s,h){const m=[],g=[],v=this.imageProviders.get(s);for(const P of t){if(!P.iconsetId){m.push(P);continue}const D=v.get(P.iconsetId);D&&(this.getImage(P,s)?g.push(P):D.addPendingRequest(P))}if(m.length===0)return void this._notify(g,s,h);let b=!0;const S=!!this.loaded.get(s),C=this.images.get(s);if(!S)for(const P of m)C.has(P.toString())||(b=!1);S||b?this._notify(m,s,h):this.requestors.push({ids:m,scope:s,callback:h})}rasterizeImages(t,s){const h=new Map,{tasks:m,scope:g}=t;for(const[v,b]of m.entries()){const S=this.getImage(b.id,g);S&&h.set(v,{image:S,imageVariant:b})}this._rasterizeImages(g,h,s)}_rasterizeImages(t,s,h){if(o.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:s,scope:t},h);else{const m=new Map;for(const[g,{image:v,imageVariant:b}]of s.entries())m.set(g,this.imageRasterizer.rasterize(b,v,t,0));h(void 0,m)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,s,h){const m=this.images.get(s),g=new Map;for(const v of t){if(!m.get(v.toString())){if(v.iconsetId)continue;this.fire(new o.A("styleimagemissing",{id:v.name}))}const b=m.get(v.toString());if(!b){o.w(`Image "${v.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const S={data:b.usvg?null:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,usvg:b.usvg,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)};b.usvg&&Object.assign(S,{width:b.icon.usvg_tree.width,height:b.icon.usvg_tree.height}),g.set(o.I.toString(v),S)}h(null,g)}getPixelSize(t){const{width:s,height:h}=this.atlasImage.get(t);return{width:s,height:h}}getPattern(t,s,h){const m=t.toString(),g=this.patterns.get(s),v=g.get(m),b=this.getImage(t,s);if(!b)return null;if(v){if(v.position.version===b.version)return v.position;v.position.version=b.version}else{if(b.usvg&&!b.data){const S=this.getPatternInFlightId(m,s);if(this.patternsInFlight.has(S))return null;this.patternsInFlight.add(S);const C=new o.B(t).scaleSelf(o.q.devicePixelRatio),P=new Map([[C.toString(),{image:b,imageVariant:C}]]);return this._rasterizeImages(s,P,(D,z)=>this.storePatternImage(C,s,b,h,z)),null}this.storePattern(t,s,b)}return this._updatePatternAtlas(s,h),g.get(m).position}getPatternInFlightId(t,s){return o.C(t,s)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,s,h,m,g){const v=t.toString(),b=g?g.get(v):void 0;b&&(h.data=b,this.storePattern(t.id,s,h),this._updatePatternAtlas(s,m),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),s)))}storePattern(t,s,h){const m={w:h.data.width+2*o.F,h:h.data.height+2*o.F,x:0,y:0},g=new o.G(m,h,o.F);this.patterns.get(s).set(t.toString(),{bin:m,position:g})}bind(t,s){const h=t.gl;let m=this.atlasTexture.get(s);m?this.dirty&&(m.update(this.atlasImage.get(s)),this.dirty=!1):(m=new o.T(t,this.atlasImage.get(s),h.RGBA8),this.atlasTexture.set(s,m)),m.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(t,s){const h=this.patterns.get(t),m=Array.from(h.values()).map(({bin:C})=>C),{w:g,h:v}=o.H(m),b=this.atlasImage.get(t);b.resize({width:g||1,height:v||1});const S=this.images.get(t);for(const[C,{bin:P,position:D}]of h.entries()){let z=D.padding;const O=P.x+z,V=P.y+z,N=S.get(C).data,H=N.width,U=N.height;z=z>1?z-1:z,o.r.copy(N,b,{x:0,y:0},{x:O,y:V},{width:H,height:U},s),o.r.copy(N,b,{x:0,y:U-z},{x:O,y:V-z},{width:H,height:z},s),o.r.copy(N,b,{x:0,y:0},{x:O,y:V+U},{width:H,height:z},s),o.r.copy(N,b,{x:H-z,y:0},{x:O-z,y:V},{width:z,height:U},s),o.r.copy(N,b,{x:0,y:0},{x:O+H,y:V},{width:z,height:U},s),o.r.copy(N,b,{x:H-z,y:U-z},{x:O-z,y:V-z},{width:z,height:z},s),o.r.copy(N,b,{x:0,y:U-z},{x:O+H,y:V-z},{width:z,height:z},s),o.r.copy(N,b,{x:0,y:0},{x:O+H,y:V+U},{width:z,height:z},s),o.r.copy(N,b,{x:H-z,y:0},{x:O-z,y:V+U},{width:z,height:z},s)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,s){const h=this.images.get(s);for(const m of t){if(this.callbackDispatchedThisFrame.get(s).has(m.toString()))continue;this.callbackDispatchedThisFrame.get(s).add(m.toString());const g=h.get(m.toString());ea(g)&&this.updateImage(m,s,g)}}}function ir(u){const t=u.key,s=u.value,h=u.valueSpec||{},m=u.objectElementValidators||{},g=u.style,v=u.styleSpec;let b=[];const S=o.K(s);if(S!=="object")return[new o.V(t,s,`object expected, ${S} found`)];for(const C in s){const P=C.split(".")[0];let D;m[P]?D=m[P]:h[P]?D=oi:m["*"]?D=m["*"]:h["*"]&&(D=oi),D?b=b.concat(D({key:(t&&`${t}.`)+C,value:s[C],valueSpec:h[P]||h["*"],style:g,styleSpec:v,object:s,objectKey:C},s)):b.push(new o.J(t,s[C],`unknown property "${C}"`))}for(const C in h)m[C]||h[C].required&&h[C].default===void 0&&s[C]===void 0&&b.push(new o.V(t,s,`missing required property "${C}"`));return b}function Fo(u){const t=u.value,s=u.valueSpec,h=u.style,m=u.styleSpec,g=u.key,v=u.arrayElementValidator||oi;if(o.K(t)!=="array")return[new o.V(g,t,`array expected, ${o.K(t)} found`)];if(s.length&&t.length!==s.length)return[new o.V(g,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new o.V(g,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let b={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};m.$version<7&&(b.function=s.function),o.K(s.value)==="object"&&(b=s.value);let S=[];for(let C=0;C<t.length;C++)S=S.concat(v({array:t,arrayIndex:C,value:t[C],valueSpec:b,style:h,styleSpec:m,key:`${g}[${C}]`},!0));return S}function Zo(u){const t=u.key,s=u.value,h=u.valueSpec;let m=o.K(s);if(m==="number"&&s!=s&&(m="NaN"),m!=="number")return[new o.V(t,s,`number expected, ${m} found`)];if("minimum"in h){let g=h.minimum;if(o.K(h.minimum)==="array"&&(g=h.minimum[u.arrayIndex]),s<g)return[new o.V(t,s,`${s} is less than the minimum value ${g}`)]}if("maximum"in h){let g=h.maximum;if(o.K(h.maximum)==="array"&&(g=h.maximum[u.arrayIndex]),s>g)return[new o.V(t,s,`${s} is greater than the maximum value ${g}`)]}return[]}function Bn(u){const t=u.valueSpec,s=o.M(u.value.type);let h,m,g,v={};const b=s!=="categorical"&&u.value.property===void 0,S=!b,C=o.K(u.value.stops)==="array"&&o.K(u.value.stops[0])==="array"&&o.K(u.value.stops[0][0])==="object",P=ir({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(O){if(s==="identity")return[new o.V(O.key,O.value,'identity function may not have a "stops" property')];let V=[];const N=O.value;return V=V.concat(Fo({key:O.key,value:N,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:D})),o.K(N)==="array"&&N.length===0&&V.push(new o.V(O.key,N,"array must have at least one stop")),V},default:function(O){return oi({key:O.key,value:O.value,valueSpec:t,style:O.style,styleSpec:O.styleSpec})}}});return s==="identity"&&b&&P.push(new o.V(u.key,u.value,'missing required property "property"')),s==="identity"||u.value.stops||P.push(new o.V(u.key,u.value,'missing required property "stops"')),s==="exponential"&&u.valueSpec.expression&&!o.N(u.valueSpec)&&P.push(new o.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(S&&!o.O(u.valueSpec)?P.push(new o.V(u.key,u.value,"property functions not supported")):b&&!o.Q(u.valueSpec)&&P.push(new o.V(u.key,u.value,"zoom functions not supported"))),s!=="categorical"&&!C||u.value.property!==void 0||P.push(new o.V(u.key,u.value,'"property" property is required')),P;function D(O){let V=[];const N=O.value,H=O.key;if(o.K(N)!=="array")return[new o.V(H,N,`array expected, ${o.K(N)} found`)];if(N.length!==2)return[new o.V(H,N,`array length 2 expected, length ${N.length} found`)];if(C){if(o.K(N[0])!=="object")return[new o.V(H,N,`object expected, ${o.K(N[0])} found`)];if(N[0].zoom===void 0)return[new o.V(H,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new o.V(H,N,"object stop key must have value")];const U=o.M(N[0].zoom);if(typeof U!="number")return[new o.V(H,N[0].zoom,"stop zoom values must be numbers")];if(g&&g>U)return[new o.V(H,N[0].zoom,"stop zoom values must appear in ascending order")];U!==g&&(g=U,m=void 0,v={}),V=V.concat(ir({key:`${H}[0]`,value:N[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:Zo,value:z}}))}else V=V.concat(z({key:`${H}[0]`,value:N[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},N));return o.S(o.U(N[1]))?V.concat([new o.V(`${H}[1]`,N[1],"expressions are not allowed in function stops.")]):V.concat(oi({key:`${H}[1]`,value:N[1],valueSpec:t,style:O.style,styleSpec:O.styleSpec}))}function z(O,V){const N=o.K(O.value),H=o.M(O.value),U=O.value!==null?O.value:V;if(h){if(N!==h)return[new o.V(O.key,U,`${N} stop domain type must match previous stop domain type ${h}`)]}else h=N;if(N!=="number"&&N!=="string"&&N!=="boolean"&&typeof H!="number"&&typeof H!="string"&&typeof H!="boolean")return[new o.V(O.key,U,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&s!=="categorical"){let Q=`number expected, ${N} found`;return o.O(t)&&s===void 0&&(Q+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(O.key,U,Q)]}return s!=="categorical"||N!=="number"||typeof H=="number"&&isFinite(H)&&Math.floor(H)===H?s!=="categorical"&&N==="number"&&typeof H=="number"&&typeof m=="number"&&m!==void 0&&H<m?[new o.V(O.key,U,"stop domain values must appear in ascending order")]:(m=H,s==="categorical"&&H in v?[new o.V(O.key,U,"stop domain values must be unique")]:(v[H]=!0,[])):[new o.V(O.key,U,`integer expected, found ${String(H)}`)]}}function Or(u){const t=(u.expressionContext==="property"?o.W:o.X)(o.U(u.value),u.valueSpec);if(t.result==="error")return t.value.map(h=>new o.V(`${u.key}${h.key}`,u.value,h.message));const s=t.value.expression||t.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!s.outputDefined())return[new o.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!o.Y(s))return[new o.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Fs(s,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!o.Z(s,["zoom","feature-state"]))return[new o.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!o._(s))return[new o.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fs(u,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)s.delete(m);if(s.size===0)return[];const h=[];return u instanceof o.$&&s.has(u.name)?[new o.V(t.key,t.value,`["${u.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(u.eachChild(m=>{h.push(...Fs(m,t))}),h)}function hs(u){const t=u.key,s=u.value,h=u.valueSpec,m=[];return Array.isArray(h.values)?h.values.indexOf(o.M(s))===-1&&m.push(new o.V(t,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(o.M(s))===-1&&m.push(new o.V(t,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function Xo(u){return o.a1(o.U(u.value))?Or(o.L({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):$r(u)}function $r(u){const t=u.value,s=u.key;if(o.K(t)!=="array")return[new o.V(s,t,`array expected, ${o.K(t)} found`)];const h=u.styleSpec;let m,g=[];if(t.length<1)return[new o.V(s,t,"filter array must have at least 1 element")];switch(g=g.concat(hs({key:`${s}[0]`,value:t[0],valueSpec:h.filter_operator,style:u.style,styleSpec:u.styleSpec})),o.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&o.M(t[1])==="$type"&&g.push(new o.V(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new o.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=o.K(t[1]),m!=="string"&&g.push(new o.V(`${s}[1]`,t[1],`string expected, ${m} found`)));for(let v=2;v<t.length;v++)m=o.K(t[v]),o.M(t[1])==="$type"?g=g.concat(hs({key:`${s}[${v}]`,value:t[v],valueSpec:h.geometry_type,style:u.style,styleSpec:u.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&g.push(new o.V(`${s}[${v}]`,t[v],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)g=g.concat($r({key:`${s}[${v}]`,value:t[v],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":m=o.K(t[1]),t.length!==2?g.push(new o.V(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):m!=="string"&&g.push(new o.V(`${s}[1]`,t[1],`string expected, ${m} found`))}return g}function Jr(u,t){const s=u.key,h=u.style,m=u.layer,g=u.styleSpec,v=u.value,b=u.objectKey,S=g[`${t}_${u.layerType}`];if(!S)return[];const C=b.match(/^(.*)-use-theme$/);if(t==="paint"&&C&&S[C[1]])return o.S(v)?[].concat(oi({key:u.key,value:v,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:b})):oi({key:s,value:v,valueSpec:{type:"string"},style:h,styleSpec:g});const P=b.match(/^(.*)-transition$/);if(t==="paint"&&P&&S[P[1]]&&S[P[1]].transition)return oi({key:s,value:v,valueSpec:g.transition,style:h,styleSpec:g});const D=u.valueSpec||S[b];if(!D)return[new o.J(s,v,`unknown property "${b}"`)];let z;if(o.K(v)==="string"&&o.O(D)&&!D.tokens&&(z=/^{([^}]+)}$/.exec(v))){const V=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new o.V(s,v,`"${b}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}const O=[];if(u.layerType==="symbol")b!=="text-field"||!h||h.glyphs||h.imports||O.push(new o.V(s,v,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&o.a2(o.U(v))&&o.M(v.type)==="identity"&&O.push(new o.V(s,v,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&t==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&o.O(D)&&(o.a3(D)||o.Q(D))){const V=o.W(o.U(v),D),N=V.value.expression||V.value._styleExpression.expression;N&&!o.Z(N,["measure-light"])&&(b==="model-emissive-strength"&&o._(N)&&o.Y(N)||O.push(new o.V(s,v,`${b} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return O.concat(oi({key:u.key,value:v,valueSpec:D,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:b}))}function ta(u){return Jr(u,"paint")}function wo(u){return Jr(u,"layout")}function ia(u){let t=[];const s=u.value,h=u.key,m=u.style,g=u.styleSpec;s.type||s.ref||t.push(new o.V(h,s,'either "type" or "ref" is required'));let v=o.M(s.type);const b=o.M(s.ref);if(s.id){const S=o.M(s.id);for(let C=0;C<u.arrayIndex;C++){const P=m.layers[C];o.M(P.id)===S&&t.push(new o.V(h,s.id,`duplicate layer id "${s.id}", previously used at line ${P.id.__line__}`))}}if("ref"in s){let S;["type","source","source-layer","filter","layout"].forEach(C=>{C in s&&t.push(new o.V(h,s[C],`"${C}" is prohibited for ref layers`))}),m.layers.forEach(C=>{o.M(C.id)===b&&(S=C)}),S?S.ref?t.push(new o.V(h,s.ref,"ref cannot reference another ref layer")):v=o.M(S.type):typeof b=="string"&&t.push(new o.V(h,s.ref,`ref layer "${b}" not found`))}else if(v!=="background"&&v!=="sky"&&v!=="slot")if(s.source){const S=m.sources&&m.sources[s.source],C=S&&o.M(S.type);S?C==="vector"&&v==="raster"?t.push(new o.V(h,s.source,`layer "${s.id}" requires a raster source`)):C==="raster"&&v!=="raster"?t.push(new o.V(h,s.source,`layer "${s.id}" requires a vector source`)):C!=="vector"||s["source-layer"]?C==="raster-dem"&&v!=="hillshade"?t.push(new o.V(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="raster-array"||["raster","raster-particle"].includes(v)?v==="line"&&s.paint&&(s.paint["line-gradient"]||s.paint["line-trim-offset"])&&C==="geojson"&&!S.lineMetrics?t.push(new o.V(h,s,`layer "${s.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):v==="raster-particle"&&C!=="raster-array"&&t.push(new o.V(h,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):t.push(new o.V(h,s.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new o.V(h,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new o.V(h,s.source,`source "${s.source}" not found`))}else t.push(new o.V(h,s,'missing required property "source"'));return t=t.concat(ir({key:h,value:s,valueSpec:g.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>oi({key:`${h}.type`,value:s.type,valueSpec:g.layer.type,style:u.style,styleSpec:u.styleSpec,object:s,objectKey:"type"}),filter:S=>Xo(o.L({layerType:v},S)),layout:S=>ir({layer:s,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":C=>wo(o.L({layerType:v},C))}}),paint:S=>ir({layer:s,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":C=>ta(o.L({layerType:v,layer:s},C))}})}})),t}function Hr(u){const t=u.value,s=u.key,h=o.K(t);return h!=="string"?[new o.V(s,t,`string expected, ${h} found`)]:[]}const Yo={promoteId:function u({key:t,value:s}){if(o.K(s)==="string")return Hr({key:t,value:s});if(Array.isArray(s)){const h=[],m=o.U(s),g=o.X(m);return g.result==="error"&&g.value.forEach(v=>{h.push(new o.V(`${t}${v.key}`,null,`${v.message}`))}),o.Z(g.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||h.push(new o.V(`${t}`,null,"promoteId expression should be only feature dependent")),h}{const h=[];for(const m in s)h.push(...u({key:`${t}.${m}`,value:s[m]}));return h}}};function qr(u){const t=u.value,s=u.key,h=u.styleSpec,m=u.style;if(!t.type)return[new o.V(s,t,'"type" is required')];const g=o.M(t.type);let v=[];switch(["vector","raster","raster-dem","raster-array"].includes(g)&&(t.url||t.tiles||v.push(new o.J(s,t,'Either "url" or "tiles" is required.'))),g){case"vector":case"raster":case"raster-dem":case"raster-array":return v=v.concat(ir({key:s,value:t,valueSpec:h[`source_${g.replace("-","_")}`],style:u.style,styleSpec:h,objectElementValidators:Yo})),v;case"geojson":if(v=ir({key:s,value:t,valueSpec:h.source_geojson,style:m,styleSpec:h,objectElementValidators:Yo}),t.cluster)for(const b in t.clusterProperties){const[S,C]=t.clusterProperties[b],P=typeof S=="string"?[S,["accumulated"],["get",b]]:S;v.push(...Or({key:`${s}.${b}.map`,value:C,expressionContext:"cluster-map"})),v.push(...Or({key:`${s}.${b}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return v;case"video":return ir({key:s,value:t,valueSpec:h.source_video,style:m,styleSpec:h});case"image":return ir({key:s,value:t,valueSpec:h.source_image,style:m,styleSpec:h});case"canvas":return[new o.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return hs({key:`${s}.type`,value:t.type,valueSpec:{values:Bs(h)},style:m,styleSpec:h})}}function Bs(u){return u.source.reduce((t,s)=>{const h=u[s];return h.type.type==="enum"&&(t=t.concat(Object.keys(h.type.values))),t},[])}function ds(u){const t=u.value,s=u.styleSpec,h=s.light,m=u.style;let g=[];const v=o.K(t);if(t===void 0)return g;if(v!=="object")return g=g.concat([new o.V("light",t,`object expected, ${v} found`)]),g;for(const b in t){const S=b.match(/^(.*)-transition$/),C=b.match(/^(.*)-use-theme$/);g=g.concat(C&&h[C[1]]?oi({key:b,value:t[b],valueSpec:{type:"string"},style:m,styleSpec:s}):S&&h[S[1]]&&h[S[1]].transition?oi({key:b,value:t[b],valueSpec:s.transition,style:m,styleSpec:s}):h[b]?oi({key:b,value:t[b],valueSpec:h[b],style:m,styleSpec:s}):[new o.V(b,t[b],`unknown property "${b}"`)])}return g}function Ko(u){const t=u.value;let s=[];if(!t)return s;const h=o.K(t);if(h!=="object")return s=s.concat([new o.V("light-3d",t,`object expected, ${h} found`)]),s;const m=u.styleSpec,g=m["light-3d"],v=u.key,b=u.style,S=u.style.lights;for(const D of["type","id"])if(!(D in t))return s=s.concat([new o.V("light-3d",t,`missing property ${D} on light`)]),s;if(t.type&&S)for(let D=0;D<u.arrayIndex;D++){const z=o.M(t.type),O=S[D];o.M(O.type)===z&&s.push(new o.V(v,t.id,`duplicate light type "${t.type}", previously defined at line ${O.id.__line__}`))}const C=`properties_light_${t.type}`;if(!(C in m))return s=s.concat([new o.V("light-3d",t,`Invalid light type ${t.type}`)]),s;const P=m[C];for(const D in t)if(D==="properties"){const z=t[D],O=o.K(z);if(O!=="object")return s=s.concat([new o.V("properties",z,`object expected, ${O} found`)]),s;for(const V in z)s=s.concat(P[V]?oi({key:V,value:z[V],valueSpec:P[V],style:b,styleSpec:m}):[new o.J(u.key,z[V],`unknown property "${V}"`)])}else{const z=D.match(/^(.*)-transition$/),O=D.match(/^(.*)-use-theme$/);s=s.concat(O&&g[O[1]]?oi({key:D,value:t[D],valueSpec:{type:"string"},style:b,styleSpec:m}):z&&g[z[1]]&&g[z[1]].transition?oi({key:D,value:t[D],valueSpec:m.transition,style:b,styleSpec:m}):g[D]?oi({key:D,value:t[D],valueSpec:g[D],style:b,styleSpec:m}):[new o.J(D,t[D],`unknown property "${D}"`)])}return s}function fs(u){const t=u.value,s=u.key,h=u.style,m=u.styleSpec,g=m.terrain;let v=[];const b=o.K(t);if(t===void 0||b==="null")return v;if(b!=="object")return v=v.concat([new o.V("terrain",t,`object expected, ${b} found`)]),v;for(const S in t){const C=S.match(/^(.*)-transition$/),P=S.match(/^(.*)-use-theme$/);v=v.concat(P&&g[P[1]]?oi({key:S,value:t[S],valueSpec:{type:"string"},style:h,styleSpec:m}):C&&g[C[1]]&&g[C[1]].transition?oi({key:S,value:t[S],valueSpec:m.transition,style:h,styleSpec:m}):g[S]?oi({key:S,value:t[S],valueSpec:g[S],style:h,styleSpec:m}):[new o.J(S,t[S],`unknown property "${S}"`)])}if(t.source){const S=h.sources&&h.sources[t.source],C=S&&o.M(S.type);S?C!=="raster-dem"&&v.push(new o.V(s,t.source,`terrain cannot be used with a source of type ${String(C)}, it only be used with a "raster-dem" source type`)):v.push(new o.V(s,t.source,`source "${t.source}" not found`))}else v.push(new o.V(s,t,'terrain is missing required property "source"'));return v}function eo(u){const t=u.value,s=u.style,h=u.styleSpec,m=h.fog;let g=[];const v=o.K(t);if(t===void 0)return g;if(v!=="object")return g=g.concat([new o.V("fog",t,`object expected, ${v} found`)]),g;for(const b in t){const S=b.match(/^(.*)-transition$/),C=b.match(/^(.*)-use-theme$/);g=g.concat(C&&m[C[1]]?oi({key:b,value:t[b],valueSpec:{type:"string"},style:s,styleSpec:h}):S&&m[S[1]]&&m[S[1]].transition?oi({key:b,value:t[b],valueSpec:h.transition,style:s,styleSpec:h}):m[b]?oi({key:b,value:t[b],valueSpec:m[b],style:s,styleSpec:h}):[new o.J(b,t[b],`unknown property "${b}"`)])}return g}const hl={"*":()=>[],array:Fo,boolean:function(u){const t=u.value,s=u.key,h=o.K(t);return h!=="boolean"?[new o.V(s,t,`boolean expected, ${h} found`)]:[]},number:Zo,color:function(u){const t=u.key,s=u.value,h=o.K(s);return h!=="string"?[new o.V(t,s,`color expected, ${h} found`)]:o.a0.parseCSSColor(s)===null?[new o.V(t,s,`color expected, "${s}" found`)]:[]},enum:hs,filter:Xo,function:Bn,layer:ia,object:ir,source:qr,model:o.a4,light:ds,"light-3d":Ko,terrain:fs,fog:eo,string:Hr,formatted:function(u){return Hr(u).length===0?[]:Or(u)},resolvedImage:function(u){return Hr(u).length===0?[]:Or(u)},projection:function(u){const t=u.value,s=u.styleSpec,h=s.projection,m=u.style;let g=[];const v=o.K(t);if(v==="object")for(const b in t)g=g.concat(oi({key:b,value:t[b],valueSpec:h[b],style:m,styleSpec:s}));else v!=="string"&&(g=g.concat([new o.V("projection",t,`object or string expected, ${v} found`)]));return g},import:function(u){const{value:t,styleSpec:s}=u,{data:h,...m}=t;Object.defineProperty(m,"__line__",{value:t.__line__,enumerable:!1});let g=ir(o.L({},u,{value:m,valueSpec:s.import}));return o.M(m.id)===""&&g.push(new o.V(`${u.key}.id`,m,"import id can't be an empty string")),h&&(g=g.concat(Ln(h,s,{key:`${u.key}.data`}))),g},iconset:function(u){const t=u.value,s=u.key,h=u.styleSpec,m=u.style;if(!t.type)return[new o.V(s,t,'"type" is required')];const g=o.M(t.type);let v=[];if(v=v.concat(ir({key:s,value:t,valueSpec:h[`iconset_${g}`],style:m,styleSpec:h})),g==="source"&&t.source){const b=m.sources&&m.sources[t.source],S=b&&o.M(b.type);b?S!=="raster-array"&&v.push(new o.V(s,t.source,`iconset cannot be used with a source of type ${String(S)}, it only be used with a "raster-array" source type`)):v.push(new o.V(s,t.source,`source "${t.source}" not found`))}return v}};function oi(u,t=!1){const s=u.value,h=u.valueSpec,m=u.styleSpec;if(h.expression&&o.a2(o.M(s)))return Bn(u);if(h.expression&&o.S(o.U(s)))return Or(u);if(h.type&&hl[h.type]){const g=hl[h.type](u);return t===!0&&g.length>0&&o.K(u.value)==="array"?Or(u):g}return ir(o.L({},u,{valueSpec:h.type?m[h.type]:h}))}function Sn(u){const t=u.value,s=u.key,h=Hr(u);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new o.V(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new o.V(s,t,'"glyphs" url must include a "{range}" token'))),h}function Ln(u,t=o.a5,s={}){return oi({key:s.key||"",value:u,valueSpec:t.$root,styleSpec:t,style:u,objectElementValidators:{glyphs:Sn,"*":()=>[]}})}function ur(u,t=o.a5){return Ce(Ln(u,t))}const to=u=>Ce(qr(u)),na=u=>Ce(ds(u)),dl=u=>Ce(Ko(u)),gt=u=>Ce(fs(u)),ra=u=>Ce(eo(u)),Kh=u=>Ce(function(t){const s=t.value,h=t.style,m=t.styleSpec,g=m.snow;let v=[];const b=o.K(s);if(s===void 0)return v;if(b!=="object")return v=v.concat([new o.V("snow",s,`object expected, ${b} found`)]),v;for(const S in s){const C=S.match(/^(.*)-transition$/);v=v.concat(C&&g[C[1]]&&g[C[1]].transition?oi({key:S,value:s[S],valueSpec:m.transition,style:h,styleSpec:m}):g[S]?oi({key:S,value:s[S],valueSpec:g[S],style:h,styleSpec:m}):[new o.J(S,s[S],`unknown property "${S}"`)])}return v}(u)),We=u=>Ce(function(t){const s=t.value,h=t.style,m=t.styleSpec,g=m.rain;let v=[];const b=o.K(s);if(s===void 0)return v;if(b!=="object")return v=v.concat([new o.V("rain",s,`object expected, ${b} found`)]),v;for(const S in s){const C=S.match(/^(.*)-transition$/);v=v.concat(C&&g[C[1]]&&g[C[1]].transition?oi({key:S,value:s[S],valueSpec:m.transition,style:h,styleSpec:m}):g[S]?oi({key:S,value:s[S],valueSpec:g[S],style:h,styleSpec:m}):[new o.J(S,s[S],`unknown property "${S}"`)])}return v}(u)),G=u=>Ce(ia(u)),X=u=>Ce(Xo(u)),ue=u=>Ce(ta(u)),Te=u=>Ce(wo(u)),ve=u=>Ce(o.a4(u));function Ce(u){return u.slice().sort((t,s)=>t.line&&s.line?t.line-s.line:0)}function Me(u,t){let s=!1;if(t&&t.length)for(const h of t)h instanceof o.J?o.w(h.message):(u.fire(new o.z(new Error(h.message))),s=!0);return s}let Re;class Ve extends o.E{constructor(t,s="flat"){super(),this._transitionable=new o.a6(Re||(Re=new o.a7({anchor:new o.a8(o.a5.light.anchor),position:new o.a9(o.a5.light.position),color:new o.a8(o.a5.light.color),intensity:new o.a8(o.a5.light.intensity)}))),this.setLight(t,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s,h={}){this._validate(na,t,h)||(this._transitionable.setTransitionOrValue(t),this.id=s)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&Me(this,t.call(ur,o.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let Ye=class extends o.E{constructor(u,t,s,h){super(),this.scope=s,this._transitionable=new o.a6(new o.a7({source:new o.a8(o.a5.terrain.source),exaggeration:new o.a8(o.a5.terrain.exaggeration)}),s,h),this._transitionable.setTransitionOrValue(u,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(u,t){this._transitionable.setTransitionOrValue(u,t)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new o.aa(u)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const u=this._transitionable._values.exaggeration;if(!u)return null;const t=u.value.expression;if(!t)return null;let s=-1,h=-1,m=1;for(const g of t.zoomStops)m=t.evaluate(new o.aa(g)),m>.01?(s=g,h=-1):h=g;return m<.01&&s>0&&h>s?[s,h]:null}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof o.ab}};const Ne=45,yt=65,Et=.05;function Ot(u,t,s,h){const m=o.af(Ne,yt,s),[g,v]=li(u,h);let b=1-Math.min(1,Math.exp((t-g)/(v-g)*-6));return b*=b*b,b=Math.min(1,1.00747*b),b*m*u.alpha}function li(u,t){const s=.5/Math.tan(.5*t);return[u.range[0]+s,u.range[1]+s]}function fi(u,t,s,h,m){const g=o.ad([],[t,s,h],m.mercatorFogMatrix);return Ot(u,o.ae(g),m.pitch,m._fov)}function xi(u,t,s,h,m,g,v){const b=[[s,h,0],[m,h,0],[m,g,0],[s,g,0]];let S=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(const P of b){const D=o.ad([],P,t),z=o.ae(D);S=Math.min(S,z),C=Math.max(C,z)}return[Ot(u,S,v.pitch,v._fov),Ot(u,C,v.pitch,v._fov)]}class Ii extends o.E{constructor(t,s,h,m){super();const g=new o.a7({range:new o.a8(o.a5.fog.range),color:new o.a8(o.a5.fog.color),"color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.a8(o.a5.fog["high-color"]),"high-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.a8(o.a5.fog["space-color"]),"space-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.a8(o.a5.fog["horizon-blend"]),"star-intensity":new o.a8(o.a5.fog["star-intensity"]),"vertical-range":new o.a8(o.a5.fog["vertical-range"])});this._transitionable=new o.a6(g,h,new Map(m)),this.set(t,m),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new o.ag(g),this.scope=h}get state(){const t=this._transform,s=t.projection.name==="globe",h=o.ah(t.zoom),m=this.properties.get("range"),g=[.5,3];return{range:s?[o.ai(g[0],m[0],h),o.ai(g[1],m[1],h)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s,h={}){if(this._validate(ra,t,h))return;const m=o.l({},t);for(const g of Object.keys(o.a5.fog))m[g]===void 0&&(m[g]=o.a5.fog[g].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.af(Ne,yt,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?function(h,m,g){const v=o.ac.fromLngLat(m),b=g.elevation?g.elevation.getAtPointOrZero(v):0;return fi(h,v.x,v.y,b,g)}(this.state,t,s):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(t.toUnwrapped());return xi(this.state,s,0,0,o.aj,o.aj,this._transform)}getOpacityForBounds(t,s,h,m,g){return this._transform.projection.supportsFog?xi(this.state,t,s,h,m,g,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?li(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const h of s){const m=t.points[h];let g;if(m[2]>=0)g=m;else{const v=t.points[h-4];g=o.ak(v,m,v[2]/(v[2]-m[2]))}if(fi(this.state,g[0],g[1],0,this._transform)>=Et)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&Me(this,t.call(ur,o.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let Nn,Ci,ln,Ui,cn=class extends o.E{constructor(u,t,s,h){super();const m=Nn||(Nn=new o.a7({density:new o.a8(o.a5.snow.density),intensity:new o.a8(o.a5.snow.intensity),color:new o.a8(o.a5.snow.color),opacity:new o.a8(o.a5.snow.opacity),vignette:new o.a8(o.a5.snow.vignette),"vignette-color":new o.a8(o.a5.snow["vignette-color"]),"center-thinning":new o.a8(o.a5.snow["center-thinning"]),direction:new o.a8(o.a5.snow.direction),"flake-size":new o.a8(o.a5.snow["flake-size"])}));this._transitionable=new o.a6(m,s,new Map(h)),this.set(u,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(m),this.scope=s}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),h=o.al(s[0]),m=-Math.max(o.al(s[1]),.01),g=[Math.cos(h)*Math.cos(m),Math.sin(h)*Math.cos(m),Math.sin(m)],v=this.properties.get("vignette"),b=this.properties.get("vignette-color");return b.a=v,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(t.r,t.g,t.b,t.a*u),direction:g,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(u,t,s={}){if(this._validate(Kh,u,s))return;const h=o.l({},u);for(const m of Object.keys(o.a5.snow))h[m]===void 0&&(h[m]=o.a5.snow[m].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,s){return(!s||s.validate!==!1)&&Me(this,u.call(ur,o.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}},pn=class extends o.E{constructor(u,t,s,h){super();const m=Ci||(Ci=new o.a7({density:new o.a8(o.a5.rain.density),intensity:new o.a8(o.a5.rain.intensity),color:new o.a8(o.a5.rain.color),opacity:new o.a8(o.a5.rain.opacity),vignette:new o.a8(o.a5.rain.vignette),"vignette-color":new o.a8(o.a5.rain["vignette-color"]),"center-thinning":new o.a8(o.a5.rain["center-thinning"]),direction:new o.a8(o.a5.rain.direction),"droplet-size":new o.a8(o.a5.rain["droplet-size"]),"distortion-strength":new o.a8(o.a5.rain["distortion-strength"])}));this._transitionable=new o.a6(m,s,new Map(h)),this.set(u,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(m),this.scope=s}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),h=o.al(s[0]),m=-Math.max(o.al(s[1]),.01),g=[Math.cos(h)*Math.cos(m),Math.sin(h)*Math.cos(m),Math.sin(m)],v=this.properties.get("vignette-color");return v.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(t.r,t.g,t.b,t.a*u),direction:g,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:v}}get(){return this._transitionable.serialize()}set(u,t,s={}){if(this._validate(We,u,s))return;const h=o.l({},u);for(const m of Object.keys(o.a5.rain))h[m]===void 0&&(h[m]=o.a5.rain[m].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,s){return(!s||s.validate!==!1)&&Me(this,u.call(ur,o.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}};class Zn extends o.E{constructor(t,s,h,m){super(),this.scope=h,this._options=t,this.properties=new o.ag(s),this._transitionable=new o.a6(s,h,new Map(m)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,s){this._options=t,this._transitionable.setTransitionOrValue(t.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class or{constructor(t,s,h,m){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(t,s){let h,m;if(t instanceof o.P||typeof t[0]=="number"){const g=o.P.convert(t);h=[g],m=s.isPointAboveHorizon(g)}else{const g=o.P.convert(t[0]),v=o.P.convert(t[1]),b=g.add(v)._div(2);h=[g,v],m=o.ao(g,v).every(S=>s.isPointAboveHorizon(S))&&s.isPointAboveHorizon(b)}return new or(h,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return o.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],m=o.ao(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),o.ap(m,t)}bufferedCameraGeometryGlobe(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],m=o.ao(s,h,t),g=this.cameraPoint.clone();switch(3*((g.y>s.y)+(g.y>h.y))+((g.x>s.x)+(g.x>h.x))){case 0:m[0]=g,m[4]=g.clone();break;case 1:m.splice(1,0,g);break;case 2:m[1]=g;break;case 3:m.splice(4,0,g);break;case 5:m.splice(2,0,g);break;case 6:m[3]=g;break;case 7:m.splice(3,0,g);break;case 8:m[2]=g}return m}containsTile(t,s,h,m=0){const g=t.queryPadding/s._pixelsPerMercatorPixel+1,v=h?this._bufferedCameraMercator(g,s):this._bufferedScreenMercator(g,s);let b=t.tileID.wrap+(v.unwrapped?m:0);const S=v.polygon.map(H=>o.aq(t.tileTransform,H,b));if(!o.ar(S,0,0,o.aj,o.aj))return;b=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const C=this.screenGeometryMercator.polygon.map(H=>o.as(t.tileTransform,H,b)),P=C.map(H=>new o.P(H[0],H[1])),D=s.getFreeCameraOptions().position||new o.ac(0,0,0),z=o.as(t.tileTransform,D,b),O=C.map(H=>{const U=o.at(H,H,z);return o.au(U,U),new o.av(z,U)}),V=o.aw(t,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:O,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(N=o.ax(S),N.min.x=o.aD(N.min.x,0,o.aj),N.min.y=o.aD(N.min.y,0,o.aj),N.max.x=o.aD(N.max.x,0,o.aj),N.max.y=o.aD(N.max.y,0,o.aj),N),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:V};var N}_bufferedScreenMercator(t,s){const h=oa(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map(g=>s.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[h]=m,m}}_bufferedCameraMercator(t,s){const h=oa(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map(g=>s.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[h]=m,m}}_projectAndResample(t,s){const h=function(g,v){const b=o.az([],v.pixelMatrix,v.globeMatrix),S=[0,-o.aE,0,1],C=[0,o.aE,0,1],P=[0,0,0,1];o.aA(S,S,b),o.aA(C,C,b),o.aA(P,P,b);const D=new o.P(S[0]/S[3],S[1]/S[3]),z=new o.P(C[0]/C[3],C[1]/C[3]),O=o.aB(g,D)&&S[3]<P[3],V=o.aB(g,z)&&C[3]<P[3];if(!O&&!V)return null;const N=function(fe,le,ye){for(let be=1;be<fe.length;be++){const Fe=zr(le.pointCoordinate3D(fe[be-1]).x),Le=zr(le.pointCoordinate3D(fe[be]).x);if(ye<0){if(Fe<Le)return{idx:be,t:-Fe/(Le-1-Fe)}}else if(Le<Fe)return{idx:be,t:(1-Fe)/(Le+1-Fe)}}return null}(g,v,O?-1:1);if(!N)return null;const{idx:H,t:U}=N;let Q=H>1?yr(g.slice(0,H),v):[],ne=H<g.length?yr(g.slice(H),v):[];Q=Q.map(fe=>new o.P(zr(fe.x),fe.y)),ne=ne.map(fe=>new o.P(zr(fe.x),fe.y));const ae=[...Q];ae.length===0&&ae.push(ne[ne.length-1]);const ge=o.ai(ae[ae.length-1].y,(ne.length===0?Q[0]:ne[0]).y,U);let de;return de=O?[new o.P(0,ge),new o.P(0,0),new o.P(1,0),new o.P(1,ge)]:[new o.P(1,ge),new o.P(1,1),new o.P(0,1),new o.P(0,ge)],ae.push(...de),ne.length===0?ae.push(Q[0]):ae.push(...ne),{polygon:ae.map(fe=>new o.ac(fe.x,fe.y)),unwrapped:!1}}(t,s);if(h)return h;const m=function(g,v){let b=!1,S=-1/0,C=0;for(let D=0;D<g.length-1;D++)g[D].x>S&&(S=g[D].x,C=D);for(let D=0;D<g.length-1;D++){const z=(C+D)%(g.length-1),O=g[z],V=g[z+1];Math.abs(O.x-V.x)>.5&&(O.x<V.x?(O.x+=1,z===0&&(g[g.length-1].x+=1)):(V.x+=1,z+1===g.length-1&&(g[0].x+=1)),b=!0)}const P=o.ay(v.center.lng);return b&&P<Math.abs(P-1)&&g.forEach(D=>{D.x-=1}),{polygon:g,unwrapped:b}}(yr(t,s).map(g=>new o.P(zr(g.x),g.y)),s);return{polygon:m.polygon.map(g=>new o.ac(g.x,g.y)),unwrapped:m.unwrapped}}}function yr(u,t){return o.aC(u,s=>{const h=t.pointCoordinate3D(s);s.x=h.x,s.y=h.y},1/256)}function zr(u){return u<0?1+u%1:u%1}function oa(u){return 100*u|0}function Wr(u,t,s,h,m){const g=function(b,S){if(b)return m(b);if(S){if(u.url&&S.tiles&&u.tiles&&delete u.tiles,S.variants){if(!Array.isArray(S.variants))return m(new Error("variants must be an array"));for(const P of S.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return m(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return m(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){S=o.l(S,P);break}}}const C=o.aF(o.l({},S,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);C.tiles=t.canonicalizeTileset(C,u.url),m(null,C)}},v=function(b,S,C){if(!b)return null;if(!S&&!C)return b;C=C||b.worldview_default;const P=Object.values(b.language||{});if(P.length===0)return null;const D=Object.values(b.worldview||{});if(D.length===0)return null;const z=P.every(V=>V===S),O=D.every(V=>V===C);return z&&O?b:S in(b.language_options||{})||C in(b.worldview_options||{})?null:b.language_options&&b.worldview_options?b:null}(u.data,s,h);return v?o.q.frame(()=>g(null,v)):u.url?o.n(t.transformRequest(t.normalizeSourceURL(u.url,null,s,h),o.R.Source),g):o.q.frame(()=>{const{data:b,...S}=u;g(null,S)})}function Zr(u,t){const s=Math.pow(2,t.z),h=Math.floor(o.ay(u.getWest())*s),m=Math.floor(o.aH(u.getNorth())*s),g=Math.ceil(o.ay(u.getEast())*s),v=Math.ceil(o.aH(u.getSouth())*s);return t.x>=h&&t.x<g&&t.y>=m&&t.y<v}class Ar{constructor(t,s,h){this.bounds=t?o.aG.convert(this.validateBounds(t)):null,this.minzoom=s||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const s of t)this.extraBounds.push(o.aG.convert(this.validateBounds(s)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Zr(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const s of this.extraBounds)if(Zr(s,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const s=new Ar(t.bounds,t.minzoom,t.maxzoom);return s.addExtraBounds(t.extra_bounds),s}}class Fr extends o.E{constructor(t,s,h,m){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.l(this,o.aF(s,["url","scheme","tileSize","promoteId"])),this._options=o.l({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new o.aI}load(t){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=Wr(this._options,this.map._requestManager,s,h,(m,g)=>{if(this._tileJSONRequest=null,this._loaded=!0,m)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new o.z(m));else if(g){if(o.l(this,g),this.hasWorldviews=!!g.worldview_options,g.worldview_default&&(this.worldviewDefault=g.worldview_default),g.vector_layers){this.vectorLayers=g.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const v of g.vector_layers)this.vectorLayerIds.push(v.id),g.worldview&&g.worldview[v.source]&&this.localizableLayerIds.add(v.id)}this.tileBounds=Ar.fromTileJSON(g),Li(g.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(m)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}loadTile(t,s){const h=t.tileID.canonical.url(this.tiles,this.scheme),m=this.map._requestManager.normalizeTileURL(h),g=this.map._requestManager.transformRequest(m,o.R.Tile),v=this.map.style?this.map.style.getLut(this.scope):null,b=v?{image:v.image.clone()}:null,S={request:g,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:b,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&o.f(h)&&(S.worldview=this.map.getWorldview()||this.worldviewDefault,S.localizableLayerIds=this.localizableLayerIds),S.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",S,C.bind(this));else if(t.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",S,C.bind(this),void 0,!0);else{const P=o.aJ.call({deduped:this._deduped},S,(D,z)=>{D||!z?C.call(this,D):(S.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},t.actor&&t.actor.send("loadTile",S,C.bind(this),void 0,!0))},!0);t.request={cancel:P}}function C(P,D){return delete t.request,t.aborted?s(null):P&&P.status!==404?s(P):(D&&D.resourceTiming&&(t.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&t.setExpiryData(D),t.loadVectorData(D,this.map.painter),o.aK(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ns extends o.E{constructor(t,s,h,m){super(),this.id=t,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.l({type:"raster"},s),o.l(this,o.aF(s,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Wr(this._options,this.map._requestManager,null,null,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new o.z(s)):h&&(o.l(this,h),h.raster_layers&&(this.rasterLayers=h.raster_layers,this.rasterLayerIds=this.rasterLayers.map(m=>m.id)),this.tileBounds=Ar.fromTileJSON(h),Li(h.tiles),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(s)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const h=o.q.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=o.o(this.map._requestManager.transformRequest(m,o.R.Tile),(g,v,b,S)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):g?(t.state="errored",s(g)):v?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:b,expires:S}),t.setTexture(v,this.map.painter),t.state="loaded",o.aK(this.dispatcher),void s(null)):s(null)))}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s&&s()}unloadTile(t,s){t.texture&&t.texture instanceof o.T?(t.destroy(!0),t.texture&&t.texture instanceof o.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class fl extends Ns{constructor(t,s,h,m){super(t,s,h,m),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=o.l({type:"raster-array"},s)}triggerRepaint(t){const s=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);s&&s.enabled&&h&&s._clearRenderCacheForTile(h.id,t.tileID),this.map.triggerRepaint()}loadTile(t,s){const h=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(h,o.R.Tile),g={request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=m,t.actor||(t.actor=this.dispatcher.getActor());const v=(b,S,C,P)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(b)return b.name==="AbortError"?void 0:(t.state="errored",s(b));if(this.map._refreshExpiredTiles&&S&&t.setExpiryData({cacheControl:C,expires:P}),this.partial)t.state="empty";else{if(!S)return s(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=S}s(null)};t.request=this.partial?t.fetchHeader(void 0,v.bind(this)):t.actor.send("loadTile",g,v.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){const h=t.texture;h&&h instanceof o.T?(t.destroy(!0),this.map.painter.saveTileTexture(h)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,s,h){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(s,h,(m,g)=>{if(m)return t.state="errored",this.fire(new o.z(m)),void this.triggerRepaint(t);g&&(t._isHeaderLoaded=!0,t.setTexture(g,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:g})=>g===t),h=s&&s.fields,m=h&&h.bands&&h.bands;return m?m[0]:0}getTextureDescriptor(t,s,h){if(!t)return;const m=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let g=null;s instanceof o.aN?g=s.paint.get("raster-array-band"):s instanceof o.aO&&(g=s.paint.get("raster-particle-array-band"));const v=g||this.getInitialBand(m);if(v!=null)if(t.textureDescriptor){if(!t.updateNeeded(m,v)||h)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,m,v)}getImages(t,s){const h=new Map;for(const m of t)for(const g of s){const[v,b]=g.split("/"),S=m.getLayer(v);if(!S||!S.hasBand(b)||!S.hasDataForBand(b))continue;const{bytes:C,tileSize:P,buffer:D}=S.getBandView(b),z=P+2*D,O={data:new o.r({width:z,height:z},C),pixelRatio:2,sdf:!1,usvg:!1,version:0};h.set(g,O)}return h}}const Cu={vector:Fr,raster:Ns,"raster-dem":class extends Ns{constructor(u,t,s,h){super(u,t,s,h),this.type="raster-dem",this.maxzoom=22,this._options=o.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(m,g){m&&(u.state="errored",t(m)),g&&(u.dem=g,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=o.o(this.map._requestManager.transformRequest(s,o.R.Tile),(function(m,g,v,b){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(m)u.state="errored",t(m);else if(g){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:v,expires:b});const S=ImageBitmap&&g instanceof ImageBitmap&&o.t(),C=1-(g.width-o.aL(g.width))/2;C<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const P=S?g:o.q.getImageData(g,C),D={uid:u.uid,tileID:u.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:P,encoding:this.encoding,padding:C};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadTile",D,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const t=u.canonical,s=Math.pow(2,t.z),h=(t.x-1+s)%s,m=t.x===0?u.wrap-1:u.wrap,g=(t.x+1+s)%s,v=t.x+1===s?u.wrap+1:u.wrap,b={};return b[new o.aM(u.overscaledZ,m,t.z,h,t.y).key]={backfilled:!1},b[new o.aM(u.overscaledZ,v,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(b[new o.aM(u.overscaledZ,m,t.z,h,t.y-1).key]={backfilled:!1},b[new o.aM(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},b[new o.aM(u.overscaledZ,v,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<s&&(b[new o.aM(u.overscaledZ,m,t.z,h,t.y+1).key]={backfilled:!1},b[new o.aM(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},b[new o.aM(u.overscaledZ,v,t.z,g,t.y+1).key]={backfilled:!1}),b}},"raster-array":fl,geojson:class extends o.E{constructor(u,t,s,h){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=t.data,this._options=o.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=o.aj/this.tileSize;this.workerOptions=o.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:o.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:o.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){if(!this._options.dynamic)return this.fire(new o.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection"))return this.fire(new o.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const s of this._data.features)t.set(s.id,s);for(const s of u.features)t.set(s.id,s);this._data.features=[...t.values()]}else this._data=u;return this._updateWorkerData(!0),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterLeaves(u,t,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:t,offset:s},h),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=o.l({append:u},this.workerOptions);t.scope=this.scope;const s=this._data;typeof s=="string"?(t.request=this.map._requestManager.transformRequest(o.q.resolveURL(s),o.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(h,m)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new o.z(h));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(g.resourceTiming=m.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new o.A("data",g)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const u=o.C(this.id,this.scope);this.map.style.clearSource(u),this._updateWorkerData()}loadTile(u,t){const s=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const h=this.map.style?this.map.style.getLut(this.scope):null,m=h?{image:h.image.clone()}:null,g=this._partialReload,v={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:u.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:g};u.request=this.actor.send(s,v,(b,S)=>g&&!S?(u.state="loaded",t(null)):(delete u.request,u.destroy(),u.aborted?t(null):b?t(b):(u.loadVectorData(S,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,t){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aP{constructor(u,t,s,h){super(u,t,s,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,o.R.Source).url);o.aQ(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new o.z(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new o.z(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(u,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aP,model:class extends o.E{constructor(u,t,s,h){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const u=[];for(const t in this._options.models){const s=this._options.models[t],h=o.aS(this.map._requestManager.transformRequest(s.uri,o.R.Model).url).then(m=>{if(!m)return;const g=o.aT(m),v=new o.aU(t,s.position,s.orientation,g);v.computeBoundsAndApplyParent(),this.models.push(v)}).catch(m=>{this.fire(new o.z(new Error(`Could not load model ${t} from ${s.uri}: ${m.message}`)))});u.push(h)}Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new o.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,t){}serialize(){return this._options}},"batched-model":class extends o.E{constructor(u,t,s,h){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(u){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=Wr(this._options,this.map._requestManager,t,s,(h,m)=>{this._tileJSONRequest=null,this._loaded=!0,h?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new o.z(h))):m&&(o.l(this,m),m.bounds&&(this.tileBounds=new Ar(m.bounds,this.minzoom,this.maxzoom)),Li(m.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),u&&u(h)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,t){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,o.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.q.devicePixelRatio,promoteId:this.promoteId};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=t;else{if(u.buckets){const g=Object.values(u.buckets);for(const v of g)v.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",h,m.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",h,m.bind(this),void 0,!0);function m(g,v){return u.aborted?t(null):g&&g.status!==404?t(g):(this.map._refreshExpiredTiles&&v&&u.setExpiryData(v),u.loadModelData(v,this.map.painter),u.state="loaded",void t(null))}}serialize(){return o.l({},this._options)}},canvas:class extends o.aP{constructor(u,t,s,h){super(u,t,s,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(g=>typeof g!="number"))||this.fire(new o.z(new o.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.z(new o.V(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new o.z(new o.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new o.z(new o.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.z(new o.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof o.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends o.E{constructor(u,t,s,h){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ar(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),o.l(this,o.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:t,y:s,z:h}=u.canonical;return this._implementation.hasTile({x:t,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,t){const{x:s,y:h,z:m}=u.tileID.canonical,g=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:s,y:h,z:m},{signal:g.signal})).then((function(v){return delete u.request,u.aborted?(u.state="unloaded",t(null)):v===void 0?(u.state="errored",t(null)):v===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null)):function(b){return b instanceof ImageData||b instanceof HTMLCanvasElement||b instanceof ImageBitmap||b instanceof HTMLImageElement}(v)?(this.loadTileData(u,v),u.state="loaded",void t(null)):(u.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(v=>{v.name!=="AbortError"&&(u.state="errored",t(v))}),u.request.cancel=()=>g.abort()}loadTileData(u,t){u.setTexture(t,this.map.painter)}unloadTile(u,t){if(u.texture&&u.texture instanceof o.T?(u.destroy(!0),u.texture&&u.texture instanceof o.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:s,y:h,z:m}=u.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:m})}t&&t()}abortTile(u,t){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=o.C(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}}},ic=function(u,t,s,h){const m=new Cu[t.type](u,t,s,h);if(m.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${m.id}`);return o.aV(["load","abort","unload","serialize","prepare"],m),m};function Qh(u,t,s=""){return`${s}:${t.id||""}:${t.layer.id}:${function(h){if("layerId"in h)return`layer:${h.layerId}`;{const{featuresetId:m,importId:g}=h;return`featureset:${m}${g?`:import:${g}`:""}`}}(u.target)}`}function Mu(u,t,s,h=""){if(u.uniqueFeatureID){const m=Qh(u,t,h);if(s.has(m))return!0;s.add(m)}return!1}function pl(u,t,s,h,m=!1){const g=t.sourceCache.transform,v=t.sourceCache.tilesIn(u,t.has3DLayers,m);v.sort(ps);const b=[];for(const S of v){const C=S.tile.queryRenderedFeatures(t,S,s,h,g,m);Object.keys(C).length&&b.push({wrappedTileID:S.tile.tileID.wrapped().key,queryResults:C})}return b.length===0?{}:function(S){const C={},P={};for(const D of S){const z=D.queryResults,O=D.wrappedTileID,V=P[O]=P[O]||{};for(const N in z){const H=z[N],U=V[N]=V[N]||{},Q=C[N]=C[N]||[];for(const ne of H)U[ne.featureIndex]||(U[ne.featureIndex]=!0,Q.push(ne))}}return C}(b)}function Pu(u,t,s,h,m){const g={},v=h.queryRenderedSymbols(u),b=[];for(const S of Object.keys(v).map(Number))b.push(m[S]);b.sort(ps);for(const S of b){const C=S.featureIndex.lookupSymbolFeatures(v[S.bucketInstanceId],S.bucketIndex,S.sourceLayerIndex,t,s);for(const P in C){const D=g[P]=g[P]||[],z=C[P];z.sort((O,V)=>{const N=S.featureSortOrder;if(N){const H=N.indexOf(O.featureIndex);return N.indexOf(V.featureIndex)-H}return V.featureIndex-O.featureIndex});for(const O of z)D.push(O)}}return g}function cp(u,t){const s=u.getRenderableIds().map(g=>u.getTileByID(g)),h=[],m={};for(let g=0;g<s.length;g++){const v=s[g],b=v.tileID.canonical.key;m[b]||(m[b]=!0,v.querySourceFeatures(h,t))}return h}function ps(u,t){const s=u.tileID,h=t.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function up(u,t){const s={};if(!t)return s;for(const h of u){const m=h.layerIds.map(g=>t.getLayer(g)).filter(Boolean);if(m.length!==0){h.layers=m,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(g=>m.filter(v=>v.id===g)[0]));for(const g of m)s[g.fqid]=h}}return s}const To=32,ms=33,sa=new Uint16Array(8184);for(let u=0;u<2046;u++){let t=u+2,s=0,h=0,m=0,g=0,v=0,b=0;for(1&t?m=g=v=To:s=h=b=To;(t>>=1)>1;){const C=s+m>>1,P=h+g>>1;1&t?(m=s,g=h,s=v,h=b):(s=m,h=g,m=v,g=b),v=C,b=P}const S=4*u;sa[S+0]=s,sa[S+1]=h,sa[S+2]=m,sa[S+3]=g}const gs=new Uint16Array(2178),aa=new Uint8Array(1089),Qo=new Uint16Array(1089);function Ru(u){return u===0?-.03125:u===32?.03125:0}const hp={type:2,extent:o.aj,loadGeometry:()=>[[new o.P(0,0),new o.P(o.aj+1,0),new o.P(o.aj+1,o.aj+1),new o.P(0,o.aj+1),new o.P(0,0)]]};class la{constructor(t,s,h,m,g){this.tileID=t,this.uid=o.a$(),this.uses=0,this.tileSize=s,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(t){const s=t+this.timeAdded;s<o.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,h){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=up(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const g=this.buckets[m];if(g instanceof o.b1){if(this.hasSymbolBuckets=!0,!h)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const g=this.buckets[m];if(g instanceof o.b1&&g.hasRTLText){this.hasRTLText=!0,o.b2();break}}this.queryPadding=0;for(const m in this.buckets){const g=this.buckets[m],v=s.style.getOwnLayer(m);if(!v)continue;const b=v.queryRadius(g);this.queryPadding=Math.max(this.queryPadding,b)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new o.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,s,h){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,up(t.buckets,s.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const m in this.buckets){const g=this.buckets[m];g.uploadPending()&&g.upload(t)}const s=t.gl,h=this.imageAtlas;h&&!h.uploaded&&(this.imageAtlasTexture=new o.T(t,h.image,s.RGBA8,{useMipmap:!!h.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(t,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(t,s,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,h),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=s.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==m),this._lastUpdatedBrightness=m))}queryRenderedFeatures(t,s,h,m,g,v){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const b=function(S,C){const P=o.bn([],[.5*S.width,.5*-S.height,1]);return o.bo(P,P,[1,-1,0]),o.az(P,P,S.calculateProjMatrix(C.toUnwrapped())),Float32Array.from(P)}(g,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:s,pixelPosMatrix:b,transform:m,availableImages:h,tileTransform:this.tileTransform})}querySourceFeatures(t,s){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const m=h.loadVTLayers(),g=s?s.sourceLayer:"",v=m._geojsonTileLayer||m[g];if(!v)return;const b=o.b3(s&&s.filter),{z:S,x:C,y:P}=this.tileID.canonical,D={z:S,x:C,y:P};for(let z=0;z<v.length;z++){const O=v.feature(z);if(b.needGeometry){const H=o.b4(O,!0);if(!b.filter(new o.aa(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!b.filter(new o.aa(this.tileID.overscaledZ),O))continue;const V=h.getId(O,g),N=new o.b5(O,S,C,P,V);N.tile=D,t.push(N)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const h=o.b6(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let m=!1;if(this.expirationTime>h)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{const g=this.expirationTime-s;g?this.expirationTime=h+Math.max(g,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,s){if(!this.latestFeatureIndex||!t.style)return;const h=this.latestFeatureIndex.loadVTLayers(),m=t.style.listImages(),g=t.style.getBrightness();for(const v in this.buckets){if(!t.style.hasLayer(v))continue;const b=this.buckets[v],S=b.layers[0],C=S.sourceLayer||"_geojsonTileLayer",P=h[C],D=t.style.getLayerSourceCache(S);let z={};D&&(z=D._state.getState(C,void 0));const O=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},V=Object.keys(z).length>0&&!s;V&&!b.stateDependentLayers.length&&!s||b.update(z,P,m,O,V?b.stateDependentLayers:b.layers,s,g),(b instanceof o.b7||b instanceof o.b8)&&t._terrain&&t._terrain.enabled&&D&&b.uploadPending()&&t._terrain._clearRenderCacheForTile(D.id,this.tileID);const N=t&&t.style&&t.style.getOwnLayer(v);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.q.now()+t}setTexture(t,s){const h=s.context,m=h.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t):(this.texture=new o.T(h,t,m.RGBA8,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,s){const h={};for(const m of s)h[m]=!0;this.dependencies[t]=h}hasDependency(t,s){for(const h of t){const m=this.dependencies[h];if(m){for(const g of s)if(m[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const h=o.b9(hp,this.tileID.canonical,this.tileTransform)[0],m=new o.ba,g=new o.bb;for(let v=0;v<h.length;v++){const{x:b,y:S}=h[v];m.emplaceBack(b,S),g.emplaceBack(v)}g.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(g),this._tileDebugBuffer=t.createVertexBuffer(m,o.bc.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,m.length,g.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const h=o.b9(hp,this.tileID.canonical,this.tileTransform)[0];let m,g;if(this.isRaster){const v=function(b,S){const C=o.aW(b,S),P=Math.pow(2,b.z);for(let H=0;H<ms;H++)for(let U=0;U<ms;U++){const Q=o.aX((b.x+(U+Ru(U))/To)/P),ne=o.aY((b.y+(H+Ru(H))/To)/P),ae=S.project(Q,ne),ge=H*ms+U;gs[2*ge+0]=Math.round((ae.x*C.scale-C.x)*o.aj),gs[2*ge+1]=Math.round((ae.y*C.scale-C.y)*o.aj)}aa.fill(0),Qo.fill(0);for(let H=2045;H>=0;H--){const U=4*H,Q=sa[U+0],ne=sa[U+1],ae=sa[U+2],ge=sa[U+3],de=Q+ae>>1,fe=ne+ge>>1,le=de+fe-ne,ye=fe+Q-de,be=ne*ms+Q,Fe=ge*ms+ae,Le=fe*ms+de,Ke=Math.hypot((gs[2*be+0]+gs[2*Fe+0])/2-gs[2*Le+0],(gs[2*be+1]+gs[2*Fe+1])/2-gs[2*Le+1])>=16;aa[Le]=aa[Le]||(Ke?1:0),H<1022&&(aa[Le]=aa[Le]||aa[(ne+ye>>1)*ms+(Q+le>>1)]||aa[(ge+ye>>1)*ms+(ae+le>>1)])}const D=new o.aZ,z=new o.a_;let O=0;function V(H,U){const Q=U*ms+H;return Qo[Q]===0&&(D.emplaceBack(gs[2*Q+0],gs[2*Q+1],H*o.aj/To,U*o.aj/To),Qo[Q]=++O),Qo[Q]-1}function N(H,U,Q,ne,ae,ge){const de=H+Q>>1,fe=U+ne>>1;if(Math.abs(H-ae)+Math.abs(U-ge)>1&&aa[fe*ms+de])N(ae,ge,H,U,de,fe),N(Q,ne,ae,ge,de,fe);else{const le=V(H,U),ye=V(Q,ne),be=V(ae,ge);z.emplaceBack(le,ye,be)}}return N(0,0,To,To,To,0),N(To,To,0,0,0,To),{vertices:D,indices:z}}(this.tileID.canonical,s);m=v.vertices,g=v.indices}else{m=new o.aZ,g=new o.a_;for(const{x:b,y:S}of h)m.emplaceBack(b,S,0,0);const v=o.be(m.int16.subarray(0,4*m.length),void 0,4);for(let b=0;b<v.length;b+=3)g.emplaceBack(v[b],v[b+1],v[b+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,o.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(g),this._tileBoundsSegments=o.bd.simpleSegment(0,0,m.length,g.length)}_makeGlobeTileDebugBuffers(t,s){const h=s.projection;if(!h||h.name!=="globe"||s.freezeTileCoverage)return;const m=this.tileID.canonical,g=o.bg(m,s),v=o.bh(g),b=o.ah(s.zoom);let S;b>0&&(S=o.bi(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,s,v,S,b),this._makeGlobeTileDebugTextBuffer(t,m,s,v,S,b)}_globePoint(t,s,h,m,g,v,b){let S=o.bj(t,s,h);if(v){const C=1<<h.z,P=o.ay(m.center.lng),D=o.aH(m.center.lat),z=(h.x+.5)/C-P;let O=0;z>.5?O=-1:z<-.5&&(O=1);let V=(t/o.aj+h.x)/C+O,N=(s/o.aj+h.y)/C;V=(V-P)*m._pixelsPerMercatorPixel+P,N=(N-D)*m._pixelsPerMercatorPixel+D;const H=[V*m.worldSize,N*m.worldSize,0];o.ad(H,H,v),S=o.bk(S,H,b)}return o.ad(S,S,g)}_makeGlobeTileDebugBorderBuffer(t,s,h,m,g,v){const b=new o.ba,S=new o.bb,C=new o.bl,P=(z,O,V,N,H)=>{const U=(V-z)/(H-1),Q=(N-O)/(H-1),ne=b.length;for(let ae=0;ae<H;ae++){const ge=z+ae*U,de=O+ae*Q;b.emplaceBack(ge,de);const fe=this._globePoint(ge,de,s,h,m,g,v);C.emplaceBack(fe[0],fe[1],fe[2]),S.emplaceBack(ne+ae)}},D=o.aj;P(0,0,D,0,16),P(D,0,D,D,16),P(D,D,0,D,16),P(0,D,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(S),this._tileDebugBuffer=t.createVertexBuffer(b,o.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(C,o.bm.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,b.length,S.length)}_makeGlobeTileDebugTextBuffer(t,s,h,m,g,v){const b=o.aj/4,S=new o.ba,C=new o.a_,P=new o.bl,D=25;C.reserve(32),S.reserve(D),P.reserve(D);const z=(O,V)=>D*O+V;for(let O=0;O<D;O++){const V=O*b;for(let N=0;N<D;N++){const H=N*b;S.emplaceBack(H,V);const U=this._globePoint(H,V,s,h,m,g,v);P.emplaceBack(U[0],U[1],U[2])}}for(let O=0;O<4;O++)for(let V=0;V<4;V++){const N=z(O,V),H=z(O,V+1),U=z(O+1,V),Q=z(O+1,V+1);C.emplaceBack(N,H,U),C.emplaceBack(U,H,Q)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(C),this._tileDebugTextBuffer=t.createVertexBuffer(S,o.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(P,o.bm.members),this._tileDebugTextSegments=o.bd.simpleSegment(0,0,D,32)}destroy(t=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bp.setPbf(o.bq);class zu extends la{constructor(t,s,h,m,g){super(t,s,h,m,g),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,s){const h=s.context,m=h.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t,{premultiply:!1}):this.texture=new o.T(h,t,m.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,s){const h=this._mrt=new o.bp(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=o.br(m,(g,v,b,S)=>{if(g)s(g);else try{const C=h.getHeaderLength(v);if(C>t)return void(this.request=this.fetchHeader(C,s));h.parseHeader(v),this._isHeaderLoaded=!0;let P=0;for(const D of Object.values(h.layers))P=Math.max(P,D.dataIndex[D.dataIndex.length-1].lastByte);v.byteLength>=P&&(this.entireBuffer=v),s(null,this.entireBuffer||v,b,S)}catch(C){s(C)}}),this.request}fetchBand(t,s,h){const m=this._mrt;if(!this._isHeaderLoaded||!m)return void h(new Error("Tile header is not ready"));const g=this.actor;if(!g)return void h(new Error("Can't fetch tile band without an actor"));let v;const b=(D,z)=>{v.complete(D,z),D?h(D):(this.updateTextureDescriptor(t,s),h(null,this.textureDescriptor&&this.textureDescriptor.img))},S=(D,z)=>{if(D)return h(D);const O=g.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:z,task:v},b,void 0,!0);this._workQueue.push(()=>{O&&O.cancel(),v.cancel()})},C=m.getLayer(t);if(!C)return void h(new Error(`Unknown sourceLayer "${t}"`));if(C.hasDataForBand(s))return this.updateTextureDescriptor(t,s),void h(null,this.textureDescriptor?this.textureDescriptor.img:null);const P=C.getDataRange([s]);if(v=m.createDecodingTask(P),!v||v.tasks.length)if(this.flushQueues(),this.entireBuffer)S(null,this.entireBuffer.slice(P.firstByte,P.lastByte+1));else{const D=Object.assign({},this.requestParams,{headers:{Range:`bytes=${P.firstByte}-${P.lastByte}`}}),z=o.br(D,S);this._fetchQueue.push(()=>{z.cancel(),v.cancel()})}else h(null)}updateNeeded(t,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,s){if(!this._mrt)return;const h=this._mrt.getLayer(t);if(!h||!h.hasBand(s)||!h.hasDataForBand(s))return;const{bytes:m,tileSize:g,buffer:v,offset:b,scale:S}=h.getBandView(s),C=g+2*v,P=new o.r({width:C,height:C},m),D=this.texture;D&&D instanceof o.T&&D.update(P,{premultiply:!1}),this.textureDescriptor={layer:t,band:s,img:P,buffer:v,offset:b,tileSize:g,format:h.pixelFormat,mix:[S,256*S,65536*S,16777216*S]}}}class dp{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,h){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const g={value:s,timeout:void 0};if(h!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},h)),this.data[m].push(g),this.order.push(m),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const h=t.wrapped().key,m=s===void 0?0:this.data[h].indexOf(s),g=this.data[h][m];return this.data[h].splice(m,1),g.timeout&&clearTimeout(g.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(g.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const h in this.data)for(const m of this.data[h])t(m.value)||s.push(m);for(const h of s)this.remove(h.value.tileID,h)}}class Du{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,h){const m=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},o.l(this.stateChanges[t][m],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==m&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const g in this.state[t][m])h[g]||(this.deletedStates[t][m][g]=null)}else for(const g in h)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][g]===null&&delete this.deletedStates[t][m][g]}removeFeatureState(t,s,h){if(this.deletedStates[t]===null)return;const m=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&s!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][h]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(h in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][h]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,s){const h=this.state[t]||{},m=this.stateChanges[t]||{},g=this.deletedStates[t];if(g===null)return{};if(s!==void 0){const b=String(s),S=o.l({},h[b],m[b]);if(g){const C=g[s];if(C===null)return{};for(const P in C)delete S[P]}return S}const v=o.l({},h,m);if(g)for(const b in g)delete v[b];return v}initializeTileState(t,s){t.refreshFeatureState(s)}coalesceChanges(t,s){const h={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const g={};for(const v in this.stateChanges[m])this.state[m][v]||(this.state[m][v]={}),o.l(this.state[m][v],this.stateChanges[m][v]),g[v]=this.state[m][v];h[m]=g}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const g={};if(this.deletedStates[m]===null)for(const v in this.state[m])g[v]={},this.state[m][v]={};else for(const v in this.deletedStates[m]){if(this.deletedStates[m][v]===null)this.state[m][v]={};else if(this.state[m][v])for(const b of Object.keys(this.deletedStates[m][v]))delete this.state[m][v][b];g[v]=this.state[m][v]}h[m]=h[m]||{},o.l(h[m],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const m in t)t[m].refreshFeatureState(s)}}class io extends o.E{constructor(t,s,h){super(),this.id=t,this._onlySymbols=h,s.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new dp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Du,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const h=this._tiles[s];h.upload(t),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Jh).map(t=>t.key)}getRenderableIds(t,s){const h=[];for(const m in this._tiles)this._isIdRenderable(+m,t,s)&&h.push(this._tiles[m]);return t?h.sort((m,g)=>{const v=m.tileID,b=g.tileID,S=new o.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),C=new o.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-b.overscaledZ||C.y-S.y||C.x-S.x}).map(m=>m.tileID.key):h.map(m=>m.tileID).sort(Jh).map(m=>m.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s,h){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())&&(h||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=s),this._loadTile(h,this._tileLoaded.bind(this,h,t,s)))}_tileLoaded(t,s,h,m){if(m)if(t.state="errored",m.status!==404)this._source.fire(new o.z(m,{tile:t}));else{if(this._source.fire(new o.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=o.q.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new o.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let m=0;m<s.length;m++){const g=s[m];if(t.neighboringTiles&&t.neighboringTiles[g]){const v=this.getTileByID(g);h(t,v),h(v,t)}}function h(m,g){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let v=g.tileID.canonical.x-m.tileID.canonical.x;const b=g.tileID.canonical.y-m.tileID.canonical.y,S=Math.pow(2,m.tileID.canonical.z),C=g.tileID.key;v===0&&b===0||Math.abs(b)>1||(Math.abs(v)>1&&(Math.abs(v+S)===1?v+=S:Math.abs(v-S)===1&&(v-=S)),g.dem&&m.dem&&(m.dem.backfillBorder(g.dem,v,b),m.neighboringTiles&&m.neighboringTiles[C]&&(m.neighboringTiles[C].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,h,m){for(const g in this._tiles){let v=this._tiles[g];if(m[g]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>h)continue;let b=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const C=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[C.key],v&&v.hasData()&&(b=C)}let S=b;for(;S.overscaledZ>s;)if(S=S.scaledTo(S.overscaledZ-1),t[S.key]){m[b.key]=b;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=s?h:null}for(let h=t.overscaledZ-1;h>=s;h--){const m=t.scaledTo(h),g=this._getLoadedTile(m);if(g)return g}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const h=Math.ceil(t.width/s)+1,m=Math.ceil(t.height/s)+1,g=Math.floor(h*m*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(b)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const h={};for(const m in this._tiles){const g=this._tiles[m];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),h[g.tileID.key]=g}this._tiles=h;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,s,h,m,g){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let b,S=this._source.maxzoom;const C=this.map&&this.map.painter?this.map.painter._terrain:null;if(C&&C.sourceCache===this&&C.attenuationRange()){const z=C.attenuationRange()[0],O=Math.floor(z)-Math.log2(C.getDemUpscale());S>O&&(S=O)}if(this.used||this.usedForTerrain){if(this._source.tileID)b=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new o.aM(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y));else if(this.tileCoverLift!==0){const z=t.clone();z.tileCoverLift=this.tileCoverLift,b=z.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&t.projection.name==="globe"&&(b.push(new o.aM(1,0,1,0,0)),b.push(new o.aM(1,0,1,1,0)),b.push(new o.aM(1,0,1,0,1)),b.push(new o.aM(1,0,1,1,1)))}else if(b=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:S,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const z=this._source.hasTile.bind(this._source);b=b.filter(O=>z(O))}}else b=[];if(b.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ed(this._source.type)){const z=t.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),O=Math.min(z,this._source.maxzoom);if(v){const V=t.extendTileCover(b,O);for(const N of V)b.push(N)}else if(g){const V=t.extendTileCover(b,O,this.transform._camera.forward());for(const N of V)b.push(N)}else if(this.castsShadows&&m){const V=t.extendTileCover(b,O,m);for(const N of V)this._shadowCasterTiles[N.key]=!0,b.push(N)}}const P=this._updateRetainedTiles(b);if(ed(this._source.type)&&b.length!==0){const z={},O={},V=Object.keys(P);for(const H of V){const U=P[H],Q=this._tiles[H];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=o.q.now())continue;const ne=this.findLoadedParent(U,Math.max(U.overscaledZ-io.maxOverzooming,this._source.minzoom));ne&&(this._addTile(ne.tileID),z[ne.tileID.key]=ne.tileID),O[H]=U}const N=b[b.length-1].overscaledZ;for(const H in this._tiles){const U=this._tiles[H];if(P[H]||!U.hasData())continue;let Q=U.tileID;for(;Q.overscaledZ>N;){Q=Q.scaledTo(Q.overscaledZ-1);const ne=this._tiles[Q.key];if(ne&&ne.hasData()&&O[Q.key]){P[H]=U.tileID;break}}}for(const H in z)P[H]||(this._coveredTiles[H]=!0,P[H]=z[H])}for(const z in P)this._tiles[z].clearFadeHold();const D=o.bs(this._tiles,P);for(const z of D){const O=this._tiles[z];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(+z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const h={},m=t.reduce((C,P)=>Math.min(C,P.overscaledZ),1/0),g=t[0].overscaledZ,v=Math.max(g-io.maxOverzooming,this._source.minzoom),b=Math.max(g+io.maxUnderzooming,this._source.minzoom),S={};for(const C of t){const P=this._addTile(C);s[C.key]=C,P.hasData()||m<this._source.maxzoom&&(S[C.key]=C)}this._retainLoadedChildren(S,m,b,s);for(const C of t){let P=this._tiles[C.key];if(P.hasData())continue;if(C.canonical.z>=this._source.maxzoom){const z=C.children(this._source.maxzoom)[0],O=this.getTile(z);if(O&&O.hasData()){s[z.key]=z;continue}}else{const z=C.children(this._source.maxzoom);if(s[z[0].key]&&s[z[1].key]&&s[z[2].key]&&s[z[3].key])continue}let D=P.wasRequested();for(let z=C.overscaledZ-1;z>=v;--z){const O=C.scaledTo(z);if(h[O.key]||(h[O.key]=!0,P=this.getTile(O),!P&&D&&(P=this._addTile(O)),P&&(s[O.key]=O,D=P.wasRequested(),P.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let h,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){h=this._loadedParentTiles[m.key];break}s.push(m.key);const g=m.scaledTo(m.overscaledZ-1);if(h=this._getLoadedTile(g),h)break;m=g}for(const g of s)this._loadedParentTiles[g]=h}}_addTile(t){let s=this._tiles[t.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const h=!!s;if(!h){const m=this.map?this.map.painter:null,g=this._source.tileSize*t.overscaleFactor();s=this._source.type==="raster-array"?new zu(t,g,this.transform.tileZoom,m,this._isRaster):new la(t,g,this.transform.tileZoom,m,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s.uses++,this._tiles[t.key]=s,h||this._source.fire(new o.A("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=s.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,h){const m=[],g=this.transform;if(!g)return m;const v=g.projection.name==="globe",b=o.ay(g.center.lng);for(const S in this._tiles){const C=this._tiles[S];if(h&&C.clearQueryDebugViz(),C.holdingForFade())continue;let P;if(v){const D=C.tileID.canonical;if(D.z===0){const z=[Math.abs(o.aD(b,...nc(D,-1))-b),Math.abs(o.aD(b,...nc(D,1))-b)];P=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(o.aD(b,...nc(D,-1))-b),Math.abs(o.aD(b,...nc(D,0))-b),Math.abs(o.aD(b,...nc(D,1))-b)];P=[z.indexOf(Math.min(...z))-1]}}else P=[0];for(const D of P){const z=t.containsTile(C,g,s,D);z&&m.push(z)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,s){const h=this.getRenderableIds(t,s).map(g=>this._tiles[g].tileID),m=this.transform.projection.name==="globe";for(const g of h)g.projMatrix=this.transform.calculateProjMatrix(g.toUnwrapped()),g.expandedProjMatrix=m?this.transform.calculateProjMatrix(g.toUnwrapped(),!1,!0):g.projMatrix;return h}sortCoordinatesByDistance(t){const s=t.slice(),h=this.transform._camera.position,m=this.transform._camera.forward(),g={};for(const v of s){const b=1/(1<<v.canonical.z);g[v.key]=((v.canonical.x+.5)*b+v.wrap-h[0])*m[0]+((v.canonical.y+.5)*b-h[1])*m[1]-h[2]*m[2]}return s.sort((v,b)=>g[v.key]-g[b.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(ed(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(t,s,h){this._state.updateState(t=t||"_geojsonTileLayer",s,h)}removeFeatureState(t,s,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,h)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,h){const m=this._tiles[t];m&&m.setDependencies(s,h)}reloadTilesForDependencies(t,s){for(const h in this._tiles)this._tiles[h].hasDependency(t,s)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(t,s))}_preloadTiles(t,s){if(!this._sourceLoaded){const S=()=>{this._sourceLoaded&&(this._source.off("data",S),this._preloadTiles(t,s))};return void this._source.on("data",S)}const h=new Map,m=Array.isArray(t)?t:[t],g=this.map.painter.terrain,v=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const S of m){const C=S.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const P of C)h.set(P.key,P);this.usedForTerrain&&S.updateElevation(!1)}const b=Array.from(h.values());o.bt(b,(S,C)=>{const P=new la(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(P,D=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),C(D,P)})},s)}}function Jh(u,t){const s=Math.abs(2*u.wrap)-+(u.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||h-s||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function ed(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function nc(u,t){const s=1<<u.z;return[u.x/s+t,(u.x+1)/s+t]}io.maxOverzooming=10,io.maxUnderzooming=3;class a_{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,s=!1;for(const h in this.style._mergedLayers){const m=this.style._mergedLayers[h];if(m.type==="fill-extrusion")this.layers.push({layer:m,visible:t,visibilityChanged:s});else if(m.type==="model"){const g=this.style.getLayerSource(m);g&&g.type==="batched-model"&&this.layers.push({layer:m,visible:t,visibilityChanged:s})}}}onNewFrame(t){this.layersGotHidden=!1;for(const s of this.layers){const h=s.layer;let m=!1;h.type==="fill-extrusion"?m=!h.isHidden(t)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="model"&&(m=!h.isHidden(t)&&h.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!m&&s.visible,s.visible=m}}updateZOffset(t,s){this.currentBuildingBuckets=[];for(const m of this.layers){const g=m.layer,v=this.style.getLayerSourceCache(g);let b=1;g.type==="fill-extrusion"&&(b=m.visible?g.paint.get("fill-extrusion-vertical-scale"):0);let S=v?v.getTile(s):null;if(!S&&v&&s.canonical.z>v.getSource().minzoom){let C=s.scaledTo(Math.min(v.getSource().maxzoom,s.overscaledZ-1));for(;C.overscaledZ>=v.getSource().minzoom&&(S=v.getTile(C),!S&&C.overscaledZ!==0);)C=C.scaledTo(C.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:S?S.getBucket(g):null,tileID:S?S.tileID:s,verticalScale:b})}t.hasAnyZOffset=!1;let h=!1;for(let m=0;m<t.symbolInstances.length;m++){const g=t.symbolInstances.get(m),v=g.zOffset,b=this._getHeightAtTileOffset(s,g.tileAnchorX,g.tileAnchorY);g.zOffset=b!==Number.NEGATIVE_INFINITY?b:v,h||v===g.zOffset||(h=!0),t.hasAnyZOffset||g.zOffset===0||(t.hasAnyZOffset=!0)}h&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,s,h,m){let g=s,v=h;if(t.canonical.z!==m.canonical.z){const b=m.canonical,S=1/(1<<t.canonical.z-b.z);g=(s+t.canonical.x*o.aj)*S-b.x*o.aj|0,v=(h+t.canonical.y*o.aj)*S-b.y*o.aj|0}return{tileX:g,tileY:v}}_getHeightAtTileOffset(t,s,h){let m,g;for(let v=0;v<this.layers.length;++v){if(this.layers[v].layer.type!=="fill-extrusion")continue;const{bucket:b,tileID:S,verticalScale:C}=this.currentBuildingBuckets[v];if(!b)continue;const{tileX:P,tileY:D}=this._mapCoordToOverlappingTile(t,s,h,S),z=b.getHeightAtTileCoord(P,D);z&&z.height!==void 0&&(z.hidden?m=z.height:g=Math.max(z.height*C,g||0))}if(g!==void 0)return g;for(let v=0;v<this.layers.length;++v){const b=this.layers[v];if(b.layer.type!=="model"||!b.visible)continue;const{bucket:S,tileID:C}=this.currentBuildingBuckets[v];if(!S)continue;const{tileX:P,tileY:D}=this._mapCoordToOverlappingTile(t,s,h,C),z=S.getHeightAtTileCoord(P,D);if(z&&!z.hidden)return z.height===void 0&&m!==void 0?Math.min(z.maxHeight,m)*z.verticalScale:z.height?z.height*z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function td(u,t){const s={};for(const h in u)h!=="ref"&&(s[h]=u[h]);return o.bu.forEach(h=>{h in t&&(s[h]=t[h])}),s}function id(u){u=u.slice();const t=Object.create(null);for(let s=0;s<u.length;s++)t[u[s].id]=u[s];for(let s=0;s<u.length;s++)"ref"in u[s]&&(u[s]=td(u[s],t[u[s].ref]));return u}const Ni={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function rc(u,t,s){s.push({command:Ni.addSource,args:[u,t[u]]})}function oc(u,t,s){t.push({command:Ni.removeSource,args:[u]}),s[u]=!0}function tx(u,t,s,h){oc(u,s,h),rc(u,t,s)}function l_(u,t,s){let h;for(h in u[s])if(u[s].hasOwnProperty(h)&&h!=="data"&&!o.bv(u[s][h],t[s][h]))return!1;for(h in t[s])if(t[s].hasOwnProperty(h)&&h!=="data"&&!o.bv(u[s][h],t[s][h]))return!1;return!0}function ml(u,t,s,h,m,g){let v;for(v in t=t||{},u=u||{})u.hasOwnProperty(v)&&(o.bv(u[v],t[v])||s.push({command:g,args:[h,v,t[v],m]}));for(v in t)t.hasOwnProperty(v)&&!u.hasOwnProperty(v)&&(o.bv(u[v],t[v])||s.push({command:g,args:[h,v,t[v],m]}))}function za(u){return u.id}function sc(u,t){return u[t.id]=t,u}class c_{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.aD(t,0,1);let s=1,h=this._distances[s];const m=t*this.paddedLength+this.padding;for(;h<m&&s<this._distances.length;)h=this._distances[++s];const g=s-1,v=this._distances[g],b=h-v,S=b>0?(m-v)/b:0;return this.points[g].mult(1-S).add(this.points[s].mult(S))}}class fp{constructor(t,s,h){const m=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(s/h);for(let v=0;v<this.xCellCount*this.yCellCount;v++)m.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,h,m,g){this._forEachCell(s,h,m,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(g)}insertCircle(t,s,h,m){this._forEachCell(s-m,h-m,s+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(h),this.circles.push(m)}_insertBoxCell(t,s,h,m,g,v){this.boxCells[g].push(v)}_insertCircleCell(t,s,h,m,g,v){this.circleCells[g].push(v)}_query(t,s,h,m,g,v){if(h<0||t>this.width||m<0||s>this.height)return!g&&[];const b=[];if(t<=0&&s<=0&&this.width<=h&&this.height<=m){if(g)return!0;for(let S=0;S<this.boxKeys.length;S++)b.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const C=this.circles[3*S],P=this.circles[3*S+1],D=this.circles[3*S+2];b.push({key:this.circleKeys[S],x1:C-D,y1:P-D,x2:C+D,y2:P+D})}return v?b.filter(v):b}return this._forEachCell(t,s,h,m,this._queryCell,b,{hitTest:g,seenUids:{box:{},circle:{}}},v),g?b.length>0:b}_queryCircle(t,s,h,m,g){const v=t-h,b=t+h,S=s-h,C=s+h;if(b<0||v>this.width||C<0||S>this.height)return!m&&[];const P=[];return this._forEachCell(v,S,b,C,this._queryCellCircle,P,{hitTest:m,circle:{x:t,y:s,radius:h},seenUids:{box:{},circle:{}}},g),m?P.length>0:P}query(t,s,h,m,g){return this._query(t,s,h,m,!1,g)}hitTest(t,s,h,m,g){return this._query(t,s,h,m,!0,g)}hitTestCircle(t,s,h,m){return this._queryCircle(t,s,h,!0,m)}_queryCell(t,s,h,m,g,v,b,S){const C=b.seenUids,P=this.boxCells[g];if(P!==null){const z=this.bboxes;for(const O of P)if(!C.box[O]){C.box[O]=!0;const V=4*O;if(t<=z[V+2]&&s<=z[V+3]&&h>=z[V+0]&&m>=z[V+1]&&(!S||S(this.boxKeys[O]))){if(b.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[O],x1:z[V],y1:z[V+1],x2:z[V+2],y2:z[V+3]})}}}const D=this.circleCells[g];if(D!==null){const z=this.circles;for(const O of D)if(!C.circle[O]){C.circle[O]=!0;const V=3*O;if(this._circleAndRectCollide(z[V],z[V+1],z[V+2],t,s,h,m)&&(!S||S(this.circleKeys[O]))){if(b.hitTest)return v.push(!0),!0;{const N=z[V],H=z[V+1],U=z[V+2];v.push({key:this.circleKeys[O],x1:N-U,y1:H-U,x2:N+U,y2:H+U})}}}}}_queryCellCircle(t,s,h,m,g,v,b,S){const C=b.circle,P=b.seenUids,D=this.boxCells[g];if(D!==null){const O=this.bboxes;for(const V of D)if(!P.box[V]){P.box[V]=!0;const N=4*V;if(this._circleAndRectCollide(C.x,C.y,C.radius,O[N+0],O[N+1],O[N+2],O[N+3])&&(!S||S(this.boxKeys[V])))return v.push(!0),!0}}const z=this.circleCells[g];if(z!==null){const O=this.circles;for(const V of z)if(!P.circle[V]){P.circle[V]=!0;const N=3*V;if(this._circlesCollide(O[N],O[N+1],O[N+2],C.x,C.y,C.radius)&&(!S||S(this.circleKeys[V])))return v.push(!0),!0}}}_forEachCell(t,s,h,m,g,v,b,S){const C=this._convertToXCellCoord(t),P=this._convertToYCellCoord(s),D=this._convertToXCellCoord(h),z=this._convertToYCellCoord(m);for(let O=C;O<=D;O++)for(let V=P;V<=z;V++)if(g.call(this,t,s,h,m,this.xCellCount*V+O,v,b,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,h,m,g,v){const b=m-t,S=g-s,C=h+v;return C*C>b*b+S*S}_circleAndRectCollide(t,s,h,m,g,v,b){const S=(v-m)/2,C=Math.abs(t-(m+S));if(C>S+h)return!1;const P=(b-g)/2,D=Math.abs(s-(g+P));if(D>P+h)return!1;if(C<=S||D<=P)return!0;const z=C-S,O=D-P;return z*z+O*O<=h*h}}const gl={unknown:0,flipRequired:1,flipNotRequired:2},Lu=Math.tan(85*Math.PI/180);function ac(u,t,s,h,m,g,v){const b=o.bz();if(s)if(g.name==="globe"){const S=o.bA(m,t);o.az(b,b,S)}else{const S=o.bB([],v);b[0]=S[0],b[1]=S[1],b[4]=S[2],b[5]=S[3],h||o.by(b,b,m.angle)}else o.az(b,m.labelPlaneMatrix,u);return b}function nd(u,t,s,h,m,g,v){const b=ac(u,t,s,h,m,g,v);return g.name==="globe"&&s||(b[2]=b[6]=b[10]=b[14]=0),b}function pp(u,t,s,h,m,g,v){if(s){if(g.name==="globe"){const b=ac(u,t,s,h,m,g,v);return o.bi(b,b),o.az(b,u,b),b}{const b=o.bw(u),S=o.bx([]);return S[0]=v[0],S[1]=v[1],S[4]=v[2],S[5]=v[3],o.az(b,b,S),h||o.by(b,b,-m.angle),b}}return m.glCoordMatrix}function So(u,t,s,h){const m=[u,t,s,1];s?o.aA(m,m,h):u_(m,m,h);const g=m[3];return m[0]/=g,m[1]/=g,m[2]/=g,m}function Da(u,t){return Math.min(.5+u/t*.5,1.5)}function mp(u,t){const s=u[0]/u[3],h=u[1]/u[3];return s>=-t[0]&&s<=t[0]&&h>=-t[1]&&h<=t[1]}function gp(u,t,s,h,m,g,v,b,S,C){const P=s.transform,D=h?u.textSizeData:u.iconSizeData,z=o.bH(D,s.transform.zoom),O=P.projection.name==="globe",V=[256/s.width*2+1,256/s.height*2+1],N=h?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;N.clear();let H=null;O&&(H=h?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const U=u.lineVertexArray,Q=h?u.text.placedSymbolArray:u.icon.placedSymbolArray,ne=s.transform.width/s.transform.height;let ae,ge=!1;for(let de=0;de<Q.length;de++){const fe=Q.get(de),{numGlyphs:le,writingMode:ye}=fe;if(ye!==o.bI.vertical||ge||ae===o.bI.horizontal||(ge=!0),ae=ye,(fe.hidden||ye===o.bI.vertical)&&!ge){Hi(le,N);continue}ge=!1;const be=new o.P(fe.tileAnchorX,fe.tileAnchorY);let{x:Fe,y:Le,z:Ke}=P.projection.projectTilePoint(be.x,be.y,C.canonical);if(S){const[Pt,Nt,Ct]=S(be);Fe+=Pt,Le+=Nt,Ke+=Ct}const Xe=[Fe,Le,Ke,1];if(o.aA(Xe,Xe,t),!mp(Xe,V)){Hi(le,N);continue}const dt=Xe[3],ke=Da(s.transform.getCameraToCenterDistance(P.projection),dt),Be=o.bJ(D,z,fe),ze=v?Be/ke:Be*ke,et=So(Fe,Le,Ke,m);if(et[3]<=0){Hi(le,N);continue}let Ge={};const ot=o.al(u.layers[0].layout.get("text-max-angle")),Qe=Math.cos(ot),st=v?null:S,at=Eo(fe,ze,!1,b,t,m,g,u.glyphOffsetArray,U,N,H,et,be,Ge,ne,st,P.projection,C,v,Qe);ge=at.useVertical,st&&at.needsFlipping&&(Ge={}),(at.notEnoughRoom||ge||at.needsFlipping&&Eo(fe,ze,!0,b,t,m,g,u.glyphOffsetArray,U,N,H,et,be,Ge,ne,st,P.projection,C,v,Qe).notEnoughRoom)&&Hi(le,N)}h?(u.text.dynamicLayoutVertexBuffer.updateData(N),H&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(H)):(u.icon.dynamicLayoutVertexBuffer.updateData(N),H&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(H))}function rd(u,t,s,h,m,g,v,b,S,C,P,D,z,O,V,N,H){const{lineStartIndex:U,glyphStartIndex:Q,segment:ne}=b,ae=Q+b.numGlyphs,ge=U+b.lineLength,de=t.getoffsetX(Q),fe=t.getoffsetX(ae-1),le=ku(u*de,s,h,m,g,v,ne,U,ge,S,C,P,D,z,!0,O,V,N,H);if(!le)return null;const ye=ku(u*fe,s,h,m,g,v,ne,U,ge,S,C,P,D,z,!0,O,V,N,H);return ye?{first:le,last:ye}:null}function _l(u,t,s,h){return u===o.bI.horizontal&&Math.abs(h)>Math.abs(s)?{useVertical:!0}:u===o.bI.vertical?h>0?{needsFlipping:!0}:null:t!==gl.unknown&&function(m,g){return m===0||Math.abs(g/m)>Lu}(s,h)?t===gl.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function Eo(u,t,s,h,m,g,v,b,S,C,P,D,z,O,V,N,H,U,Q,ne){const ae=t/24,ge=u.lineOffsetX*ae,de=u.lineOffsetY*ae,{lineStartIndex:fe,glyphStartIndex:le,numGlyphs:ye,segment:be,writingMode:Fe,flipState:Le}=u,Ke=fe+u.lineLength,Xe=dt=>{if(P){const[et,Ge,ot]=dt.up,Qe=C.length;o.bK(P,Qe+0,et,Ge,ot),o.bK(P,Qe+1,et,Ge,ot),o.bK(P,Qe+2,et,Ge,ot),o.bK(P,Qe+3,et,Ge,ot)}const[ke,Be,ze]=dt.point;o.bL(C,ke,Be,ze,dt.angle)};if(ye>1){const dt=rd(ae,b,ge,de,s,D,z,u,S,g,O,N,!1,H,U,Q,ne);if(!dt)return{notEnoughRoom:!0};if(h&&!s){let[ke,Be,ze]=dt.first.point,[et,Ge,ot]=dt.last.point;[ke,Be]=So(ke,Be,ze,v),[et,Ge]=So(et,Ge,ot,v);const Qe=_l(Fe,Le,(et-ke)*V,Ge-Be);if(u.flipState=Qe&&Qe.needsFlipping?gl.flipRequired:gl.flipNotRequired,Qe)return Qe}Xe(dt.first);for(let ke=le+1;ke<le+ye-1;ke++){const Be=ku(ae*b.getoffsetX(ke),ge,de,s,D,z,be,fe,Ke,S,g,O,N,!1,!1,H,U,Q,ne);if(!Be)return C.length-=4*(ke-le),{notEnoughRoom:!0};Xe(Be)}Xe(dt.last)}else{if(h&&!s){const ke=So(z.x,z.y,0,m),Be=fe+be+1,ze=new o.P(S.getx(Be),S.gety(Be)),et=So(ze.x,ze.y,0,m),Ge=et[3]>0?et:od(z,ze,ke,1,m,void 0,H,U.canonical),ot=_l(Fe,Le,(Ge[0]-ke[0])*V,Ge[1]-ke[1]);if(u.flipState=ot&&ot.needsFlipping?gl.flipRequired:gl.flipNotRequired,ot)return ot}const dt=ku(ae*b.getoffsetX(le),ge,de,s,D,z,be,fe,Ke,S,g,O,N,!1,!1,H,U,Q,ne);if(!dt)return{notEnoughRoom:!0};Xe(dt)}return{}}function _p(u,t,s,h,m){const{x:g,y:v,z:b}=h.projectTilePoint(u.x,u.y,t);if(!m)return So(g,v,b,s);const[S,C,P]=m(u);return So(g+S,v+C,b+P,s)}function od(u,t,s,h,m,g,v,b){const S=_p(u.sub(t)._unit()._add(u),b,m,v,g);return o.at(S,s,S),o.au(S,S),o.bF(S,s,S,h)}function ku(u,t,s,h,m,g,v,b,S,C,P,D,z,O,V,N,H,U,Q){const ne=h?u-t:u+t;let ae=ne>0?1:-1,ge=0;h&&(ae*=-1,ge=Math.PI),ae<0&&(ge+=Math.PI);let de=b+v+(ae>0?0:1)|0,fe=m,le=m,ye=0,be=0;const Fe=Math.abs(ne),Le=[],Ke=[];let Xe=g,dt=Xe,ke=o.bC([]);const Be=()=>od(dt,Xe,le,Fe-ye+1,P,z,N,H.canonical);for(;ye+be<=Fe;){if(de+=ae,de<b||de>=S)return null;if(le=fe,dt=Xe,Le.push(le),O&&Ke.push(dt),Xe=new o.P(C.getx(de),C.gety(de)),fe=D[de],!fe){const Ct=_p(Xe,H.canonical,P,N,z);fe=Ct[3]>0?D[de]=Ct:Be()}ye+=be;const Pt=o.at([],fe,le),Nt=o.bD(le,fe);if(s&&Nt>0&&be>0&&o.bE(ke,Pt)/(be*Nt)<Q)return null;be=Nt,ke=Pt}V&&z&&(D[de]&&(fe=Be(),be=o.bD(le,fe),ke=o.at([],fe,le)),D[de]=fe);const ze=(Fe-ye)/be,et=Xe.sub(dt)._mult(ze)._add(dt),Ge=o.bF([],le,ke,ze);let ot=[0,0,1],Qe=ke[0],st=ke[1];if(U&&(ot=N.upVector(H.canonical,et.x,et.y),ot[0]!==0||ot[1]!==0||ot[2]!==1)){const Pt=[ot[2],0,-ot[0]],Nt=o.bG([],ot,Pt);o.au(Pt,Pt),o.au(Nt,Nt),Qe=o.bE(ke,Pt),st=o.bE(ke,Nt)}if(s){const Pt=o.bG([],ot,ke);o.au(Pt,Pt),o.bF(Ge,Ge,Pt,s*ae)}const at=ge+Math.atan2(st,Qe);return Le.push(Ge),O&&Ke.push(et),{point:Ge,angle:at,path:Le,tilePath:Ke,up:ot}}function Hi(u,t){const s=t.length,h=s+4*u;t.resize(h),t.float32.fill(-1/0,4*s,4*h)}function u_(u,t,s){const h=t[0],m=t[1];return u[0]=s[0]*h+s[4]*m+s[12],u[1]=s[1]*h+s[5]*m+s[13],u[3]=s[3]*h+s[7]*m+s[15],u}const qt=100;class h_{constructor(t,s,h=new fp(t.width+200,t.height+200,25),m=new fp(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+qt,this.screenBottomBoundary=t.height+qt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,h,m,g,v,b,S){let C=h.projectedAnchorX,P=h.projectedAnchorY,D=h.projectedAnchorZ;const z=h.elevation,O=h.tileID,V=t.getProjection();if(z&&O){const[de,fe,le]=V.upVector(O.canonical,h.tileAnchorX,h.tileAnchorY),ye=V.upVectorScale(O.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;C+=de*z*ye,P+=fe*z*ye,D+=le*z*ye}const N=this.projectAndGetPerspectiveRatio(b,C,P,D,h.tileID,V.name==="globe"||!!z||this.transform.pitch>0,V),H=v*N.perspectiveRatio,U=(h.x1*s+m.x-h.padding)*H+N.point.x,Q=(h.y1*s+m.y-h.padding)*H+N.point.y,ne=(h.x2*s+m.x+h.padding)*H+N.point.x,ae=(h.y2*s+m.y+h.padding)*H+N.point.y,ge=N.perspectiveRatio<=.55||N.occluded;return!this.isInsideGrid(U,Q,ne,ae)||!g&&this.grid.hitTest(U,Q,ne,ae,S)||ge?{box:[],offscreen:!1,occluded:N.occluded}:{box:[U,Q,ne,ae],offscreen:this.isOffscreen(U,Q,ne,ae),occluded:!1}}placeCollisionCircles(t,s,h,m,g,v,b,S,C,P,D,z,O,V,N){const H=[],U=this.transform.elevation,Q=t.getProjection(),ne=U?U.getAtTileOffsetFunc(N,this.transform.center.lat,this.transform.worldSize,Q):null,ae=new o.P(h.tileAnchorX,h.tileAnchorY);let{x:ge,y:de,z:fe}=Q.projectTilePoint(ae.x,ae.y,N.canonical);if(ne){const[ot,Qe,st]=ne(ae);ge+=ot,de+=Qe,fe+=st}const le=Q.name==="globe",ye=this.projectAndGetPerspectiveRatio(b,ge,de,fe,N,le||!!U||this.transform.pitch>0,Q),{perspectiveRatio:be}=ye,Fe=(D?v/be:v*be)/o.bO,Le=So(ge,de,fe,S),Ke=h.lineOffsetX*Fe,Xe=h.lineOffsetY*Fe,dt=o.al(t.layers[0].layout.get("text-max-angle")),ke=Math.cos(dt),Be=ye.signedDistanceFromCamera>0?rd(Fe,g,Ke,Xe,!1,Le,ae,h,m,S,{},U&&!D?ne:null,D&&!!U,Q,N,D,ke):null;let ze=!1,et=!1,Ge=!0;if(Be&&!ye.occluded){const ot=.5*O*be+V,Qe=new o.P(-100,-100),st=new o.P(this.screenRightBoundary,this.screenBottomBoundary),at=new c_,{first:Pt,last:Nt}=Be,Ct=Pt.path.length;let jt=[];for(let si=Ct-1;si>=1;si--)jt.push(Pt.path[si]);for(let si=1;si<Nt.path.length;si++)jt.push(Nt.path[si]);const zt=2.5*ot;C&&(jt=jt.map(([si,Ai,tn],Yi)=>(ne&&!le&&(tn=ne(Yi<Ct-1?Pt.tilePath[Ct-1-Yi]:Nt.tilePath[Yi-Ct+2])[2]),So(si,Ai,tn,C))),jt.some(si=>si[3]<=0)&&(jt=[]));let Zt=[];if(jt.length>0){let si=1/0,Ai=-1/0,tn=1/0,Yi=-1/0;for(const Mi of jt)si=Math.min(si,Mi[0]),tn=Math.min(tn,Mi[1]),Ai=Math.max(Ai,Mi[0]),Yi=Math.max(Yi,Mi[1]);Ai>=Qe.x&&si<=st.x&&Yi>=Qe.y&&tn<=st.y&&(Zt=[jt.map(Mi=>new o.P(Mi[0],Mi[1]))],(si<Qe.x||Ai>st.x||tn<Qe.y||Yi>st.y)&&(Zt=o.bM(Zt,Qe.x,Qe.y,st.x,st.y)))}for(const si of Zt){at.reset(si,.25*ot);let Ai=0;Ai=at.length<=.5*ot?1:Math.ceil(at.paddedLength/zt)+1;for(let tn=0;tn<Ai;tn++){const Yi=tn/Math.max(Ai-1,1),Mi=at.lerp(Yi),Un=Mi.x+qt,Dn=Mi.y+qt;H.push(Un,Dn,ot,0);const hi=Un-ot,ki=Dn-ot,ji=Un+ot,nn=Dn+ot;if(Ge=Ge&&this.isOffscreen(hi,ki,ji,nn),et=et||this.isInsideGrid(hi,ki,ji,nn),!s&&this.grid.hitTestCircle(Un,Dn,ot,z)&&(ze=!0,!P))return{circles:[],offscreen:!1,collisionDetected:ze,occluded:!1}}}}return{circles:!P&&ze||!et?[]:H,offscreen:Ge,collisionDetected:ze,occluded:ye.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,m=1/0,g=-1/0,v=-1/0;for(const P of t){const D=new o.P(P.x+qt,P.y+qt);h=Math.min(h,D.x),m=Math.min(m,D.y),g=Math.max(g,D.x),v=Math.max(v,D.y),s.push(D)}const b=this.grid.query(h,m,g,v).concat(this.ignoredGrid.query(h,m,g,v)),S={},C={};for(const P of b){const D=P.key;if(S[D.bucketInstanceId]===void 0&&(S[D.bucketInstanceId]={}),S[D.bucketInstanceId][D.featureIndex])continue;const z=[new o.P(P.x1,P.y1),new o.P(P.x2,P.y1),new o.P(P.x2,P.y2),new o.P(P.x1,P.y2)];o.bN(s,z)&&(S[D.bucketInstanceId][D.featureIndex]=!0,C[D.bucketInstanceId]===void 0&&(C[D.bucketInstanceId]=[]),C[D.bucketInstanceId].push(D.featureIndex))}return C}insertCollisionBox(t,s,h,m,g){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,h,m,g){const v=s?this.ignoredGrid:this.grid,b={bucketInstanceId:h,featureIndex:m,collisionGroupID:g};for(let S=0;S<t.length;S+=4)v.insertCircle(b,t[S],t[S+1],t[S+2])}projectAndGetPerspectiveRatio(t,s,h,m,g,v,b){const S=[s,h,m,1];let C=!1;m||this.transform.pitch>0?(o.aA(S,S,t),this.fogState&&g&&b.name!=="globe"&&(C=function(z,O,V,N,H,U){const Q=U.calculateFogTileMatrix(H),ne=[O,V,N];return o.ad(ne,ne,Q),Ot(z,o.ae(ne),U.pitch,U._fov)}(this.fogState,s,h,m,g.toUnwrapped(),this.transform)>.9)):u_(S,S,t);const P=S[3];return{point:new o.P((S[0]/P+1)/2*this.transform.width+qt,(-S[1]/P+1)/2*this.transform.height+qt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(b)/P*.5,1.5),signedDistanceFromCamera:P,occluded:v&&S[2]>P||C}}isOffscreen(t,s,h,m){return h<qt||t>=this.screenRightBoundary||m<qt||s>this.screenBottomBoundary}isInsideGrid(t,s,h,m){return h>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=o.bx([]);return o.bo(t,t,[-100,-100,0]),t}}function sd(u,t,s){const h=t.createTileMatrix(u,u.worldSize,s.toUnwrapped());return o.az(new Float32Array(16),u.projMatrix,h)}function ad(u,t,s){if(t.projection.name===s.projection.name)return u.projMatrix;const h=s.clone();return h.setProjection(t.projection),sd(h,t.getProjection(),u)}function Ou(u,t,s){return t.name===s.projection.name?u.projMatrix:sd(s,t,u)}class Jo{constructor(t,s,h,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class yl{constructor(t,s,h,m,g,v=!1){this.text=new Jo(t?t.text:null,s,h,g),this.icon=new Jo(t?t.icon:null,s,m,g),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class La{constructor(t,s,h,m=!1){this.text=t,this.icon=s,this.skipFade=h,this.clipped=m}}class Ut{constructor(){this.invProjMatrix=o.bz(),this.viewportMatrix=o.bz(),this.circles=[]}}class on{constructor(t,s,h,m,g){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=g}}class Xi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[t]}}function mo(u,t,s,h,m){const{horizontalAlign:g,verticalAlign:v}=o.bV(u),b=-(g-.5)*t,S=-(v-.5)*s,C=o.bU(u,h);return new o.P(b+C[0]*m,S+C[1]*m)}function ka(u,t,s,h,m){const g=new o.P(u,t);return s&&g._rotate(h?m:-m),g}class Wi{constructor(t,s,h,m,g,v){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new h_(this.transform,g),this.buildingIndex=v,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Xi(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,h,m,g=1){const v=h.getBucket(s),b=h.latestFeatureIndex;if(!v||!b||s.fqid!==v.layerIds[0])return;const S=v.layers[0].layout,C=v.layers[0].paint,P=h.collisionBoxArray,D=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),z=h.tileSize/o.aj,O=h.tileID.toUnwrapped();this.transform.setProjection(v.projection);const V=(N=h.tileID,H=v.getProjection(),U=this.transform,H.name===this.projection?U.calculateProjMatrix(N.toUnwrapped()):sd(U,H,N));var N,H,U;const Q=S.get("text-pitch-alignment")==="map",ne=S.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const ae=s.dynamicFilter(),ge=s.dynamicFilterNeedsFeature(),de=this.transform.calculatePixelsToTileUnitsMatrix(h),fe=nd(V,h.tileID.canonical,Q,ne,this.transform,v.getProjection(),de);let le=null;if(Q){const Be=pp(V,h.tileID.canonical,Q,ne,this.transform,v.getProjection(),de);le=o.az([],this.transform.labelPlaneMatrix,Be)}let ye=null;ae&&h.latestFeatureIndex&&(ye={unwrappedTileID:O,dynamicFilter:ae,dynamicFilterNeedsFeature:ge}),this.retainedQueryData[v.bucketInstanceId]=new on(v.bucketInstanceId,b,v.sourceLayerIndex,v.index,h.tileID);const[be,Fe]=v.layers[0].layout.get("text-size-scale-range"),Le=o.aD(g,be,Fe),[Ke,Xe]=S.get("icon-size-scale-range"),dt=o.aD(g,Ke,Xe),ke={bucket:v,layout:S,paint:C,posMatrix:V,textLabelPlaneMatrix:fe,labelToScreenMatrix:le,clippingData:ye,scale:D,textPixelRatio:z,holdingForFade:h.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:o.bH(v.textSizeData,this.transform.zoom,Le),partiallyEvaluatedIconSize:o.bH(v.iconSizeData,this.transform.zoom,dt),collisionGroup:this.collisionGroups.get(v.sourceID),latestFeatureIndex:h.latestFeatureIndex};if(m)for(const Be of v.sortKeyRanges){const{sortKey:ze,symbolInstanceStart:et,symbolInstanceEnd:Ge}=Be;t.push({sortKey:ze,symbolInstanceStart:et,symbolInstanceEnd:Ge,parameters:ke})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ke})}attemptAnchorPlacement(t,s,h,m,g,v,b,S,C,P,D,z,O,V,N,H,U,Q){const{textOffset0:ne,textOffset1:ae,crossTileID:ge}=z,de=[ne,ae],fe=mo(t,h,m,de,g),le=this.collisionIndex.placeCollisionBox(V,g,s,ka(fe.x,fe.y,v,b,this.transform.angle),D,S,C,P.predicate);if(H){const ye=V.getSymbolInstanceIconSize(Q,this.transform.zoom,z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(V,ye,H,ka(fe.x,fe.y,v,b,this.transform.angle),D,S,C,P.predicate).box.length===0)return}if(le.box.length>0){let ye;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&(ye=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:de,width:h,height:m,anchor:t,textScale:g,prevAnchor:ye},this.markUsedJustification(V,t,z,N),V.allowVerticalPlacement&&(this.markUsedOrientation(V,N,z),this.placedOrientations[ge]=N),{shift:fe,placedGlyphBoxes:le}}}placeLayerBucketPart(t,s,h,m,g=1){const{bucket:v,layout:b,paint:S,posMatrix:C,textLabelPlaneMatrix:P,labelToScreenMatrix:D,clippingData:z,textPixelRatio:O,holdingForFade:V,collisionBoxArray:N,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:U,collisionGroup:Q,latestFeatureIndex:ne}=t.parameters,ae=b.get("text-optional"),ge=b.get("icon-optional"),de=b.get("text-allow-overlap"),fe=b.get("icon-allow-overlap"),le=b.get("text-rotation-alignment")==="map",ye=b.get("text-pitch-alignment")==="map",be=S.get("symbol-z-offset"),Fe=b.get("symbol-elevation-reference")==="sea",[Le,Ke]=b.get("text-size-scale-range"),[Xe,dt]=b.get("icon-size-scale-range"),ke=o.aD(g,Le,Ke),Be=o.aD(g,Xe,dt);this.transform.setProjection(v.projection);let ze=de&&(fe||!v.hasIconData()||ge),et=fe&&(de||!v.hasTextData()||ae);const Ge=!be.isConstant();!v.collisionArrays&&N&&v.deserializeCollisionBoxes(N),h&&m&&v.updateCollisionDebugBuffers(this.transform.zoom,N,ke,Be);const ot=(Qe,st,at)=>{const{crossTileID:Pt,numVerticalGlyphVertices:Nt}=Qe;let Ct=null;if(z&&z.dynamicFilterNeedsFeature||Ge){const Bi=this.retainedQueryData[v.bucketInstanceId];Ct=ne.loadFeature({featureIndex:Qe.featureIndex,bucketIndex:Bi.bucketIndex,sourceLayerIndex:Bi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(z&&!(0,z.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Ct,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new o.P(Qe.tileAnchorX,Qe.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[Pt]=new La(!1,!1,!1,!0),void s.add(Pt);const jt=be.evaluate(Ct,{});if(s.has(Pt))return;if(V)return void(this.placements[Pt]=new La(!1,!1,!1));let zt=!1,Zt=!1,si=!0,Ai=!1,tn=!1,Yi=null,Mi={box:null,offscreen:null,occluded:null},Un={box:null,offscreen:null,occluded:null},Dn=null,hi=null,ki=null,ji=0,nn=0,nr=0;at.textFeatureIndex?ji=at.textFeatureIndex:Qe.useRuntimeCollisionCircles&&(ji=Qe.featureIndex),at.verticalTextFeatureIndex&&(nn=at.verticalTextFeatureIndex);const qn=Bi=>{Bi.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const In=this.transform.elevation;Bi.elevation=Fe?jt:jt+(In?In.getAtTileOffset(Bi.tileID,Bi.tileAnchorX,Bi.tileAnchorY):0),Bi.elevation+=Qe.zOffset},tr=at.textBox;if(tr){qn(tr);const Bi=qi=>{let Rn=o.bI.horizontal;if(v.allowVerticalPlacement&&!qi&&this.prevPlacement){const xr=this.prevPlacement.placedOrientations[Pt];xr&&(this.placedOrientations[Pt]=xr,Rn=xr,this.markUsedOrientation(v,Rn,Qe))}return Rn},In=(qi,Rn)=>{if(v.allowVerticalPlacement&&Nt>0&&at.verticalTextBox){for(const xr of v.writingModes)if(xr===o.bI.vertical?(Mi=Rn(),Un=Mi):Mi=qi(),Mi&&Mi.box&&Mi.box.length)break}else Mi=qi()};if(b.get("text-variable-anchor")){let qi=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Pt]){const mn=this.prevPlacement.variableOffsets[Pt];qi.indexOf(mn.anchor)>0&&(qi=qi.filter(Cr=>Cr!==mn.anchor),qi.unshift(mn.anchor))}const Rn=(mn,Cr,Yn)=>{const Dr=v.getSymbolInstanceTextSize(H,Qe,this.transform.zoom,st),Ts=(mn.x2-mn.x1)*Dr+2*mn.padding,ma=(mn.y2-mn.y1)*Dr+2*mn.padding,Ao=Qe.hasIconTextFit&&!fe?Cr:null;Ao&&qn(Ao);let rs={box:[],offscreen:!1,occluded:!1};const $s=de?2*qi.length:qi.length;for(let Hs=0;Hs<$s;++Hs){const Ss=this.attemptAnchorPlacement(qi[Hs%qi.length],mn,Ts,ma,Dr,le,ye,O,C,Q,Hs>=qi.length,Qe,st,v,Yn,Ao,H,U);if(Ss&&(rs=Ss.placedGlyphBoxes,rs&&rs.box&&rs.box.length)){zt=!0,Yi=Ss.shift;break}}return rs};In(()=>Rn(tr,at.iconBox,o.bI.horizontal),()=>{const mn=at.verticalTextBox;return mn&&qn(mn),v.allowVerticalPlacement&&!(Mi&&Mi.box&&Mi.box.length)&&Nt>0&&mn?Rn(mn,at.verticalIconBox,o.bI.vertical):{box:null,offscreen:null,occluded:null}}),Mi&&(zt=Mi.box,si=Mi.offscreen,Ai=Mi.occluded);const xr=Bi(!(!Mi||!Mi.box));if(!zt&&this.prevPlacement){const mn=this.prevPlacement.variableOffsets[Pt];mn&&(this.variableOffsets[Pt]=mn,this.markUsedJustification(v,mn.anchor,Qe,xr))}}else{const qi=(Rn,xr)=>{const mn=v.getSymbolInstanceTextSize(H,Qe,this.transform.zoom,st,g),Cr=this.collisionIndex.placeCollisionBox(v,mn,Rn,new o.P(0,0),de,O,C,Q.predicate);return Cr&&Cr.box&&Cr.box.length&&(this.markUsedOrientation(v,xr,Qe),this.placedOrientations[Pt]=xr),Cr};In(()=>qi(tr,o.bI.horizontal),()=>{const Rn=at.verticalTextBox;return v.allowVerticalPlacement&&Nt>0&&Rn?(qn(Rn),qi(Rn,o.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Bi(!!(Mi&&Mi.box&&Mi.box.length))}}if(Dn=Mi,zt=Dn&&Dn.box&&Dn.box.length>0,si=Dn&&Dn.offscreen,Ai=Dn&&Dn.occluded,Qe.useRuntimeCollisionCircles){const Bi=v.text.placedSymbolArray.get(Qe.centerJustifiedTextSymbolIndex>=0?Qe.centerJustifiedTextSymbolIndex:Qe.verticalPlacedTextSymbolIndex),In=o.bJ(v.textSizeData,H,Bi),qi=b.get("text-padding");hi=this.collisionIndex.placeCollisionCircles(v,de,Bi,v.lineVertexArray,v.glyphOffsetArray,In,C,P,D,h,ye,Q.predicate,Qe.collisionCircleDiameter*In/o.bO,qi,this.retainedQueryData[v.bucketInstanceId].tileID),zt=de||hi.circles.length>0&&!hi.collisionDetected,si=si&&hi.offscreen,Ai=hi.occluded}if(at.iconFeatureIndex&&(nr=at.iconFeatureIndex),at.iconBox){const Bi=In=>{qn(In);const qi=Qe.hasIconTextFit&&Yi?ka(Yi.x,Yi.y,le,ye,this.transform.angle):new o.P(0,0),Rn=v.getSymbolInstanceIconSize(U,this.transform.zoom,Qe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,Rn,In,qi,fe,O,C,Q.predicate)};Un&&Un.box&&Un.box.length&&at.verticalIconBox?(ki=Bi(at.verticalIconBox),Zt=ki.box.length>0):(ki=Bi(at.iconBox),Zt=ki.box.length>0),si=si&&ki.offscreen,tn=ki.occluded}const Pn=ae||Qe.numHorizontalGlyphVertices===0&&Nt===0,mi=ge||Qe.numIconVertices===0;if(Pn||mi?mi?Pn||(Zt=Zt&&zt):zt=Zt&&zt:Zt=zt=Zt&&zt,zt&&Dn&&Dn.box&&this.collisionIndex.insertCollisionBox(Dn.box,b.get("text-ignore-placement"),v.bucketInstanceId,Un&&Un.box&&nn?nn:ji,Q.ID),Zt&&ki&&this.collisionIndex.insertCollisionBox(ki.box,b.get("icon-ignore-placement"),v.bucketInstanceId,nr,Q.ID),hi&&(zt&&this.collisionIndex.insertCollisionCircles(hi.circles,b.get("text-ignore-placement"),v.bucketInstanceId,ji,Q.ID),h)){const Bi=v.bucketInstanceId;let In=this.collisionCircleArrays[Bi];In===void 0&&(In=this.collisionCircleArrays[Bi]=new Ut);for(let qi=0;qi<hi.circles.length;qi+=4)In.circles.push(hi.circles[qi+0]),In.circles.push(hi.circles[qi+1]),In.circles.push(hi.circles[qi+2]),In.circles.push(hi.collisionDetected?1:0)}const En=v.projection.name!=="globe";ze=ze&&(En||!Ai),et=et&&(En||!tn),this.placements[Pt]=new La(zt||ze,Zt||et,si||v.justReloaded),s.add(Pt)};if(v.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.elevationType==="road"&&v.updateRoadElevation(),v.updateZOffset(),v.sortFeaturesByY){const Qe=v.getSortedSymbolIndexes(this.transform.angle);for(let st=Qe.length-1;st>=0;--st){const at=Qe[st];ot(v.symbolInstances.get(at),at,v.collisionArrays[at])}v.hasAnyZOffset&&o.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){const Qe=v.getSortedIndexesByZOffset();for(let st=0;st<Qe.length;++st){const at=Qe[st];ot(v.symbolInstances.get(at),at,v.collisionArrays[at])}}else for(let Qe=t.symbolInstanceStart;Qe<t.symbolInstanceEnd;Qe++)ot(v.symbolInstances.get(Qe),Qe,v.collisionArrays[Qe]);if(h&&v.bucketInstanceId in this.collisionCircleArrays){const Qe=this.collisionCircleArrays[v.bucketInstanceId];o.bi(Qe.invProjMatrix,C),Qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,s,h,m){const{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:S,crossTileID:C}=h,P=o.bT(s),D=m===o.bI.vertical?S:P==="left"?g:P==="center"?v:P==="right"?b:-1;g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=D>=0&&g!==D?0:C),v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=D>=0&&v!==D?0:C),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=D>=0&&b!==D?0:C),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=D>=0&&S!==D?0:C)}markUsedOrientation(t,s,h){const m=s===o.bI.horizontal||s===o.bI.horizontalOnly?s:0,g=s===o.bI.vertical?s:0,{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:C}=h,P=t.text.placedSymbolArray;v>=0&&(P.get(v).placedOrientation=m),b>=0&&(P.get(b).placedOrientation=m),S>=0&&(P.get(S).placedOrientation=m),C>=0&&(P.get(C).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,g=s?s.opacities:{},v=s?s.variableOffsets:{},b=s?s.placedOrientations:{};for(const S in this.placements){const C=this.placements[S],P=g[S];P?(this.opacities[S]=new yl(P,m,C.text,C.icon,null,C.clipped),h=h||C.text!==P.text.placed||C.icon!==P.icon.placed):(this.opacities[S]=new yl(null,m,C.text,C.icon,C.skipFade,C.clipped),h=h||C.text||C.icon)}for(const S in g){const C=g[S];if(!this.opacities[S]){const P=new yl(C,m,!1,!1);P.isHidden()||(this.opacities[S]=P,h=h||C.text.placed||C.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in b)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=b[S]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s,h,m){const g=new Set;for(const v of s){const b=v.getBucket(t);b&&v.latestFeatureIndex&&t.fqid===b.layerIds[0]&&(this.updateBucketOpacities(b,g,v,v.collisionBoxArray,h,m,v.tileID,t.scope),b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,v.tileID),b.elevationType==="road"&&b.updateRoadElevation(),b.updateZOffset())}}updateBucketOpacities(t,s,h,m,g,v,b,S){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const C=t.layers[0].layout,P=t.layers[0].paint,D=!!t.layers[0].dynamicFilter(),z=new yl(null,0,!1,!1,!0),O=C.get("text-allow-overlap"),V=C.get("icon-allow-overlap"),N=C.get("text-variable-anchor"),H=C.get("text-rotation-alignment")==="map",U=C.get("text-pitch-alignment")==="map",Q=P.get("symbol-z-offset"),ne=C.get("symbol-elevation-reference")==="sea",ae=!Q.isConstant(),ge=new yl(null,0,O&&(V||!t.hasIconData()||C.get("icon-optional")),V&&(O||!t.hasTextData()||C.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const de=(le,ye,be)=>{for(let Fe=0;Fe<ye/4;Fe++)le.opacityVertexArray.emplaceBack(be)};let fe=0;v&&t.updateReplacement(b,v);for(let le=0;le<t.symbolInstances.length;le++){const ye=t.symbolInstances.get(le),{numHorizontalGlyphVertices:be,numVerticalGlyphVertices:Fe,crossTileID:Le,numIconVertices:Ke,tileAnchorX:Xe,tileAnchorY:dt}=ye;let ke=null;const Be=this.retainedQueryData[t.bucketInstanceId];ae&&ye&&Be&&(ke=h.latestFeatureIndex.loadFeature({featureIndex:ye.featureIndex,bucketIndex:Be.bucketIndex,sourceLayerIndex:Be.sourceLayerIndex,layoutVertexArrayOffset:0}));const ze=Q.evaluate(ke,{}),et=s.has(Le);let Ge=this.opacities[Le];et?Ge=z:Ge||(Ge=ge,this.opacities[Le]=Ge),s.add(Le);const ot=be>0||Fe>0,Qe=Ke>0,st=this.placedOrientations[Le],at=st===o.bI.vertical,Pt=st===o.bI.horizontal||st===o.bI.horizontalOnly;!ot&&!Qe||Ge.isHidden()||fe++;let Nt=!1;if((ot||Qe)&&v)for(const Ct of t.activeReplacements){if(o.bP(Ct,g,o.bQ.Symbol,S)||Ct.min.x>Xe||Xe>Ct.max.x||Ct.min.y>dt||dt>Ct.max.y)continue;const jt=o.bR(Xe,dt,b.canonical,Ct.footprintTileId.canonical);if(Nt=o.bS(jt,Ct.footprint),Nt)break}if(ot){const Ct=Nt?Oa:lc(Ge.text);de(t.text,be,at?Oa:Ct),de(t.text,Fe,Pt?Oa:Ct);const jt=Ge.text.isHidden(),{leftJustifiedTextSymbolIndex:zt,centerJustifiedTextSymbolIndex:Zt,rightJustifiedTextSymbolIndex:si,verticalPlacedTextSymbolIndex:Ai}=ye,tn=t.text.placedSymbolArray,Yi=jt||at?1:0;zt>=0&&(tn.get(zt).hidden=Yi),Zt>=0&&(tn.get(Zt).hidden=Yi),si>=0&&(tn.get(si).hidden=Yi),Ai>=0&&(tn.get(Ai).hidden=jt||Pt?1:0);const Mi=this.variableOffsets[Le];Mi&&this.markUsedJustification(t,Mi.anchor,ye,st);const Un=this.placedOrientations[Le];Un&&(this.markUsedJustification(t,"left",ye,Un),this.markUsedOrientation(t,Un,ye))}if(Qe){const Ct=Nt?Oa:lc(Ge.icon),{placedIconSymbolIndex:jt,verticalPlacedIconSymbolIndex:zt}=ye,Zt=t.icon.placedSymbolArray,si=Ge.icon.isHidden()?1:0;jt>=0&&(de(t.icon,Ke,at?Oa:Ct),Zt.get(jt).hidden=si),zt>=0&&(de(t.icon,ye.numVerticalIconVertices,Pt?Oa:Ct),Zt.get(zt).hidden=si)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ct=t.collisionArrays[le];if(Ct){let jt=new o.P(0,0),zt=!0;if(Ct.textBox||Ct.verticalTextBox){if(N){const si=this.variableOffsets[Le];si?(jt=mo(si.anchor,si.width,si.height,si.textOffset,si.textScale),H&&jt._rotate(U?this.transform.angle:-this.transform.angle)):zt=!1}D&&(zt=!Ge.clipped),Ct.textBox&&vl(t.textCollisionBox.collisionVertexArray,Ge.text.placed,!zt||at,ze,ne,jt.x,jt.y),Ct.verticalTextBox&&vl(t.textCollisionBox.collisionVertexArray,Ge.text.placed,!zt||Pt,ze,ne,jt.x,jt.y)}const Zt=zt&&!!(!Pt&&Ct.verticalIconBox);Ct.iconBox&&vl(t.iconCollisionBox.collisionVertexArray,Ge.icon.placed,Zt,ze,ne,ye.hasIconTextFit?jt.x:0,ye.hasIconTextFit?jt.y:0),Ct.verticalIconBox&&vl(t.iconCollisionBox.collisionVertexArray,Ge.icon.placed,!Zt,ze,ne,ye.hasIconTextFit?jt.x:0,ye.hasIconTextFit?jt.y:0)}}}if(t.fullyClipped=fe===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=le.invProjMatrix,t.placementViewportMatrix=le.viewportMatrix,t.collisionCircleArray=le.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function vl(u,t,s,h,m,g,v){u.emplaceBack(t?1:0,s?1:0,g||0,v||0,h,m?1:0),u.emplaceBack(t?1:0,s?1:0,g||0,v||0,h,m?1:0),u.emplaceBack(t?1:0,s?1:0,g||0,v||0,h,m?1:0),u.emplaceBack(t?1:0,s?1:0,g||0,v||0,h,m?1:0)}const Fu=Math.pow(2,25),Bu=Math.pow(2,24),no=Math.pow(2,17),sr=Math.pow(2,16),ix=Math.pow(2,9),Nu=Math.pow(2,8),yp=Math.pow(2,1);function lc(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,s=Math.floor(127*u.opacity);return s*Fu+t*Bu+s*no+t*sr+s*ix+t*Nu+s*yp+t}const Oa=0;class ld{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,s,h,m,g,v){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(b,m,t[this._currentTileIndex],this._sortAcrossTiles,v),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((S,C)=>S.sortKey-C.sortKey));this._currentPartIndex<b.length;){const S=b[this._currentPartIndex];if(s.placeLayerBucketPart(S,this._seenCrossTileIDs,h,S.symbolInstanceStart===0,v),this._currentPartIndex++,g())return!0}return!1}}class ro{constructor(t,s,h,m,g,v,b,S,C){this.placement=new Wi(t,g,v,b,S,C),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,s,h,m,g){const v=o.q.now(),b=()=>{const S=o.q.now()-v;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=s[t[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=C)&&(!S.maxzoom||S.maxzoom>C)){const P=S,D=P.layout.get("symbol-z-elevate"),z=P.layout.get("symbol-sort-key").constantOr(1)!==void 0,O=P.layout.get("symbol-z-order"),V=O==="viewport-y"||O==="auto"&&!(O!=="viewport-y"&&z),N=P.layout.get("text-allow-overlap")||P.layout.get("icon-allow-overlap")||P.layout.get("text-ignore-placement")||P.layout.get("icon-ignore-placement"),H=V&&N,U=this._inProgressLayer=this._inProgressLayer||new ld(P),Q=o.C(S.source,S.scope);if(U.continuePlacement(D||H?m[Q]:h[Q],this.placement,this._showCollisionBoxes,S,b,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const _s=512/o.aj/2;class go{constructor(t,s,h){this.tileID=t,this.bucketInstanceId=h,this.index=new o.bW(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=t.canonical.x*o.aj,g=t.canonical.y*o.aj;for(let v=0;v<s.length;v++){const{key:b,crossTileID:S,tileAnchorX:C,tileAnchorY:P}=s.get(v),D=Math.floor((m+C)*_s),z=Math.floor((g+P)*_s);this.index.add(D,z),this.keys.push(b),this.crossTileIDs.push(S)}this.index.finish()}findMatches(t,s,h){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),g=_s/Math.pow(2,s.canonical.z-this.tileID.canonical.z),v=s.canonical.x*o.aj,b=s.canonical.y*o.aj;for(let S=0;S<t.length;S++){const C=t.get(S);if(C.crossTileID)continue;const{key:P,tileAnchorX:D,tileAnchorY:z}=C,O=Math.floor((v+D)*g),V=Math.floor((b+z)*g),N=this.index.range(O-m,V-m,O+m,V+m).sort((H,U)=>H-U);for(const H of N){const U=this.crossTileIDs[H];if(this.keys[H]===P&&!h.has(U)){h.add(U),C.crossTileID=U;break}}}}}class d_{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const h in this.indexes){const m=this.indexes[h],g={};for(const v in m){const b=m[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),g[b.tileID.key]=b}this.indexes[h]=g}this.lng=t}addBucket(t,s,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const m=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const v=this.indexes[g];if(Number(g)>t.overscaledZ)for(const b in v){const S=v[b];S.tileID.isChildOf(t)&&S.findMatches(s.symbolInstances,t,m)}else{const b=v[t.scaledTo(Number(g)).key];b&&b.findMatches(s.symbolInstances,t,m)}}for(let g=0;g<s.symbolInstances.length;g++){const v=s.symbolInstances.get(g);v.crossTileID||(v.crossTileID=h.generate(),m.add(v.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new go(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const h of s.crossTileIDs)this.usedCrossTileIDs[t].delete(h)}removeStaleBuckets(t){let s=!1;for(const h in this.indexes){const m=this.indexes[h];for(const g in m)t[m[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[g]),delete m[g],s=!0)}return s}}class mr{constructor(){this.layerIndexes={},this.crossTileIDs=new d_,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,h,m){let g=this.layerIndexes[t.fqid];g===void 0&&(g=this.layerIndexes[t.fqid]=new cc);let v=!1;const b={};m.name!=="globe"&&g.handleWrapJump(h);for(const S of s){const C=S.getBucket(t);C&&t.fqid===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(S.tileID,C,this.crossTileIDs)&&(v=!0),b[C.bucketInstanceId]=!0)}return g.removeStaleBuckets(b)&&(v=!0),v}pruneUnusedLayers(t){const s={};t.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const oo=771;class bi{constructor(t,s,h,m){this.blendFunction=t,this.blendColor=s,this.mask=h,this.blendEquation=m}}bi.Replace=[1,0,1,0],bi.disabled=new bi(bi.Replace,o.am.transparent,[!1,!1,!1,!1]),bi.unblended=new bi(bi.Replace,o.am.transparent,[!0,!0,!0,!0]),bi.alphaBlended=new bi([1,oo,1,oo],o.am.transparent,[!0,!0,!0,!0]),bi.alphaBlendedNonPremultiplied=new bi([770,oo,770,oo],o.am.transparent,[!0,!0,!0,!0]),bi.multiply=new bi([774,0,774,0],o.am.transparent,[!0,!0,!0,!0]);class Rt{constructor(t,s,h){this.func=t,this.mask=s,this.range=h}}Rt.ReadOnly=!1,Rt.ReadWrite=!0,Rt.disabled=new Rt(519,Rt.ReadOnly,[0,1]);const ju=7680;class Qt{constructor(t,s,h,m,g,v){this.test=t,this.ref=s,this.mask=h,this.fail=m,this.depthFail=g,this.pass=v}}Qt.disabled=new Qt({func:519,mask:0},0,0,ju,ju,ju);const xl=1029,uc=2305;class Jt{constructor(t,s,h){this.enable=t,this.mode=s,this.frontFace=h}}function f_(u,t){const s=o.c1(u,3);o.c3(u,t),o.c7(u,3,s)}function ys(u,t){const s=o.bY([]);return o.bZ(s,s,-t),o.b_(s,s,-u),s}function p_(u,t){const s=[u[0],u[1],0],h=[t[0],t[1],0];if(o.ae(s)>=1e-15){const v=o.au([],s);o.b$(h,v,o.bE(h,v)),t[0]=h[0],t[1]=h[1]}const m=o.bG([],t,u);if(o.c0(m)<1e-15)return null;const g=Math.atan2(-m[1],m[0]);return ys(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),g)}Jt.disabled=new Jt(!1,xl,uc),Jt.backCCW=new Jt(!0,xl,uc),Jt.backCW=new Jt(!0,xl,2304),Jt.frontCW=new Jt(!0,1028,2304),Jt.frontCCW=new Jt(!0,1028,uc);class cd{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof o.ac?t:new o.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=o.bX(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const h=this.position,m=this._elevation?this._elevation.getAtPointOrZero(o.ac.fromLngLat(t)):0,g=o.ac.fromLngLat(t,m),v=[g.x-h.x,g.y-h.y,g.z-h.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=p_(v,s)}setPitchBearing(t,s){this.orientation=ys(o.al(t),o.al(-s))}}class Xr{constructor(t,s){this._transform=o.bx([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new o.ac(t[0],t[1],t[2])}get position(){const t=o.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&o.c7(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||o.bY([]),t&&f_(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=ys(t,s),f_(this._transform,this._orientation)}forward(){const t=o.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=o.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=o.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const h=new Float64Array(16);return o.bi(h,this.getWorldToCamera(t,s)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,s,h){const m=this.position;o.b$(m,m,-t);const g=new Float64Array(16);return o.bn(g,[h,h,h]),o.bo(g,g,m),g[10]*=s,g}getWorldToCamera(t,s){const h=new Float64Array(16),m=new Float64Array(4),g=this.position;return o.c2(m,this._orientation),o.b$(g,g,-t),o.c3(h,m),o.bo(h,h,g),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(t,s,h,m){const g=new Float64Array(16);return o.c4(g,t,s,h,m),g}getCameraToClipOrthographic(t,s,h,m,g,v){const b=new Float64Array(16);return o.c5(b,t,s,h,m,g,v),b}getDistanceToElevation(t,s=!1){const h=t===0?0:o.c6(t,s?o.aY(this.position[1]):this.position[1]),m=this.forward();return(h-this.position[2])/m[2]}clone(){return new Xr([...this.position],[...this.orientation])}}const so={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class hc{constructor(t=0,s=0,h=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=h,this.right=m}interpolate(t,s,h){return s.top!=null&&t.top!=null&&(this.top=o.ai(t.top,s.top,h)),s.bottom!=null&&t.bottom!=null&&(this.bottom=o.ai(t.bottom,s.bottom,h)),s.left!=null&&t.left!=null&&(this.left=o.ai(t.left,s.left,h)),s.right!=null&&t.right!=null&&(this.right=o.ai(t.right,s.right,h)),this}getCenter(t,s){const h=o.aD((this.left+t-this.right)/2,0,t),m=o.aD((this.top+s-this.bottom)/2,0,s);return new o.P(h,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new hc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Fa=15;class bl{constructor(t,s,h,m,g,v,b){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=h??0,this._maxPitch=m??60,this.setProjection(v),this.setMaxBounds(b),this.width=0,this.height=0,this._center=new o.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new hc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Xr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new bl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Fa}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,s=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(t||h)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return o.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=o.ce(this.projectionOptions);const h=this.getProjection(),m=!o.bv(s,h);return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.ce({name:"mercator"});const s=t!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=o.cf(),o.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=o.aD(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=o.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let m=0,g=0;for(let v=0;v<s.length;v++){const b=new o.P(s[v][0]*this.width,h+s[v][1]*(this.height-h)),S=t.pointCoordinate(b);if(!S)continue;const C=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);m+=S[3]*C,g+=C}return g===0?NaN:m/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),v=Math.max(m-h,g);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let h;h=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const m=o.ae(o.at([],this._camera.position,h));return o.aD(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!o.ch(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const h=[t.position.x,t.position.y,t.position.z];o.ci(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new cd;return s.position=new o.ac(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!o.cj(t))return!1;o.ck(t,t);const s=o.cl([],[0,0,-1],t),h=o.cl([],[0,-1,0],t);if(h[2]<0)return!1;const m=p_(s,h);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=o.aD(t[2],m/h,m/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,h){this._unmodified=!1,this._edgeInsets.interpolate(t,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new o.cm(0,t)];if(this.renderWorldCopies){const h=this.pointCoordinate(new o.P(0,0)),m=this.pointCoordinate(new o.P(this.width,0)),g=this.pointCoordinate(new o.P(this.width,this.height)),v=this.pointCoordinate(new o.P(0,this.height)),b=Math.floor(Math.min(h.x,m.x,g.x,v.x)),S=Math.floor(Math.max(h.x,m.x,g.x,v.x)),C=1;for(let P=b-C;P<=S+C;P++)P!==0&&s.push(new o.cm(P,t))}return s}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,s,h){let m=[];const g=h!=null,v=!g;if(v&&this.zoom<s||g&&h[0]===0&&h[1]===0)return m;const b=new Set,S=(P,D,z,O,V)=>{const N=o.cK(D,P,z,O,V);b.has(N)||(m.push(new o.aM(P,D,z,O,V)),b.add(N))};for(let P=0;P<t.length;P++){const D=t[P];if(v&&D.canonical.z!==s)continue;const z=D.canonical,O=D.overscaledZ,V=D.wrap,N=1<<z.z,H=z.x+1<N,U=z.x>0,Q=z.y+1<N,ne=z.y>0,ae=D.wrap-(U?0:1),ge=D.wrap+(H?0:1),de=U?z.x-1:N-1,fe=H?z.x+1:0;if(g)h[0]<0?(S(O,ge,z.z,fe,z.y),h[1]<0&&Q&&(S(O,V,z.z,z.x,z.y+1),S(O,ge,z.z,fe,z.y+1)),h[1]>0&&ne&&(S(O,V,z.z,z.x,z.y-1),S(O,ge,z.z,fe,z.y-1))):h[0]>0?(S(O,ae,z.z,de,z.y),h[1]<0&&Q&&(S(O,V,z.z,z.x,z.y+1),S(O,ae,z.z,de,z.y+1)),h[1]>0&&ne&&(S(O,V,z.z,z.x,z.y-1),S(O,ae,z.z,de,z.y-1))):h[1]<0&&Q?S(O,V,z.z,z.x,z.y+1):ne&&S(O,V,z.z,z.x,z.y-1);else{const le=D.visibleQuadrants;1&le&&(S(O,ae,z.z,de,z.y),ne&&(S(O,V,z.z,z.x,z.y-1),S(O,ae,z.z,de,z.y-1))),2&le&&(S(O,ge,z.z,fe,z.y),ne&&(S(O,V,z.z,z.x,z.y-1),S(O,ge,z.z,fe,z.y-1))),4&le&&(S(O,ae,z.z,de,z.y),Q&&(S(O,V,z.z,z.x,z.y+1),S(O,ae,z.z,de,z.y+1))),8&le&&(S(O,ge,z.z,fe,z.y),Q&&(S(O,V,z.z,z.x,z.y+1),S(O,ge,z.z,fe,z.y+1)))}}const C=[];for(const P of m)m.some(D=>P.isChildOf(D))||C.push(P);if(m=C.filter(P=>!t.some(D=>!!(P.overscaledZ<s&&D.isChildOf(P))||P.equals(D)||P.isChildOf(D))),v){const P=1<<s,D=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),z=[P*D.x,P*D.y],O=4,V=O*O;m=m.filter(N=>{const H=N.canonical.x+.5-z[0],U=N.canonical.y+.5-z[1];return H*H+U*U<V})}return m}coveringTiles(t){let s=this.coveringZoomLevel(t);const h=s,m=this.elevation&&this.elevation.exaggeration(),g=m&&!t.isTerrainDEM,v=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const b=this.locationCoordinate(this.center),S=this.center.lat,C=1<<s,P=[C*b.x,C*b.y,0],D=this.projection.name==="globe",z=!D,O=o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,z),V=D?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),N=C*o.c6(1,this.center.lat),H=this._camera.position[2]/o.c6(1,this.center.lat),U=[C*V.x,C*V.y,H*(z?1:N)],Q=D||m,ne=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ae=this.isLODDisabled(!0)?s:0;let ge;if(this._elevation&&t.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){const ze=this._elevation.getMinMaxForVisibleTiles();ge=ze?ze.max:this._centerAltitude}else ge=this._centerAltitude;const de=t.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?o.co(this):1,le=ze=>{const Ge=new o.ac(ze.x+25e-6,ze.y,ze.z),ot=new o.ac(ze.x,ze.y+25e-6,ze.z),Qe=ze.toLngLat(),st=Ge.toLngLat(),at=ot.toLngLat(),Pt=this.locationCoordinate(Qe),Nt=this.locationCoordinate(st),Ct=this.locationCoordinate(at),jt=Math.hypot(Nt.x-Pt.x,Nt.y-Pt.y),zt=Math.hypot(Ct.x-Pt.x,Ct.y-Pt.y);return Math.sqrt(jt*zt)*fe/25e-6},ye=ze=>{const et=ge,Ge=de;return{aabb:o.cr(this,C,0,0,0,ze,Ge,et,this.projection),zoom:0,x:0,y:0,minZ:Ge,maxZ:et,wrap:ze,fullyVisible:!1}},be=[];let Fe=[];const Le=s,Ke=t.reparseOverscaled?h:s,Xe=(H-this._centerAltitude)*N,dt=ze=>{if(!this._elevation||!ze.tileID||!v)return;const et=this._elevation.getMinMaxForTile(ze.tileID),Ge=ze.aabb;et?(Ge.min[2]=et.min,Ge.max[2]=et.max,Ge.center[2]=(Ge.min[2]+Ge.max[2])/2):(ze.shouldSplit=Be(ze),ze.shouldSplit||(Ge.min[2]=Ge.max[2]=Ge.center[2]=this._centerAltitude))},ke=(ze,et)=>{if(.707*et<ze)return 1;const Ge=et/ze;return Ge/(1.4144271570014144+(Math.pow(1.1,Ge-1.4144271570014144+1)-1)/(1.1-1)-1)},Be=ze=>{if(ze.zoom<ae)return!0;if(ze.zoom===Le)return!1;if(ze.shouldSplit!=null)return ze.shouldSplit;const et=ze.aabb.distanceX(U),Ge=ze.aabb.distanceY(U);let ot=Xe,Qe=1;if(D){ot=ze.aabb.distanceZ(U);const zt=Math.pow(2,ze.zoom),Zt=o.aY((ze.y+1)/zt),si=o.aY(ze.y/zt),Ai=Math.min(Math.max(S,Zt),si),tn=o.cP(Ai)/o.cP(S);if(Qe=Ai===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,tn/this._mercatorScaleRatio),this.zoom<=o.cL&&ze.zoom===Le-1&&tn>=.9)return!0}else if(g&&(ot=ze.aabb.distanceZ(U)*N),this.projection.isReprojectedInTileSpace&&h<=5){const zt=Math.pow(2,ze.zoom),Zt=le(new o.ac((ze.x+.5)/zt,(ze.y+.5)/zt));Qe=Zt>.85?1:Zt}if(!v){const zt=Math.sqrt(et*et+Ge*Ge+ot*ot);let Zt=(1<<Le-ze.zoom)*ne*Qe;return Zt*=ke(Math.max(ot,Xe),zt),zt<Zt}let st=Number.MAX_VALUE,at=0;const Pt=ze.aabb.getCorners(),Nt=[];for(const zt of Pt){o.at(Nt,zt,U),D||(g?Nt[2]*=N:Nt[2]=Xe);const Zt=o.bE(Nt,this._camera.forward());Zt<st&&(st=Zt,at=Math.abs(Nt[2]))}let Ct=(1<<Le-ze.zoom)*ne*Qe;if(Ct*=ke(Math.max(at,Xe),st),st<Ct)return!0;const jt=ze.aabb.closestPoint(P);return jt[0]===P[0]&&jt[1]===P[1]};if(this.renderWorldCopies)for(let ze=1;ze<=3;ze++)be.push(ye(-ze)),be.push(ye(ze));for(be.push(ye(0));be.length>0;){const ze=be.pop(),et=ze.x,Ge=ze.y;let ot=ze.fullyVisible;const Qe=()=>this.projection.name==="globe"&&(ze.y===0||ze.y===(1<<ze.zoom)-1);if(!ot){let st=Q?ze.aabb.intersects(O):ze.aabb.intersectsFlat(O);if(st===0&&Qe()){const at=new o.cp(ze.zoom,et,Ge);st=o.cq(this,C,at,!0).intersects(O)}if(st===0)continue;ot=st===2}if(ze.zoom!==Le&&Be(ze))for(let st=0;st<4;st++){const at=(et<<1)+st%2,Pt=(Ge<<1)+(st>>1),Nt={aabb:v?ze.aabb.quadrant(st):o.cr(this,C,ze.zoom+1,at,Pt,ze.wrap,ze.minZ,ze.maxZ,this.projection),zoom:ze.zoom+1,x:at,y:Pt,wrap:ze.wrap,fullyVisible:ot,tileID:void 0,shouldSplit:void 0,minZ:ze.minZ,maxZ:ze.maxZ};g&&!D&&(Nt.tileID=new o.aM(ze.zoom+1===Le?Ke:ze.zoom+1,ze.wrap,ze.zoom+1,at,Pt),dt(Nt)),be.push(Nt)}else{const st=ze.zoom===Le?Ke:ze.zoom;if(t.minzoom&&t.minzoom>st)continue;let at=0;if(!ot){let jt=Q?ze.aabb.intersectsPrecise(O):ze.aabb.intersectsPreciseFlat(O);if(jt===0&&Qe()){const zt=new o.cp(ze.zoom,et,Ge);jt=o.cq(this,C,zt,!0).intersectsPrecise(O)}if(jt===0)continue;if(t.calculateQuadrantVisibility)if(O.containsPoint(ze.aabb.center))at=15;else for(let zt=0;zt<4;zt++)ze.aabb.quadrant(zt).intersects(O)!==0&&(at|=1<<zt)}const Pt=P[0]-(.5+et+(ze.wrap<<ze.zoom))*(1<<s-ze.zoom),Nt=P[1]-.5-Ge,Ct=ze.tileID?ze.tileID:new o.aM(st,ze.wrap,ze.zoom,et,Ge);t.calculateQuadrantVisibility&&(Ct.visibleQuadrants=at),Fe.push({tileID:Ct,distanceSq:Pt*Pt+Nt*Nt})}}if(this.fogCullDistSq){const ze=this.fogCullDistSq,et=this.horizonLineFromTop();Fe=Fe.filter(Ge=>{const ot=[0,0,0,1],Qe=[o.aj,o.aj,0,1],st=this.calculateFogTileMatrix(Ge.tileID.toUnwrapped());o.aA(ot,ot,st),o.aA(Qe,Qe,st);const at=o.cs([],ot,Qe),Pt=o.ct([],ot,Qe),Nt=o.cM(at,Pt);if(Nt===0)return!0;let Ct=!1;const jt=this._elevation;if(jt&&Nt>ze&&et!==0){const zt=this.calculateProjMatrix(Ge.tileID.toUnwrapped());let Zt;t.isTerrainDEM||(Zt=jt.getMinMaxForTile(Ge.tileID)),Zt||(Zt={min:de,max:ge});const si=o.cu(this.rotation),Ai=[si[0]*o.aj,si[1]*o.aj,Zt.max];o.ad(Ai,Ai,zt),Ct=(1-Ai[1])*this.height*.5<et}return Nt<ze||Ct})}return Fe.sort((ze,et)=>ze.distanceSq-et.distanceSq).map(ze=>ze.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=o.aD(t.lat,-o.cv,o.cv),h=this.projection.project(t.lng,s);return new o.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,s){let h,m;const g=this.centerPoint;if(this.projection.name==="globe"){const b=this.worldSize;h=(s.x-g.x)/b,m=(s.y-g.y)/b}else{const b=this.pointCoordinate(s),S=this.pointCoordinate(g);h=b.x-S.x,m=b.y-S.y}const v=this.locationCoordinate(t);this.setLocation(new o.ac(v.x-h,v.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,s){return this.projection.locationPoint(this,t,s)}locationPoint3D(t,s){return this.projection.locationPoint(this,t,s,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,s){return this.coordinateLocation(this.pointCoordinate3D(t,s))}locationCoordinate(t,s){const h=s?o.c6(s,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new o.ac(m.x,m.y,h)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const h=s??this._centerAltitude,m=[t.x,t.y,0,1],g=[t.x,t.y,1,1];o.aA(m,m,this.pixelMatrixInverse),o.aA(g,g,this.pixelMatrixInverse);const v=g[3];o.cw(m,m,1/m[3]),o.cw(g,g,1/v);const b=m[2],S=g[2];return{p0:m,p1:g,t:b===S?0:(h-b)/(S-b)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return o.aA(s,s,this.pixelMatrixInverse),o.aA(h,h,this.pixelMatrixInverse),o.cw(s,s,1/s[3]),o.cw(h,h,1/h[3]),s[2]=o.c6(s[2],this._center.lat)*this.worldSize,h[2]=o.c6(h[2],this._center.lat)*this.worldSize,o.cw(s,s,1/this.worldSize),o.cw(h,h,1/this.worldSize),new o.av([s[0],s[1],s[2]],o.au([],o.at([],h,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:h,t:m}=t,g=o.c6(s[2],this._center.lat),v=o.c6(h[2],this._center.lat);return new o.ac(o.ai(s[0],h[0],m)/this.worldSize,o.ai(s[1],h[1],m)/this.worldSize,o.ai(g,v,m))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t,s){if(!this.elevation)return this.pointCoordinate(t,s);let h=this.projection.pointCoordinate3D(this,t.x,t.y);if(h)return new o.ac(h[0],h[1],h[2]);let m=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t,s);const v=.02*g,b=t.clone();for(let S=0;S<10&&g-m>v;S++){b.y=o.ai(m,g,.66);const C=this.projection.pointCoordinate3D(this,b.x,b.y);C?(g=b.y,h=C):m=b.y}return h?new o.ac(h[0],h[1],h[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=o.cx)return!this.isPointAboveHorizon(t);const s=this.pointCoordinate(t);return s.y>=0&&s.y<=1}_coordinatePoint(t,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return o.aA(m,m,this.pixelMatrix),m[3]>0?new o.P(m[0]/m[3],m[1]/m[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:s}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,g=this.pointLocation3D(new o.P(s,t)),v=this.pointLocation3D(new o.P(m,t)),b=this.pointLocation3D(new o.P(m,h)),S=this.pointLocation3D(new o.P(s,h));let C=Math.min(g.lng,v.lng,b.lng,S.lng),P=Math.max(g.lng,v.lng,b.lng,S.lng),D=Math.min(g.lat,v.lat,b.lat,S.lat),z=Math.max(g.lat,v.lat,b.lat,S.lat);const O=Math.pow(2,-this.zoom)/16*270,V=this.projection.name==="globe"?1:4,N=(H,U,Q,ne,ae)=>{const ge=(H+Q)/2,de=(U+ne)/2,fe=new o.P(ge,de),{lng:le,lat:ye}=this.pointLocation3D(fe),be=Math.max(0,C-le,D-ye,le-P,ye-z);C=Math.min(C,le),P=Math.max(P,le),D=Math.min(D,ye),z=Math.max(z,ye),(ae<V||be>O)&&(N(H,U,ge,de,ae+1),N(ge,de,Q,ne,ae+1))};if(N(s,t,m,t,1),N(m,t,m,h,1),N(m,h,s,h,1),N(s,h,s,t,1),this.projection.name==="globe"){const[H,U]=o.cy(this);H?(z=90,P=180,C=-180):U&&(D=-90,P=180,C=-180)}return new o.aG(new o.cd(C,D),new o.cd(P,z))}_getBoundsRectangular(t,s){const{top:h,left:m}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=new o.P(m,h),S=new o.P(v,h),C=new o.P(v,g),P=new o.P(m,g);let D=this.pointCoordinate(b,t),z=this.pointCoordinate(S,t);const O=this.pointCoordinate(C,s),V=this.pointCoordinate(P,s),N=(H,U)=>(U.y-H.y)/(U.x-H.x);return D.y>1&&z.y>=0?D=new o.ac((1-V.y)/N(V,D)+V.x,1):D.y<0&&z.y<=1&&(D=new o.ac(-V.y/N(V,D)+V.x,0)),z.y>1&&D.y>=0?z=new o.ac((1-O.y)/N(O,z)+O.x,1):z.y<0&&D.y<=1&&(z=new o.ac(-O.y/N(O,z)+O.x,0)),new o.aG().extend(this.coordinateLocation(D)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(O))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=t.visibleDemTiles.reduce((h,m)=>{if(m.dem){const g=m.dem.tree;h.min=Math.min(h.min,g.minimums[0]),h.max=Math.max(h.max,g.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-o.cv,this.maxLat=o.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.ay(this.minLng)*this.tileSize,this.worldMaxX=o.ay(this.maxLng)*this.tileSize,this.worldMinY=o.aH(this.maxLat)*this.tileSize,this.worldMaxY=o.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,h=this._distanceTileDataCache;if(h[s])return h[s];const m=t.canonical,g=1/this.height,v=this.cameraWorldSize,b=v/this.zoomScale(m.z),S=(m.x+Math.pow(2,m.z)*t.wrap)*b,C=m.y*b,P=this.point;P.x*=v/this.worldSize,P.y*=v/this.worldSize;const D=this.angle,z=Math.sin(-D),O=-Math.cos(-D);return h[s]={bearing:[z,O],center:[(P.x-S)*g,(P.y-C)*g],scale:b/o.aj*g},h[s]}calculateFogTileMatrix(t){const s=t.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return o.az(m,this.worldToFogMatrix,m),h[s]=new Float32Array(m),h[s]}calculateProjMatrix(t,s=!1,h=!1){const m=t.key;let g;if(g=h?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,g[m])return g[m];const v=this.calculatePosMatrix(t,this.worldSize);let b;return b=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,o.az(v,b,v),g[m]=new Float32Array(v),g[m]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const m=o.cz(t,this);return h[s]=m,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,s=o.bn([],[t,t,t]);return o.az(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const s=o.c6(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=this._camera.forward(),g=o.c6(1,this._center.lat);h[2]/=g,m[2]/=g,o.au(m,m);const v=t.raycast(h,m,t.exaggeration());if(v){const b=o.bF([],h,m,v),S=new o.ac(b[0],b[1],o.c6(b[2],o.aY(b[1]))),C=(S.z+o.ae([S.x-h[0],S.y-h[1],S.z-h[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(C),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const s=this._elevation,h=o.c6(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(h),g=s.getAtPointOrZero(new o.ac(...m)),v=this.pixelsPerMeter/this.worldSize*g,b=this._minimumHeightOverTerrain(),S=m[2]-v;if(S<=b)if(S<0||t){const C=this.locationCoordinate(this._center,this._centerAltitude),P=[m[0],m[1],C.z-m[2]],D=o.ae(P);P[2]-=(b-S)/this._pixelsPerMercatorPixel;const z=o.ae(P);if(z===0)return;o.b$(P,P,D/z*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],C.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const z=this.center;return z.lat=o.aD(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(z.lng=o.aD(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}const s=this._unmodified,{x:h,y:m}=this.point;let g=0,v=h,b=m;const S=this.width/2,C=this.height/2,P=this.worldMinY*this.scale,D=this.worldMaxY*this.scale;if(m-C<P&&(b=P+C),m+C>D&&(b=D-C),D-P<this.height&&(g=Math.max(g,this.height/(D-P)),b=(D+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const z=this.worldMinX*this.scale,O=this.worldMaxX*this.scale,V=this.worldSize/2-(z+O)/2;v=(h+V+this.worldSize)%this.worldSize-V,v-S<z&&(v=z+S),v+S>O&&(v=O-S),O-z<this.width&&(g=Math.max(g,this.width/(O-z)),v=(O+z)/2)}v===h&&b===m||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(v,b))),g&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(g)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.c6(1,this.center.lat)/o.c6(1,o.cN));const m=o.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?h:1,v=this._camera.getWorldToCamera(this.worldSize,g);let b;const S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(S[8]=2*-t.x/this.width,S[9]=2*t.y/this.height,this.isOrthographic){let ye=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),be=ye*this.aspect,Fe=-be,Le=-ye;be-=t.x,Fe-=t.x,ye+=t.y,Le+=t.y,b=this._camera.getCameraToClipOrthographic(Fe,be,Le,ye,this._nearZ,this._farZ),((Ke,Xe,dt,ke)=>{for(let Be=0;Be<16;Be++)Ke[Be]=o.ai(Xe[Be],dt[Be],ke)})(b,b,S,o.cO(this.pitch>=Fa?1:this.pitch/Fa))}else b=S;const C=o.cB([],S,v);let P=o.cB([],b,v);if(this.projection.isReprojectedInTileSpace){const ye=this.locationCoordinate(this.center),be=o.bx([]);o.bo(be,be,[ye.x*this.worldSize,ye.y*this.worldSize,0]),o.az(be,be,o.cC(this)),o.bo(be,be,[-ye.x*this.worldSize,-ye.y*this.worldSize,0]),o.az(P,P,be),o.az(C,C,be),this.inverseAdjustmentMatrix=o.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cE([],P,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=P,this.invProjMatrix=o.bi(new Float64Array(16),this.projMatrix),s){const ye=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ye[8]=2*-t.x/this.width,ye[9]=2*t.y/this.height,this.expandedFarZProjMatrix=o.cB([],ye,v)}else this.expandedFarZProjMatrix=this.projMatrix;const D=o.bi([],b);this.frustumCorners=o.cF.fromInvProjectionMatrix(D,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const z=new Float32Array(16);o.bx(z),o.cE(z,z,[1,-1,1]),o.cG(z,z,this._pitch),o.by(z,z,this.angle);const O=o.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bw(O);const V=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;O[8]=2*-t.x/this.width,O[9]=2*(t.y+V)/this.height,this.skyboxMatrix=o.az(z,O,z);const N=this.point,H=N.x,U=N.y,Q=this.width%2/2,ne=this.height%2/2,ae=Math.cos(this.angle),ge=Math.sin(this.angle),de=H-Math.round(H)+ae*Q+ge*ne,fe=U-Math.round(U)+ae*ne+ge*Q,le=new Float64Array(P);if(o.bo(le,le,[de>.5?de-1:de,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=le,P=o.bz(),o.cE(P,P,[this.width/2,-this.height/2,1]),o.bo(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=o.bz(),o.cE(P,P,[1,-1,1]),o.bo(P,P,[-1,-1,0]),o.cE(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=o.az(new Float64Array(16),this.labelPlaneMatrix,C),this._calcFogMatrices(),this._distanceTileDataCache={},P=o.bi(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cH(this);const ye=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.ad(ye,ye,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,h=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,g=[t,t,s];o.b$(g,g,m),o.b$(h,h,-1),o.cI(h,h,g);const v=o.bz();o.bo(v,v,h),o.cE(v,v,g),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,m)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),m=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-h[0]*g,m.y/this.worldSize-h[1]*g,t/this.worldSize*this._centerAltitude-h[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],m=t[2];let g=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(g=Math.min((s-h)/m,1)),this._camera.position=o.bF([],this._camera.position,t,g),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:m}=this._camera.getPitchBearing(),g=o.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.al(this._maxPitch)),b=Math.max((t[2]-g)/Math.cos(h),v),S=this._zoomFromMercatorZ(b);o.bF(t,t,s,b),this._pitch=o.aD(h,o.al(this.minPitch),o.al(this.maxPitch)),this.angle=o.bX(m,-Math.PI,Math.PI),this._setZoom(o.aD(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let s=0,h=o.cx,m=0,g=1/0;for(;h-s>1e-6&&h>s;){const v=s+.5*(h-s),b=this.tileSize*Math.pow(2,v),S=this.getCameraToCenterDistance(this.projection,v,b),C=this.scaleZoom(S/(t*this.tileSize)),P=Math.abs(v-C);P<g&&(g=P,m=v),v<C?s=v:h=v}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){const h=Math.min(t.x,s.x),m=Math.max(t.x,s.x),g=Math.min(t.y,s.y),v=Math.max(t.y,s.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const b=[new o.P(h,g),new o.P(m,v),new o.P(h,v),new o.P(m,g)],S=this.renderWorldCopies?-3:0,C=this.renderWorldCopies?4:1;for(const P of b){const D=this.pointRayIntersection(P);if(D.t<0)return!0;const z=this.rayIntersectionCoordinate(D);if(z.x<S||z.y<0||z.x>C||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(t,s){const h=o.ae(o.at([],this._camera.position,t)),m=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([s,h,m],g){const v=[s,h,m,1];o.aA(v,v,g);const b=v[3]=Math.max(v[3],1e-6);return v[0]/=b,v[1]/=b,v[2]/=b,v}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,t))}}getCameraToCenterDistance(t,s=this.zoom,h=this.worldSize){const m=o.cA(t,s,this.width,this.height,1024),g=t.pixelSpaceConversion(this.center.lat,h,m);let v=.5/Math.tan(.5*this._fov)*this.height*g;return this.isOrthographic&&(v=o.ai(1,v,o.cO(this.pitch>=Fa?1:this.pitch/Fa))),v}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.az(t,t,this.globeMatrix),t}getFrustum(t){return o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const wl=(u,t)=>{if(t>0&&u.terrain&&o.w("Cutoff is currently disabled on terrain"),t<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=u.transform,h=Math.max(Math.abs(s._zoom-(u.minCutoffZoom-1)),1),m=s.isLODDisabled(!1)?o.af(60,45,s.pitch):o.af(30,15,s.pitch),g=s._farZ-s._nearZ,v=t*s.height,b=((1-(S=m))*s.cameraToCenterDistance+S*(s._farZ+v))*h;var S;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(b-s._nearZ)/g,(b-v-s._nearZ)/g]}}},ao={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Vu{constructor(t,s){this.aabb=t,this.lastCascade=s}}class Uu{add(t,s){const h=this.receivers[t.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],s.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],s.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],s.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],s.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],s.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],s.max[2])):this.receivers[t.key]=new Vu(s,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,s,h){const m=o.cV.fromPoints(t.points);let g=0;for(const v in this.receivers){const b=this.receivers[v];if(!b||!m.intersectsAabb(b.aabb))continue;b.aabb.min=m.closestPoint(b.aabb.min),b.aabb.max=m.closestPoint(b.aabb.max);const S=b.aabb.getCorners();for(let C=0;C<h.length;C++){let P=!0;for(const D of S){const z=[D[0]*s,D[1]*s,D[2]];if(o.ad(z,z,h[C].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){P=!1;break}}if(b.lastCascade=C,g=Math.max(g,C),P)break}}return g+1}}class nx{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Uu,this._depthMode=new Rt(t.context.gl.LEQUAL,Rt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(ao,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(ao,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(ao,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,s){const h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const m=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||m<=0||(this._shadowLayerCount=h.style.order.reduce((V,N)=>{const H=h.style._mergedLayers[N];return V+(H.hasShadowPass()&&!H.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const g=h.context,v=ao.shadowMapResolution,b=ao.shadowMapResolution;if(this._cascades.length===0||ao.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let V=0;V<ao.cascadeCount;++V){const N=h._shadowMapDebug,H=g.gl,U=g.createFramebuffer(v,b,N,"texture"),Q=new o.T(g,{width:v,height:b,data:null},H.DEPTH_COMPONENT16);if(U.depthAttachment.set(Q.texture),N){const ne=new o.T(g,{width:v,height:b,data:null},H.RGBA8);U.colorAttachment.set(ne.texture)}this._cascades.push({framebuffer:U,texture:Q,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cn,scale:0})}}this.shadowDirection=vp(s);let S=0;if(t.elevation){const V=t.elevation,N=[1e4,-1e4];V.visibleDemTiles.filter(H=>H.dem).forEach(H=>{const U=H.dem.tree;N[0]=Math.min(N[0],U.minimums[0]),N[1]=Math.max(N[1],U.maximums[0])}),N[0]!==1e4&&(S=(N[1]-N[0])*V.exaggeration())}const C=1.5*t.cameraToCenterDistance,P=3*C,D=new Float64Array(16);for(let V=0;V<this._cascades.length;++V){const N=this._cascades[V];let H=t.height/50,U=1;ao.cascadeCount===1?U=P:V===0?U=C:(H=C,U=P);const[Q,ne]=xp(t,this.shadowDirection,H,U,ao.shadowMapResolution,S);N.scale=t.scale,N.matrix=Q,N.boundingSphereRadius=ne,o.bi(D,N.matrix),N.frustum=o.cn.fromInvProjectionMatrix(D,1,0,!0),N.far=U}const z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ao.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ao.shadowMapResolution,this._uniformValues.u_shadowmap_0=so.ShadowMap0,this._uniformValues.u_shadowmap_1=so.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const O=h.transform.elevation;for(const V of this._groundShadowTiles){let N={min:0,max:0};if(O){const H=O.getMinMaxForTile(V);H&&(N=H)}this.addShadowReceiver(V.toUnwrapped(),N.min,N.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,s){if(!this.enabled)return;const h=this.painter,m=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),m.viewport.set([0,0,ao.shadowMapResolution,ao.shadowMapResolution]);for(let g=0;g<this._numCascadesToRender;++g){h.currentShadowCascade=g,m.bindFramebuffer.set(this._cascades[g].framebuffer.framebuffer),m.clear({color:o.am.white,depth:1});for(const v of t.order){const b=t._mergedLayers[v];if(!b.hasShadowPass()||b.isHidden(h.transform.zoom))continue;const S=t.getLayerSourceCache(b),C=S?s[S.id]:void 0;(b.type==="model"||C&&C.length)&&h.renderLayer(h,S,b,C)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,s=t.style,h=t.context,m=s.directionalLight,g=s.ambientLight;if(!m||!g)return;const v=[],b=wl(t,t.longestCutoffRange);b.shouldRenderCutoff&&v.push("RENDER_CUTOFF"),v.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&v.push("NORMAL_OFFSET");const S=js(s,m,g),C=new Rt(h.gl.LEQUAL,Rt.ReadOnly,t.depthRangeFor3D);for(const P of this._groundShadowTiles){const D=P.toUnwrapped(),z=t.isTileAffectedByFog(P),O=t.getOrCreateProgram("groundShadow",{defines:v,overrideFog:z});this.setupShadows(D,O),t.uploadCommonUniforms(h,O,D,null,b);const V={u_matrix:t.transform.calculateProjMatrix(D),u_ground_shadow_factor:S};O.draw(t,h.gl.TRIANGLES,C,Qt.disabled,bi.multiply,Jt.disabled,V,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?bi.unblended:bi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const s=this.painter.transform,h=s.calculatePosMatrix(t,s.worldSize);return o.az(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(t){return o.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,s,h,m=0){if(!this.enabled)return;const g=this.painter.transform,v=this.painter.context,b=v.gl,S=this._uniformValues,C=new Float64Array(16),P=g.calculatePosMatrix(t,g.worldSize);for(let D=0;D<this._cascades.length;D++)o.az(C,this._cascades[D].matrix,P),S[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),v.activeTexture.set(b.TEXTURE0+so.ShadowMap0+D),this._cascades[D].texture.bind(b.NEAREST,b.CLAMP_TO_EDGE);if(this.useNormalOffset=!!h,this.useNormalOffset){const D=o.cT(t.canonical),z=2/g.tileSize*o.aj/ao.shadowMapResolution,O=z*this._cascades[0].boundingSphereRadius,V=z*this._cascades[this._cascades.length-1].boundingSphereRadius,N=(h==="vector-tile"?1:3)/Math.pow(2,m-t.canonical.z-(1-g.zoom+Math.floor(g.zoom)));S.u_shadow_normal_offset=[D,O*N,V*N],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(v,S)}setupShadowsFromMatrix(t,s,h=!1){if(!this.enabled)return;const m=this.painter.context,g=m.gl,v=this._uniformValues,b=new Float64Array(16);for(let S=0;S<ao.cascadeCount;S++)o.az(b,this._cascades[S].matrix,t),v[S===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(b),m.activeTexture.set(g.TEXTURE0+so.ShadowMap0+S),this._cascades[S].texture.bind(g.NEAREST,g.CLAMP_TO_EDGE);if(this.useNormalOffset=h,h){const S=ao.normalOffset;v.u_shadow_normal_offset=[1,S,S],v.u_shadow_bias=[6e-5,.0012,.012]}else v.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(m,v)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,s,h,m){if(m[2]>=0)return{};const g=function(S,C,P){const D=P/(1<<S.canonical.z);return new o.cV([S.canonical.x*D+S.wrap*P,S.canonical.y*D+S.wrap*P,0],[(S.canonical.x+1)*D+S.wrap*P,(S.canonical.y+1)*D+S.wrap*P,C])}(t,s,h).getCorners(),v=s/-m[2];m[0]<0?(o.cU(g[0],g[0],[m[0]*v,0,0]),o.cU(g[3],g[3],[m[0]*v,0,0])):m[0]>0&&(o.cU(g[1],g[1],[m[0]*v,0,0]),o.cU(g[2],g[2],[m[0]*v,0,0])),m[1]<0?(o.cU(g[0],g[0],[0,m[1]*v,0]),o.cU(g[1],g[1],[0,m[1]*v,0])):m[1]>0&&(o.cU(g[2],g[2],[0,m[1]*v,0]),o.cU(g[3],g[3],[0,m[1]*v,0]));const b={};return b.vertices=g,b.planes=[ca(g[1],g[0],g[4]),ca(g[2],g[1],g[5]),ca(g[3],g[2],g[6]),ca(g[0],g[3],g[7])],b}addShadowReceiver(t,s,h){this._receivers.add(t,o.cV.fromTileIdAndHeight(t,s,h))}getMaxCascadeForTile(t){const s=this._receivers.get(t);return s&&s.lastCascade?s.lastCascade:0}}function ca(u,t,s){const h=o.at([],s,t),m=o.at([],u,t),g=o.bG([],h,m),v=o.ae(g);return v===0?[0,0,1,0]:(o.b$(g,g,1/v),[g[0],g[1],g[2],-o.bE(g,t)])}function vp(u){const t=u.properties.get("direction"),s=o.cR(t.x,t.y,t.z);s[2]=o.aD(s[2],0,75);const h=o.cW([s[0],s[1],s[2]]);return o.cS(h.x,h.y,h.z)}function js(u,t,s){const h=t.properties.get("color-use-theme")==="none",m=t.properties.get("color"),g=t.properties.get("intensity"),v=t.properties.get("direction"),b=[v.x,v.y,v.z],S=s.properties.get("color-use-theme")==="none",C=s.properties.get("color"),P=s.properties.get("intensity"),D=Math.max(o.bE([0,0,1],b),0),z=[0,0,0];o.b$(z,C.toRenderColor(S?null:u.getLut(t.scope)).toArray01Linear().slice(0,3),P);const O=[0,0,0];return o.b$(O,m.toRenderColor(h?null:u.getLut(s.scope)).toArray01Linear().slice(0,3),D*g),o.cX([z[0]>0?z[0]/(z[0]+O[0]):0,z[1]>0?z[1]/(z[1]+O[1]):0,z[2]>0?z[2]/(z[2]+O[2]):0])}function xp(u,t,s,h,m,g){const v=u.zoom,b=u.scale,S=u.worldSize,C=1/S,P=u.aspect,D=Math.sqrt(1+P*P)*Math.tan(.5*u.fovX),z=D*D,O=h-s,V=h+s;let N,H;z>O/V?(N=h,H=h*D):(N=.5*V*(1+z),H=.5*Math.sqrt(O*O+2*(h*h+s*s)*z+V*V*z*z));const U=u.projection.pixelsPerMeter(u.center.lat,S),Q=u._camera.getCameraToWorldMercator(),ne=[0,0,-N*C];o.ad(ne,ne,Q);let ae=H*C;const ge=u._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){const ot=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?U:1),Qe=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,s,h);Qe[8]=2*-u.centerOffset.x/u.width,Qe[9]=2*u.centerOffset.y/u.height;const st=new Float64Array(16);o.cB(st,Qe,ot);const at=new Float64Array(16);o.bi(at,st);const Pt=o.cn.fromInvProjectionMatrix(at,S,v,!0);for(const Nt of Pt.points){const Ct=((de=Nt)[0]/=b,de[1]/=b,de[2]=o.c6(de[2],u._center.lat),de);ae=Math.max(ae,o.c0(o.cY([],ne,Ct)))}}var de;ae*=m/(m-1);const fe=Math.acos(t[2]),le=Math.atan2(-t[0],-t[1]),ye=new Xr;ye.position=ne,ye.setPitchBearing(fe,le);const be=ye.getWorldToCamera(S,U),Fe=ae*S,Le=Math.min(u._mercatorZfromZoom(17)*S*-2,-2*Fe),Ke=ye.getCameraToClipOrthographic(-Fe,Fe,-Fe,Fe,Le,(Fe+g*U)/t[2]),Xe=new Float64Array(16);o.az(Xe,Ke,be);const dt=o.cS(Math.floor(1e6*ne[0])/1e6*S,Math.floor(1e6*ne[1])/1e6*S,0),ke=.5*m,Be=[0,0,0];o.ad(Be,dt,Xe),o.b$(Be,Be,ke);const ze=[Math.floor(Be[0]),Math.floor(Be[1]),Math.floor(Be[2])],et=[0,0,0];o.at(et,Be,ze),o.b$(et,et,-1/ke);const Ge=new Float64Array(16);return o.bx(Ge),o.bo(Ge,Ge,et),o.az(Xe,Ge,Xe),[Xe,Fe]}class Ba extends o.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,s){return o.aS(this.requestManager.transformRequest(s,o.R.Model).url).then(h=>{if(!h)return;const m=o.aT(h),g=new o.aU(t,void 0,void 0,m);return g.computeBoundsAndApplyParent(),g}).catch(h=>{if(h&&h.status===404)return null;this.fire(new o.z(new Error(`Could not load model ${t} from ${s}: ${h.message}`)))})}load(t,s,h={forceReload:!1}){this.models[s]||(this.models[s]={});const m=Object.keys(t),g=[],v=[];for(const b of m){const S=t[b];this.hasURLBeenRequested(S)&&!h.forceReload||(this.modelByURL[S]={modelId:b,scope:s},g.push(this.loadModel(b,S)),v.push(b)),this.models[s][b]||(this.models[s][b]={model:null,numReferences:1})}this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+v.length,Promise.allSettled(g).then(b=>{for(let S=0;S<b.length;S++){const{status:C}=b[S];if(C==="rejected")continue;const{value:P}=b[S];this.models[s][v[S]]||(this.models[s][v[S]]={model:null,numReferences:1}),this.models[s][v[S]].model=P}this.numModelsLoading[s]-=v.length,this.fire(new o.A("data",{dataType:"style"}))}).catch(b=>{this.fire(new o.z(new Error(`Could not load models: ${b.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,s,h={exactIdMatch:!1}){return!!(h.exactIdMatch?this.getModel(t,s):this.getModelByURL(this.modelUris[s][t]))}getModel(t,s){return this.models[s]||(this.models[s]={}),this.models[s][t]?this.models[s][t].model:void 0}getModelByURL(t){if(!t)return null;const s=this.modelByURL[t];return s?this.models[s.scope][s.modelId].model:null}hasModelBeenAdded(t,s){return this.models[s]&&this.models[s][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,s,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const m=this.requestManager.normalizeModelURL(s);if((this.hasModel(t,h,{exactIdMatch:!0})||this.hasModelBeenAdded(t,h))&&this.modelUris[h][t]===m)this.models[h][t].numReferences++;else if(this.hasURLBeenRequested(m)){const{scope:g,modelId:v}=this.modelByURL[m];this.models[g][v].numReferences++}else this.modelUris[h][t]=m,this.load({[t]:this.modelUris[h][t]},h)}addModelURLs(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const h=this.modelUris[s];for(const m in t)h[m]=this.requestManager.normalizeModelURL(t[m])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const h={};for(const m of t)this.hasModel(m,s,{exactIdMatch:!0})||this.hasURLBeenRequested(m)?this.models[s][m].numReferences++:this.modelUris[s][m]&&!this.hasURLBeenRequested(m)?h[m]=this.modelUris[s][m]:!this.hasURLBeenRequested(m)&&o.cZ(m,!1)&&(this.modelUris[s][m]=this.requestManager.normalizeModelURL(m),h[m]=this.modelUris[s][m]);this.load(h,s)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,s,h=!1){if(this.models[s]&&this.models[s][t]&&(this.models[s][t].numReferences--,this.models[s][t].numReferences===0)){const m=this.modelUris[s][t];h||delete this.modelUris[s][t],delete this.modelByURL[m];const g=this.models[s][t].model;if(!g)return;delete this.models[s][t],g.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const s of Object.keys(this.models[t])){const h=this.models[t][s].model;delete this.models[t][s],h&&h.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,s){this.models[s]||(this.models[s]={});for(const h in this.models[s])this.models[s][h].model&&this.models[s][h].model.upload(t.context)}}const rx=new o.a7({data:new o.a8(o.a5.colorTheme.data)}),ox={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function m_(u){return u=u||{},Object.assign(u,ox)}class g_ extends o.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},o.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new o.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(v,b){const[S,C]=v,{center:P,radius:D}=b,[z,O]=P,V=Math.abs(S-z);return Math.sqrt((V>180?360-V:V)**2+(C-O)**2)<=D}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new o.A("floorplangone")));const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=new o.P(this._map.transform.width/2,this._map.transform.height/2),m=[new o.P(0,0),new o.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(t?m:h,s);g.length>0&&(this._selectedFloorplan&&g[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=g[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(g){const[[v,b],[S,C]]=g,P=(S-v+360)%360,D=P>180?360-P:P;return{center:[(v+D/2+360)%360,(b+C)/2],radius:Math.sqrt(D**2+(C-b)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const s=this._floorplanStates[this._indoorData.id].selectedBuilding,h=this._floorplanStates[this._indoorData.id].selectedLevel;let m;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const g of this._indoorData.levels)g.id===this._selectedLevel.id&&(m=g.id);if(this.fire(new o.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:m})),s){const g=this._indoorData.buildings.find(v=>v.id===s);this._buildingSelected(g,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(h){const g=this._indoorData.levels.find(v=>v.id===h);this._updateLevels(g,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,s){s&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const h=this._indoorData.levels.filter(m=>t.levels.includes(m.id));this.fire(new o.A("buildingselected",{buildingId:t.id,levels:h}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const s=this._indoorData.levels.find(h=>h.id===t);this._updateLevels(s,!0)}this.fire(new o.A("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,s){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(s&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function h(C){const P=C.indexOf("/floor/");if(P===-1)return C;const D=P+7,z=C.indexOf("/",D);return z===-1?C.slice(D):C.slice(D,z)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const m=[],g={},v={},b={},S={};for(const C of this._indoorData.levels)if(m.push(C.id),g[C.id]=C.height,v[C.id]=C.base,t){if(this.mergeFloors){const P=h(t.id),D=h(C.id);b[C.id]=D===P?"true":"false"}else b[C.id]=C.id===t.id?"true":"false";S[C.id]=C.base<t.base?"true":"false"}else S[C.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",m]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",S]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),s&&t.extent)){const C=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),P=this._map.getZoom(),D=C.zoom?Math.abs(P-C.zoom):0;this._map.fitBounds(t.extent,D>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:P})}}selectFloorplan(t){const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=[new o.P(0,0),new o.P(this._map.transform.width,this._map.transform.height)],m=this._map.queryRenderedFeatures(h,s);if(m.length>0){for(const g of m)if(JSON.parse(g.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=g,this._floorplanSelected(!0);break}}}selectBuilding(t){const s=this._indoorData.buildings.find(h=>h.id===t);this._buildingSelected(s,!0)}selectLevel(t){this._levelSelected(t)}}function sx(u){if(!u.metadata||!u.metadata.content_area)return;const t=o.q.devicePixelRatio,{left:s,top:h,width:m,height:g}=u.metadata.content_area,v=s*t,b=h*t;return[v,b,v+m*t,b+g*t]}function ud(u){if(u)return u.map(([t,s])=>[t*o.q.devicePixelRatio,s*o.q.devicePixelRatio])}class __{constructor(t,s,h){this.id=t,this.scope=s,this.sourceCache=h,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const s=this.sourceCache.getVisibleCoordinates();if(s.length===0)return t;const h=this.sourceCache.getSource();if(!(h instanceof fl))return t;const m=s.map(v=>this.sourceCache.getTile(v)),g=h.getImages(m,Array.from(this.pendingRequests));for(const[v,b]of g)t.set(o.I.from({name:v,iconsetId:this.id}),b),this.pendingRequests.delete(v);for(const v of this.pendingRequests)this.missingRequests.add(v);return this.pendingRequests.clear(),t}}const Na=(u,t)=>Me(u,t&&t.filter(s=>s.identifier!=="source.canvas")),y_=o.aF(Ni,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),v_=o.aF(Ni,["setCenter","setZoom","setBearing","setPitch"]),ua=new Set(["background","sky","slot","custom"]),Gu={version:8,layers:[],sources:{}},bp={duration:300,delay:0};class es extends o.E{constructor(t,s={}){super(),this.map=t,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=o.l({},bp),this._buildingIndex=new a_(this),this.crossTileSymbolIndex=new mr,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new Tn,this.dispatcher=s.dispatcher?s.dispatcher:new o.D(o.d0(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Wo(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new o.d1(t._requestManager,s.localFontFamily?o.d2.all:s.localIdeographFontFamily?o.d2.ideographs:o.d2.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new Ba(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",o.d3());const h=this;this._rtlTextPluginCallback=es.registerForPluginStateChange(m=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(g,v)=>{if(o.d4(g),v&&v.every(b=>b))for(const b in h._sourceCaches){const S=h._sourceCaches[b],C=S.getSource().type;C!=="vector"&&C!=="geojson"||S.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.getOwnSource(m.sourceId);if(g&&g.vectorLayerIds)for(const v in this._layers){const b=this._layers[v];b.source===g.id&&this._validateLayer(b)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(o.f(t))return t;const s=o.d5(t);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${o.d6(JSON.stringify(t))}`}_diffStyle(t,s,h){this.globalId=this._getGlobalId(t);const m=(g,v)=>{try{v(null,this.setState(g,h))}catch(b){v(b,!1)}};if(typeof t=="string"){const g=this.map._requestManager.normalizeStyleURL(t),v=this.map._requestManager.transformRequest(g,o.R.Style);o.n(v,(b,S)=>{b?this.fire(new o.z(b)):S&&m(S,s)})}else typeof t=="object"&&m(t,s)}loadURL(t,s={}){this.fire(new o.A("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!o.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,s.accessToken),this.resolvedImports.add(t);const m=this.importsCache.get(t);if(m)return this._load(m,h);const g=this.map._requestManager.transformRequest(t,o.R.Style);this._request=o.n(g,(v,b)=>{if(this._request=null,v)this.fire(new o.z(v));else if(b)return this.importsCache.set(t,b),this._load(b,h)})}loadJSON(t,s={}){this.fire(new o.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=o.q.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new o.A("dataloading",{dataType:"style"})),this._load(Gu,!1)}_loadImports(t,s,h){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const g of t){const v=this._createFragmentStyle(g),b=new Promise(P=>{v.once("style.import.load",P),v.once("error",P)}).then(()=>this.mergeAll());if(m.push(b),this.resolvedImports.has(g.url)){v.loadEmpty();continue}const S=g.data||this.importsCache.get(g.url);S?(v.loadJSON(S,{validate:s}),this._isInternalStyle(S)&&(v.globalId=null)):g.url?v.loadURL(g.url,{validate:s}):v.loadEmpty();const C={style:v,id:g.id,config:g.config};if(h){const P=this.fragments.findIndex(({id:D})=>D===h);this.fragments=this.fragments.slice(0,P).concat(C).concat(this.fragments.slice(P))}else this.fragments.push(C)}return Promise.allSettled(m)}getImportGlobalIds(t=this,s=new Set){for(const h of t.fragments)h.style.globalId&&s.add(h.style.globalId),this.getImportGlobalIds(h.style,s);return[...s.values()]}_createFragmentStyle(t){const s=this.scope?o.C(t.id,this.scope):t.id;let h;const m=this._initialConfig&&this._initialConfig[s];(t.config||m)&&(h=o.l({},t.config,m));const g=new es(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:h,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return g.setEventedParent(this.map,{style:g}),g}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,s){const h=t.indoor?m_(t.schema):t.schema;if(this._isInternalStyle(t)){const v=o.l({},Gu,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(v,s)}if(this.updateConfig(this._config,h),s&&Na(this,ur(t)))return;this._loaded=!0,this.stylesheet=o.d7(t);const m=()=>{for(const C in t.sources)this.addSource(C,t.sources[C],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const C in t.iconsets)this.addIconset(C,t.iconsets[C]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const v=id(this.stylesheet.layers);if(this._order=v.map(C=>C.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const C=this.stylesheet.lights[0];this.light=new Ve(C.properties,C.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ve(this.stylesheet.light)),this._layers={};for(const C of v){const P=o.dc(C,this.scope,this._styleColorTheme.lut,this.options);P.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P;const D=this.getOwnLayerSourceCache(P),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&P.canCastShadows()&&z&&(D.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const b=this.stylesheet.terrain;b&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(b,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.A("data",{dataType:"style"}));const S=this.isRootStyle();t.imports?this._loadImports(t.imports,s).then(()=>{this._reloadImports(),this.fire(new o.A(S?"style.load":"style.import.load"))}).catch(C=>{this.fire(new o.z(new Error("Failed to load imports",C))),this.fire(new o.A(S?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.A(S?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(g){const v=this._evaluateColorThemeData(g);this._loadColorTheme(v).then(()=>{m()}).catch(b=>{o.w(`Couldn't load color theme from the stylesheet: ${b}`),m()})}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,s,h,m,g,v,b,S,C,P;const D={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(z=>{if(z.stylesheet){if(z.light!=null&&(t=z.light),z.stylesheet.lights)for(const O of z.stylesheet.lights)O.type==="ambient"&&z.ambientLight!=null&&(s=z.ambientLight),O.type==="directional"&&z.directionalLight!=null&&(h=z.directionalLight);m=this._prioritizeTerrain(m,z.terrain,z.stylesheet.terrain),z.stylesheet.fog&&z.fog!=null&&(g=z.fog),z.stylesheet.snow&&z.snow!=null&&(v=z.snow),z.stylesheet.rain&&z.rain!=null&&(b=z.rain),z.stylesheet.camera!=null&&(P=z.stylesheet.camera),z.stylesheet.projection!=null&&(S=z.stylesheet.projection),z.stylesheet.transition!=null&&(C=z.stylesheet.transition),D[z.scope]=z._styleColorTheme}}),this.light=t,this.ambientLight=s,this.directionalLight=h,this.fog=g,this.snow=v,this.rain=b,this._styleColorThemeForScope=D,m===null?delete this.terrain:this.terrain=m,this.camera=P||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=o.l({},bp,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const s=h=>{for(const m of h.fragments)s(m.style);t(h)};s(this)}_prioritizeTerrain(t,s,h){const m=t&&t.drapeRenderMode===0;return h===null?s&&s.drapeRenderMode===0?s:m?t:null:s!=null&&(!t||m||s&&s.drapeRenderMode===1)?s:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{t=this._prioritizeTerrain(t,s.terrain,s.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(t=s.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},s={},h={};this.forEachFragmentStyle(m=>{for(const g in m._sourceCaches){const v=o.C(g,m.scope);t[v]=m._sourceCaches[g]}for(const g in m._otherSourceCaches){const v=o.C(g,m.scope);s[v]=m._otherSourceCaches[g]}for(const g in m._symbolSourceCaches){const v=o.C(g,m.scope);h[v]=m._symbolSourceCaches[g]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=h}mergeLayers(){const t={},s=[],h={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(g=>{for(const v of g._order){const b=g._layers[v];if(b.type==="slot"){const S=o.d8(v);if(t[S])continue;t[S]=[]}b.slot&&t[b.slot]?t[b.slot].push(b):s.push(b)}}),this._mergedOrder=[];const m=(g=[])=>{for(const v of g)if(v.type==="slot"){const b=o.d8(v.id);t[b]&&m(t[b]),this._mergedSlots.push(b)}else{const b=o.C(v.id,v.scope);this._mergedOrder.push(b),h[b]=v,v.is3D(!!this.terrain)&&(this._has3DLayers=!0),v.type==="circle"&&(this._hasCircleLayers=!0),v.type==="symbol"&&(this._hasSymbolLayers=!0),v.type==="clip"&&(this._clipLayerPresent=!0)}};m(s),this._mergedOrder.sort((g,v)=>{const b=h[g],S=h[v];return b.hasInitialOcclusionOpacityProperties?S.is3D(!!this.terrain)?1:0:b.is3D(!!this.terrain)&&S.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=o.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(s,h,m){const g=o.l({},h);for(const b of Object.keys(o.a5.colorTheme))g[b]===void 0&&(g[b]=o.a5.colorTheme[b].default);const v=new o.a6(rx,s,new Map(m));return v.setTransitionOrValue(g,m),v.untransitioned().possiblyEvaluate(new o.aa(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((h,m)=>{const g="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();let v=t;v.startsWith(g)||(v=g+v);const b=o.I.from("mapbox-reserved-lut"),S=new Image;S.src=v,S.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},S.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void h();this._styleColorTheme.lutLoading=!1;const{width:C,height:P,data:D}=o.q.getImageData(S);if(P>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(C!==P*P)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(b)&&this.removeImage(b),this.addImage(b,{data:new o.r({width:C,height:P},D),pixelRatio:1,sdf:!1,usvg:!1,version:0});const z=this.imageManager.getImage(b,this.scope);z?(this._styleColorTheme.lut={image:z.data,data:t},h()):m(new Error("Missing LUT image."))}})}getLut(t){const s=this._styleColorThemeForScope[t];return s?s.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(s,h,m){let g,v,b;const S=o.q.devicePixelRatio>1?"@2x":"";let C=o.n(h.transformRequest(h.normalizeSpriteURL(s,S,".json"),o.R.SpriteJSON),(z,O)=>{C=null,b||(b=z,g=O,D())}),P=o.o(h.transformRequest(h.normalizeSpriteURL(s,S,".png"),o.R.SpriteImage),(z,O)=>{P=null,b||(b=z,v=O,D())});function D(){if(b)m(b);else if(g&&v){const z=o.q.getImageData(v),O={};for(const V in g){const{width:N,height:H,x:U,y:Q,sdf:ne,pixelRatio:ae,stretchX:ge,stretchY:de,content:fe}=g[V],le=new o.r({width:N,height:H});o.r.copy(z,le,{x:U,y:Q},{x:0,y:0},{width:N,height:H},null),O[V]={data:le,pixelRatio:ae,sdf:ne,stretchX:ge,stretchY:de,content:fe,usvg:!1}}m(null,O)}}return{cancel(){C&&(C.cancel(),C=null),P&&(P.cancel(),P=null)}}}(t,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new o.z(s));else if(h){const m=new Map;for(const g in h)m.set(o.I.from(g),h[g]);this.addImages(m)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))})}addIconset(t,s){if(s.type==="sprite")return void this._loadSprite(s.url);const h=this.getOwnSourceCache(s.source);if(!h)return void this.fire(new o.z(new Error(`Source "${s.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const m=h.getSource();if(m.type!=="raster-array")return void this.fire(new o.z(new Error(`Source "${s.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));m.partial=!1;const g=new __(t,this.scope,h);this.imageManager.addImageProvider(g,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!o.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const s=this.map._spriteFormat==="auto";var h,m;this._spriteRequest=(m=(g,v)=>{if(this._spriteRequest=null,g)s?this._loadSprite(t):this.fire(new o.z(g));else if(v){const b=new Map;for(const S in v)b.set(o.I.from(S),v[S]);this.addImages(b)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))},o.br((h=this.map._requestManager).transformRequest(h.normalizeIconsetURL(t),o.R.Iconset),(g,v)=>{if(g)return void m(g);const b={},S=o.c_(new o.bq(v));for(const C of S.icons){const P={version:1,pixelRatio:o.q.devicePixelRatio,content:sx(C),stretchX:C.metadata?ud(C.metadata.stretch_x_areas):void 0,stretchY:C.metadata?ud(C.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:C};b[C.name]=P}m(null,b)}))}_validateLayer(t){const s=this.getOwnSource(t.source);if(!s)return;const h=t.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new o.z(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,s)=>{const h=this.fragments[s];return h&&h.style&&(t.data=h.style.serialize()),t})}_serializeSources(){const t={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();t[h.id]||(t[h.id]=h.serialize())}return t}_serializeLayers(t){const s=[];for(const h of t){const m=this._layers[h];m&&m.type!=="custom"&&s.push(m.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const s=this.getOwnLayer(t);if(s)return s;this.fire(new o.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const s=this.getOwnSource(t);if(s)return s;this.fire(new o.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,s){const h=this.map.painter;if(h)for(let m=t.minzoom||0;m<(t.maxzoom||25.5);m++){const g=t.getProgramIds();if(g)for(const v of g){const b=t.getDefaultProgramParams(v,s.zoom,this._styleColorTheme.lut);b&&(h.style=this,this.fog&&(h._fogVisible=!0,b.overrideFog=!0,h.getOrCreateProgram(v,b)),h._fogVisible=!1,b.overrideFog=!1,h.getOrCreateProgram(v,b),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(b.overrideRtt=!0,h.getOrCreateProgram(v,b)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const s=this.calculateLightsBrightness();t.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const h=this._changes.isDirty();let m=!1;if(this._changes.isDirty()){const b=this._changes.getLayerUpdatesByScope();for(const S in b){const{updatedIds:C,removedIds:P}=b[S];(C||P)&&(this._updateWorkerLayers(S,C,P),m=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const g={};for(const b in this._mergedSourceCaches){const S=this._mergedSourceCaches[b];g[b]=S.used,S.used=!1,S.tileCoverLift=0}for(const b of this._mergedOrder){const S=this._mergedLayers[b];if(S.recalculate(t,this._availableImages),!S.isHidden(t.zoom)){const C=this.getLayerSourceCache(S);C&&(C.used=!0,C.tileCoverLift=Math.max(C.tileCoverLift,S.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(S,t)}):this.precompilePrograms(S,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&m&&this.mergeLayers();const v=this.imageManager.getPendingImageProviders();for(const b of v)b.sourceCache.used=!0;for(const b in g){const S=this._mergedSourceCaches[b];g[b]!==S.used&&S.getSource().fire(new o.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),h&&this.fire(new o.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const s of t){const h=s.resolvePendingRequests(),m=this.getFragmentStyle(s.scope);m&&m.addImages(h)}}_updateTilesForChangedImages(){const t={};for(const s in this._mergedSourceCaches){const h=this._mergedSourceCaches[s].getSource().scope;t[h]=t[h]||this._changes.getUpdatedImages(h),t[h].length!==0&&this._mergedSourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t[h])}for(const s in t)this._changes.resetUpdatedImages(s)}_updateWorkerLayers(t,s,h){const m=this.getFragmentStyle(t);m&&this.dispatcher.broadcast("updateLayers",{layers:s?m._serializeLayers(s):[],scope:t,removedIds:h||[],options:m.options})}setState(t,s){if(this._checkLoaded(),Na(this,ur(t)))return!1;(t=o.d7(t)).layers=id(t.layers);const h=function(v,b){if(!v)return[{command:Ni.setStyle,args:[b]}];let S=[];try{if(!o.bv(v.version,b.version))return[{command:Ni.setStyle,args:[b]}];if(o.bv(v.center,b.center)||S.push({command:Ni.setCenter,args:[b.center]}),o.bv(v.zoom,b.zoom)||S.push({command:Ni.setZoom,args:[b.zoom]}),o.bv(v.bearing,b.bearing)||S.push({command:Ni.setBearing,args:[b.bearing]}),o.bv(v.pitch,b.pitch)||S.push({command:Ni.setPitch,args:[b.pitch]}),o.bv(v.sprite,b.sprite)||S.push({command:Ni.setSprite,args:[b.sprite]}),o.bv(v.glyphs,b.glyphs)||S.push({command:Ni.setGlyphs,args:[b.glyphs]}),o.bv(v.imports,b.imports)||function(O=[],V=[],N){V=V||[];const H=(O=O||[]).map(za),U=V.map(za),Q=O.reduce(sc,{}),ne=V.reduce(sc,{}),ae=H.slice();let ge,de,fe,le;for(ge=0,de=0;ge<H.length;ge++)fe=H[ge],ne.hasOwnProperty(fe)?de++:(N.push({command:Ni.removeImport,args:[fe]}),ae.splice(ae.indexOf(fe,de),1));for(ge=0,de=0;ge<U.length;ge++)fe=U[U.length-1-ge],ae[ae.length-1-ge]!==fe&&(Q.hasOwnProperty(fe)?(N.push({command:Ni.removeImport,args:[fe]}),ae.splice(ae.lastIndexOf(fe,ae.length-de),1)):de++,le=ae[ae.length-ge],N.push({command:Ni.addImport,args:[ne[fe],le]}),ae.splice(ae.length-ge,0,fe));for(const ye of V){const be=Q[ye.id];be&&!o.bv(be,ye)&&N.push({command:Ni.updateImport,args:[ye.id,ye]})}}(v.imports,b.imports,S),o.bv(v.transition,b.transition)||S.push({command:Ni.setTransition,args:[b.transition]}),o.bv(v.light,b.light)||S.push({command:Ni.setLight,args:[b.light]}),o.bv(v.fog,b.fog)||S.push({command:Ni.setFog,args:[b.fog]}),o.bv(v.snow,b.snow)||S.push({command:Ni.setSnow,args:[b.snow]}),o.bv(v.rain,b.rain)||S.push({command:Ni.setRain,args:[b.rain]}),o.bv(v.projection,b.projection)||S.push({command:Ni.setProjection,args:[b.projection]}),o.bv(v.lights,b.lights)||S.push({command:Ni.setLights,args:[b.lights]}),o.bv(v.camera,b.camera)||S.push({command:Ni.setCamera,args:[b.camera]}),o.bv(v.iconsets,b.iconsets)||function(O,V,N){let H;for(H in V=V||{},O=O||{})O.hasOwnProperty(H)&&(V.hasOwnProperty(H)||N.push({command:Ni.removeIconset,args:[H]}));for(H in V){if(!V.hasOwnProperty(H))continue;const U=V[H];O.hasOwnProperty(H)?o.bv(O[H],U)||(N.push({command:Ni.removeIconset,args:[H]}),N.push({command:Ni.addIconset,args:[H,U]})):N.push({command:Ni.addIconset,args:[H,U]})}}(v.iconsets,b.iconsets,S),!o.bv(v["color-theme"],b["color-theme"]))return[{command:Ni.setStyle,args:[b]}];const C={},P=[];(function(O,V,N,H){let U;for(U in V=V||{},O=O||{})O.hasOwnProperty(U)&&(V.hasOwnProperty(U)||oc(U,N,H));for(U in V){if(!V.hasOwnProperty(U))continue;const Q=V[U];O.hasOwnProperty(U)?o.bv(O[U],Q)||(O[U].type==="geojson"&&Q.type==="geojson"&&l_(O,V,U)?N.push({command:Ni.setGeoJSONSourceData,args:[U,Q.data]}):tx(U,V,N,H)):rc(U,V,N)}})(v.sources,b.sources,P,C);const D=[];v.layers&&v.layers.forEach(O=>{O.source&&C[O.source]?S.push({command:Ni.removeLayer,args:[O.id]}):D.push(O)});let z=v.terrain;z&&C[z.source]&&(S.push({command:Ni.setTerrain,args:[void 0]}),z=void 0),S=S.concat(P),o.bv(z,b.terrain)||S.push({command:Ni.setTerrain,args:[b.terrain]}),function(O,V,N){V=V||[];const H=(O=O||[]).map(za),U=V.map(za),Q=O.reduce(sc,{}),ne=V.reduce(sc,{}),ae=H.slice(),ge=Object.create(null);let de,fe,le,ye,be,Fe,Le;for(de=0,fe=0;de<H.length;de++)le=H[de],ne.hasOwnProperty(le)?fe++:(N.push({command:Ni.removeLayer,args:[le]}),ae.splice(ae.indexOf(le,fe),1));for(de=0,fe=0;de<U.length;de++)le=U[U.length-1-de],ae[ae.length-1-de]!==le&&(Q.hasOwnProperty(le)?(N.push({command:Ni.removeLayer,args:[le]}),ae.splice(ae.lastIndexOf(le,ae.length-fe),1)):fe++,Fe=ae[ae.length-de],N.push({command:Ni.addLayer,args:[ne[le],Fe]}),ae.splice(ae.length-de,0,le),ge[le]=!0);for(de=0;de<U.length;de++)if(le=U[de],ye=Q[le],be=ne[le],!ge[le]&&!o.bv(ye,be))if(o.bv(ye.source,be.source)&&o.bv(ye["source-layer"],be["source-layer"])&&o.bv(ye.type,be.type)){for(Le in ml(ye.layout,be.layout,N,le,null,Ni.setLayoutProperty),ml(ye.paint,be.paint,N,le,null,Ni.setPaintProperty),o.bv(ye.slot,be.slot)||N.push({command:Ni.setSlot,args:[le,be.slot]}),o.bv(ye.filter,be.filter)||N.push({command:Ni.setFilter,args:[le,be.filter]}),o.bv(ye.minzoom,be.minzoom)&&o.bv(ye.maxzoom,be.maxzoom)||N.push({command:Ni.setLayerZoomRange,args:[le,be.minzoom,be.maxzoom]}),ye)ye.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&Le!=="slot"&&(Le.indexOf("paint.")===0?ml(ye[Le],be[Le],N,le,Le.slice(6),Ni.setPaintProperty):o.bv(ye[Le],be[Le])||N.push({command:Ni.setLayerProperty,args:[le,Le,be[Le]]}));for(Le in be)be.hasOwnProperty(Le)&&!ye.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&Le!=="slot"&&(Le.indexOf("paint.")===0?ml(ye[Le],be[Le],N,le,Le.slice(6),Ni.setPaintProperty):o.bv(ye[Le],be[Le])||N.push({command:Ni.setLayerProperty,args:[le,Le,be[Le]]}))}else N.push({command:Ni.removeLayer,args:[le]}),Fe=ae[ae.lastIndexOf(le)+1],N.push({command:Ni.addLayer,args:[be,Fe]})}(D,b.layers,S)}catch(C){console.warn("Unable to compute style diff:",C),S=[{command:Ni.setStyle,args:[b]}]}return S}(this.serialize(),t).filter(v=>!(v.command in v_));if(h.length===0)return!1;const m=h.filter(v=>!(v.command in y_));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);const g=[];return h.forEach(v=>{g.push(this[v.command](...v.args))}),s&&Promise.all(g).then(s).catch(s),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[s,h]of t.entries()){if(this.getImage(s))return this.fire(new o.z(new Error(`An image with the name "${s.name}" already exists.`)));this.imageManager.addImage(s,this.scope,h),this._changes.updateImage(s,this.scope)}return this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this}addImage(t,s){return this.getImage(t)?this.fire(new o.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,s),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this)}updateImage(t,s,h=!1){this.imageManager.updateImage(t,this.scope,s),h&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new o.A("data",{dataType:"style"})),this}addModel(t,s,h={}){return this._checkLoaded(),this._validate(ve,`models.${t}`,s,null,h)||(this.modelManager.addModel(t,s,this.scope),this.fire(new o.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,s,h={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(to,`sources.${t}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=ic(t,s,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));const g=v=>{const b=(v?"symbol:":"other:")+m.id,S=o.C(b,this.scope),C=this._sourceCaches[b]=new io(S,m,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=C,C.onAdd(this.map)};g(!1),s.type!=="vector"&&s.type!=="geojson"||g(!0),m.onAdd&&m.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const s=this.getOwnSource(t);if(!s)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new o.z(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new o.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const m=Object.entries(this.stylesheet.iconsets).find(([g,v])=>v.type==="source"&&v.source===t);if(m)return this.fire(new o.z(new Error(`Source "${t}" cannot be removed while iconset "${m[0]}" is using it.`)))}const h=this.getOwnSourceCaches(t);for(const m of h){const g=o.d8(m.id);delete this._sourceCaches[g],this._changes.discardSourceCacheUpdate(m.id),m.fire(new o.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getOwnSource(t).setData(s),this._changes.setDirty()}getOwnSource(t){const s=this.getOwnSourceCache(t);return s&&s.getSource()}getOwnSources(){const t=[];for(const s in this._otherSourceCaches){const h=this.getOwnSourceCache(s);h&&t.push(h.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const s in t){const h=t[s]._tiles;for(const m in h){const g=h[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const m of t){if(this._validate(dl,"lights",m))return;switch(m.type){case"ambient":if(this.ambientLight){const g=this.ambientLight;g.set(m),g.updateTransitions(s)}else this.ambientLight=new Zn(m,ln||(ln=new o.a7({color:new o.a8(o.a5.properties_light_ambient.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const g=this.directionalLight;g.set(m),g.updateTransitions(s)}else this.directionalLight=new Zn(m,Ui||(Ui=new o.a7({direction:new o.an(o.a5.properties_light_directional.direction),color:new o.a8(o.a5.properties_light_directional.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_directional.intensity),"cast-shadows":new o.a8(o.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new o.a8(o.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.a8(o.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const h=new o.aa(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(h),this.directionalLight&&this.directionalLight.recalculate(h),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,s=this.ambientLight;if(!t||!s)return;const h=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),m=t.properties.get("color").toRenderColor(null).toArray01(),g=t.properties.get("intensity"),v=t.properties.get("direction"),b=1-o.cR(v.x,v.y,v.z)[2]/90,S=h(m)*g*b,C=s.properties.get("color").toRenderColor(null).toArray01(),P=s.properties.get("intensity"),D=h(C)*P;return Number(((S+D)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(o.d9(t)){const s=o.da(t),h=this.fragments.find(({id:g})=>g===s);if(!h)return;const m=o.d8(t);return h.style.getFragmentStyle(m)}{const s=this.fragments.find(({id:h})=>h===t);return s?s.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const s={},h=(m,g="")=>`${m}::${g}`;this._featuresetSelectors={};for(const m in t){const g=this._featuresetSelectors[m]=[];for(const v of t[m].selectors){if(v.featureNamespace){const S=this.getOwnLayer(v.layer);if(!S){o.w(`Layer is undefined for selector: ${v.layer}`);continue}const C=h(S.source,S.sourceLayer);if(C in s&&s[C]!==v.featureNamespace){o.w(`"featureNamespace ${v.featureNamespace} of featureset ${m}'s selector is not associated to the same source, skip this selector`);continue}s[C]=v.featureNamespace}let b;if(v.properties)for(const S in v.properties){const C=o.X(v.properties[S]);C.result==="success"&&(b=b||{},b[S]=C.value)}g.push({layerId:v.layer,namespace:v.featureNamespace,properties:b,uniqueFeatureID:v._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const s=this.getFragmentStyle(t);if(!s||!s.stylesheet.featuresets)return[];const h=[];for(const m in s.stylesheet.featuresets)h.push({featuresetId:m,importId:s.scope?s.scope:void 0});return h}getFeaturesetLayers(t,s){const h=this.getFragmentStyle(s),m=h.stylesheet.featuresets;if(!m||!m[t])return this.fire(new o.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const g=[];for(const v of m[t].selectors){const b=h.getOwnLayer(v.layer);b&&g.push(b)}return g}getConfigProperty(t,s){const h=this.getFragmentStyle(t);if(!h)return null;const m=o.C(s,h.scope),g=h.options.get(m),v=g?g.value||g.default:null;return v?v.serialize():null}setConfigProperty(t,s,h){const m=this.getFragmentStyle(t);if(!m)return;const g=m.stylesheet.indoor?m_(m.stylesheet.schema):m.stylesheet.schema;if(!g||!g[s])return;const v=o.X(h);if(v.result!=="success")return void Na(this,v.value);const b=v.value.expression,S=o.C(s,m.scope),C=m.options.get(S);if(!C)return;let P;const{minValue:D,maxValue:z,stepValue:O,type:V,values:N}=g[s],H=o.X(g[s].default);H.result==="success"&&(P=H.value.expression),P?(this.options.set(S,Object.assign({},C,{value:b,default:P,minValue:D,maxValue:z,stepValue:O,type:V,values:N})),this.updateConfigDependencies(s)):this.fire(new o.z(new Error(`No schema defined for the config option "${s}" in the "${t}" fragment.`)))}getConfig(t){const s=this.getFragmentStyle(t);if(!s)return null;const h=s.stylesheet.schema;if(!h)return null;const m={};for(const g in h){const v=o.C(g,s.scope),b=s.options.get(v),S=b?b.value||b.default:null;m[g]=S?S.serialize():null}return m}setConfig(t,s){const h=this.getFragmentStyle(t);h&&(h.updateConfig(s,h.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const s=this.getFragmentStyle(t);return s?s.stylesheet.schema:null}setSchema(t,s){const h=this.getFragmentStyle(t);h&&(h.stylesheet.schema=s,h.updateConfig(h._config,s),this.updateConfigDependencies())}updateConfig(t,s){if(this._config=t,t||s)if(s)for(const h in s){let m,g;const v=o.X(s[h].default);if(v.result==="success"&&(m=v.value.expression),t&&t[h]!==void 0){const z=o.X(t[h]);z.result==="success"&&(g=z.value.expression)}const{minValue:b,maxValue:S,stepValue:C,type:P,values:D}=s[h];if(m){const z=o.C(h,this.scope);this.options.set(z,{default:m,value:g,minValue:b,maxValue:S,stepValue:C,type:P,values:D})}else this.fire(new o.z(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new o.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const s of this._configDependentLayers){const h=this.getLayer(s);if(h){if(t&&!h.configDependencies.has(t))continue;h.possiblyEvaluateVisibility(),this._updateLayer(h)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(s=>{const h=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(h){const m=s._evaluateColorThemeData(h);(!s._styleColorTheme.lut&&m!==""||s._styleColorTheme.lut&&m!==s._styleColorTheme.lut.data)&&s.setColorTheme(h)}}),this._changes.setDirty()}addLayer(t,s,h={}){this._checkLoaded();const m=t.id;if(this._layers[m])return void this.fire(new o.z(new Error(`Layer with id "${m}" already exists on this map`)));let g;if(t.type==="custom"){if(Na(this,o.db(t)))return;g=o.dc(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=o.d7(t),t=o.l(t,{source:m})),this._validate(G,`layers.${m}`,t,{arrayIndex:-1},h))return;g=o.dc(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(g),g.setEventedParent(this,{layer:{id:m}})}g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid);let v=this._order.length;if(s){const P=this._order.indexOf(s);if(P===-1)return void this.fire(new o.z(new Error(`Layer with id "${s}" does not exist on this map.`)));g.slot===this._layers[s].slot?v=P:o.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,m),this._layerOrderChanged=!0,this._layers[m]=g;const b=this.getOwnLayerSourceCache(g),S=!!this.directionalLight&&this.directionalLight.shadowsEnabled();b&&g.canCastShadows()&&S&&(b.castsShadows=!0);const C=this._changes.getRemovedLayer(g);if(C&&g.source&&b&&g.type!=="custom"){this._changes.discardLayerRemoval(g);const P=o.C(g.source,g.scope);C.type!==g.type?this._changes.updateSourceCache(P,"clear"):(this._changes.updateSourceCache(P,"reload"),b.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),g.scope=this.scope,this.mergeLayers()}moveLayer(t,s){this._checkLoaded();const h=this._checkLayer(t);if(!h||t===s)return;const m=this._order.indexOf(t);this._order.splice(m,1);let g=this._order.length;if(s){const v=this._order.indexOf(s);if(v===-1)return void this.fire(new o.z(new Error(`Layer with id "${s}" does not exist on this map.`)));h.slot===this._layers[s].slot?g=v:o.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(g,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;s.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const m=this.getOwnLayerSourceCache(s);if(m&&m.castsShadows){let g=!1;for(const v in this._layers)if(this._layers[v].source===s.source&&this._layers[v].canCastShadows()){g=!0;break}m.castsShadows=g}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,h){this._checkLoaded();const m=this._checkLayer(t);m&&(m.minzoom===s&&m.maxzoom===h||(s!=null&&(m.minzoom=s),h!=null&&(m.maxzoom=h),this._updateLayer(m)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,s){this._checkLoaded();const h=this._checkLayer(t);h&&h.slot!==s&&(h.slot=s,this._updateLayer(h))}setFilter(t,s,h={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!o.bv(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(X,`layers.${m.id}.filter`,s,{layerType:m.type},h)||(m.filter=o.d7(s),this._updateLayer(m)))}getFilter(t){const s=this._checkLayer(t);if(s)return o.d7(s.filter)}setLayoutProperty(t,s,h,m={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!o.bv(g.getLayoutProperty(s),h)){if(h!=null&&(!m||m.validate!==!1)&&Na(g,Te.call(ur,{key:`layers.${t}.layout.${s}`,layerType:g.type,objectKey:s,value:h,styleSpec:o.a5,style:{glyphs:!0,sprite:!0}})))return;g.setLayoutProperty(s,h),g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),this._updateLayer(g)}}getLayoutProperty(t,s){const h=this._checkLayer(t);if(h)return h.getLayoutProperty(s)}setPaintProperty(t,s,h,m={}){this._checkLoaded();const g=this._checkLayer(t);if(!g||o.bv(g.getPaintProperty(s),h)||h!=null&&(!m||m.validate!==!1)&&Na(g,ue.call(ur,{key:`layers.${t}.paint.${s}`,layerType:g.type,objectKey:s,value:h,styleSpec:o.a5})))return;const v=g.setPaintProperty(s,h);g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),v&&this._updateLayer(g),this._changes.updatePaintProperties(g)}getPaintProperty(t,s){const h=this._checkLayer(t);if(h)return h.getPaintProperty(s)}setFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:S,importId:C}=t.target,P=this.getFragmentStyle(C),D=P.getFeaturesetLayers(S);for(const{source:z,sourceLayer:O}of D)P.setFeatureState({id:t.id,source:z,sourceLayer:O},s)}else if("layerId"in t.target){const{layerId:S}=t.target,C=this.getLayer(S);this.setFeatureState({id:t.id,source:C.source,sourceLayer:C.sourceLayer},s)}return}const h=t.source,m=t.sourceLayer,g=this._checkSource(h);if(!g)return;const v=g.type;if(v==="geojson"&&m)return void this.fire(new o.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(v==="vector"&&!m)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided.")));const b=this.getOwnSourceCaches(h);for(const S of b)S.setFeatureState(m,t.id,s)}removeFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:S,importId:C}=t.target,P=this.getFragmentStyle(C),D=P.getFeaturesetLayers(S);for(const{source:z,sourceLayer:O}of D)P.removeFeatureState({id:t.id,source:z,sourceLayer:O},s)}else if("layerId"in t.target){const{layerId:S}=t.target,C=this.getLayer(S);this.removeFeatureState({id:t.id,source:C.source,sourceLayer:C.sourceLayer},s)}return}const h=t.source,m=this._checkSource(h);if(!m)return;const g=m.type,v=g==="vector"?t.sourceLayer:void 0;if(g==="vector"&&!v)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new o.z(new Error("A feature id is required to remove its specific state property.")));const b=this.getOwnSourceCaches(h);for(const S of b)S.removeFeatureState(v,t.id,s)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let g;if("featuresetId"in t.target){const{featuresetId:v,importId:b}=t.target,S=this.getFragmentStyle(b),C=S.getFeaturesetLayers(v);for(const{source:P,sourceLayer:D}of C){const z=S.getFeatureState({id:t.id,source:P,sourceLayer:D});if(z&&!g)g=z;else if(!o.bv(g,z))return void this.fire(new o.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:v}=t.target,b=this.getLayer(v);g=this.getFeatureState({id:t.id,source:b.source,sourceLayer:b.sourceLayer})}return g}const s=t.source,h=t.sourceLayer,m=this._checkSource(s);if(m){if(m.type!=="vector"||h)return t.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(h,t.id);this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=o.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return o.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),s=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return o.dd({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateFilteredLayers(t){for(const s of Object.values(this._mergedLayers))t(s)&&this._updateLayer(s)}_updateLayer(t){this._changes.updateLayer(t);const s=this.getLayerSourceCache(t),h=o.C(t.source,t.scope),m=this._changes.getUpdatedSourceCaches();t.source&&!m[h]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),s.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=b=>this._mergedLayers[b].is3D(!!this.terrain),h=this.order,m={},g=[];for(let b=h.length-1;b>=0;b--){const S=h[b];if(s(S)){m[S]=b;for(const C of t){const P=C[S];if(P)for(const D of P)g.push(D)}}}g.sort((b,S)=>S.intersectionZ-b.intersectionZ);const v=[];for(let b=h.length-1;b>=0;b--){const S=h[b];if(s(S))for(let C=g.length-1;C>=0;C--){const P=g[C].feature;if(P.layer&&m[P.layer.id]<b)break;v.push(P),g.pop()}else for(const C of t){const P=C[S];if(P)for(const D of P)v.push(D.feature)}}return v}queryRenderedFeatures(t,s,h){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(X,"queryRenderedFeatures.filter",s.filter,null,s),m=o.b3(s.filter));const g={},v=P=>{if(ua.has(P.type))return;const D=this.getOwnLayerSourceCache(P),z=g[D.id]=g[D.id]||{sourceCache:D,layers:{},has3DLayers:!1};P.is3D(!!this.terrain)&&(z.has3DLayers=!0),z.layers[P.fqid]=z.layers[P.fqid]||{styleLayer:P,targets:[]},z.layers[P.fqid].targets.push({filter:m})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.z(new Error("parameters.layers must be an Array."))),[];for(const P of s.layers){const D=this._layers[P];if(!D)return this.fire(new o.z(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];v(D)}}else for(const P in this._layers)v(this._layers[P]);const b=this._queryRenderedFeatures(t,g,h),S=this._flattenAndSortRenderedFeatures(b),C=[];for(const P of S)o.de(P.layer.id)===this.scope&&C.push(P);return C}queryRenderedFeatureset(t,s,h){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(X,"queryRenderedFeatures.filter",s.filter,null,s),m=o.b3(s.filter));const g="mock",v=[];if(s&&s.target)v.push(Object.assign({},s,{targetId:g,filter:m}));else{const P=this.getFeaturesetDescriptors();for(const D of P)v.push({targetId:g,filter:m,target:D});for(const{style:D}of this.fragments){const z=D.getFeaturesetDescriptors();for(const O of z)v.push({targetId:g,filter:m,target:O})}}const b=this.queryRenderedTargets(t,v,h),S=[],C=new Set;for(const P of b)for(const D of P.variants[g])Mu(D,P,C)||S.push(new o.df(P,D));return S}queryRenderedTargets(t,s,h){const m={},g=(b,S,C,P)=>{const D=m[S.id]=m[S.id]||{sourceCache:S,layers:{},has3DLayers:!1};if(D.layers[b.fqid]=D.layers[b.fqid]||{styleLayer:b,targets:[]},b.is3D(!!this.terrain)&&(D.has3DLayers=!0),!P)return C.uniqueFeatureID=!1,void D.layers[b.fqid].targets.push(C);D.layers[b.fqid].targets.push(Object.assign({},C,{namespace:P.namespace,properties:P.properties,uniqueFeatureID:P.uniqueFeatureID}))};for(const b of s)if("featuresetId"in b.target){const{featuresetId:S,importId:C}=b.target,P=this.getFragmentStyle(C);if(!P||!P._featuresetSelectors)continue;const D=P._featuresetSelectors[S];if(!D){this.fire(new o.z(new Error(`The featureset '${S}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const z of D){const O=P.getOwnLayer(z.layerId);O&&!ua.has(O.type)&&g(O,P.getOwnLayerSourceCache(O),b,z)}}else if("layerId"in b.target){const{layerId:S}=b.target,C=this.getLayer(S);if(!C||ua.has(C.type))continue;g(C,this.getLayerSourceCache(C),b)}const v=this._queryRenderedFeatures(t,m,h);return this._flattenAndSortRenderedFeatures(v)}_queryRenderedFeatures(t,s,h){const m=[],g=!!this.map._showQueryGeometry,v=or.createFromScreenPoints(t,h);for(const b in s){const S=pl(v,s[b],this._availableImages,h,g);Object.keys(S).length&&m.push(S)}if(this.placement)for(const b in s){if(!s[b].sourceCache._onlySymbols)continue;const S=Pu(v.screenGeometry,s[b],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(S).length&&m.push(S)}return m}querySourceFeatures(t,s){const h=s&&s.filter;h&&this._validate(X,"querySourceFeatures.filter",h,null,s);let m=[];const g=this.getOwnSourceCaches(t);for(const v of g)m=m.concat(cp(v,s));return m}addSourceType(t,s,h){return es.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(es.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,s,h={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const b in t)if(!o.bv(t[b],m[b])){g=!0;break}if(!g)return;const v=this._getTransitionParameters();this.light.setLight(t,s,h),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,s=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let h=t;const m=t.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof h.source=="object"){const b="terrain-dem-src";this.addSource(b,h.source),h=o.d7(h),h=o.l(h,{source:b})}const g=o.l({},h),v={};if(this.terrain&&m){g.source=this.terrain.get().source;const b=this.terrain?this.getFragmentStyle(this.terrain.scope):null;b&&(v.style=b.serialize())}if(this._validate(gt,"terrain",g,v))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&s!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,s),this.fire(new o.A("data",{dataType:"style"}))}else{const g=this.terrain,v=g.get();for(const b of Object.keys(o.a5.terrain))!h.hasOwnProperty(b)&&o.a5.terrain[b].default&&(h[b]=o.a5.terrain[b].default);for(const b in t)if(!o.bv(t[b],v[b])){g.set(t,this.options),this.stylesheet.terrain=t;const S=this._getTransitionParameters({duration:0});g.updateTransitions(S),this.fire(new o.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Ii(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_createSnow(t){const s=this.snow=new cn(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_createRain(t){const s=this.rain=new pn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!o.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!o.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.snow=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!o.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.rain=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const m in this._layers)this._layers[m].lut=this._styleColorTheme.lut;for(const m in this._sourceCaches)this._sourceCaches[m].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void t();const h=this._evaluateColorThemeData(s);this._loadColorTheme(h).then(()=>{this.fire(new o.A("colorthemeset")),t()}).catch(m=>{o.w(`Couldn't set color theme: ${m}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,s){const h=this.getFragmentStyle(t);h&&(h._styleColorTheme.colorThemeOverride=s,h._reloadColorTheme())}_getTransitionParameters(t){return{now:o.q.now(),transition:o.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],s=[];for(const h of this._mergedOrder)this.isLayerDraped(this._mergedLayers[h])?t.push(h):s.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const h=this.terrain=new Ye(t,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});h.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,h,m,g={}){if(g&&g.validate===!1)return!1;const v=o.l({},this.serialize());return Na(this,t.call(ur,o.l({key:s,style:v,value:h,styleSpec:o.a5},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dg.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const s=this.getSourceCaches(t);for(const h of s)h.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const s=this.getSourceCaches(t);for(const h of s)h.resume(),h.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let s;this.directionalLight&&(s=vp(this.directionalLight));const h=new Set;for(const m in this._mergedLayers){const g=this._mergedLayers[m];g.hasElevation()&&!h.has(g.source)&&h.add(g.source)}for(const m in this._mergedSourceCaches){const g=this._mergedSourceCaches[m],v=h.has(g._source.id);g.update(t,void 0,void 0,s,v)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,h,m,g,v,b=!1){let S=!1,C=!1;const P={},D={};for(const z of this._mergedOrder){const O=this._mergedLayers[z];if(O.type!=="symbol")continue;const V=o.C(O.source,O.scope);let N=P[V];if(!N){const U=this.getLayerSourceCache(O);if(!U)continue;const Q=U.getRenderableIds(!0).map(ne=>U.getTileByID(ne));D[V]=Q.slice(),N=P[V]=Q.sort((ne,ae)=>ae.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(ae.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(O,N,s.center.lng,s.projection);S=S||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),b=b||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new o.A("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),s.zoom))&&(this.pauseablePlacement=new ro(s,this._mergedOrder,b,h,m,g,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,P,D,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),C=!0),S&&this.pauseablePlacement.placement.setStale()),C||S){this._buildingIndex.onNewFrame(s.zoom);for(let z=0;z<this._mergedOrder.length;z++){const O=this._mergedLayers[this._mergedOrder[z]];if(O.type!=="symbol")continue;const V=this.isLayerClipped(O);this.placement.updateLayerOpacities(O,P[o.C(O.source,O.scope)],z,V?v:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,s){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:g})=>g===t.id)!==-1)return void this.fire(new o.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!s)return h.push(t),this._loadImports([t],!0);const m=h.findIndex(({id:g})=>g===s);return m===-1&&this.fire(new o.z(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=h.slice(0,m).concat(t).concat(h.slice(m)),this._loadImports([t],!0,s)}updateImport(t,s){this._checkLoaded();const h=this.stylesheet.imports||[],m=this.getImportIndex(t);return m===-1?this:typeof s=="string"?(this.setImportUrl(t,s),this):(s.url&&s.url!==h[m].url&&this.setImportUrl(t,s.url),o.bv(s.config,h[m].config)||this.setImportConfig(t,s.config,s.data.schema),o.bv(s.data,h[m].data)||this.setImportData(t,s.data),this)}moveImport(t,s){this._checkLoaded();let h=this.stylesheet.imports||[];const m=this.getImportIndex(t);if(m===-1)return this;const g=this.getImportIndex(s);if(g===-1)return this;const v=h[m],b=this.fragments[m];return h=h.filter(({id:S})=>S!==t),this.fragments=this.fragments.filter(({id:S})=>S!==t),this.stylesheet.imports=h.slice(0,g).concat(v).concat(h.slice(g)),this.fragments=this.fragments.slice(0,g).concat(b).concat(this.fragments.slice(g)),this.mergeLayers(),this}setImportUrl(t,s){this._checkLoaded();const h=this.stylesheet.imports||[],m=this.getImportIndex(t);if(m===-1)return this;h[m].url=s;const g=this.fragments[m];return g.style=this._createFragmentStyle(h[m]),g.style.on("style.import.load",()=>this.mergeAll()),g.style.loadURL(s),this}setImportData(t,s){this._checkLoaded();const h=this.getImportIndex(t),m=this.stylesheet.imports||[];return h===-1?this:s?(this.fragments[h].style.setState(s),this._reloadImports(),this):(delete m[h].data,this.setImportUrl(t,m[h].url))}setImportConfig(t,s,h){this._checkLoaded();const m=this.getImportIndex(t),g=this.stylesheet.imports||[];if(m===-1)return this;s?g[m].config=s:delete g[m].config;const v=this.fragments[m];h&&v.style.stylesheet&&(v.style.stylesheet.schema=h);const b=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=s,v.style.updateConfig(s,b),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const s=this.stylesheet.imports||[],h=this.getImportIndex(t);h!==-1&&(s.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports())}getImportIndex(t){const s=(this.stylesheet.imports||[]).findIndex(h=>h.id===t);return s===-1&&this.fire(new o.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),s}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const s in this._mergedOtherSourceCaches){const h=this._mergedOtherSourceCaches[s];h&&t.push(h.getSource())}return t}getSource(t,s){const h=this.getSourceCache(t,s);return h&&h.getSource()}getLayerSource(t){const s=this.getLayerSourceCache(t);return s&&s.getSource()}getSourceCache(t,s){const h=o.C(t,s);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(t){const s=o.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[t]&&s.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&s.push(this._mergedSymbolSourceCaches[t]),s}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const s in t){const h=t[s];h==="reload"?this.reloadSource(s):h==="clear"&&this.clearSource(s)}}updateLayers(t){const s=this._changes.getUpdatedPaintProperties();for(const h of s){const m=this.getLayer(h);m&&m.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,s,h){this.imageManager.getImages(s.images,s.scope,h),this._updateTilesForChangedImages();const m=v=>{if(v){const b=s.images.map(S=>o.I.toString(S));v.setDependencies(s.tileID.key,s.type,b)}},g=o.C(s.source,s.scope);m(this._mergedOtherSourceCaches[g]),m(this._mergedSymbolSourceCaches[g])}rasterizeImages(t,s,h){this.imageManager.rasterizeImages(s,h)}getGlyphs(t,s,h){this.glyphManager.getGlyphs(s.stacks,s.scope,h)}getResource(t,s,h){return o.dh(s,h)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this.getOwnSourceCaches(t);return s.length===0?(this.fire(new o.z(new Error(`There is no source with ID '${t}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,s){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const h=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D(!!this.terrain)){if(h||s&&s.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}es.getSourceType=function(u){return Cu[u]},es.setSourceType=function(u,t){Cu[u]=t},es.registerForPluginStateChange=o.c$;var dc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,fc=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,wp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,hd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Bo=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,dd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,vt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Tp=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,fd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,pd=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Sp=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Tl=[];mc(dc,Tl),mc(wp,Tl),mc(fc,Tl);const ts={"_prelude_fog.vertex.glsl":dd,"_prelude_terrain.vertex.glsl":Bo,"_prelude_shadow.vertex.glsl":pd,"_prelude_fog.fragment.glsl":vt,"_prelude_shadow.fragment.glsl":Sp,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Tp,"_prelude_raster_particle.glsl":fd},pc={};Oi("",Bo),Oi(vt,dd),Oi(Sp,pd),Oi(Tp,""),Oi(fd,"");const ja=Oi(fc,wp),$u=dc;var Sl={background:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);color*=u_opacity;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=vec4(linearTosRGB(color.rgb),color.a);
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Oi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Oi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Oi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Oi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Oi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Oi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Oi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Oi(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Oi(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Oi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Oi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Oi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Oi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Oi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Oi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Oi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Oi(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(abs(v_z_offset) > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Oi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Oi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,hd),skyboxGradient:Oi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,hd),skyboxCapture:Oi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Oi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Oi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Oi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Oi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Oi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Oi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Oi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function mc(u,t){const s=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of s)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=h.split(" ");for(const g of m)t.includes(g)||t.push(g)}}function Oi(u,t){const s=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let m=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);m&&(m=m.map(C=>{const P=C.split(" ");return P[P.length-1]}),m=[...new Set(m)]);const g={},v=[],b=[];if(u=u.replace(s,(C,P)=>(b.push(P),"")),(t=t.replace(s,(C,P)=>(v.push(P),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let S=[...Tl];mc(u,S),mc(t,S);for(const C of[...v,...b])ts[C]||console.error(`Undefined include: ${C}`),pc[C]||(pc[C]=[],mc(ts[C],pc[C])),S=[...S,...pc[C]];return{fragmentSource:u=u.replace(h,(C,P,D,z,O)=>(g[O]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${D} ${z} ${O};
#else
uniform ${D} ${z} u_${O};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${O}
    ${D} ${z} ${O} = u_${O};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${D} ${z} ${O};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(h,(C,P,D,z,O)=>{const V=z==="float"?"vec2":z,N=O.match(/color/)?"color":V;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${O}
in ${D} ${z} a_${O};
#endif
`:g[O]?P==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${D} ${V} a_${O};
out ${D} ${z} ${O};
#else
uniform ${D} ${z} u_${O};
#endif
`:P==="initialize"?N==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${D} ${z} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${N}(a_${O}, u_${O}_t);
#else
    ${D} ${z} ${O} = u_${O};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${D} ${z} a_${O};
    out ${D} ${z} ${O};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${O} = a_${O};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${D} ${V} a_${O};
#else
uniform ${D} ${z} u_${O};
#endif
`:P==="define-instanced"?N==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${O}0;
in vec4 a_${O}1;
in vec4 a_${O}2;
in vec4 a_${O}3;
#else
uniform ${D} ${z} u_${O};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${D} ${V} a_${O};
#else
uniform ${D} ${z} u_${O};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${D} ${z} ${O} = a_${O};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${D} ${z} ${O} = a_${O};
#else
    ${D} ${z} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${D} ${z} ${O} = unpack_mix_${N}(a_${O}, u_${O}_t);
#else
    ${D} ${z} ${O} = u_${O};
#endif
`}),staticAttributes:m,usedDefines:S,vertexIncludes:v,fragmentIncludes:b}}class Ep{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,s,h,m,g,v,b,S){this.context=t;let C=this.boundPaintVertexBuffers.length!==m.length;for(let D=0;!C&&D<m.length;D++)this.boundPaintVertexBuffers[D]!==m[D]&&(C=!0);let P=this.boundDynamicVertexBuffers.length!==b.length;for(let D=0;!P&&D<b.length;D++)this.boundDynamicVertexBuffers[D]!==b[D]&&(P=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==h||C||P||this.boundIndexBuffer!==g||this.boundVertexOffset!==v)this.freshBind(s,h,m,g,v,b,S);else{t.bindVertexArrayOES.set(this.vao);for(const D of b)D&&(D.bind(),S&&D.instanceCount&&D.setVertexAttribDivisor(t.gl,s,S));g&&g.dynamicDraw&&g.bind()}}freshBind(t,s,h,m,g,v,b){const S=t.numAttributes,C=this.context,P=C.gl;this.vao&&this.destroy(),this.vao=C.gl.createVertexArray(),C.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=v,s.enableAttributes(P,t),s.bind(),s.setVertexAttribPointers(P,t,g);for(const D of h)D.enableAttributes(P,t),D.bind(),D.setVertexAttribPointers(P,t,g);for(const D of v)D&&(D.enableAttributes(P,t),D.bind(),D.setVertexAttribPointers(P,t,g),b&&D.instanceCount&&D.setVertexAttribDivisor(P,t,b));m&&m.bind(),C.currentNumAttributes=S}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ax(u,t){const s=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new o.ac(0,h/s).toLngLat().lat,new o.ac(0,(h+1)/s).toLngLat().lat]}function x_(u,t,s,h,m,g,v){const b=u.context,S=b.gl,C=s.hillshadeFBO;if(!C)return;u.prepareDrawTile();const P=u.isTileAffectedByFog(t),D=u.getOrCreateProgram("hillshade",{overrideFog:P});b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get());const z=((H,U,Q,ne)=>{const ae=Q.paint.get("hillshade-shadow-color"),ge=Q.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",de=Q.paint.get("hillshade-highlight-color"),fe=Q.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",le=Q.paint.get("hillshade-accent-color"),ye=Q.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",be=Q.paint.get("hillshade-emissive-strength");let Fe=o.al(Q.paint.get("hillshade-illumination-direction"));if(Q.paint.get("hillshade-illumination-anchor")==="viewport")Fe-=H.transform.angle;else if(H.style&&H.style.enable3dLights()&&H.style.directionalLight){const Ke=H.style.directionalLight.properties.get("direction"),Xe=o.cR(Ke.x,Ke.y,Ke.z);Fe=o.al(Xe[1])}const Le=!H.options.moving;return{u_matrix:ne||H.transform.calculateProjMatrix(U.tileID.toUnwrapped(),Le),u_image:0,u_latrange:ax(0,U.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),Fe],u_shadow:ae.toRenderColor(ge?null:Q.lut),u_highlight:de.toRenderColor(fe?null:Q.lut),u_emissive_strength:be,u_accent:le.toRenderColor(ye?null:Q.lut)}})(u,s,h,u.terrain?t.projMatrix:null);u.uploadCommonUniforms(b,D,t.toUnwrapped());const{tileBoundsBuffer:O,tileBoundsIndexBuffer:V,tileBoundsSegments:N}=u.getTileBoundsBuffers(s);D.draw(u,S.TRIANGLES,m,g,v,Jt.disabled,z,h.id,O,V,N)}function Ip(u,t,s){if(!t.needsDEMTextureUpload)return;const h=u.context,m=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(s.stride);const g=s.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new o.T(h,g,m.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Ap(u,t,s){const h=u.context,m=h.gl;if(!t.dem)return;const g=t.dem;if(h.activeTexture.set(m.TEXTURE1),Ip(u,t,g),!t.demTexture)return;t.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const v=g.dim;h.activeTexture.set(m.TEXTURE0);let b=t.hillshadeFBO;if(!b){const z=new o.T(h,{width:v,height:v,data:null},m.RGBA8);z.bind(m.LINEAR,m.CLAMP_TO_EDGE),b=t.hillshadeFBO=h.createFramebuffer(v,v,!0,"renderbuffer"),b.colorAttachment.set(z.texture)}h.bindFramebuffer.set(b.framebuffer),h.viewport.set([0,0,v,v]);const{tileBoundsBuffer:S,tileBoundsIndexBuffer:C,tileBoundsSegments:P}=u.getMercatorTileBoundsBuffers(),D=[];u.linearFloatFilteringSupported()&&D.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:D}).draw(u,m.TRIANGLES,Rt.disabled,Qt.disabled,bi.unblended,Jt.disabled,((z,O)=>{const V=O.stride,N=o.bz();return o.c5(N,0,o.aj,-o.aj,0,0,1),o.bo(N,N,[0,-o.aj,0]),{u_matrix:N,u_image:1,u_dimension:[V,V],u_zoom:z.overscaledZ}})(t.tileID,g),s.id,S,C,P),t.needsHillshadePrepare=!1}class jn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class lx extends jn{getDefault(){return o.am.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class cx extends jn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ux extends jn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class b_ extends jn{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hx extends jn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class md extends jn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class dx extends jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class w_ extends jn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Cp extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class gd extends jn{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Mp extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class El extends jn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Pp extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class T_ extends jn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class gc extends jn{getDefault(){return o.am.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Hu extends jn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class _d extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class yd extends jn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class _c extends jn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let vd=class extends jn{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class Rp extends jn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class S_ extends jn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class zp extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class xd extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class qu extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class E_ extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class I_ extends jn{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class A_ extends jn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class yc extends jn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class C_ extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class fx extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Dp extends jn{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class px extends Dp{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class bd extends Dp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Lp extends Dp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class kp extends bd{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Op=(u,t,s)=>({u_matrix:u,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:s}),Fp=(u,t,s,h,m,g,v,b,S,C,P,D,z,O,V,N)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:s,u_zoom_transition:m,u_merc_center:g,u_image0:0,u_frustum_tl:v,u_frustum_tr:b,u_frustum_br:S,u_frustum_bl:C,u_globe_pos:P,u_globe_radius:D,u_viewport:z,u_grid_matrix:N?Float32Array.from(N):new Float32Array(9),u_skirt_height:O,u_far_z_cutoff:V});function Bp(u,t){return u!=null&&t!=null&&!(!u.hasData()||!t.hasData())&&u.demTexture!=null&&t.demTexture!=null&&u.tileID.key!==t.tileID.key}const vc=new class{constructor(){this.operations={}}newMorphing(u,t,s,h,m){if(u in this.operations){const g=this.operations[u];g.to.tileID.key!==s.tileID.key&&(g.queued=s)}else this.operations[u]={startTime:h,phase:0,duration:m,from:t,to:s,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const s=this.operations[t];for(s.phase=(u-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},xc={0:null,1:"TERRAIN_VERTEX_MORPHING"};function bc(u,t,s){if(t===0)return 0;const h=t<1&&s===514?.25/t:1;return 6*Math.pow(1.5,22-u)*Math.max(t,1)*h}function M_(u,t){const s=1<<u.z;return!t&&(u.x===0||u.x===s-1)||u.y===0||u.y===s-1}const _o=u=>({u_matrix:u});function Wu(u,t,s,h,m){if(m>0){const g=o.q.now(),v=(g-u.timeAdded)/m,b=t?(g-t.timeAdded)/m:-1,S=s.getSource(),C=h.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),P=!t||Math.abs(t.tileID.overscaledZ-C)>Math.abs(u.tileID.overscaledZ-C),D=P&&u.refreshedUponExpiration?1:o.aD(P?v:1-b,0,1);return u.refreshedUponExpiration&&v>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-D}:{opacity:D,mix:0}}return{opacity:1,mix:0}}class wd extends io{constructor(t){const s={type:"raster-dem",maxzoom:t.transform.maxZoom},h=new o.D(o.d0(),null),m=ic("mock-dem",s,h,t.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class Td extends io{constructor(t){const s=ic("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new o.D(o.d0(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,h){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,v)=>{if(g[v.key]="",!this._tiles[v.key]){const b=new la(v,this._source.tileSize*v.overscaleFactor(),t.tileZoom);b.state="loaded",this._tiles[v.key]=b}return g},{});for(const g in this._tiles)g in m||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Sd extends o.aM{constructor(t,s,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class Ed extends o.dt{constructor(t,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,m,g]=function(S){const C=new o.ba,P=new o.a_,D=131;C.reserve(17161),P.reserve(33800);const z=o.aj/128,O=o.aj+z/2,V=O+z;for(let H=-z;H<V;H+=z)for(let U=-z;U<V;U+=z){const Q=U<0||U>O||H<0||H>O?24575:0,ne=o.aD(Math.round(U),0,o.aj),ae=o.aD(Math.round(H),0,o.aj);C.emplaceBack(ne+Q,ae)}const N=(H,U)=>{const Q=U*D+H;P.emplaceBack(Q+1,Q,Q+D),P.emplaceBack(Q+D,Q+D+1,Q+1)};for(let H=1;H<129;H++)for(let U=1;U<129;U++)N(U,H);return[0,129].forEach(H=>{for(let U=0;U<130;U++)N(U,H),N(H,U)}),[C,P,32768]}(),v=t.context;this.gridBuffer=v.createVertexBuffer(h,o.bc.members),this.gridIndexBuffer=v.createIndexBuffer(m),this.gridSegments=o.bd.simpleSegment(0,0,h.length,m.length),this.gridNoSkirtSegments=o.bd.simpleSegment(0,0,h.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Td(s.map),this.orthoMatrix=o.bz(),o.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.aj,0,o.aj,0,1);const b=v.gl;this._overlapStencilMode=new Qt({func:b.GEQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new wd(s.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,s,h){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const m=t.terrain.properties,g=t.terrain.drapeRenderMode===0,v=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const b=t.terrain&&t.terrain.scope,S=m.get("source"),C=g?this._mockSourceCache:t.getSourceCache(S,b);if(!C)return void o.w(`Couldn't find terrain source "${S}".`);if(this.sourceCache=C,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=v?this.calculateExaggeration(s):m.get("exaggeration"),!s.projection.requiresDraping&&v&&this._exaggeration===0)return void this._disable();this.enabled=!0;const P=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const D=this.getScaledDemTileSize();this.sourceCache.update(s,D,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),s.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const s=this._previousCameraAltitude,h=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=h;const m=s!=null?h-s:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const g=t.zoom,v=this._style.terrain;if(!this._previousUpdateTimestamp)return v.getExaggeration(g);let b=g-this._previousZoom;const S=this._previousUpdateTimestamp;let C=g;this._evaluationZoom!=null&&(C=this._evaluationZoom,Math.abs(g-C)>.5&&(b=.5*(g-C+b)),b*m<0&&(C+=b)),this._evaluationZoom=C;const P=v.getExaggeration(C),D=P===v.getExaggeration(Math.max(0,C-.1));if(D&&Math.abs(P-this._exaggeration)<.01)return P;let z=Math.min(.1,.00375*(this._updateTimestamp-S));return(D||P<.1||Math.abs(b)<1e-4)&&(z=Math.min(.2,4*z)),o.ai(this._exaggeration,P,z)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(o.ac.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(S=>{const C=s.getTileByID(S).tileID;return C.projMatrix=h.calculateProjMatrix(C.toUnwrapped()),C});(function(S,C){const P=C.transform.pointCoordinate(C.transform.getCameraPoint()),D=new o.P(P.x,P.y);S.sort((z,O)=>{if(O.overscaledZ-z.overscaledZ)return O.overscaledZ-z.overscaledZ;const V=new o.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),N=new o.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),H=D.mult(1<<z.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(V)-H.distSqr(N)})})(m,this.painter);const g=this.proxyToSource||{};this.proxyToSource={},m.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};const v=this._style._mergedSourceCaches;for(const S in v){const C=v[S];if(!C.used||(C!==this.sourceCache&&this.resetTileLookupCache(C.id),this._setupProxiedCoordsForOrtho(C,t[S],g),C.usedForTerrain))continue;const P=t[S];C.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[s.id]=m.map(S=>new Sd(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1;const b={};this._visibleDemTiles=[];for(const S of this.proxyCoords){const C=this.terrainTileForTile[S.key];if(!C)continue;const P=C.tileID.key;P in b||(this._visibleDemTiles.push(C),b[P]=P)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const h in this.terrainTileForTile){const m=this.terrainTileForTile[h],g=m.dem;!g||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),Ip(this.painter,m,g))}}_prepareDemTileUniforms(t,s,h,m){if(!s||s.demTexture==null)return!1;const g=t.tileID.canonical,v=Math.pow(2,s.tileID.canonical.z-g.z),b=m||"";return h[`u_dem_tl${b}`]=[g.x*v%1,g.y*v%1],h[`u_dem_scale${b}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const s=this._visibleDemTiles.reduce((h,m)=>{if(!m.dem)return h;const g=m.dem.tree.minimums[0];return g>0&&t++,h+g},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),m=new o.du({width:1,height:1},new Float32Array([h]));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(m,{premultiply:!1}):g=this._emptyDEMTexture=new o.T(t,m,s.R32F,{premultiply:!1}),g}setupElevationDraw(t,s,h){const m=this.painter.context,g=m.gl,v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};v.u_exaggeration=this.exaggeration();let b=null,S=null,C=1;if(h&&h.morphing&&this._useVertexMorphing){const O=h.morphing.srcDemTile,V=h.morphing.dstDemTile;C=h.morphing.phase,O&&V&&(this._prepareDemTileUniforms(t,O,v,"_prev")&&(S=O),this._prepareDemTileUniforms(t,V,v)&&(b=V))}const P=O=>O&&O.demTexture&&this.painter.linearFloatFilteringSupported()?g.LINEAR:g.NEAREST;let D=null;var z;if(this.enabled?S&&b?(D=b.demTexture,m.activeTexture.set(g.TEXTURE4),S.demTexture.bind(P(S),g.CLAMP_TO_EDGE),v.u_dem_lerp=C):(b=this.terrainTileForTile[t.tileID.key],D=this._prepareDemTileUniforms(t,b,v)?b.demTexture:this.emptyDEMTexture):D=this.emptyDEMTexture,m.activeTexture.set(g.TEXTURE2),D&&(v.u_dem_size=(z=D).size[0]===1?1:z.size[0]-2,D.bind(P(b),g.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(h&&h.useDepthForOcclusion,s,v),h&&h.useMeterToDem&&b){const O=(1<<b.tileID.canonical.z)*o.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=O}if(h&&h.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(m,v),this.painter.transform.projection.name==="globe"){const O=this.globeUniformValues(this.painter.transform,t.tileID.canonical,h&&h.useDenormalizedUpVectorScale);s.setGlobeUniformValues(m,O)}}globeUniformValues(t,s,h){const m=t.projection;return{u_tile_tl_up:m.upVector(s,0,0),u_tile_tr_up:m.upVector(s,o.aj,0),u_tile_br_up:m.upVector(s,o.aj,o.aj),u_tile_bl_up:m.upVector(s,0,o.aj),u_tile_up_scale:h?o.dv(1):m.upVectorScale(s,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const s=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,g,v,b,S){if(m.transform.projection.name==="globe")(function(C,P,D,z,O){const V=C.context,N=V.gl;let H,U;const Q=C.transform,ne=o.dl(C,V,Q),ae=(Ke,Xe)=>{if(U===Xe)return;const dt=[xc[Xe],"PROJECTION_GLOBE_VIEW"];ne&&dt.push("CUSTOM_ANTIALIASING");const ke=C.isTileAffectedByFog(Ke);H=C.getOrCreateProgram("globeRaster",{defines:dt,overrideFog:ke}),U=Xe},ge=C.colorModeForRenderPass(),de=new Rt(N.LEQUAL,Rt.ReadWrite,C.depthRangeFor3D);vc.update(O);const fe=o.dm(Q),le=[o.ay(Q.center.lng),o.aH(Q.center.lat)],ye=C.globeSharedBuffers,be=[Q.width*o.q.devicePixelRatio,Q.height*o.q.devicePixelRatio],Fe=Float32Array.from(Q.globeMatrix),Le={useDenormalizedUpVectorScale:!0};{const Ke=C.transform,Xe=bc(Ke.zoom,P.exaggeration(),P.sourceCache._source.tileSize);U=-1;const dt=N.TRIANGLES;for(const ke of z){const Be=D.getTile(ke),ze=Qt.disabled,et=P.prevTerrainTileForTile[ke.key],Ge=P.terrainTileForTile[ke.key];Bp(et,Ge)&&vc.newMorphing(ke.key,et,Ge,O,250),V.activeTexture.set(N.TEXTURE0),Be.texture&&Be.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const ot=vc.getMorphValuesForProxy(ke.key),Qe=ot?1:0;ot&&o.L(Le,{morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:o.dk(ot.phase)}});const st=o.dn(ke.canonical),at=o.dp(st.getCenter().lat),Pt=o.dq(ke.canonical,st,at,Ke.worldSize/Ke._pixelsPerMercatorPixel),Nt=o.bh(o.dr(ke.canonical)),Ct=Fp(Ke.expandedFarZProjMatrix,Fe,fe,Nt,o.ah(Ke.zoom),le,Ke.frustumCorners.TL,Ke.frustumCorners.TR,Ke.frustumCorners.BR,Ke.frustumCorners.BL,Ke.globeCenterInViewSpace,Ke.globeRadius,be,Xe,Ke._farZ,Pt);if(ae(ke,Qe),H&&(P.setupElevationDraw(Be,H,Le),C.uploadCommonUniforms(V,H,ke.toUnwrapped()),ye)){const[jt,zt,Zt]=ye.getGridBuffers(at,Xe!==0);H.draw(C,dt,de,ze,ge,Jt.backCCW,Ct,"globe_raster",jt,zt,Zt)}}}if(ye&&(C.renderDefaultNorthPole||C.renderDefaultSouthPole)){const Ke=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ne&&Ke.push("CUSTOM_ANTIALIASING"),H=C.getOrCreateProgram("globeRaster",{defines:Ke});for(const Xe of z){const{x:dt,y:ke,z:Be}=Xe.canonical,ze=ke===0,et=ke===(1<<Be)-1,[Ge,ot,Qe,st]=ye.getPoleBuffers(Be,!1);if(st&&(ze||et)){const at=D.getTile(Xe);V.activeTexture.set(N.TEXTURE0),at.texture&&at.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);let Pt=o.ds(Be,dt,Q);const Nt=o.bh(o.dr(Xe.canonical)),Ct=(jt,zt)=>jt.draw(C,N.TRIANGLES,de,Qt.disabled,ge,Jt.disabled,Fp(Q.expandedFarZProjMatrix,Pt,Pt,Nt,0,le,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,be,0,Q._farZ),"globe_pole_raster",zt,Qe,st);P.setupElevationDraw(at,H,Le),C.uploadCommonUniforms(V,H,Xe.toUnwrapped()),ze&&C.renderDefaultNorthPole&&Ct(H,Ge),et&&C.renderDefaultSouthPole&&(Pt=o.cE(o.bz(),Pt,[1,-1,1]),Ct(H,ot))}}}})(m,g,v,b,S);else{const C=m.context,P=C.gl;let D,z;const O=m.shadowRenderer,V=wl(m,m.longestCutoffRange),N=ge=>{if(z===ge)return;const de=[];de.push(xc[ge]),V.shouldRenderCutoff&&de.push("RENDER_CUTOFF"),O&&(de.push("RENDER_SHADOWS","DEPTH_TEXTURE"),O.useNormalOffset&&de.push("NORMAL_OFFSET")),D=m.getOrCreateProgram("terrainRaster",{defines:de}),z=ge},H=m.colorModeForRenderPass(),U=new Rt(P.LEQUAL,Rt.ReadWrite,m.depthRangeFor3D);vc.update(S);const Q=m.transform,ne=bc(Q.zoom,g.exaggeration(),g.sourceCache._source.tileSize);let ae=[0,0,0];if(O){const ge=m.style.directionalLight,de=m.style.ambientLight;ge&&de&&(ae=js(m.style,ge,de))}{z=-1;const ge=P.TRIANGLES,[de,fe]=[g.gridIndexBuffer,g.gridSegments];for(const le of b){const ye=v.getTile(le),be=Qt.disabled,Fe=g.prevTerrainTileForTile[le.key],Le=g.terrainTileForTile[le.key];Bp(Fe,Le)&&vc.newMorphing(le.key,Fe,Le,S,250),C.activeTexture.set(P.TEXTURE0),ye.texture&&ye.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);const Ke=vc.getMorphValuesForProxy(le.key),Xe=Ke?1:0;let dt;Ke&&(dt={morphing:{srcDemTile:Ke.from,dstDemTile:Ke.to,phase:o.dk(Ke.phase)}});const ke=Op(le.projMatrix,M_(le.canonical,Q.renderWorldCopies)?ne/10:ne,ae);if(N(Xe),!D)continue;g.setupElevationDraw(ye,D,dt);const Be=le.toUnwrapped();O&&O.setupShadows(Be,D),m.uploadCommonUniforms(C,D,Be,null,V),D.draw(m,ge,U,be,H,Jt.backCCW,ke,"terrain_raster",g.gridBuffer,de,fe)}}}}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,m=this.proxySourceCache,g=this.proxiedCoords[m.id],v=this._drapedRenderBatches.shift(),b=s.style.order,S=[];let C=0;for(const P of g){const D=m.getTileByID(P.proxyTileKey),z=m.proxyCachedFBO[P.key]?m.proxyCachedFBO[P.key][t]:void 0,O=z!==void 0?m.renderCache[z]:this.pool[C++],V=z!==void 0;if(D.texture=O.tex,V&&!O.dirty){S.push(D.tileID);continue}let N;h.bindFramebuffer.set(O.fb.framebuffer),this.renderedToTile=!1,O.dirty&&(h.clear({color:o.am.transparent,stencil:0}),O.dirty=!1);for(let H=v.start;H<=v.end;++H){const U=s.style._mergedLayers[b[H]];if(U.isHidden(s.transform.zoom))continue;const Q=s.style.getLayerSourceCache(U),ne=Q?this.proxyToSource[P.key][Q.id]:[P];if(!ne)continue;const ae=ne;h.viewport.set([0,0,O.fb.width,O.fb.height]),N!==(Q?Q.id:null)&&(this._setupStencil(O,ne,U,Q),N=Q?Q.id:null),s.renderLayer(s,Q,U,ae)}if(this._drapedRenderBatches.length===0)for(const H of this._pendingGroundEffectLayers){const U=s.style._mergedLayers[b[H]];if(U.isHidden(s.transform.zoom))continue;const Q=s.style.getLayerSourceCache(U),ne=Q?this.proxyToSource[P.key][Q.id]:[P];if(!ne)continue;const ae=ne;h.viewport.set([0,0,O.fb.width,O.fb.height]),N!==(Q?Q.id:null)&&(this._setupStencil(O,ne,U,Q),N=Q?Q.id:null),s.renderLayer(s,Q,U,ae)}this.renderedToTile?(O.dirty=!0,S.push(D.tileID)):V||--C,C===5&&(C=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),v.end+1}postRender(){}isLayerOrderingCorrect(t){const s=t.order.length;let h=-1,m=s;for(let g=0;g<s;++g)this._style.isLayerDraped(t._mergedLayers[t.order[g]])?h=Math.max(h,g):m=Math.min(m,g);return m>h}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,h){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const v=g.tileID,b=1<<v.overscaledZ,{x:S,y:C}=v.canonical,P=S/b,D=(S+1)/b,z=C/b,O=(C+1)/b;return{minx:P,miny:z,maxx:D,maxy:O,t:g.dem.tree.raycastRoot(P,z,D,O,t,s,h),tile:g}});m.sort((g,v)=>(g.t!==null?g.t:Number.MAX_VALUE)-(v.t!==null?v.t:Number.MAX_VALUE));for(const g of m){if(g.t==null)return null;const v=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,s,h);if(v!=null)return v}return null}_createFBO(){const t=this.painter.context,s=t.gl,h=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const m=new o.T(t,{width:h[0],height:h[1],data:null},s.RGBA8);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const g=t.createFramebuffer(h[0],h[1],!0,null);return g.colorAttachment.set(m.texture),g.depthAttachment=new kp(t,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._mergedLayers[t],h=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!h&&s.shouldRedrape():!h&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const h of this._style.getSources())if(h instanceof Fr){t=!0;break}if(!t)return;const s={};for(let h=0;h<this._style.order.length;++h){const m=this._style._mergedLayers[this._style.order[h]],g=this._style.getLayerSourceCache(m);if(g&&!s[g.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof o.ab){s[g.id]=!0;for(const v of this.proxyCoords){const b=this.proxyToSource[v.key][g.id];if(b)for(const S of b)this._clearRenderCacheForTile(g.id,S)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof Ns){t=!0;break}if(!t)return;const s={};for(let h=0;h<this._style.order.length;++h){const m=this._style._mergedLayers[this._style.order[h]],g=this._style.getLayerSourceCache(m);if(!g||s[g.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;const v=m.paint.get("raster-fade-duration");for(const b of this.proxyCoords){const S=this.proxyToSource[b.key][g.id];if(S)for(const C of S){const P=Wu(g.getTile(C),g.findLoadedParent(C,0),g,this.painter.transform,v);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(g.id,C)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,s=t.length;if(s===0)return;const h=[];this._pendingGroundEffectLayers=[];let m,g=0,v=this._style._mergedLayers[t[g]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++g<s;)v=this._style._mergedLayers[t[g]];for(;g<s;++g){const b=this._style._mergedLayers[t[g]];b.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(b)?m===void 0&&(m=g):(b.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(g),m!==void 0&&(h.push({start:m,end:g-1}),m=void 0)))}if(m!==void 0&&h.push({start:m,end:g-1}),h.length!==0){const b=h[h.length-1];this._pendingGroundEffectLayers.every(S=>S>b.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const v=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let b=0;b<v.length;++b){const S=Object.values(v[b]);s.renderCachePool.push(...S)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,m=this._tilesDirty;for(let v=h.length-1;v>=0;v--){const b=h[v];if(s.getTileByID(b.key),s.proxyCachedFBO[b.key]!==void 0){const S=t[b.key],C=this.proxyToSource[b.key];let P=0;for(const D in C){const z=C[D],O=S[D];if(!O||O.length!==z.length||z.some((V,N)=>V!==O[N]||m[D]&&m[D].hasOwnProperty(V.key))){P=-1;break}++P}for(const D in s.proxyCachedFBO[b.key])s.renderCache[s.proxyCachedFBO[b.key][D]].dirty=P<0||P!==Object.values(S).length}}const g=[...this._drapedRenderBatches];g.sort((v,b)=>b.end-b.start-(v.end-v.start));for(const v of g)for(const b of h){if(s.proxyCachedFBO[b.key])continue;let S=s.renderCachePool.pop();S===void 0&&s.renderCache.length<50&&(S=s.renderCache.length,s.renderCache.push(this._createFBO())),S!==void 0&&(s.proxyCachedFBO[b.key]={},s.proxyCachedFBO[b.key][v.start]=S,s.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,h,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,v=g.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let b;if(h.isTileClipped())b=s.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);b=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+b>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=b,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Qt.disabled}_renderTileClippingMasks(t,s){const h=this.painter,m=this.painter.context,g=m.gl;h._tileClippingMaskIDs={},m.setColorMode(bi.disabled),m.setDepthMode(Rt.disabled);const v=h.getOrCreateProgram("clippingMask");for(const b of t){const S=h._tileClippingMaskIDs[b.key]=--s;v.draw(h,g.TRIANGLES,Rt.disabled,new Qt({func:g.ALWAYS,mask:0},S,255,g.KEEP,g.KEEP,g.REPLACE),bi.disabled,Jt.disabled,_o(b.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const h=[t.x,t.y,1,1];o.aA(h,h,s.pixelMatrixInverse),o.cw(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const m=s._camera.position,g=o.c6(1,s.center.lat),v=[m[0],m[1],m[2]/g,0],b=o.cY([],h.slice(0,3),v);o.au(b,b);const S=this.raycast(v,b,this._exaggeration);return S!==null&&S?(o.bF(v,v,b,S),v[3]=v[2],v[2]*=g,v):null}_setupProxiedCoordsForOrtho(t,s,h){if(t.getSource()instanceof o.aP)return this._setupProxiedCoordsForImageSource(t,s,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let S=0;S<g.length;S++){const C=g[S],P=this._findTileCoveringTileID(C,t);if(P){const D=this._createProxiedId(C,P,h[C.key]&&h[C.key][t.id]);m.push(D),this.proxyToSource[C.key][t.id]=[D]}}let v=!1;const b=new Set;for(let S=0;S<s.length;S++){const C=t.getTile(s[S]);if(!C||!C.hasData())continue;const P=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==C.tileID.canonical.z){const D=this.proxyToSource[P.tileID.key][t.id],z=this._createProxiedId(P.tileID,C,h[P.tileID.key]&&h[P.tileID.key][t.id]);D?D.splice(D.length-1,0,z):this.proxyToSource[P.tileID.key][t.id]=[z];const O=this.proxyToSource[P.tileID.key][t.id];b.has(O)||b.add(O),m.push(z),v=!0}}if(this._sourceTilesOverlap[t.id]=v,v&&this._debugParams.sortTilesHiZFirst)for(const S of b)S.sort((C,P)=>P.overscaledZ-C.overscaledZ)}_setupProxiedCoordsForImageSource(t,s,h){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords,v=t.getSource(),b=v.tileID;if(!b)return;const S=new o.P(b.x,b.y)._div(1<<b.z),C=v.coordinates.map(o.ac.fromLngLat).reduce((D,z)=>(D.min.x=Math.min(D.min.x,z.x-S.x),D.min.y=Math.min(D.min.y,z.y-S.y),D.max.x=Math.max(D.max.x,z.x-S.x),D.max.y=Math.max(D.max.y,z.y-S.y),D),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(D,z)=>{const O=D.wrap+D.canonical.x/(1<<D.canonical.z),V=D.canonical.y/(1<<D.canonical.z),N=o.aj/(1<<D.canonical.z),H=z.wrap+z.canonical.x/(1<<z.canonical.z),U=z.canonical.y/(1<<z.canonical.z);return O+N<H+C.min.x||O>H+C.max.x||V+N<U+C.min.y||V>U+C.max.y};for(let D=0;D<g.length;D++){const z=g[D];for(let O=0;O<s.length;O++){const V=t.getTile(s[O]);if(!V||!V.hasData()||P(z,V.tileID))continue;const N=this._createProxiedId(z,V,h[z.key]&&h[z.key][t.id]),H=this.proxyToSource[z.key][t.id];H?H.push(N):this.proxyToSource[z.key][t.id]=[N],m.push(N)}}}_createProxiedId(t,s,h){let m=this.orthoMatrix;if(h){const g=h.find(v=>v.key===s.tileID.key);if(g)return g}if(s.tileID.key!==t.key){const g=t.canonical.z-s.tileID.canonical.z;let v,b,S;m=o.bz();const C=s.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(v=o.aj>>g,b=v*((s.tileID.canonical.x<<g)-t.canonical.x+C),S=v*((s.tileID.canonical.y<<g)-t.canonical.y)):(v=o.aj<<-g,b=o.aj*(s.tileID.canonical.x-(t.canonical.x+C<<-g)),S=o.aj*(s.tileID.canonical.y-(t.canonical.y<<-g))),o.c5(m,0,v,0,v,0,1),o.bo(m,m,[b,S,0])}return new Sd(s.tileID,t.key,m)}_findTileCoveringTileID(t,s){let h=s.getTile(t);if(h&&h.hasData())return h;const m=this._findCoveringTileCache[s.id],g=m[t.key];if(h=g?s.getTileByID(g):null,h&&h.hasData()||g===null)return h;let v=h?h.tileID:t,b=v.overscaledZ;const S=s.getSource().minzoom,C=[];if(!g){const D=s.getSource().maxzoom;if(t.canonical.z>=D){const z=t.canonical.z-D;s.getSource().reparseOverscaled?(b=Math.max(t.canonical.z+2,s.transform.tileZoom),v=new o.aM(b,t.wrap,D,t.canonical.x>>z,t.canonical.y>>z)):z!==0&&(b=D,v=new o.aM(b,t.wrap,D,t.canonical.x>>z,t.canonical.y>>z))}v.key!==t.key&&(C.push(v.key),h=s.getTile(v))}const P=D=>{C.forEach(z=>{m[z]=D}),C.length=0};for(b-=1;b>=S&&(!h||!h.hasData());b--){h&&P(h.tileID.key);const D=v.calculateScaledKey(b);if(h=s.getTileByID(D),h&&h.hasData())break;const z=m[D];if(z===null)break;z===void 0?C.push(D):h=s.getTileByID(z)}return P(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[s.key]=!0}}function Np(u,t,s){const h=function(b,S,C){const P=o.bE(S,b),D=o.bE(C,[.2126,.7152,.0722]),z=(V,N,H)=>(1-H)*V+H*N,O=z(1-.3*Math.min(D,1),1,Math.min(P+1,1));return z(.92,1,Math.asin(o.aD(S[2],-1,1))/Math.PI+.5)*O}(u,[0,0,1],t),m=[0,0,0];o.b$(m,s.slice(0,3),h);const g=[0,0,0];o.b$(g,t.slice(0,3),u[2]);const v=[0,0,0];return o.cU(v,m,g),o.cX(v)}const Id=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],jp=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Ad{static cacheKey(t,s,h,m){let g=`${s}${m?m.cacheKey:""}`;for(const v of h)t.usedDefines.includes(v)&&(g+=`/${v}`);return g}constructor(t,s,h,m,g,v){const b=t.gl;this.program=b.createProgram(),this.configuration=m,this.name=s,this.fixedDefines=[...v];const S=m?m.getBinderAttributes():[],C=(h.staticAttributes||[]).concat(S);let P=m?m.defines():[];P=P.concat(v.map(H=>`#define ${H}`));const D=`#version 300 es
`;let z=D+P.concat("precision mediump float;",$u,ja.fragmentSource).join(`
`);for(const H of h.fragmentIncludes)z+=`
${ts[H]}`;z+=`
${h.fragmentSource}`;let O=D+P.concat("precision highp float;",$u,ja.vertexSource).join(`
`);for(const H of h.vertexIncludes)O+=`
${ts[H]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&h.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(O+=`
uniform int u_instanceID;
`),O+=`
${h.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(O=O.replaceAll("gl_InstanceID","u_instanceID"));const V=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(V,z),b.compileShader(V),b.attachShader(this.program,V);const N=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())this.failedToCreate=!0;else{b.shaderSource(N,O),b.compileShader(N),b.attachShader(this.program,N),this.attributes={},this.numAttributes=C.length;for(let H=0;H<this.numAttributes;H++)if(C[H]){const U=C[H].startsWith("a_")?C[H]:`a_${C[H]}`;b.bindAttribLocation(this.program,H,U),this.attributes[U]=H}b.linkProgram(this.program),b.deleteShader(N),b.deleteShader(V),this.fixedUniforms=g(t),this.binderUniforms=m?m.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(H=>({u_instanceID:new o.cc(H)}))(t)),(v.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(H=>({u_dem:new o.cc(H),u_dem_prev:new o.cc(H),u_dem_tl:new o.c9(H),u_dem_scale:new o.cb(H),u_dem_tl_prev:new o.c9(H),u_dem_scale_prev:new o.cb(H),u_dem_size:new o.cb(H),u_dem_lerp:new o.cb(H),u_exaggeration:new o.cb(H),u_depth:new o.cc(H),u_depth_size_inv:new o.c9(H),u_depth_range_unpack:new o.c9(H),u_occluder_half_size:new o.cb(H),u_occlusion_depth_offset:new o.cb(H),u_meter_to_dem:new o.cb(H),u_label_plane_matrix_inv:new o.c8(H)}))(t)),v.includes("GLOBE")&&(this.globeUniforms=(H=>({u_tile_tl_up:new o.ca(H),u_tile_tr_up:new o.ca(H),u_tile_br_up:new o.ca(H),u_tile_bl_up:new o.ca(H),u_tile_up_scale:new o.cb(H)}))(t)),v.includes("FOG")&&(this.fogUniforms=(H=>({u_fog_matrix:new o.c8(H),u_fog_range:new o.c9(H),u_fog_color:new o.cQ(H),u_fog_horizon_blend:new o.cb(H),u_fog_vertical_limit:new o.c9(H),u_fog_temporal_offset:new o.cb(H),u_frustum_tl:new o.ca(H),u_frustum_tr:new o.ca(H),u_frustum_br:new o.ca(H),u_frustum_bl:new o.ca(H),u_globe_pos:new o.ca(H),u_globe_radius:new o.cb(H),u_globe_transition:new o.cb(H),u_is_globe:new o.cc(H),u_viewport:new o.c9(H)}))(t)),v.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(H=>({u_cutoff_params:new o.cQ(H)}))(t)),v.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(H=>({u_lighting_ambient_color:new o.ca(H),u_lighting_directional_dir:new o.ca(H),u_lighting_directional_color:new o.ca(H),u_ground_radiance:new o.ca(H)}))(t)),v.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(H=>({u_light_matrix_0:new o.c8(H),u_light_matrix_1:new o.c8(H),u_fade_range:new o.c9(H),u_shadow_normal_offset:new o.ca(H),u_shadow_intensity:new o.cb(H),u_shadow_texel_size:new o.cb(H),u_shadow_map_resolution:new o.cb(H),u_shadow_direction:new o.ca(H),u_shadow_bias:new o.ca(H),u_shadowmap_0:new o.cc(H),u_shadowmap_1:new o.cc(H)}))(t))}}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m]&&h[m].set(this.program,m,s[m])}}setGlobeUniformValues(t,s){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m]&&h[m].set(this.program,m,s[m])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setCutoffUniformValues(t,s){if(!this.cutoffUniforms)return;const h=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setLightsUniformValues(t,s){if(!this.lightsUniforms)return;const h=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setShadowUniformValues(t,s){if(this.failedToCreate||!this.shadowUniforms)return;const h=this.shadowUniforms;t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}_drawDebugWireframe(t,s,h,m,g,v,b,S,C,P){const D=t.options.wireframe;if(D.terrain===!1&&D.layers2D===!1&&D.layers3D===!1)return;const z=t.context;if(!(!(!D.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!D.layers2D||t._terrain&&t._terrain.renderingToTexture||!Id.includes(this.name))||!(!D.layers3D||!jp.includes(this.name))))return;const O=z.gl,V=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,g,z);if(!V)return;const N=[...this.fixedDefines];N.push("DEBUG_WIREFRAME");const H=t.getOrCreateProgram(this.name,{config:this.configuration,defines:N});z.program.set(H.program);const U=(ae,ge,de)=>{if(ge[ae]&&de[ae])for(const fe in ge[ae])de[ae][fe]&&de[ae][fe].set(de.program,fe,ge[ae][fe].current)};C&&C.setUniforms(H.program,z,H.binderUniforms,b,{zoom:S}),U("fixedUniforms",this,H),U("terrainUniforms",this,H),U("globeUniforms",this,H),U("fogUniforms",this,H),U("lightsUniforms",this,H),U("shadowUniforms",this,H),V.bind(),z.setColorMode(new bi([O.ONE,O.ONE_MINUS_SRC_ALPHA,O.ZERO,O.ONE],o.am.transparent,[!0,!0,!0,!1])),z.setDepthMode(new Rt(s.func===O.LESS?O.LEQUAL:s.func,Rt.ReadOnly,s.range)),z.setStencilMode(Qt.disabled);const Q=3*v.primitiveLength*2,ne=3*v.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ae=P||1;for(let ge=0;ge<ae;++ge)H.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),O.drawElements(O.LINES,Q,O.UNSIGNED_SHORT,ne)}else P&&P>1?O.drawElementsInstanced(O.LINES,Q,O.UNSIGNED_SHORT,ne,P):O.drawElements(O.LINES,Q,O.UNSIGNED_SHORT,ne);g.bind(),z.program.set(this.program),z.setDepthMode(s),z.setStencilMode(h),z.setColorMode(m)}checkUniforms(t,s,h){if(this.fixedDefines.includes(s)){for(const m of Object.keys(h))if(!h[m].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${m} not set but required by ${s} being defined`)}}draw(t,s,h,m,g,v,b,S,C,P,D,z,O,V,N,H){const U=t.context,Q=U.gl;if(this.failedToCreate)return;U.program.set(this.program),U.setDepthMode(h),U.setStencilMode(m),U.setColorMode(g),U.setCullFace(v);for(const ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(this.program,ge,b[ge]);V&&V.setUniforms(this.program,U,this.binderUniforms,z,{zoom:O});const ne={[Q.POINTS]:1,[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[s];this.checkUniforms(S,"RENDER_SHADOWS",this.shadowUniforms);const ae=H&&H>0?1:void 0;for(const ge of D.get()){const de=ge.vaos||(ge.vaos={});if((de[S]||(de[S]=new Ep)).bind(U,this,C,V?V.getPaintVertexBuffers():[],P,ge.vertexOffset,N||[],ae),this.forceManualRenderingForInstanceIDShaders){const fe=H||1;for(let le=0;le<fe;++le)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",le),P?Q.drawElements(s,ge.primitiveLength*ne,Q.UNSIGNED_SHORT,ge.primitiveOffset*ne*2):Q.drawArrays(s,ge.vertexOffset,ge.vertexLength)}else H&&H>1?Q.drawElementsInstanced(s,ge.primitiveLength*ne,Q.UNSIGNED_SHORT,ge.primitiveOffset*ne*2,H):P?Q.drawElements(s,ge.primitiveLength*ne,Q.UNSIGNED_SHORT,ge.primitiveOffset*ne*2):Q.drawArrays(s,ge.vertexOffset,ge.vertexLength);s===Q.TRIANGLES&&P&&this._drawDebugWireframe(t,h,m,g,P,ge,z,O,V,H)}}}function Zu(u,t,s=0){const h=Math.pow(2,t.tileID.overscaledZ),m=t.tileSize*Math.pow(2,u.transform.tileZoom)/h,g=m*(t.tileID.canonical.x+t.tileID.wrap*h),v=m*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.aw(t,1,u.transform.tileZoom),u_pixel_coord_upper:[g>>16,v>>16],u_pixel_coord_lower:[65535&g,65535&v],u_pattern_transition:s}}const Xu={terrain:0,flat:1},P_=o.bz(),Il=(u,t,s,h,m,g,v,b,S,C,P,D,z,O,V,N,H,U)=>{const Q=t.style.light,ne=Q.properties.get("position"),ae=[ne.x,ne.y,ne.z],ge=o.dx();Q.properties.get("anchor")==="viewport"&&(o.dy(ge,-t.transform.angle),o.dz(ae,ae,ge));const de=Q.properties.get("color"),fe=t.transform,le={u_matrix:u,u_lightpos:ae,u_lightintensity:Q.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:P_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Xu[C],u_base_type:Xu[P],u_ao:m,u_edge_radius:g,u_width_scale:v,u_flood_light_color:V,u_vertical_scale:N,u_flood_light_intensity:H,u_ground_shadow_factor:U};return fe.projection.name==="globe"&&(le.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],le.u_zoom_transition=D,le.u_inv_rot_matrix=O,le.u_merc_center=z,le.u_up_dir=fe.projection.upVector(new o.cp(0,0,0),z[0]*o.aj,z[1]*o.aj),le.u_height_lift=S),le},mx=(u,t,s,h,m,g)=>({u_matrix:u,u_edge_radius:t,u_width_scale:s,u_vertical_scale:h,u_height_type:Xu[m],u_base_type:Xu[g]}),gx=(u,t,s,h,m,g,v,b,S,C,P,D,z,O,V,N,H,U)=>{const Q=Il(u,t,s,h,m,g,v,b,C,P,D,z,O,V,N,H,1,[0,0,0]),ne={u_height_factor:-Math.pow(2,b.overscaledZ)/S.tileSize/8};return o.l(Q,Zu(t,S,U),ne)},R_=(u,t,s)=>({u_matrix:u,u_emissive_strength:t,u_ground_shadow_factor:s}),z_=(u,t,s,h,m,g=0)=>o.l(R_(u,t,m),Zu(s,h,g)),_x=(u,t,s,h)=>({u_matrix:u,u_world:s,u_emissive_strength:t,u_ground_shadow_factor:h}),yx=(u,t,s,h,m,g,v=0)=>o.l(z_(u,t,s,h,g,v),{u_world:m}),Vp=(u,t)=>({u_matrix:u,u_ground_shadow_factor:t}),Yu=(u,t,s,h,m)=>({u_matrix:u,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:s,u_height_scale:h,u_reset_depth:m}),D_=(u,t,s,h)=>{const m=o.aj/s.tileSize;return{u_matrix:u,u_camera_to_center_distance:t.getCameraToCenterDistance(h),u_extrude_scale:[t.pixelsToGLUnits[0]/m,t.pixelsToGLUnits[1]/m]}},Al=(u,t,s=1)=>({u_matrix:u,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:s}),L_=o.bz(),k_=(u,t,s,h,m,g,v)=>{const b=u.transform,S=b.projection.name==="globe",C=S?o.dA(b.zoom,t.canonical)*b._pixelsPerMercatorPixel:o.aw(s,1,g),P={u_matrix:t.projMatrix,u_extrude_scale:C,u_intensity:v,u_inv_rot_matrix:L_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){P.u_inv_rot_matrix=h,P.u_merc_center=m,P.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],P.u_zoom_transition=o.ah(b.zoom);const D=m[0]*o.aj,z=m[1]*o.aj;P.u_up_dir=b.projection.upVector(new o.cp(0,0,0),D,z)}return P};function Up(u,[t,s,h,m],[g,v]){if(g===v)return[0,0,0,0];const b=255*(u-1)/(u*(v-g));return[t*b,s*b,h*b,m*b]}function Cd(u,t,[s,h]){return s===h?0:.5/u+(t-s)*(u-1)/(u*(h-s))}const Va=(u,t,s,h,m,g,v,b,S,C,P,D,z,O,V,N,H,U,Q,ne,ae)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:m,u_tl_parent:g,u_scale_parent:C,u_fade_t:P.mix,u_opacity:P.opacity*D.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:D.paint.get("raster-brightness-min"),u_brightness_high:D.paint.get("raster-brightness-max"),u_saturation_factor:o.dB(D.paint.get("raster-saturation")),u_contrast_factor:o.dC(D.paint.get("raster-contrast")),u_spin_weights:O_(D.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:O,u_zoom_transition:v,u_merc_center:b,u_cutoff_params:S,u_colorization_mix:Up(o.dD,N,U),u_colorization_offset:Cd(o.dD,H,U),u_color_ramp:V,u_texture_offset:[ne/(Q+2*ne),Q/(Q+2*ne)],u_texture_res:[Q+2*ne,Q+2*ne],u_emissive_strength:ae});function O_(u){u*=Math.PI/180;const t=Math.sin(u),s=Math.cos(u);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const No=.05,Gp=(u,t,s,h,m,g,v,b,S,C,P,D)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:m,u_tl_parent:g,u_scale_parent:C,u_fade_t:P.mix,u_opacity:P.opacity,u_image0:0,u_image1:1,u_raster_elevation:D,u_zoom_transition:v,u_merc_center:b,u_cutoff_params:S}),Md=(u,t,s,h,m,g,v,b,S,C)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_tile_offset:s,u_velocity:h,u_color_ramp:g,u_velocity_res:m,u_max_speed:v,u_uv_offset:b,u_data_scale:[255*S[0],255*S[1]],u_data_offset:C,u_particle_pos_scale:1.1,u_particle_pos_offset:[No,No]}),F_=(u,t,s,h,m,g,v,b,S,C)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_velocity:s,u_velocity_res:h,u_max_speed:m,u_speed_factor:g,u_reset_rate:v,u_rand_seed:Math.random(),u_uv_offset:b,u_data_scale:[255*S[0],255*S[1]],u_data_offset:C,u_particle_pos_scale:1.1,u_particle_pos_offset:[No,No]}),$p=o.bz(),Pd=(u,t,s,h,m,g,v,b,S,C,P,D,z,O,V,N,H,U,Q,ne,ae,ge,de)=>{const fe=m.transform,le={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:fe.getCameraToCenterDistance(Q),u_rotate_symbol:+s,u_aspect_ratio:fe.width/fe.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:v,u_coord_matrix:b,u_is_text:+C,u_elevation_from_sea:S?1:0,u_pitch_with_map:+h,u_texsize:P,u_texsize_icon:D,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$p,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:$p,u_up_vector:[0,-1,0],u_color_adj_mat:ae,u_icon_transition:ge||0,u_gamma_scale:h?m.transform.getCameraToCenterDistance(Q)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:+z,u_scale_factor:de||1,u_ground_shadow_factor:ne,u_inv_matrix:o.bi(o.bz(),v)};return Q.name==="globe"&&(le.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],le.u_zoom_transition=V,le.u_inv_rot_matrix=H,le.u_merc_center=N,le.u_camera_forward=fe._camera.forward(),le.u_ecef_origin=o.dE(fe.globeMatrix,O.toUnwrapped()),le.u_tile_matrix=Float32Array.from(fe.globeMatrix),le.u_up_vector=U),le},Rd=(u,t,s,h)=>({u_matrix:u,u_emissive_strength:t,u_opacity:s,u_color:h}),B_=(u,t,s,h,m,g,v,b,S)=>o.l(function(C,P,D,z,O,V){const{width:N,height:H}=z.imageManager.getPixelSize(P),U=Math.pow(2,V.tileID.overscaledZ),Q=V.tileSize*Math.pow(2,z.transform.tileZoom)/U,ne=Q*(V.tileID.canonical.x+V.tileID.wrap*U),ae=Q*V.tileID.canonical.y;return{u_image:0,u_pattern_tl:D.tl,u_pattern_br:D.br,u_texsize:[N,H],u_pattern_size:D.displaySize,u_pattern_units_to_pixels:O?[z.transform.width,-1*z.transform.height]:[1/o.aw(V,1,z.transform.tileZoom),1/o.aw(V,1,z.transform.tileZoom)],u_pixel_coord_upper:[ne>>16,ae>>16],u_pixel_coord_lower:[65535&ne,65535&ae]}}(0,g,v,h,b,S),{u_matrix:u,u_emissive_strength:t,u_opacity:s}),zd=new Float32Array(o.bx([])),Cl=(u,t,s,h,m,g,v,b,S,C,P,D,z,O=[0,0,0],V)=>{const N=m.style.light,H=N.properties.get("position"),U=[-H.x,-H.y,H.z],Q=o.dx();N.properties.get("anchor")==="viewport"&&(o.dy(Q,-m.transform.angle),o.dz(U,U,Q));const ne=P.alphaMode==="MASK",ae=N.properties.get("color").toRenderColor(null),ge=z.paint.get("model-ambient-occlusion-intensity"),de=z.paint.get("model-color").constantOr(o.am.white).toRenderColor(null),fe=z.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:u,u_lighting_matrix:t,u_normal_matrix:s,u_node_matrix:h||zd,u_lightpos:U,u_lightintensity:N.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_camera_pos:O,u_opacity:g,u_baseTextureIsAlpha:0,u_alphaMask:+ne,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:[v.r,v.g,v.b,v.a],u_emissiveFactor:[b[0],b[1],b[2],1],u_metallicFactor:S,u_roughnessFactor:C,u_baseColorTexture:so.BaseColor,u_metallicRoughnessTexture:so.MetallicRoughness,u_normalTexture:so.Normal,u_occlusionTexture:so.Occlusion,u_emissionTexture:so.Emission,u_lutTexture:so.LUT,u_color_mix:[de.r,de.g,de.b,fe],u_aoIntensity:ge,u_emissive_strength:D,u_occlusionTextureTransform:V||[0,0,0,0]}},N_=(u,t=zd,s=zd)=>({u_matrix:u,u_instance:t,u_node_matrix:s}),vx={fillExtrusion:u=>({u_matrix:new o.c8(u),u_lightpos:new o.ca(u),u_lightintensity:new o.cb(u),u_lightcolor:new o.ca(u),u_vertical_gradient:new o.cb(u),u_opacity:new o.cb(u),u_edge_radius:new o.cb(u),u_width_scale:new o.cb(u),u_ao:new o.c9(u),u_height_type:new o.cc(u),u_base_type:new o.cc(u),u_tile_id:new o.ca(u),u_zoom_transition:new o.cb(u),u_inv_rot_matrix:new o.c8(u),u_merc_center:new o.c9(u),u_up_dir:new o.ca(u),u_height_lift:new o.cb(u),u_flood_light_color:new o.ca(u),u_vertical_scale:new o.cb(u),u_flood_light_intensity:new o.cb(u),u_ground_shadow_factor:new o.ca(u)}),fillExtrusionDepth:u=>({u_matrix:new o.c8(u),u_edge_radius:new o.cb(u),u_width_scale:new o.cb(u),u_vertical_scale:new o.cb(u),u_height_type:new o.cc(u),u_base_type:new o.cc(u)}),fillExtrusionPattern:u=>({u_matrix:new o.c8(u),u_lightpos:new o.ca(u),u_lightintensity:new o.cb(u),u_lightcolor:new o.ca(u),u_vertical_gradient:new o.cb(u),u_height_factor:new o.cb(u),u_edge_radius:new o.cb(u),u_width_scale:new o.cb(u),u_ao:new o.c9(u),u_height_type:new o.cc(u),u_base_type:new o.cc(u),u_tile_id:new o.ca(u),u_zoom_transition:new o.cb(u),u_inv_rot_matrix:new o.c8(u),u_merc_center:new o.c9(u),u_up_dir:new o.ca(u),u_height_lift:new o.cb(u),u_image:new o.cc(u),u_texsize:new o.c9(u),u_pixel_coord_upper:new o.c9(u),u_pixel_coord_lower:new o.c9(u),u_tile_units_to_pixels:new o.cb(u),u_opacity:new o.cb(u),u_pattern_transition:new o.cb(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new o.c8(u),u_opacity:new o.cb(u),u_ao_pass:new o.cb(u),u_meter_to_tile:new o.cb(u),u_ao:new o.c9(u),u_flood_light_intensity:new o.cb(u),u_flood_light_color:new o.ca(u),u_attenuation:new o.cb(u),u_edge_radius:new o.cb(u),u_fb:new o.cc(u),u_fb_size:new o.cb(u),u_dynamic_offset:new o.cb(u)}),fill:u=>({u_matrix:new o.c8(u),u_emissive_strength:new o.cb(u),u_ground_shadow_factor:new o.ca(u)}),fillPattern:u=>({u_matrix:new o.c8(u),u_emissive_strength:new o.cb(u),u_image:new o.cc(u),u_texsize:new o.c9(u),u_pixel_coord_upper:new o.c9(u),u_pixel_coord_lower:new o.c9(u),u_tile_units_to_pixels:new o.cb(u),u_ground_shadow_factor:new o.ca(u),u_pattern_transition:new o.cb(u)}),fillOutline:u=>({u_matrix:new o.c8(u),u_emissive_strength:new o.cb(u),u_world:new o.c9(u),u_ground_shadow_factor:new o.ca(u)}),fillOutlinePattern:u=>({u_matrix:new o.c8(u),u_emissive_strength:new o.cb(u),u_world:new o.c9(u),u_image:new o.cc(u),u_texsize:new o.c9(u),u_pixel_coord_upper:new o.c9(u),u_pixel_coord_lower:new o.c9(u),u_tile_units_to_pixels:new o.cb(u),u_ground_shadow_factor:new o.ca(u),u_pattern_transition:new o.cb(u)}),building:u=>({u_matrix:new o.c8(u),u_normal_matrix:new o.c8(u),u_opacity:new o.cb(u)}),buildingDepth:u=>({u_matrix:new o.c8(u)}),elevatedStructuresDepth:u=>({u_matrix:new o.c8(u),u_depth_bias:new o.cb(u)}),elevatedStructures:u=>({u_matrix:new o.c8(u),u_ground_shadow_factor:new o.ca(u)}),elevatedStructuresDepthReconstruct:u=>({u_matrix:new o.c8(u),u_camera_pos:new o.ca(u),u_depth_bias:new o.cb(u),u_height_scale:new o.cb(u),u_reset_depth:new o.cb(u)}),circle:o.dF,collisionBox:u=>({u_matrix:new o.c8(u),u_camera_to_center_distance:new o.cb(u),u_extrude_scale:new o.c9(u)}),collisionCircle:u=>({u_matrix:new o.c8(u),u_inv_matrix:new o.c8(u),u_camera_to_center_distance:new o.cb(u),u_viewport_size:new o.c9(u)}),debug:u=>({u_color:new o.di(u),u_matrix:new o.c8(u),u_overlay:new o.cc(u),u_overlay_scale:new o.cb(u)}),clippingMask:u=>({u_matrix:new o.c8(u)}),heatmap:u=>({u_extrude_scale:new o.cb(u),u_intensity:new o.cb(u),u_matrix:new o.c8(u),u_inv_rot_matrix:new o.c8(u),u_merc_center:new o.c9(u),u_tile_id:new o.ca(u),u_zoom_transition:new o.cb(u),u_up_dir:new o.ca(u)}),heatmapTexture:u=>({u_image:new o.cc(u),u_color_ramp:new o.cc(u),u_opacity:new o.cb(u)}),hillshade:u=>({u_matrix:new o.c8(u),u_image:new o.cc(u),u_latrange:new o.c9(u),u_light:new o.c9(u),u_shadow:new o.di(u),u_highlight:new o.di(u),u_emissive_strength:new o.cb(u),u_accent:new o.di(u)}),hillshadePrepare:u=>({u_matrix:new o.c8(u),u_image:new o.cc(u),u_dimension:new o.c9(u),u_zoom:new o.cb(u)}),line:o.dG,linePattern:o.dH,raster:u=>({u_matrix:new o.c8(u),u_normalize_matrix:new o.c8(u),u_globe_matrix:new o.c8(u),u_merc_matrix:new o.c8(u),u_grid_matrix:new o.dj(u),u_tl_parent:new o.c9(u),u_scale_parent:new o.cb(u),u_fade_t:new o.cb(u),u_opacity:new o.cb(u),u_image0:new o.cc(u),u_image1:new o.cc(u),u_brightness_low:new o.cb(u),u_brightness_high:new o.cb(u),u_saturation_factor:new o.cb(u),u_contrast_factor:new o.cb(u),u_spin_weights:new o.ca(u),u_perspective_transform:new o.c9(u),u_raster_elevation:new o.cb(u),u_zoom_transition:new o.cb(u),u_merc_center:new o.c9(u),u_cutoff_params:new o.cQ(u),u_colorization_mix:new o.cQ(u),u_colorization_offset:new o.cb(u),u_color_ramp:new o.cc(u),u_texture_offset:new o.c9(u),u_texture_res:new o.c9(u),u_emissive_strength:new o.cb(u)}),rasterParticle:u=>({u_matrix:new o.c8(u),u_normalize_matrix:new o.c8(u),u_globe_matrix:new o.c8(u),u_merc_matrix:new o.c8(u),u_grid_matrix:new o.dj(u),u_tl_parent:new o.c9(u),u_scale_parent:new o.cb(u),u_fade_t:new o.cb(u),u_opacity:new o.cb(u),u_image0:new o.cc(u),u_image1:new o.cc(u),u_raster_elevation:new o.cb(u),u_zoom_transition:new o.cb(u),u_merc_center:new o.c9(u),u_cutoff_params:new o.cQ(u)}),rasterParticleTexture:u=>({u_texture:new o.cc(u),u_opacity:new o.cb(u)}),rasterParticleDraw:u=>({u_particle_texture:new o.cc(u),u_particle_texture_side_len:new o.cb(u),u_tile_offset:new o.c9(u),u_velocity:new o.cc(u),u_color_ramp:new o.cc(u),u_velocity_res:new o.c9(u),u_max_speed:new o.cb(u),u_uv_offset:new o.c9(u),u_data_scale:new o.c9(u),u_data_offset:new o.cb(u),u_particle_pos_scale:new o.cb(u),u_particle_pos_offset:new o.c9(u)}),rasterParticleUpdate:u=>({u_particle_texture:new o.cc(u),u_particle_texture_side_len:new o.cb(u),u_velocity:new o.cc(u),u_velocity_res:new o.c9(u),u_max_speed:new o.cb(u),u_speed_factor:new o.cb(u),u_reset_rate:new o.cb(u),u_rand_seed:new o.cb(u),u_uv_offset:new o.c9(u),u_data_scale:new o.c9(u),u_data_offset:new o.cb(u),u_particle_pos_scale:new o.cb(u),u_particle_pos_offset:new o.c9(u)}),symbol:u=>({u_is_size_zoom_constant:new o.cc(u),u_is_size_feature_constant:new o.cc(u),u_size_t:new o.cb(u),u_size:new o.cb(u),u_camera_to_center_distance:new o.cb(u),u_rotate_symbol:new o.cc(u),u_aspect_ratio:new o.cb(u),u_fade_change:new o.cb(u),u_matrix:new o.c8(u),u_label_plane_matrix:new o.c8(u),u_coord_matrix:new o.c8(u),u_is_text:new o.cc(u),u_elevation_from_sea:new o.cc(u),u_pitch_with_map:new o.cc(u),u_texsize:new o.c9(u),u_texsize_icon:new o.c9(u),u_texture:new o.cc(u),u_texture_icon:new o.cc(u),u_gamma_scale:new o.cb(u),u_device_pixel_ratio:new o.cb(u),u_tile_id:new o.ca(u),u_zoom_transition:new o.cb(u),u_inv_rot_matrix:new o.c8(u),u_merc_center:new o.c9(u),u_camera_forward:new o.ca(u),u_tile_matrix:new o.c8(u),u_up_vector:new o.ca(u),u_ecef_origin:new o.ca(u),u_is_halo:new o.cc(u),u_icon_transition:new o.cb(u),u_color_adj_mat:new o.c8(u),u_scale_factor:new o.cb(u),u_ground_shadow_factor:new o.ca(u),u_inv_matrix:new o.c8(u)}),background:u=>({u_matrix:new o.c8(u),u_emissive_strength:new o.cb(u),u_opacity:new o.cb(u),u_color:new o.di(u)}),backgroundPattern:u=>({u_matrix:new o.c8(u),u_emissive_strength:new o.cb(u),u_opacity:new o.cb(u),u_image:new o.cc(u),u_pattern_tl:new o.c9(u),u_pattern_br:new o.c9(u),u_texsize:new o.c9(u),u_pattern_size:new o.c9(u),u_pixel_coord_upper:new o.c9(u),u_pixel_coord_lower:new o.c9(u),u_pattern_units_to_pixels:new o.c9(u)}),terrainRaster:u=>({u_matrix:new o.c8(u),u_image0:new o.cc(u),u_skirt_height:new o.cb(u),u_ground_shadow_factor:new o.ca(u)}),skybox:u=>({u_matrix:new o.c8(u),u_sun_direction:new o.ca(u),u_cubemap:new o.cc(u),u_opacity:new o.cb(u),u_temporal_offset:new o.cb(u)}),skyboxGradient:u=>({u_matrix:new o.c8(u),u_color_ramp:new o.cc(u),u_center_direction:new o.ca(u),u_radius:new o.cb(u),u_opacity:new o.cb(u),u_temporal_offset:new o.cb(u)}),skyboxCapture:u=>({u_matrix_3f:new o.dj(u),u_sun_direction:new o.ca(u),u_sun_intensity:new o.cb(u),u_color_tint_r:new o.cQ(u),u_color_tint_m:new o.cQ(u),u_luminance:new o.cb(u)}),globeRaster:u=>({u_proj_matrix:new o.c8(u),u_globe_matrix:new o.c8(u),u_normalize_matrix:new o.c8(u),u_merc_matrix:new o.c8(u),u_zoom_transition:new o.cb(u),u_merc_center:new o.c9(u),u_image0:new o.cc(u),u_grid_matrix:new o.dj(u),u_skirt_height:new o.cb(u),u_far_z_cutoff:new o.cb(u),u_frustum_tl:new o.ca(u),u_frustum_tr:new o.ca(u),u_frustum_br:new o.ca(u),u_frustum_bl:new o.ca(u),u_globe_pos:new o.ca(u),u_globe_radius:new o.cb(u),u_viewport:new o.c9(u)}),globeAtmosphere:u=>({u_frustum_tl:new o.ca(u),u_frustum_tr:new o.ca(u),u_frustum_br:new o.ca(u),u_frustum_bl:new o.ca(u),u_horizon:new o.cb(u),u_transition:new o.cb(u),u_fadeout_range:new o.cb(u),u_color:new o.cQ(u),u_high_color:new o.cQ(u),u_space_color:new o.cQ(u),u_temporal_offset:new o.cb(u),u_horizon_angle:new o.cb(u)}),model:u=>({u_matrix:new o.c8(u),u_lighting_matrix:new o.c8(u),u_normal_matrix:new o.c8(u),u_node_matrix:new o.c8(u),u_lightpos:new o.ca(u),u_lightintensity:new o.cb(u),u_lightcolor:new o.ca(u),u_camera_pos:new o.ca(u),u_opacity:new o.cb(u),u_baseColorFactor:new o.cQ(u),u_emissiveFactor:new o.cQ(u),u_metallicFactor:new o.cb(u),u_roughnessFactor:new o.cb(u),u_baseTextureIsAlpha:new o.cc(u),u_alphaMask:new o.cc(u),u_alphaCutoff:new o.cb(u),u_baseColorTexture:new o.cc(u),u_metallicRoughnessTexture:new o.cc(u),u_normalTexture:new o.cc(u),u_occlusionTexture:new o.cc(u),u_emissionTexture:new o.cc(u),u_lutTexture:new o.cc(u),u_color_mix:new o.cQ(u),u_aoIntensity:new o.cb(u),u_emissive_strength:new o.cb(u),u_occlusionTextureTransform:new o.cQ(u)}),modelDepth:u=>({u_matrix:new o.c8(u),u_instance:new o.c8(u),u_node_matrix:new o.c8(u)}),groundShadow:u=>({u_matrix:new o.c8(u),u_ground_shadow_factor:new o.ca(u)}),stars:u=>({u_matrix:new o.c8(u),u_up:new o.ca(u),u_right:new o.ca(u),u_intensity_multiplier:new o.cb(u)}),snowParticle:u=>({u_modelview:new o.c8(u),u_projection:new o.c8(u),u_time:new o.cb(u),u_cam_pos:new o.ca(u),u_velocityConeAperture:new o.cb(u),u_velocity:new o.cb(u),u_horizontalOscillationRadius:new o.cb(u),u_horizontalOscillationRate:new o.cb(u),u_boxSize:new o.cb(u),u_billboardSize:new o.cb(u),u_simpleShapeParameters:new o.c9(u),u_screenSize:new o.c9(u),u_thinningCenterPos:new o.c9(u),u_thinningShape:new o.ca(u),u_thinningAffectedRatio:new o.cb(u),u_thinningParticleOffset:new o.cb(u),u_particleColor:new o.cQ(u),u_direction:new o.ca(u)}),rainParticle:u=>({u_modelview:new o.c8(u),u_projection:new o.c8(u),u_time:new o.cb(u),u_cam_pos:new o.ca(u),u_texScreen:new o.cc(u),u_velocityConeAperture:new o.cb(u),u_velocity:new o.cb(u),u_boxSize:new o.cb(u),u_rainDropletSize:new o.c9(u),u_distortionStrength:new o.cb(u),u_rainDirection:new o.ca(u),u_color:new o.cQ(u),u_screenSize:new o.c9(u),u_thinningCenterPos:new o.c9(u),u_thinningShape:new o.ca(u),u_thinningAffectedRatio:new o.cb(u),u_thinningParticleOffset:new o.cb(u),u_shapeDirectionalPower:new o.cb(u),u_shapeNormalPower:new o.cb(u),u_mode:new o.cb(u)}),vignette:u=>({u_vignetteShape:new o.ca(u),u_vignetteColor:new o.cQ(u)}),occlusion:u=>({u_matrix:new o.c8(u),u_anchorPos:new o.ca(u),u_screenSizePx:new o.c9(u),u_occluderSizePx:new o.c9(u),u_color:new o.cQ(u)})};class ha{constructor(t,s,h,m){this.id=ha.uniqueIdxCounter,ha.uniqueIdxCounter++,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||m||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=ha.uniqueIdxCounter,ha.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ha.uniqueIdxCounter=0;const xx={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hp{constructor(t,s,h,m,g,v){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.instanceCount=v,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||g||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let h=0;h<this.attributes.length;h++){const m=s.attributes[this.attributes[h].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,h){for(let m=0;m<this.attributes.length;m++){const g=this.attributes[m],v=s.attributes[g.name];v!==void 0&&t.vertexAttribPointer(v,g.components,t[xx[g.type]],!1,this.itemSize,g.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(t,s,h){for(let m=0;m<this.attributes.length;m++){const g=s.attributes[this.attributes[m].name];g!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(g,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Dd{constructor(t,s,h,m,g){this.context=t,this.width=s,this.height=h;const v=this.framebuffer=t.gl.createFramebuffer();m&&(this.colorAttachment=new px(t,v)),g&&(this.depthAttachmentType=g,this.depthAttachment=g==="renderbuffer"?new bd(t,v):new Lp(t,v))}destroy(){const t=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&t.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&t.deleteTexture(s)}t.deleteFramebuffer(this.framebuffer)}}class wc{constructor(t,s){this.gl=t,this.clearColor=new lx(this),this.clearDepth=new cx(this),this.clearStencil=new ux(this),this.colorMask=new b_(this),this.depthMask=new hx(this),this.stencilMask=new md(this),this.stencilFunc=new dx(this),this.stencilOp=new w_(this),this.stencilTest=new Cp(this),this.depthRange=new gd(this),this.depthTest=new Mp(this),this.depthFunc=new El(this),this.blend=new Pp(this),this.blendFunc=new T_(this),this.blendColor=new gc(this),this.blendEquation=new Hu(this),this.cullFace=new _d(this),this.cullFaceSide=new yd(this),this.frontFace=new _c(this),this.program=new vd(this),this.activeTexture=new Rp(this),this.viewport=new S_(this),this.bindFramebuffer=new zp(this),this.bindRenderbuffer=new xd(this),this.bindTexture=new qu(this),this.bindVertexBuffer=new E_(this),this.bindElementBuffer=new I_(this),this.bindVertexArrayOES=new A_(this),this.pixelStoreUnpack=new yc(this),this.pixelStoreUnpackPremultiplyAlpha=new C_(this),this.pixelStoreUnpackFlipY=new fx(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s,h){return new ha(this,t,s,h)}createVertexBuffer(t,s,h,m,g){return new Hp(this,t,s,h,m,g)}createRenderbuffer(t,s,h){const m=this.gl,g=m.createRenderbuffer();return this.bindRenderbuffer.set(g),m.renderbufferStorage(m.RENDERBUFFER,t,s,h),this.bindRenderbuffer.set(null),g}createFramebuffer(t,s,h,m){return new Dd(this,t,s,h,m)}clear({color:t,depth:s,stencil:h,colorMask:m}){const g=this.gl;let v=0;t&&(v|=g.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(m||[!0,!0,!0,!0])),s!==void 0&&(v|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(v|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),g.clear(v)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.bv(t.blendFunction,bi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ml;function Tc(u,t,s,h,m,g,v){const b=u.context,S=b.gl,C=u.transform,P=u.getOrCreateProgram("collisionBox"),D=[];let z=0,O=0;for(let ae=0;ae<h.length;ae++){const ge=h[ae],de=t.getTile(ge),fe=de.getBucket(s);if(!fe)continue;const le=ad(ge,fe,C);let ye=le;m[0]===0&&m[1]===0||(ye=u.translatePosMatrix(le,de,m,g));const be=v?fe.textCollisionBox:fe.iconCollisionBox,Fe=fe.collisionCircleArray;if(Fe.length>0){const Le=o.bz(),Ke=ye;o.cB(Le,fe.placementInvProjMatrix,C.glCoordMatrix),o.cB(Le,Le,fe.placementViewportMatrix),D.push({circleArray:Fe,circleOffset:O,transform:Ke,invTransform:Le,projection:fe.getProjection()}),z+=Fe.length/4,O=z}be&&(u.terrain&&u.terrain.setupElevationDraw(de,P),P.draw(u,S.LINES,Rt.disabled,Qt.disabled,u.colorModeForRenderPass(),Jt.disabled,D_(ye,C,de,fe.getProjection()),s.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,null,C.zoom,null,[be.collisionVertexBuffer,be.collisionVertexBufferExt]))}if(!v||!D.length)return;const V=u.getOrCreateProgram("collisionCircle"),N=new o.dI;N.resize(4*z),N._trim();let H=0;for(const ae of D)for(let ge=0;ge<ae.circleArray.length/4;ge++){const de=4*ge,fe=ae.circleArray[de+0],le=ae.circleArray[de+1],ye=ae.circleArray[de+2],be=ae.circleArray[de+3];N.emplace(H++,fe,le,ye,be,0),N.emplace(H++,fe,le,ye,be,1),N.emplace(H++,fe,le,ye,be,2),N.emplace(H++,fe,le,ye,be,3)}(!Ml||Ml.length<2*z)&&(Ml=function(ae){const ge=2*ae,de=new o.a_;de.resize(ge),de._trim();for(let fe=0;fe<ge;fe++){const le=6*fe;de.uint16[le+0]=4*fe+0,de.uint16[le+1]=4*fe+1,de.uint16[le+2]=4*fe+2,de.uint16[le+3]=4*fe+2,de.uint16[le+4]=4*fe+3,de.uint16[le+5]=4*fe+0}return de}(z));const U=b.createIndexBuffer(Ml,!0),Q=b.createVertexBuffer(N,o.dJ.members,!0);for(const ae of D){const ge={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(ne=C).getCameraToCenterDistance(ae.projection),u_viewport_size:[ne.width,ne.height]};V.draw(u,S.TRIANGLES,Rt.disabled,Qt.disabled,u.colorModeForRenderPass(),Jt.disabled,ge,s.id,Q,U,o.bd.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,C.zoom)}var ne;Q.destroy(),U.destroy()}const Ku=o.bz();function Qu(u){const t=u._camera.getWorldToCamera(u.worldSize,1),s=o.az([],t,u.globeMatrix);o.bi(s,s);const h=[0,0,0],m=[0,1,0,0];return o.aA(m,m,s),h[0]=m[0],h[1]=m[1],h[2]=m[2],o.au(h,h),h}function Ld({width:u,height:t,anchor:s,textOffset:h,textScale:m},g){const{horizontalAlign:v,verticalAlign:b}=o.bV(s),S=-(v-.5)*u,C=-(b-.5)*t,P=o.bU(s,h);return new o.P((S/m+P[0])*g,(C/m+P[1])*g)}function qp(u,t,s,h,m,g,v,b,S,C){const P=u.text.placedSymbolArray,D=u.text.dynamicLayoutVertexArray,z=u.icon.dynamicLayoutVertexArray,O={},V=u.getProjection(),N=Ou(v,V,m),H=m.elevation,U=V.upVectorScale(v.canonical,m.center.lat,m.worldSize).metersToTile;D.clear();for(let Q=0;Q<P.length;Q++){const ne=P.get(Q),{tileAnchorX:ae,tileAnchorY:ge,numGlyphs:de}=ne,fe=ne.hidden||!ne.crossTileID||u.allowVerticalPlacement&&!ne.placedOrientation?null:h[ne.crossTileID];if(fe){let le=0,ye=0,be=0;if(H){const et=H?H.getAtTileOffset(v,ae,ge):0,[Ge,ot,Qe]=V.upVector(v.canonical,ae,ge);le=et*Ge*U,ye=et*ot*U,be=et*Qe*U}let[Fe,Le,Ke,Xe]=So(ne.projectedAnchorX+le,ne.projectedAnchorY+ye,ne.projectedAnchorZ+be,s?N:g);const dt=Da(m.getCameraToCenterDistance(V),Xe);let ke=o.bJ(u.textSizeData,S,ne)*dt/o.bO;s&&(ke*=u.tilePixelRatio/b);const Be=Ld(fe,ke);s?({x:Fe,y:Le,z:Ke}=V.projectTilePoint(ae+Be.x,ge+Be.y,v.canonical),[Fe,Le,Ke]=So(Fe+le,Le+ye,Ke+be,g)):(t&&Be._rotate(-m.angle),Fe+=Be.x,Le+=Be.y,Ke=0);const ze=u.allowVerticalPlacement&&ne.placedOrientation===o.bI.vertical?Math.PI/2:0;for(let et=0;et<de;et++)o.bL(D,Fe,Le,Ke,ze);C&&ne.associatedIconIndex>=0&&(O[ne.associatedIconIndex]={x:Fe,y:Le,z:Ke,angle:ze})}else Hi(de,D)}if(C){z.clear();const Q=u.icon.placedSymbolArray;for(let ne=0;ne<Q.length;ne++){const ae=Q.get(ne),{numGlyphs:ge}=ae,de=O[ne];if(ae.hidden||!de)Hi(ge,z);else{const{x:fe,y:le,z:ye,angle:be}=de;for(let Fe=0;Fe<ge;Fe++)o.bL(z,fe,le,ye,be)}}u.icon.dynamicLayoutVertexBuffer.updateData(z)}u.text.dynamicLayoutVertexBuffer.updateData(D)}function kd(u,t,s,h,m,g,v={}){const b=s.paint.get("icon-translate"),S=s.paint.get("text-translate"),C=s.paint.get("icon-translate-anchor"),P=s.paint.get("text-translate-anchor"),D=s.layout.get("icon-rotation-alignment"),z=s.layout.get("text-rotation-alignment"),O=s.layout.get("icon-pitch-alignment"),V=s.layout.get("text-pitch-alignment"),N=s.layout.get("icon-keep-upright"),H=s.layout.get("text-keep-upright"),U=s.paint.get("icon-color-saturation"),Q=s.paint.get("icon-color-contrast"),ne=s.paint.get("icon-color-brightness-min"),ae=s.paint.get("icon-color-brightness-max"),ge=s.layout.get("symbol-elevation-reference")==="sea",de=u.context,fe=de.gl,le=u.transform,ye=D==="map",be=z==="map",Fe=O==="map",Le=V==="map",Ke=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Xe=!1;const dt=u.depthModeForSublayer(0,Rt.ReadOnly),ke=new Rt(u.context.gl.LEQUAL,Rt.ReadOnly,u.depthRangeFor3D),Be=[o.ay(le.center.lng),o.aH(le.center.lat)],ze=s.layout.get("text-variable-anchor"),et=le.projection.name==="globe",Ge=[],ot=[0,-1,0];for(const Qe of h){const st=t.getTile(Qe),at=st.getBucket(s);if(!at||at.projection.name==="mercator"&&et||at.fullyClipped)continue;const Pt=at.projection.name==="globe",Nt=Pt?o.ah(le.zoom):0,Ct=Ou(Qe,at.getProjection(),le),jt=le.calculatePixelsToTileUnitsMatrix(st),zt=ze&&at.hasTextData(),Zt=at.hasIconTextFit()&&zt&&at.hasIconData(),si=at.elevationType==="road"?ke:dt,Ai=at.getProjection().createInversionMatrix(le,Qe.canonical),tn=u.shadowRenderer,Yi=at.elevationType==="road"&&!!tn&&tn.enabled;let Mi=[0,0,0];if(Yi){const Pn=u.style.directionalLight,mi=u.style.ambientLight;Pn&&mi&&(Mi=js(u.style,Pn,mi))}const Un=Pn=>{le.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||u.terrain)&&(Pn.push("DEPTH_D24"),Pn.push("DEPTH_OCCLUSION"))},Dn=()=>{const Pn=ye&&s.layout.get("symbol-placement")!=="point",mi=[];Un(mi);const En=Pn||Zt,Bi=s.paint.get("icon-image-cross-fade");u.terrainRenderModeElevated()&&Fe&&mi.push("PITCH_WITH_MAP_TERRAIN"),Pt&&(mi.push("PROJECTION_GLOBE_VIEW"),En&&mi.push("PROJECTED_POS_ON_VIEWPORT")),Bi>0&&mi.push("ICON_TRANSITION"),at.icon.zOffsetVertexBuffer&&mi.push("Z_OFFSET"),U===0&&Q===0&&ne===0&&ae===1||mi.push("COLOR_ADJUSTMENT"),at.sdfIcons&&mi.push("RENDER_SDF"),Yi&&mi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const In=at.icon.programConfigurations.get(s.id),qi=u.getOrCreateProgram("symbol",{config:In,defines:mi}),Rn=st.imageAtlasTexture?st.imageAtlasTexture.size:[0,0],xr=at.iconSizeData,mn=o.bH(xr,le.zoom),Cr=Fe||le.pitch!==0,Yn=ac(Ct,st.tileID.canonical,Fe,ye,le,at.getProjection(),jt),Dr=pp(Ct,st.tileID.canonical,Fe,ye,le,at.getProjection(),jt),Ts=u.translatePosMatrix(Dr,st,b,C,!0),ma=u.translatePosMatrix(Ct,st,b,C),Ao=En?Ku:Yn,rs=ye&&!Fe&&!Pn;let $s=ot;!et&&!le.mercatorFromTransition||ye||($s=Qu(le));const Hs=Pt?$s:ot,Ss=s.getColorAdjustmentMatrix(U,Q,ne,ae),kc=Pd(xr.kind,mn,rs,Fe,u,ma,Ao,Ts,ge,!1,Rn,[0,0],!0,Qe,Nt,Be,Ai,Hs,at.getProjection(),Mi,Ss,Bi),Nl=st.imageAtlasTexture?st.imageAtlasTexture:null,Qd=s.layout.get("icon-size").constantOr(0)!==1||at.iconsNeedLinear,Jd=at.sdfIcons||u.options.rotating||u.options.zooming||Qd||Cr?fe.LINEAR:fe.NEAREST,ef=at.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,ph=u.terrain&&Fe&&Pn?o.bi(o.bz(),Yn):Ku;if(Pn&&at.icon){const An=le.elevation,Oc=An?An.getAtTileOffsetFunc(Qe,le.center.lat,le.worldSize,at.getProjection()):null,gm=nd(Ct,st.tileID.canonical,Fe,ye,le,at.getProjection(),jt);gp(at,Ct,u,!1,gm,Dr,Fe,N,Oc,Qe)}return{program:qi,buffers:at.icon,uniformValues:kc,atlasTexture:Nl,atlasTextureIcon:null,atlasInterpolation:Jd,atlasInterpolationIcon:null,isSDF:at.sdfIcons,hasHalo:ef,depthMode:si,tile:st,renderWithShadows:Yi,labelPlaneMatrixInv:ph}},hi=()=>{const Pn=be&&s.layout.get("symbol-placement")!=="point",mi=[],En=Pn||ze||Zt;u.terrainRenderModeElevated()&&Le&&mi.push("PITCH_WITH_MAP_TERRAIN"),Pt&&(mi.push("PROJECTION_GLOBE_VIEW"),En&&mi.push("PROJECTED_POS_ON_VIEWPORT")),at.text.zOffsetVertexBuffer&&mi.push("Z_OFFSET"),at.iconsInText&&mi.push("RENDER_TEXT_AND_SYMBOL"),mi.push("RENDER_SDF"),Yi&&mi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Un(mi);const Bi=at.text.programConfigurations.get(s.id),In=u.getOrCreateProgram("symbol",{config:Bi,defines:mi});let qi,Rn=[0,0],xr=null;const mn=at.textSizeData;at.iconsInText&&(Rn=st.imageAtlasTexture?st.imageAtlasTexture.size:[0,0],xr=st.imageAtlasTexture?st.imageAtlasTexture:null,qi=Le||le.pitch!==0||u.options.rotating||u.options.zooming||mn.kind==="composite"||mn.kind==="camera"?fe.LINEAR:fe.NEAREST);const Cr=st.glyphAtlasTexture?st.glyphAtlasTexture.size:[0,0],Yn=s.layout.get("text-size-scale-range"),Dr=o.aD(u.scaleFactor,Yn[0],Yn[1]),Ts=o.bH(mn,le.zoom,Dr),ma=ac(Ct,st.tileID.canonical,Le,be,le,at.getProjection(),jt),Ao=pp(Ct,st.tileID.canonical,Le,be,le,at.getProjection(),jt),rs=u.translatePosMatrix(Ao,st,S,P,!0),$s=u.translatePosMatrix(Ct,st,S,P),Hs=En?Ku:ma,Ss=be&&!Le&&!Pn;let kc=ot;!et&&!le.mercatorFromTransition||be||(kc=Qu(le));const Nl=Pd(mn.kind,Ts,Ss,Le,u,$s,Hs,rs,ge,!0,Cr,Rn,!0,Qe,Nt,Be,Ai,Pt?kc:ot,at.getProjection(),Mi,null,null,Dr),Qd=st.glyphAtlasTexture?st.glyphAtlasTexture:null,Jd=fe.LINEAR,ef=s.paint.get("text-halo-width").constantOr(1)!==0,ph=u.terrain&&Le&&Pn?o.bi(o.bz(),ma):Ku;if(Pn&&at.text){const An=le.elevation,Oc=An?An.getAtTileOffsetFunc(Qe,le.center.lat,le.worldSize,at.getProjection()):null,gm=nd(Ct,st.tileID.canonical,Le,be,le,at.getProjection(),jt);gp(at,Ct,u,!0,gm,Ao,Le,H,Oc,Qe)}return{program:In,buffers:at.text,uniformValues:Nl,atlasTexture:Qd,atlasTextureIcon:xr,atlasInterpolation:Jd,atlasInterpolationIcon:qi,isSDF:!0,hasHalo:ef,depthMode:si,tile:st,renderWithShadows:Yi,labelPlaneMatrixInv:ph}},ki=at.icon.segments.get().length,ji=at.text.segments.get().length,nn=ki&&!v.onlyText?Dn():null,nr=ji&&!v.onlyIcons?hi():null,qn=s.paint.get("icon-opacity").constantOr(1),tr=s.paint.get("text-opacity").constantOr(1);if(Ke&&at.canOverlap){Xe=!0;const Pn=qn&&!v.onlyText?at.icon.segments.get():[],mi=tr&&!v.onlyIcons?at.text.segments.get():[];for(const En of Pn)Ge.push({segments:new o.bd([En]),sortKey:En.sortKey,state:nn});for(const En of mi)Ge.push({segments:new o.bd([En]),sortKey:En.sortKey,state:nr})}else v.onlyText||Ge.push({segments:qn?at.icon.segments:new o.bd([]),sortKey:0,state:nn}),v.onlyIcons||Ge.push({segments:tr?at.text.segments:new o.bd([]),sortKey:0,state:nr})}Xe&&Ge.sort((Qe,st)=>Qe.sortKey-st.sortKey);for(const Qe of Ge){const st=Qe.state;if(st)if(u.terrain?u.terrain.setupElevationDraw(st.tile,st.program,{useDepthForOcclusion:le.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:st.labelPlaneMatrixInv}):u.setupDepthForOcclusion(le.depthOcclusionForSymbolsAndCircles,st.program),de.activeTexture.set(fe.TEXTURE0),st.atlasTexture&&st.atlasTexture.bind(st.atlasInterpolation,fe.CLAMP_TO_EDGE,!0),st.atlasTextureIcon&&(de.activeTexture.set(fe.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,fe.CLAMP_TO_EDGE,!0)),st.renderWithShadows&&u.shadowRenderer.setupShadows(st.tile.tileID.toUnwrapped(),st.program,"vector-tile",st.tile.tileID.overscaledZ),u.uploadCommonLightUniforms(u.context,st.program),st.hasHalo){const at=st.uniformValues;at.u_is_halo=1,Wp(st.buffers,Qe.segments,s,u,st.program,st.depthMode,m,g,at,2),at.u_is_halo=0}else{if(st.isSDF){const at=st.uniformValues;st.hasHalo&&(at.u_is_halo=1,Wp(st.buffers,Qe.segments,s,u,st.program,st.depthMode,m,g,at,1)),at.u_is_halo=0}Wp(st.buffers,Qe.segments,s,u,st.program,st.depthMode,m,g,st.uniformValues,1)}}}function Wp(u,t,s,h,m,g,v,b,S,C){const P=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer];m.draw(h,h.context.gl.TRIANGLES,g,v,b,Jt.disabled,S,s.id,u.layoutVertexBuffer,u.indexBuffer,t,s.paint,h.transform.zoom,u.programConfigurations.get(s.id),P,C)}function Sc(u,t){const s=1<<u.canonical.z,h=(t.x*s-u.canonical.x-u.wrap*s)*o.aj,m=(t.y*s-u.canonical.y)*o.aj,g=o.dS(t.z,t.y);return o.cS(h,m,g)}function Ju(u,t,s,h,m){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const g=u.context.gl,v=new Rt(u.context.gl.LEQUAL,Rt.ReadWrite,u.depthRangeFor3D),b=new Rt(u.context.gl.GREATER,Rt.ReadWrite,u.depthRangeFor3D),S=function(O){const V=o.cJ(O.pitch);let N=.01;return O.isOrthographic&&(N=o.ai(1e-4,N,o.cO(V>=Fa?1:V/Fa))),2*N}(u.transform),C=u.transform.getFreeCameraOptions().position,P="elevatedStructuresDepthReconstruct",D=u.getOrCreateProgram(P,{defines:["DEPTH_RECONSTRUCTION"]}),z=u.getOrCreateProgram(P);for(const O of h){const V=t.getTile(O),N=V.getBucket(s);if(!N)continue;const H=N.elevatedStructures;if(!H)continue;const U=N.elevationBufferData.heightRange,Q=Sc(O.toUnwrapped(),C),ne=u.translatePosMatrix(O.projMatrix,V,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));let ae,ge,de,fe;if(m==="initialize"){if(!U||U.min>=1||H.depthSegments.segments[0].primitiveLength===0)continue;ae=Yu(ne,Q,S,1,0),ge=v,de=H.depthSegments,fe=D}else if(m==="reset"){if(!U||U.min>=0||H.maskSegments.segments[0].primitiveLength===0)continue;ae=Yu(ne,Q,0,0,1),ge=b,de=H.maskSegments,fe=D}else if(m==="geometry"){if(H.depthSegments.segments[0].primitiveLength===0)continue;ae=Yu(ne,Q,S,1,0),ge=v,de=H.depthSegments,fe=z}fe.draw(u,g.TRIANGLES,ge,Qt.disabled,bi.disabled,Jt.disabled,ae,s.id,H.vertexBuffer,H.indexBuffer,de,s.paint,u.transform.zoom)}}function At(u,t,s){const{painter:h,sourceCache:m,layer:g,coords:v,colorMode:b,elevationType:S,terrainEnabled:C,pass:P}=u,D=h.context.gl,z=g.paint.get("fill-pattern"),O=g.paint.get("fill-pattern-cross-fade"),V=z.constantOr(null);let N=S;S!=="road"||t&&!C||(N="none");const H=N==="road",U=u.painter.shadowRenderer,Q=H&&!!U&&U.enabled,ne=new Rt(h.context.gl.LEQUAL,Rt.ReadOnly,h.depthRangeFor3D);let ae=[0,0,0];if(Q){const fe=h.style.directionalLight,le=h.style.ambientLight;fe&&le&&(ae=js(h.style,fe,le))}const ge=z&&z.constantOr(1),de=(fe,le)=>{let ye,be,Fe,Le,Ke;le?(ye=ge&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Fe=D.LINES):(ye=ge?"fillPattern":"fill",Fe=D.TRIANGLES);for(const Xe of v){const dt=m.getTile(Xe);if(ge&&!dt.patternsLoaded())continue;const ke=dt.getBucket(g);if(!ke)continue;const Be=t?ke.elevationBufferData:ke.bufferData;if(Be.isEmpty())continue;h.prepareDrawTile();const ze=Be.programConfigurations.get(g.id),et=h.isTileAffectedByFog(Xe),Ge=[],ot=[];H&&(Ge.push("ELEVATED_ROADS"),ot.push(Be.elevatedLayoutVertexBuffer)),Q&&Ge.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ge&&(h.context.activeTexture.set(D.TEXTURE0),dt.imageAtlasTexture&&dt.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),ze.updatePaintBuffers());let Qe=!1;if(V&&dt.imageAtlas){const Ct=dt.imageAtlas,jt=o.dN.from(V),zt=jt.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),Zt=jt.getSecondary(),si=Ct.patternPositions.get(zt),Ai=Zt?Ct.patternPositions.get(Zt.scaleSelf(o.q.devicePixelRatio).toString()):null;Qe=!!si&&!!Ai,si&&ze.setConstantPatternPositions(si,Ai)}O>0&&(Qe||ze.getPatternTransitionVertexBuffer("fill-pattern"))&&Ge.push("FILL_PATTERN_TRANSITION");const st=h.getOrCreateProgram(ye,{config:ze,overrideFog:et,defines:Ge}),at=h.translatePosMatrix(Xe.projMatrix,dt,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));Q&&U.setupShadows(dt.tileID.toUnwrapped(),st,"vector-tile",dt.tileID.overscaledZ);const Pt=g.paint.get("fill-emissive-strength");if(le){Le=Be.lineIndexBuffer,Ke=Be.lineSegments;const Ct=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[D.drawingBufferWidth,D.drawingBufferHeight];be=ye==="fillOutlinePattern"&&ge?yx(at,Pt,h,dt,Ct,ae,O):_x(at,Pt,Ct,ae)}else Le=Be.indexBuffer,Ke=Be.triangleSegments,be=ge?z_(at,Pt,h,dt,ae,O):R_(at,Pt,ae);h.uploadCommonUniforms(h.context,st,Xe.toUnwrapped());let Nt=fe;(S==="road"&&!C||S==="offset")&&(Nt=ne),st.draw(h,Fe,Nt,s||h.stencilModeForClipping(Xe),b,Jt.disabled,be,g.id,Be.layoutVertexBuffer,Le,Ke,g.paint,h.transform.zoom,ze,ot)}};h.renderPass===P&&de(h.depthModeForSublayer(1,h.renderPass==="opaque"?Rt.ReadWrite:Rt.ReadOnly),!1),N==="none"&&h.renderPass==="translucent"&&g.paint.get("fill-antialias")&&de(h.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,Rt.ReadOnly),!0)}function eh(u,t,s,h,m,g,v,b){s.resetLayerRenderingStats(u);const S=u.context,C=S.gl,P=u.transform,D=s.paint.get("fill-extrusion-pattern"),z=s.paint.get("fill-extrusion-pattern-cross-fade"),O=D.constantOr(null),V=D.constantOr(1),N=s.paint.get("fill-extrusion-opacity"),H=u.style.enable3dLights(),U=s.paint.get(H&&!V?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Q=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),U],ne=s.layout.get("fill-extrusion-edge-radius"),ae=ne>0&&!s.paint.get("fill-extrusion-rounded-roof"),ge=ae?0:ne,de=P.projection.name==="globe"?o.dT():0,fe=P.projection.name==="globe",le=fe?o.ah(P.zoom):0,ye=[o.ay(P.center.lng),o.aH(P.center.lat)],be=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Fe=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(be?null:s.lut).toArray01().slice(0,3),Le=s.paint.get("fill-extrusion-flood-light-intensity"),Ke=s.paint.get("fill-extrusion-vertical-scale"),Xe=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,dt=s.paint.get("fill-extrusion-height-alignment"),ke=s.paint.get("fill-extrusion-base-alignment"),Be=wl(u,s.paint.get("fill-extrusion-cutoff-fade-range")),ze=[];let et;fe&&ze.push("PROJECTION_GLOBE_VIEW"),Q[0]>0&&ze.push("FAUX_AO"),ae&&ze.push("ZERO_ROOF_RADIUS"),b&&ze.push("HAS_CENTROID"),Le>0&&ze.push("FLOOD_LIGHT"),Be.shouldRenderCutoff&&ze.push("RENDER_CUTOFF"),Xe&&ze.push("RENDER_WALL_MODE");const Ge=u.renderPass==="shadow",ot=u.shadowRenderer,Qe=Ge&&!!ot,st=Ge?Jt.disabled:Jt.backCCW;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let at=[0,0,0];if(ot){const Ct=u.style.directionalLight,jt=u.style.ambientLight;Ct&&jt&&(at=js(u.style,Ct,jt)),Ge||(ze.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ot.useNormalOffset&&ze.push("NORMAL_OFFSET")),et=ze.concat(["SHADOWS_SINGLE_CASCADE"])}const Pt=Qe?"fillExtrusionDepth":V?"fillExtrusionPattern":"fillExtrusion",Nt=s.getLayerRenderingStats();for(const Ct of h){const jt=t.getTile(Ct),zt=jt.getBucket(s);if(!zt||zt.projection.name!==P.projection.name)continue;let Zt=!1;ot&&(Zt=ot.getMaxCascadeForTile(Ct.toUnwrapped())===0);const si=u.isTileAffectedByFog(Ct),Ai=zt.programConfigurations.get(s.id);let tn=!1;if(O&&jt.imageAtlas){const ji=jt.imageAtlas,nn=o.dN.from(O),nr=nn.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),qn=nn.getSecondary(),tr=ji.patternPositions.get(nr),Pn=qn?ji.patternPositions.get(qn.scaleSelf(o.q.devicePixelRatio).toString()):null;tn=!!tr&&!!Pn,tr&&Ai.setConstantPatternPositions(tr,Pn)}z>0&&(tn||Ai.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&ze.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Yi=u.getOrCreateProgram(Pt,{config:Ai,defines:Zt?et:ze,overrideFog:si});if(u.terrain&&u.terrain.setupElevationDraw(jt,Yi,{useMeterToDem:!0}),!zt.centroidVertexBuffer){const ji=Yi.attributes.a_centroid_pos;ji!==void 0&&C.vertexAttrib2f(ji,0,0)}!Ge&&ot&&ot.setupShadows(jt.tileID.toUnwrapped(),Yi,"vector-tile",jt.tileID.overscaledZ),V&&(u.context.activeTexture.set(C.TEXTURE0),jt.imageAtlasTexture&&jt.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Ai.updatePaintBuffers());const Mi=s.paint.get("fill-extrusion-vertical-gradient"),Un=1/zt.tileToMeter;let Dn;if(Ge&&ot){if(bx(jt.tileID,zt,u))continue;const ji=ot.calculateShadowPassMatrixFromTile(jt.tileID.toUnwrapped());Dn=mx(ji,ge,Un,Ke,dt,ke)}else{const ji=u.translatePosMatrix(Ct.expandedProjMatrix,jt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),nn=P.projection.createInversionMatrix(P,Ct.canonical);Dn=V?gx(ji,u,Mi,N,Q,ge,Un,Ct,jt,de,dt,ke,le,ye,nn,Fe,Ke,z):Il(ji,u,Mi,N,Q,ge,Un,Ct,de,dt,ke,le,ye,nn,Fe,Ke,Le,at)}u.uploadCommonUniforms(S,Yi,Ct.toUnwrapped(),null,Be);let hi=zt.segments;if(P.projection.name==="mercator"&&!Ge&&(hi=zt.getVisibleSegments(jt.tileID,u.terrain,u.transform.getFrustum(0)),!hi.get().length))continue;if(Nt)if(Ge)for(const ji of hi.get())Nt.numRenderedVerticesInShadowPass+=ji.primitiveLength;else for(const ji of hi.get())Nt.numRenderedVerticesInTransparentPass+=ji.primitiveLength;const ki=[];(u.terrain||b)&&ki.push(zt.centroidVertexBuffer),fe&&ki.push(zt.layoutVertexExtBuffer),Xe&&ki.push(zt.wallVertexBuffer),Yi.draw(u,S.gl.TRIANGLES,m,g,v,st,Dn,s.id,zt.layoutVertexBuffer,zt.indexBuffer,hi,s.paint,u.transform.zoom,Ai,ki)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function Pl(u,t,s,h,m,g,v,b,S,C,P,D,z,O,V,N,H,U,Q){const ne=u.context,ae=ne.gl,ge=u.transform,de=u.transform.zoom,fe=[],le=wl(u,s.paint.get("fill-extrusion-cutoff-fade-range"));C==="clear"?(fe.push("CLEAR_SUBPASS"),Q&&(fe.push("CLEAR_FROM_TEXTURE"),ne.activeTexture.set(ae.TEXTURE0),Q.bind(ae.LINEAR,ae.CLAMP_TO_EDGE))):C==="sdf"&&fe.push("SDF_SUBPASS"),H&&fe.push("HAS_CENTROID"),le.shouldRenderCutoff&&fe.push("RENDER_CUTOFF");const ye=s.layout.get("fill-extrusion-edge-radius"),be=(Fe,Le,Ke,Xe,dt)=>{const ke=Le.programConfigurations.get(s.id),Be=u.isTileAffectedByFog(Fe),ze=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:ke,defines:fe,overrideFog:Be}),et=((ot,Qe,st,at,Pt,Nt,Ct,jt,zt,Zt,si)=>({u_matrix:Qe,u_opacity:st,u_ao_pass:at?1:0,u_meter_to_tile:Pt,u_ao:Nt,u_flood_light_intensity:Ct,u_flood_light_color:jt,u_attenuation:zt,u_edge_radius:Zt,u_fb:0,u_fb_size:si,u_dynamic_offset:1}))(0,Xe,P,S,dt,[D,z*dt],O,V,N,de>=17?0:ye*dt,Q?Q.size[0]:0),Ge=[];H&&Ge.push(Le.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(ne,ze,Fe.toUnwrapped(),null,le),ze.draw(u,ne.gl.TRIANGLES,m,g,v,b,et,s.id,Le.vertexBuffer,Le.indexBuffer,Ke,s.paint,de,ke,Ge)};for(const Fe of h){const Le=t.getTile(Fe),Ke=Le.getBucket(s);if(!Ke||Ke.projection.name!==ge.projection.name||!Ke.groundEffect||Ke.groundEffect&&!Ke.groundEffect.hasData())continue;const Xe=Ke.groundEffect,dt=1/Ke.tileToMeter;{const ke=u.translatePosMatrix(Fe.projMatrix,Le,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Be=Xe.getDefaultSegment();be(Fe,Xe,Be,ke,dt)}if(U)for(let ke=0;ke<4;ke++){const Be=o.dU[ke](Fe),ze=t.getTile(Be);if(!ze)continue;const et=ze.getBucket(s);if(!et||et.projection.name!==ge.projection.name||!et.groundEffect||et.groundEffect&&!et.groundEffect.hasData())continue;const Ge=et.groundEffect;let ot,Qe;ke===0?(ot=[-o.aj,0,0],Qe=1):ke===1?(ot=[o.aj,0,0],Qe=0):ke===2?(ot=[0,-o.aj,0],Qe=3):(ot=[0,o.aj,0],Qe=2);const st=Ge.regionSegments[Qe];if(!st)continue;const at=new Float32Array(16);o.bo(at,Fe.projMatrix,ot),be(Fe,Ge,st,u.translatePosMatrix(at,Le,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),dt)}}}function Ua(u,t,s,h,m,g,v){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();const b=g?g.findDEMTileFor(s):null;if(!(b&&b.dem||v))return;g&&b&&b.dem&&h.selfDEMTileTimestamp!==b.dem._timestamp&&(h.borderDoneWithNeighborZ=[-1,-1,-1,-1],h.selfDEMTileTimestamp=b.dem._timestamp);const S=U=>new o.P(Math.ceil((U+o.dX)*o.dY),0),C=U=>{const Q=t.getSource().minzoom,ne=ge=>{const de=t.getTileByID(ge);if(de&&de.hasData())return de.getBucket(m)},ae=[0,-1,1];for(const ge of ae){if(U.overscaledZ+ge<Q)continue;const de=ne(U.calculateScaledKey(U.overscaledZ+ge));if(de)return de}},P=[0,0,0],D=(U,Q)=>(P[0]=Math.min(U.min.y,Q.min.y),P[1]=Math.max(U.max.y,Q.max.y),P[2]=o.aj-Q.min.x>U.max.x?Q.min.x-o.aj:U.max.x,P),z=(U,Q)=>(P[0]=Math.min(U.min.x,Q.min.x),P[1]=Math.max(U.max.x,Q.max.x),P[2]=o.aj-Q.min.y>U.max.y?Q.min.y-o.aj:U.max.y,P),O=[(U,Q)=>D(U,Q),(U,Q)=>D(Q,U),(U,Q)=>z(U,Q),(U,Q)=>z(Q,U)],V=(U,Q,ne,ae,ge,de,fe)=>{if(!g)return 0;const le=[[de?ne:U,de?U:ne,0],[de?ne:Q,de?Q:ne,0]],ye=fe<0?o.aj+fe:fe,be=[de?ye:(U+Q)/2,de?(U+Q)/2:ye,0];return ne===0&&fe<0||ne!==0&&fe>0?g.getForTilePoints(ge,[be],!0,ae):le.push(be),g.getForTilePoints(s,le,!0,b),Math.max(le[0][2],le[1][2],be[2])/g.exaggeration()};for(let U=0;U<4;U++){const Q=h.borderFeatureIndices[U];if(Q.length===0)continue;const ne=o.dU[U](s),ae=C(ne);if(!(ae&&ae instanceof o.dV))continue;const ge=g?g.findDEMTileFor(ne):null;if(!(ge&&ge.dem||v)||(g&&ge&&ge.dem&&h.borderDEMTileTimestamp[U]!==ge.dem._timestamp&&(h.borderDoneWithNeighborZ[U]=-1,h.borderDEMTileTimestamp[U]=ge.dem._timestamp),h.borderDoneWithNeighborZ[U]===ae.canonical.z))continue;ae.centroidVertexArray.length===0&&ae.createCentroidsBuffer();const de=(U<2?1:5)-U,fe=ae.borderDoneWithNeighborZ[de]!==h.canonical.z,le=ae.borderFeatureIndices[de];let ye=0;if(h.canonical.z!==ae.canonical.z){for(const be of Q)h.showCentroid(h.featuresOnBorder[be]);if(fe)for(const be of le)ae.showCentroid(ae.featuresOnBorder[be]);h.borderDoneWithNeighborZ[U]=ae.canonical.z,ae.borderDoneWithNeighborZ[de]=h.canonical.z}for(const be of Q){const Fe=h.featuresOnBorder[be],Le=h.centroidData[Fe.centroidDataIndex],Ke=Fe.borders[U];let Xe;for(;ye<le.length;){Xe=ae.featuresOnBorder[le[ye]];const dt=Xe.borders[de];if(dt[1]>Ke[0]+3||dt[0]>Ke[0]-3)break;ae.showCentroid(Xe),ye++}if(Xe&&ye<le.length){const dt=ye;let ke=0;for(;!(Xe.borders[de][0]>Ke[1]-3)&&(ke++,++ye!==le.length);)Xe=ae.featuresOnBorder[le[ye]];Xe=ae.featuresOnBorder[le[dt]];let Be=!1;if(ke>=1){const Ge=Xe.borders[de];Math.abs(Ke[0]-Ge[0])<3&&Math.abs(Ke[1]-Ge[1])<3&&(ke=1,Be=!0,ye=dt+1)}else if(ke===0){h.showCentroid(Fe);continue}const ze=ae.centroidData[Xe.centroidDataIndex];v&&Be&&(((N=Le).flags|(H=ze).flags)&o.dW?(N.flags|=o.dW,H.flags|=o.dW):(N.flags&=~o.dW,H.flags&=~o.dW));const et=Fe.intersectsCount()>1||Xe.intersectsCount()>1;if(ke>1)ye=dt,Le.centroidXY=ze.centroidXY=new o.P(0,0);else if(ge&&ge.dem&&!et){const Ge=O[U](Le,ze),ot=U%2?o.aj-1:0,Qe=V(Ge[0],Math.min(o.aj-1,Ge[1]),ot,ge,ne,U<2,Ge[2]);Le.centroidXY=ze.centroidXY=S(Qe)}else et?Le.centroidXY=ze.centroidXY=new o.P(0,0):(Le.centroidXY=h.encodeBorderCentroid(Fe),ze.centroidXY=ae.encodeBorderCentroid(Xe));h.writeCentroidToBuffer(Le),ae.writeCentroidToBuffer(ze)}else h.showCentroid(Fe)}h.borderDoneWithNeighborZ[U]=ae.canonical.z,ae.borderDoneWithNeighborZ[de]=h.canonical.z}var N,H;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(u)}const Ga=[1,0,0],Wt=[0,1,0],Zp=[0,0,1];function bx(u,t,s){const h=s.transform,m=s.shadowRenderer;if(!m)return!0;const g=u.toUnwrapped(),v=h.tileSize*m._cascades[s.currentShadowCascade].scale;let b=t.maxHeight;if(h.elevation){const N=h.elevation.getMinMaxForTile(u);N&&(b+=N.max)}const S=[...m.shadowDirection];S[2]=-S[2];const C=m.computeSimplifiedTileShadowVolume(g,b,v,S);if(!C)return!1;const P=[Ga,Wt,Zp,S,[S[0],0,S[2]],[0,S[1],S[2]]],D=h.projection.name==="globe",z=h.scaleZoom(v),O=o.cn.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,z,!D),V=m.getCurrentCascadeFrustum();return O.intersectsPrecise(C.vertices,C.planes,P)===0||V.intersectsPrecise(C.vertices,C.planes,P)===0}function j_(u){return[u[0]*o.dZ,u[1]*o.dZ,u[2]*o.dZ,0]}function th(u,t,s,h,m,g,v,b,S){const C=h.getSource(),P=s.globeSharedBuffers;if(!P)return;let D,z,O;if(t&&(D=h.getTile(t)),C instanceof o.aP?(z=C.texture,O=o.ds(0,0,s.transform)):D&&t&&(z=D.texture,O=o.ds(t.canonical.z,t.canonical.x,s.transform)),!z||!O)return;u||(O=o.cE(o.bz(),O,[1,-1,1]));const V=s.context,N=V.gl,H=m.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR,U=s.colorModeForDrapableLayerRenderPass(g),Q=v.defines;Q.push("GLOBE_POLES");const ne=new Rt(N.LEQUAL,Rt.ReadWrite,s.depthRangeFor3D),ae=Float32Array.from(s.transform.expandedFarZProjMatrix),ge=Float32Array.from(o.bh(o.dr(new o.cp(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),V.activeTexture.set(N.TEXTURE0),z.bind(H,N.CLAMP_TO_EDGE),V.activeTexture.set(N.TEXTURE1),z.bind(H,N.CLAMP_TO_EDGE),"useMipmap"in z&&V.extTextureFilterAnisotropic&&s.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const[de,fe,le,ye]=t?P.getPoleBuffers(t.canonical.z,!1):P.getPoleBuffers(0,!0),be=m.paint.get("raster-elevation");let Fe;u?(Fe=de,s.renderDefaultNorthPole=be!==0):(Fe=fe,s.renderDefaultSouthPole=be!==0);const Le=j_(v.mix),Ke=((dt,ke,Be,ze,et,Ge,ot,Qe,st,at,Pt,Nt,Ct)=>Va(dt,ke,Be,new Float32Array(16),new Float32Array(9),[0,0],ze,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ge,[0,0],Qe,2,at,Pt,Nt,1,0,Ct))(ae,ge,O,o.ah(s.transform.zoom),0,m,0,be,0,Le,v.offset,v.range,g),Xe=s.getOrCreateProgram("raster",{defines:Q});s.uploadCommonUniforms(V,Xe,null),Xe.draw(s,N.TRIANGLES,ne,S,U,b,Ke,m.id,Fe,le,ye)}function V_(u){const t=u._nearZ,s=u.projection.farthestPixelDistance(u),h=s-t,m=.2*u.height,g=t+m;return[t,s,(g-m-t)/h,(g-t)/h]}function wx(u,t,s,h){if(u)return t instanceof fl&&u instanceof zu?t.getTextureDescriptor(u,s,!0):{texture:u.texture,mix:j_(h.mix),offset:h.offset,buffer:0,tileSize:1}}var U_=o.d_([{name:"a_index",type:"Int16",components:1}]);class Tx{constructor(t,s,h,m){const g={width:h[0],height:h[1],data:null},v=t.gl;this.targetColorTexture=new o.T(t,g,v.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(t,g,v.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(s,m),this.lastInvalidatedAt=0}updateParticleTexture(t,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const h=this.context.gl,m=s.width*s.height;this.particleTexture0=new o.T(this.context,s,h.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,s,h.RGBA8,{premultiply:!1,useMipmap:!1});const g=new o.d$;g.reserve(m);for(let v=0;v<m;v++)g.emplaceBack(v);this.particleIndexBuffer=this.context.createVertexBuffer(g,U_.members,!0),this.particleSegment=o.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Sx(u,t,s){if(!u)return null;const h=t.getTextureDescriptor(u,s,!0);if(!h)return null;let{texture:m,mix:g,offset:v,tileSize:b,buffer:S,format:C}=h;if(!m||!C)return null;let P=!1;return C==="uint32"&&(P=!0,g[3]=0,g=Up(o.e0,g,[0,s.paint.get("raster-particle-max-speed")]),v=Cd(o.e0,v,[0,s.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[S/(b+2*S),b/(b+2*S)],tileSize:b,scalarData:P,scale:g,offset:v,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[C]]}}function Xp(u){const t=u._nearZ,s=u.projection.farthestPixelDistance(u),h=s-t,m=.2*u.height,g=t+m;return[t,s,(g-m-t)/h,(g-t)/h]}const Yp=new o.am(1,0,0,1),Kp=new o.am(0,1,0,1),Qp=new o.am(0,0,1,1),Io=new o.am(1,0,1,1),$a=new o.am(0,1,1,1);function Rl(u,t,s,h,m,g,v){const b=u.context,S=u.transform,C=b.gl,P=S.projection.name==="globe",D=P?["PROJECTION_GLOBE_VIEW"]:[];let z=o.bw(s.projMatrix);if(P&&o.ah(S.zoom)>0){const Le=o.bg(s.canonical,S),Ke=o.e1(Le);z=o.az(new Float32Array(16),S.globeMatrix,Ke),o.az(z,S.projMatrix,z)}const O=o.bz();O[12]+=2*m/(o.q.devicePixelRatio*S.width),O[13]+=2*g/(o.q.devicePixelRatio*S.height),o.az(z,O,z);const V=u.getOrCreateProgram("debug",{defines:D}),N=t.getTileByID(s.key);u.terrain&&u.terrain.setupElevationDraw(N,V);const H=Rt.disabled,U=Qt.disabled,Q=u.colorModeForRenderPass(),ne="$debug";b.activeTexture.set(C.TEXTURE0),u.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),P?N._makeGlobeTileDebugBuffers(u.context,S):N._makeDebugTileBoundsBuffers(u.context,S.projection);const ae=N._tileDebugBuffer||u.debugBuffer,ge=N._tileDebugIndexBuffer||u.debugIndexBuffer,de=N._tileDebugSegments||u.debugSegments;if(V.draw(u,C.LINE_STRIP,H,U,Q,Jt.disabled,Al(z,h),ne,ae,ge,de,null,null,null,[N._globeTileDebugBorderBuffer]),v){const Le=N.latestRawTileData,Ke=Math.floor((Le&&Le.byteLength||0)/1024);let Xe=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Xe+=` => ${s.overscaledZ}`),Xe+=` ${N.state}`,Xe+=` ${Ke}kb`,function(dt,ke){dt.initDebugOverlayCanvas();const Be=dt.debugOverlayCanvas,ze=dt.context.gl,et=dt.debugOverlayCanvas.getContext("2d");et.clearRect(0,0,Be.width,Be.height),et.shadowColor="white",et.shadowBlur=2,et.lineWidth=1.5,et.strokeStyle="white",et.textBaseline="top",et.font="bold 36px Open Sans, sans-serif",et.fillText(ke,5,5),et.strokeText(ke,5,5),dt.debugOverlayTexture.update(Be),dt.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)}(u,Xe)}const fe=t.getTile(s).tileSize,le=512/Math.min(fe,512)*(s.overscaledZ/S.zoom)*.5,ye=N._tileDebugTextBuffer||u.debugBuffer,be=N._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Fe=N._tileDebugTextSegments||u.debugSegments;V.draw(u,C.TRIANGLES,H,U,bi.alphaBlended,Jt.disabled,Al(z,o.am.transparent,le),ne,ye,be,Fe,null,null,null,[N._globeTileDebugTextBuffer])}function Od(u,t,s,h){Ec(u,0,t+s/2,u.transform.width,s,h)}function Fd(u,t,s,h){Ec(u,t-s/2,0,s,u.transform.height,h)}function Ec(u,t,s,h,m,g){const v=u.context,b=v.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*o.q.devicePixelRatio,s*o.q.devicePixelRatio,h*o.q.devicePixelRatio,m*o.q.devicePixelRatio),v.clear({color:g}),b.disable(b.SCISSOR_TEST)}const G_=o.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:is}=G_;function en(u,t,s,h){u.emplaceBack(t,s,h)}class ih{constructor(t){this.vertexArray=new o.e2,this.indices=new o.a_,en(this.vertexArray,-1,-1,1),en(this.vertexArray,1,-1,1),en(this.vertexArray,-1,1,1),en(this.vertexArray,1,1,1),en(this.vertexArray,-1,-1,-1),en(this.vertexArray,1,-1,-1),en(this.vertexArray,-1,1,-1),en(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,is),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=o.bd.simpleSegment(0,0,36,12)}}function Ha(u,t,s,h,m,g){const v=u.context.gl,b=t.paint.get("sky-atmosphere-color"),S=t.paint.get("sky-atmosphere-halo-color"),C=t.paint.get("sky-atmosphere-sun-intensity"),P=((D,z,O,V,N)=>({u_matrix_3f:D,u_sun_direction:z,u_sun_intensity:O,u_color_tint_r:[V.r,V.g,V.b,V.a],u_color_tint_m:[N.r,N.g,N.b,N.a],u_luminance:5e-5}))(o.e4(o.dx(),h),m,C,b,S);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),s.draw(u,v.TRIANGLES,Rt.disabled,Qt.disabled,bi.unblended,Jt.frontCW,P,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const $_=o.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class H_{constructor(t){const s=new o.e5;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const h=new o.a_;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,$_.members),this.indexBuffer=t.createIndexBuffer(h),this.segments=o.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const q_=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ex{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ic{constructor(t){this.colorModeAlphaBlendedWriteRGB=new bi([1,oo,1,oo],o.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new bi([1,0,1,0],o.am.transparent,[!1,!1,!1,!0]),this.params=new Ex,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const s=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new H_(s);const h=this.params.sizeRange,m=this.params.intensityRange,g=function(P){const D=o.ea(30),z=[];for(let O=0;O<P;++O){const V=2*Math.PI*D(),N=Math.acos(1-2*D())-.5*Math.PI;z.push(o.cS(Math.cos(N)*Math.cos(V),Math.cos(N)*Math.sin(V),Math.sin(N)))}return z}(this.params.starsCount),v=o.ea(300),b=new o.e6,S=new o.a_;let C=0;for(let P=0;P<g.length;++P){const D=o.b$([],g[P],200),z=Math.max(0,1+.01*h*(1*v()-.5)),O=Math.max(0,1+.01*m*(1*v()-.5));b.emplaceBack(D[0],D[1],D[2],-1,-1,z,O),b.emplaceBack(D[0],D[1],D[2],1,-1,z,O),b.emplaceBack(D[0],D[1],D[2],1,1,z,O),b.emplaceBack(D[0],D[1],D[2],-1,1,z,O),S.emplaceBack(C+0,C+1,C+2),S.emplaceBack(C+0,C+2,C+3),C+=4}this.starsVx=s.createVertexBuffer(b,q_.members),this.starsIdx=s.createIndexBuffer(S),this.starsSegments=o.bd.simpleSegment(0,0,b.length,S.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,s){const h=t.context,m=h.gl,g=t.transform,v=new Rt(m.LEQUAL,Rt.ReadOnly,[0,1]),b=o.ah(g.zoom),S=t.style.getLut(s.scope),C=s.properties.get("color-use-theme")==="none",P=s.properties.get("color").toRenderColor(C?null:S).toArray01(),D=s.properties.get("high-color-use-theme")==="none",z=s.properties.get("high-color").toRenderColor(D?null:S).toArray01(),O=s.properties.get("space-color-use-theme")==="none",V=s.properties.get("space-color").toRenderColor(O?null:S).toArray01PremultipliedAlpha(),N=5e-4,H=o.e7(s.properties.get("horizon-blend"),0,1,N,.25),U=o.dl(t,h,g)&&H===N?g.worldSize/(2*Math.PI*1.025)-1:g.globeRadius,Q=t.frameCounter/1e3%1,ne=o.ae(g.globeCenterInViewSpace),ae=Math.sqrt(Math.pow(ne,2)-Math.pow(U,2)),ge=Math.acos(ae/ne),de=fe=>{const le=g.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];fe&&le.push("ALPHA_PASS");const ye=t.getOrCreateProgram("globeAtmosphere",{defines:le}),be=((Le,Ke,Xe,dt,ke,Be,ze,et,Ge,ot,Qe,st)=>({u_frustum_tl:Le,u_frustum_tr:Ke,u_frustum_br:Xe,u_frustum_bl:dt,u_horizon:ke,u_transition:Be,u_fadeout_range:ze,u_color:et,u_high_color:Ge,u_space_color:ot,u_temporal_offset:Qe,u_horizon_angle:st}))(g.frustumCorners.TL,g.frustumCorners.TR,g.frustumCorners.BR,g.frustumCorners.BL,g.frustumCorners.horizon,b,H,P,z,V,Q,ge);t.uploadCommonUniforms(h,ye);const Fe=this.atmosphereBuffer;Fe&&ye.draw(t,m.TRIANGLES,v,Qt.disabled,fe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Jt.backCW,be,fe?"atmosphere_glow_alpha":"atmosphere_glow",Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)};de(!1),de(!0)}drawStars(t,s){const h=o.aD(s.properties.get("star-intensity"),0,1);if(h===0)return;const m=t.context,g=m.gl,v=t.transform,b=t.getOrCreateProgram("stars"),S=o.bY([]);o.b_(S,S,-v._pitch),o.bZ(S,S,-v.angle),o.b_(S,S,o.al(v._center.lat)),o.e8(S,S,-o.al(v._center.lng));const C=o.c3(new Float32Array(16),S),P=o.az([],v.starsProjMatrix,C),D=o.e4([],C),z=o.e9([],D),O=[0,1,0];o.dz(O,O,z),o.b$(O,O,this.params.sizeMultiplier);const V=[1,0,0];o.dz(V,V,z),o.b$(V,V,this.params.sizeMultiplier);const N=(H=O,U=V,Q=h,{u_matrix:Float32Array.from(P),u_up:H,u_right:U,u_intensity_multiplier:Q});var H,U,Q;t.uploadCommonUniforms(m,b),this.starsVx&&this.starsIdx&&b.draw(t,g.TRIANGLES,Rt.disabled,Qt.disabled,this.colorModeAlphaBlendedWriteRGB,Jt.disabled,N,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function zl(u,t){const s=[...u],h=t.cameraWorldSizeForFog/t.worldSize,m=o.bx([]);return o.cE(m,m,[h,h,1]),o.az(s,m,s),o.az(s,t.worldToFogMatrix,s),s}function pt(u,t,s,h,m){const g=s.material,v=h.context,{baseColorTexture:b,metallicRoughnessTexture:S}=g.pbrMetallicRoughness,{normalTexture:C,occlusionTexture:P,emissionTexture:D}=g;function z(V,N,H){if(V&&(u.push(N),v.activeTexture.set(v.gl.TEXTURE0+H),V.gfxTexture)){const{minFilter:U,magFilter:Q,wrapS:ne,wrapT:ae}=V.sampler;V.gfxTexture.bindExtraParam(U,Q,ne,ae)}}z(b,"HAS_TEXTURE_u_baseColorTexture",so.BaseColor),z(S,"HAS_TEXTURE_u_metallicRoughnessTexture",so.MetallicRoughness),z(C,"HAS_TEXTURE_u_normalTexture",so.Normal),z(P,"HAS_TEXTURE_u_occlusionTexture",so.Occlusion),z(D,"HAS_TEXTURE_u_emissionTexture",so.Emission),m&&(m.texture||(m.texture=new o.ed(h.context,m.image,[m.image.height,m.image.height,m.image.height],v.gl.RGBA8)),v.activeTexture.set(v.gl.TEXTURE0+so.LUT),m.texture&&m.texture.bind(v.gl.LINEAR,v.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(s.texcoordBuffer)),s.colorBuffer&&(u.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(s.colorBuffer)),s.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(s.normalBuffer)),s.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(s.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||u.push("DIFFUSE_SHADED");const O=h.shadowRenderer;O&&(u.push("RENDER_SHADOWS","DEPTH_TEXTURE"),O.useNormalOffset&&u.push("NORMAL_OFFSET"))}function It(u,t,s,h,m,g){const v=s.paint.get("model-opacity").constantOr(1),b=t.context,S=new Rt(t.context.gl.LEQUAL,Rt.ReadWrite,t.depthRangeFor3D),C=t.transform,P=u.mesh,D=P.material,z=D.pbrMetallicRoughness,O=t.style.fog;let V;V=t.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:o.az([],h.zScaleMatrix,u.nodeModelMatrix),o.az(V,h.negCameraPosMatrix,V);const N=o.bi([],V);o.ee(N,N);const H=s.paint.get("model-color-use-theme").constantOr("default")==="none",U=s.paint.get("model-emissive-strength").constantOr(0),Q=Cl(new Float32Array(u.worldViewProjection),new Float32Array(V),new Float32Array(N),null,t,v,z.baseColorFactor.toRenderColor(null),D.emissiveFactor,z.metallicFactor,z.roughnessFactor,D,U,s),ne={defines:[]},ae=[],ge=t.shadowRenderer;ge&&(ge.useNormalOffset=!1),pt(ne.defines,ae,P,t,H?null:s.lut);let de=null;if(O){const ye=zl(u.nodeModelMatrix,t.transform);if(de=new Float32Array(ye),C.projection.name!=="globe"){const be=P.aabb.min,Fe=P.aabb.max,[Le,Ke]=O.getOpacityForBounds(ye,be[0],be[1],Fe[0],Fe[1]);ne.overrideFog=Le>=Et||Ke>=Et}}const fe=wl(t,s.paint.get("model-cutoff-fade-range"));fe.shouldRenderCutoff&&ne.defines.push("RENDER_CUTOFF");const le=t.getOrCreateProgram("model",ne);t.uploadCommonUniforms(b,le,null,de,fe),t.renderPass!=="shadow"&&ge&&ge.setupShadowsFromMatrix(u.nodeModelMatrix,le),le.draw(t,b.gl.TRIANGLES,S,m,g,P.material.doubleSided?Jt.disabled:Jt.backCCW,Q,s.id,P.vertexBuffer,P.indexBuffer,P.segments,s.paint,t.transform.zoom,void 0,ae)}function Dl(u,t,s,h,m,g,v){let b;b=u.projection.name==="globe"?o.ef(s,u):[...s],o.az(b,b,t.matrix);const S=o.az([],h,b);if(t.meshes)for(const C of t.meshes){if(C.material.alphaMode!=="BLEND"){v.push({mesh:C,depth:0,modelIndex:m,worldViewProjection:S,nodeModelMatrix:b});continue}const P=o.ad([],C.centroid,S);!u.isOrthographic&&P[2]<=0||g.push({mesh:C,depth:P[2],modelIndex:m,worldViewProjection:S,nodeModelMatrix:b})}if(t.children)for(const C of t.children)Dl(u,C,s,h,m,g,v)}function Hn(u,t,s,h){const m=s.shadowRenderer;if(!m)return;const g=m.getShadowPassDepthMode(),v=m.getShadowPassColorMode(),b=m.calculateShadowPassMatrixFromMatrix(t),S=N_(b);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,g,Qt.disabled,v,Jt.backCCW,S,h.id,u.vertexBuffer,u.indexBuffer,u.segments,h.paint,s.transform.zoom,void 0,void 0)}function Oe(u,t,s){const h=t.updateZoomBasedPaintProperties(),m=function(g,v,b){let S,C,P,D=g.terrain?g.terrain.exaggeration():0;if(g.terrain&&D>0){const z=g.terrain,O=z.findDEMTileFor(b);O&&O.dem?S=o.el.create(z,b,O):D=0}if(D===0&&(v.terrainElevationMin=0,v.terrainElevationMax=0),D===v.validForExaggeration&&(D===0||S&&S._demTile&&S._demTile.tileID===v.validForDEMTile.id&&S._dem._timestamp===v.validForDEMTile.timestamp))return!1;for(const z in v.instancesPerModel){const O=v.instancesPerModel[z];for(let V=0;V<O.instancedDataArray.length;++V){const N=(S?D*S.getElevationAt(0|O.instancedDataArray.float32[16*V],0|O.instancedDataArray.float32[16*V+1],!0,!0):0)+O.instancesEvaluatedElevation[V];O.instancedDataArray.float32[16*V+6]=N,C=C?Math.min(v.terrainElevationMin,N):N,P=P?Math.max(v.terrainElevationMax,N):N}}return v.terrainElevationMin=C||0,v.terrainElevationMax=P||0,v.validForExaggeration=D,v.validForDEMTile=S&&S._demTile?{id:S._demTile.tileID,timestamp:S._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,t,s);(h||m)&&(t.uploaded=!1,t.upload(u.context))}const vs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.cV([0,0,0],[o.aj,o.aj,0])};function Bd(u,t){const s=1<<u.canonical.z,h=t.getFreeCameraOptions().position,m=t.elevation,g=u.canonical.x/s,v=(u.canonical.x+1)/s,b=u.canonical.y/s,S=(u.canonical.y+1)/s;let C=t._centerAltitude;if(m){const O=m.getMinMaxForTile(u);O&&O.max>C&&(C=O.max)}const P=o.aD(h.x,g,v)-h.x,D=o.aD(h.y,b,S)-h.y,z=o.c6(C,t.center.lat)-h.z;return t._zoomFromMercatorZ(Math.sqrt(P*P+D*D+z*z))}function Nd(u,t,s,h,m,g,v){const b=u.context,S=u.renderPass==="shadow",C=u.shadowRenderer,P=S&&C?C.getShadowPassDepthMode():new Rt(b.gl.LEQUAL,Rt.ReadWrite,u.depthRangeFor3D),D=u.isTileAffectedByFog(g);if(s.meshes)for(const z of s.meshes){const O=["MODEL_POSITION_ON_GPU"],V=[];let N,H,U;h.instancedDataArray.length>20&&O.push("INSTANCED_ARRAYS");const Q=wl(u,t.paint.get("model-cutoff-fade-range"));if(Q.shouldRenderCutoff&&O.push("RENDER_CUTOFF"),S&&C)N=u.getOrCreateProgram("modelDepth",{defines:O}),H=N_(v.shadowTileMatrix,v.shadowTileMatrix,Float32Array.from(s.matrix)),U=C.getShadowPassColorMode();else{pt(O,V,z,u,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),N=u.getOrCreateProgram("model",{defines:O,overrideFog:D});const ae=z.material,ge=ae.pbrMetallicRoughness,de=t.paint.get("model-opacity").constantOr(1),fe=t.paint.get("model-emissive-strength").constantOr(0);H=Cl(g.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,u,de,ge.baseColorFactor.toRenderColor(null),ae.emissiveFactor,ge.metallicFactor,ge.roughnessFactor,ae,fe,t,m),C&&(v.shadowUniformsInitialized?N.setShadowUniformValues(b,C.getShadowUniformValues()):(C.setupShadows(g.toUnwrapped(),N,"model-tile",g.overscaledZ),v.shadowUniformsInitialized=!0)),U=Q.shouldRenderCutoff||de<1||ae.alphaMode!=="OPAQUE"?bi.alphaBlended:bi.unblended}u.uploadCommonUniforms(b,N,g.toUnwrapped(),null,Q);const ne=z.material.doubleSided?Jt.disabled:Jt.backCCW;if(h.instancedDataArray.length>20)V.push(h.instancedDataBuffer),N.draw(u,b.gl.TRIANGLES,P,Qt.disabled,U,ne,H,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,u.transform.zoom,void 0,V,h.instancedDataArray.length);else{const ae=S?"u_instance":"u_normal_matrix";for(let ge=0;ge<h.instancedDataArray.length;++ge)H[ae]=new Float32Array(h.instancedDataArray.arrayBuffer,64*ge,16),N.draw(u,b.gl.TRIANGLES,P,Qt.disabled,U,ne,H,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,u.transform.zoom,void 0,V)}}if(s.children)for(const z of s.children)Nd(u,t,z,h,m,g,v)}const Jp=[1,-1,1];function W_(u,t,s,h){if(!s.modelManager)return!0;const m=s.modelManager;if(!s.shadowRenderer)return!0;const g=s.shadowRenderer,v=t.aabb;let b=!0,S=u.maxHeight;if(S===0){let P=0;for(const D in u.instancesPerModel){const z=m.getModel(D,h);z?P=Math.max(P,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):b=!1}S=u.maxScale*P*1.41+u.maxVerticalOffset,b&&(u.maxHeight=S)}v.max[2]=S,v.min[2]+=u.terrainElevationMin,v.max[2]+=u.terrainElevationMax,o.ad(v.min,v.min,t.tileMatrix),o.ad(v.max,v.max,t.tileMatrix);const C=v.intersects(g.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=C===2),C===0}function Z_(u,t){const s=u.uniformValues.u_cutoff_params[0],h=u.uniformValues.u_cutoff_params[1],m=u.uniformValues.u_cutoff_params[2],g=u.uniformValues.u_cutoff_params[3];return h===s||g===m?1:o.aD(((t-s)/(h-s)-m)/(g-m),0,1)}function Ac(u,t,s,h){if(t.pitch<20)return 1;const m=t.getWorldToCameraMatrix();o.az(m,m,u);const g=o.ei(s.min[0],s.min[1],s.min[2],1);let v=o.aA(o.ej(),g,m),b=v,S=v;g[1]=s.max[1],v=o.aA(o.ej(),g,m),b=v[1]<b[1]?v:b,S=v[1]>S[1]?v:S,g[0]=s.max[0],v=o.aA(o.ej(),g,m),b=v[1]<b[1]?v:b,S=v[1]>S[1]?v:S,g[1]=s.min[1],v=o.aA(o.ej(),g,m),b=v[1]<b[1]?v:b,S=v[1]>S[1]?v:S;const C=o.aD(h[0],0,1),P=100*t.pixelsPerMeter*o.aD(h[1],0,1),D=o.aD(h[2],0,1),z=o.ek(o.ej(),b,S,C),O=Math.tan(.5*t.fovX),V=-z[2]*O;if(P===0)return z[1]<-Math.abs(V)?D:1;const N=(-Math.abs(V)-z[1])/P,H=(Q,ne,ae)=>(1-ae)*Q+ae*ne,U=o.aD(H(1,D,N),D,1);return H(1,U,o.aD((t.pitch-20)/20,0,1))}class Ix{}class Ax{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,s,h){{const D=this._storage.get(s.id);if(D)return D.lastUsedFrameIdx=t,D.buf}const m=h.gl,g=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),v=new ArrayBuffer(g),b=new Int16Array(v);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(v));const S=new o.en;for(let D=0;D<g/2;D+=3){const z=b[D],O=b[D+1],V=b[D+2];S.emplaceBack(z,O),S.emplaceBack(O,V),S.emplaceBack(V,z)}const C=h.bindVertexArrayOES.current,P=new Ix;return P.buf=new ha(h,S),P.lastUsedFrameIdx=t,this._storage.set(s.id,P),h.bindVertexArrayOES.set(C),P.buf}update(t){for(const[s,h]of this._storage)t-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(s))}destroy(){for(const[t,s]of this._storage)s.buf.destroy(),this._storage.delete(t)}}class X_{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const jd=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class em{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class tm{constructor(t,s){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...s,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...s,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Y_=o.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Vd{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,s){const h=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const v=new o.eo,b=new o.a_;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(1,1),v.emplaceBack(-1,1),b.emplaceBack(0,1,2),b.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(v,Y_.members),this.vignetteIdx=t.context.createIndexBuffer(b)}const m=o.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,h);const v={u_vignetteShape:(g={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:g.vignetteColor};h.draw(t,t.context.gl.TRIANGLES,Rt.disabled,Qt.disabled,bi.alphaBlended,Jt.disabled,v,"vignette",this.vignetteVx,this.vignetteIdx,m)}var g}}class nh{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,s){const h=t.getFreeCameraOptions().position,m=h.toAltitude(),g=h.toLngLat(),v=o.al(g.lng),b=o.al(g.lat),S=t.pixelsPerMeter/s,C=v*o.eq,P=o.eq*Math.log(Math.tan(Math.PI/4+b/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const D=-this._offsetYPrev+P,z=-this._elevationPrev+m;this._accumulatedOffsetX+=(-this._offsetXPrev+C)*S,this._accumulatedOffsetY+=D*S,this._accumulatedElevation+=z*S,this._offsetXPrev=C,this._offsetYPrev=P,this._elevationPrev=m}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Ll(u,t){return[-(u[0]-Math.floor(u[0]/t)*t),-(u[1]-Math.floor(u[1]/t)*t),-(u[2]-Math.floor(u[2]/t)*t)]}function im(u){const t=o.ea(1323123451230),s=[];for(let h=0;h<u;++h){const m=2*t()-1,g=2*t()-1,v=2*t()-1;s.push(o.cS(m,g,v))}return s}function qa(u,t,s,h,m){const g=o.aD((m-s)/(h-s),0,1);return(1-g)*u+g*t}class lo{constructor(t){this._movement=new nh,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Vd,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,s){const h=t.transform;this._movement.update(h,this._ppmScaleFactor);const m=h.starsProjMatrix,g=o.bY([]);o.b_(g,g,o.al(90)-h._pitch),o.bZ(g,g,-h.angle);const v=o.c3(new Float32Array(16),g),b=o.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),S=o.ee([],b),C=o.az([],S,v),P=Date.now()/1e3;return this._accumulatedTimeFromStart+=(P-this._prevTime)*s,this._prevTime=P,{projectionMatrix:m,modelviewMatrix:C}}}class Cx extends lo{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new tm(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const h=im(this.particlesCount),m=new o.er,g=new o.a_;let v=0;const b=o.ea(1323123451230);for(let S=0;S<h.length;++S){const C=h[S],P=[2*b()-1,b(),b(),b()];m.emplaceBack(C[0],C[1],C[2],-1,-1,...P),m.emplaceBack(C[0],C[1],C[2],1,-1,...P),m.emplaceBack(C[0],C[1],C[2],1,1,...P),m.emplaceBack(C[0],C[1],C[2],-1,1,...P),g.emplaceBack(v+0,v+1,v+2),g.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=s.createVertexBuffer(m,jd.members),this.particlesIdx=s.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},h=t.transform.zoom;if(s.revealStart>h)return;const m=qa(0,1,s.revealStart,s.revealStart+s.revealRange,h);if(!this.particlesVx||!this.particlesIdx)return;const g=structuredClone(this._params);let v=[-g.direction.x,g.direction.y,-100];o.au(v,v);const b=structuredClone(this._vignetteParams);b.strength*=m,g.overrideStyleParameters||(g.intensity=t.style.rain.state.density,g.timeFactor=t.style.rain.state.intensity,g.color=structuredClone(t.style.rain.state.color),v=structuredClone(t.style.rain.state.direction),g.screenThinning.intensity=t.style.rain.state.centerThinning,g.dropletSizeX=t.style.rain.state.dropletSize[0],g.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],g.distortionStrength=100*t.style.rain.state.distortionStrength,b.strength=1,b.color=structuredClone(t.style.rain.state.vignetteColor));const S=this.updateOnRender(t,g.timeFactor),C=t.context,P=C.gl,D=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new o.T(C,{width:t.width,height:t.height,data:null},P.RGBA8)),g.distortionStrength>0&&(C.activeTexture.set(P.TEXTURE0),this.screenTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),P.copyTexSubImage2D(P.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const z=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(C,z),C.activeTexture.set(P.TEXTURE0),this.screenTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE);const O=[g.color.r,g.color.g,g.color.b,g.color.a],V=(N,H)=>{const U=Ll(this._movement.getPosition(),N),Q=g.dropletSizeX,ne=g.dropletSizeX*g.dropletSizeYScale,ae=t.width/2,ge=t.height/2,de=qa(0,g.screenThinning.start,0,1,g.screenThinning.intensity),fe=qa(.001,g.screenThinning.range,0,1,g.screenThinning.intensity),le=qa(0,g.screenThinning.particleOffset,0,1,g.screenThinning.intensity),ye=(be={modelview:S.modelviewMatrix,projection:S.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:U,velocityConeAperture:g.velocityConeAperture,velocity:g.velocity,boxSize:N,rainDropletSize:[Q,ne],distortionStrength:g.distortionStrength,rainDirection:v,color:O,screenSize:[D.width,D.height],thinningCenterPos:[ae,ge],thinningShape:[de,fe,Math.pow(10,g.screenThinning.fadePower)],thinningAffectedRatio:g.screenThinning.affectedRatio,thinningParticleOffset:le,shapeDirectionalPower:g.shapeDirPower,shapeNormalPower:g.shapeNormalPower,mode:H?0:1},{u_modelview:Float32Array.from(be.modelview),u_projection:Float32Array.from(be.projection),u_time:be.time,u_cam_pos:be.camPos,u_texScreen:0,u_velocityConeAperture:be.velocityConeAperture,u_velocity:be.velocity,u_boxSize:be.boxSize,u_rainDropletSize:be.rainDropletSize,u_distortionStrength:be.distortionStrength,u_rainDirection:be.rainDirection,u_color:be.color,u_screenSize:be.screenSize,u_thinningCenterPos:be.thinningCenterPos,u_thinningShape:be.thinningShape,u_thinningAffectedRatio:be.thinningAffectedRatio,u_thinningParticleOffset:be.thinningParticleOffset,u_shapeDirectionalPower:be.shapeDirectionalPower,u_shapeNormalPower:be.shapeNormalPower,u_mode:be.mode});var be;const Fe=Math.round(g.intensity*this.particlesCount),Le=o.bd.simpleSegment(0,0,4*Fe,2*Fe);z.draw(t,P.TRIANGLES,Rt.disabled,Qt.disabled,bi.alphaBlended,Jt.disabled,ye,"rain_particles",this.particlesVx,this.particlesIdx,Le)};g.distortionStrength>0&&V(g.boxSize,!0),V(g.boxSize,!1),this._vignette.draw(t,b)}}const rh=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Mn extends lo{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new tm(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const h=im(this.particlesCount),m=new o.es,g=new o.a_;let v=0;const b=o.ea(1323123451230);for(let S=0;S<h.length;++S){const C=h[S],P=b(),D=b(),z=b(),O=[S/h.length,P,D,z],V=[b(),b()];m.emplaceBack(C[0],C[1],C[2],-1,-1,...O,...V),m.emplaceBack(C[0],C[1],C[2],1,-1,...O,...V),m.emplaceBack(C[0],C[1],C[2],1,1,...O,...V),m.emplaceBack(C[0],C[1],C[2],-1,1,...O,...V),g.emplaceBack(v+0,v+1,v+2),g.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=s.createVertexBuffer(m,rh.members),this.particlesIdx=s.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const s=structuredClone(this._params);let h=[-s.direction.x,s.direction.y,-100];o.au(h,h);const m=structuredClone(this._vignetteParams),g=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},v=t.transform.zoom;if(g.revealStart>v)return;const b=qa(0,1,g.revealStart,g.revealStart+g.revealRange,v);m.strength*=b,s.overrideStyleParameters||(s.intensity=t.style.snow.state.density,s.timeFactor=t.style.snow.state.intensity,s.color=structuredClone(t.style.snow.state.color),h=structuredClone(t.style.snow.state.direction),s.screenThinning.intensity=t.style.snow.state.centerThinning,s.billboardSize=2.79*t.style.snow.state.flakeSize,m.strength=1,m.color=structuredClone(t.style.snow.state.vignetteColor));const S=this.updateOnRender(t,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const C=t.context,P=C.gl,D=t.transform,z=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(C,z),((O,V,N)=>{const H=Ll(this._movement.getPosition(),O),U=D.width/2,Q=D.height/2,ne=qa(0,N.screenThinning.start,0,1,N.screenThinning.intensity),ae=qa(.001,N.screenThinning.range,0,1,N.screenThinning.intensity),ge=qa(0,N.screenThinning.particleOffset,0,1,N.screenThinning.intensity),de=(fe={modelview:S.modelviewMatrix,projection:S.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:H,velocityConeAperture:N.velocityConeAperture,velocity:N.velocity,horizontalOscillationRadius:N.horizontalOscillationRadius,horizontalOscillationRate:N.horizontalOscillationRate,boxSize:O,billboardSize:1*N.billboardSize,simpleShapeParameters:[N.shapeFadeStart,N.shapeFadePower],screenSize:[D.width,D.height],thinningCenterPos:[U,Q],thinningShape:[ne,ae,Math.pow(10,N.screenThinning.fadePower)],thinningAffectedRatio:N.screenThinning.affectedRatio,thinningParticleOffset:ge,color:[N.color.r,N.color.g,N.color.b,N.color.a],direction:h},{u_modelview:Float32Array.from(fe.modelview),u_projection:Float32Array.from(fe.projection),u_time:fe.time,u_cam_pos:fe.camPos,u_velocityConeAperture:fe.velocityConeAperture,u_velocity:fe.velocity,u_horizontalOscillationRadius:fe.horizontalOscillationRadius,u_horizontalOscillationRate:fe.horizontalOscillationRate,u_boxSize:fe.boxSize,u_billboardSize:fe.billboardSize,u_simpleShapeParameters:fe.simpleShapeParameters,u_screenSize:fe.screenSize,u_thinningCenterPos:fe.thinningCenterPos,u_thinningShape:fe.thinningShape,u_thinningAffectedRatio:fe.thinningAffectedRatio,u_thinningParticleOffset:fe.thinningParticleOffset,u_particleColor:fe.color,u_direction:fe.direction});var fe;const le=Math.round(N.intensity*this.particlesCount),ye=o.bd.simpleSegment(0,0,4*le,2*le);this.particlesVx&&this.particlesIdx&&z.draw(t,P.TRIANGLES,Rt.disabled,Qt.disabled,bi.alphaBlended,Jt.disabled,de,"snow_particles",this.particlesVx,this.particlesIdx,ye)})(s.boxSize,0,s),this._vignette.draw(t,m)}}const Gi={symbol:function(u,t,s,h,m){if(u.renderPass!=="translucent")return;const g=Qt.disabled,v=u.colorModeForRenderPass(),b=s.layout.get("text-variable-anchor"),S=s.layout.get("text-size-scale-range"),C=o.aD(u.scaleFactor,S[0],S[1]);b&&function(z,O,V,N,H,U,Q,ne){const ae=O.transform,ge=H==="map",de=U==="map";for(const fe of z){const le=N.getTile(fe),ye=le.getBucket(V);if(!ye||!ye.text||!ye.text.segments.get().length)continue;const be=o.bH(ye.textSizeData,ae.zoom,ne),Fe=Ou(fe,ye.getProjection(),ae),Le=ae.calculatePixelsToTileUnitsMatrix(le),Ke=ac(Fe,le.tileID.canonical,de,ge,ae,ye.getProjection(),Le),Xe=ye.hasIconTextFit()&&ye.hasIconData();be&&qp(ye,ge,de,Q,ae,Ke,fe,Math.pow(2,ae.zoom-le.tileID.overscaledZ),be,Xe)}}(h,u,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m,C);const P=s.paint.get("icon-opacity").constantOr(1)!==0,D=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(P||D)?kd(u,t,s,h,g,v):(P&&kd(u,t,s,h,g,v,{onlyIcons:!0}),D&&kd(u,t,s,h,g,v,{onlyText:!0})),t.map.showCollisionBoxes&&(Tc(u,t,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Tc(u,t,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,s,h){if(u.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),g=s.paint.get("circle-stroke-width"),v=s.paint.get("circle-stroke-opacity"),b=s.layout.get("circle-sort-key").constantOr(1)!==void 0,S=s.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(g.constantOr(1)===0||v.constantOr(1)===0))return;const C=u.context,P=C.gl,D=u.transform,z=u.depthModeForSublayer(0,Rt.ReadOnly),O=Qt.disabled,V=u.colorModeForDrapableLayerRenderPass(S),N=D.projection.name==="globe",H=[o.ay(D.center.lng),o.aH(D.center.lat)],U=[];for(let ne=0;ne<h.length;ne++){const ae=h[ne],ge=t.getTile(ae),de=ge.getBucket(s);if(!de||de.projection.name!==D.projection.name)continue;const fe=de.programConfigurations.get(s.id),le=o.dK(s),ye=u.isTileAffectedByFog(ae);N&&le.push("PROJECTION_GLOBE_VIEW"),le.push("DEPTH_D24"),u.terrain&&D.depthOcclusionForSymbolsAndCircles&&le.push("DEPTH_OCCLUSION");const be=u.getOrCreateProgram("circle",{config:fe,defines:le,overrideFog:ye}),Fe=de.layoutVertexBuffer,Le=de.globeExtVertexBuffer,Ke=de.indexBuffer,Xe=D.projection.createInversionMatrix(D,ae.canonical),dt={programConfiguration:fe,program:be,layoutVertexBuffer:Fe,globeExtVertexBuffer:Le,indexBuffer:Ke,uniformValues:o.dL(u,ae,ge,Xe,H,s),tile:ge};if(b){const ke=de.segments.get();for(const Be of ke)U.push({segments:new o.bd([Be]),sortKey:Be.sortKey,state:dt})}else U.push({segments:de.segments,sortKey:0,state:dt})}b&&U.sort((ne,ae)=>ne.sortKey-ae.sortKey);const Q={useDepthForOcclusion:D.depthOcclusionForSymbolsAndCircles};for(const ne of U){const{programConfiguration:ae,program:ge,layoutVertexBuffer:de,globeExtVertexBuffer:fe,indexBuffer:le,uniformValues:ye,tile:be}=ne.state,Fe=ne.segments;u.terrain&&u.terrain.setupElevationDraw(be,ge,Q),u.uploadCommonUniforms(C,ge,be.tileID.toUnwrapped()),ge.draw(u,P.TRIANGLES,z,O,V,Jt.disabled,ye,s.id,de,le,Fe,s.paint,D.zoom,ae,[fe])}},heatmap:function(u,t,s,h){if(s.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const m=u.context,g=m.gl,v=Qt.disabled,b=new bi([g.ONE,g.ONE,g.ONE,g.ONE],o.am.transparent,[!0,!0,!0,!0]);(function(O,V,N,H){const U=O.gl,Q=V.width*H,ne=V.height*H;O.activeTexture.set(U.TEXTURE1),O.viewport.set([0,0,Q,ne]);let ae=N.heatmapFbo;if(!ae||ae&&(ae.width!==Q||ae.height!==ne)){ae&&ae.destroy();const ge=U.createTexture();U.bindTexture(U.TEXTURE_2D,ge),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),ae=N.heatmapFbo=O.createFramebuffer(Q,ne,!0,null),function(de,fe,le,ye,be,Fe){const Le=de.gl;Le.texImage2D(Le.TEXTURE_2D,0,de.extRenderToTextureHalfFloat?Le.RGBA16F:Le.RGBA,be,Fe,0,Le.RGBA,de.extRenderToTextureHalfFloat?Le.HALF_FLOAT:Le.UNSIGNED_BYTE,null),ye.colorAttachment.set(le)}(O,0,ge,ae,Q,ne)}else U.bindTexture(U.TEXTURE_2D,ae.colorAttachment.get()),O.bindFramebuffer.set(ae.framebuffer)})(m,u,s,u.transform.projection.name==="globe"?.5:.25),m.clear({color:o.am.transparent});const S=u.transform,C=S.projection.name==="globe",P=C?["PROJECTION_GLOBE_VIEW"]:[],D=C?Jt.frontCCW:Jt.disabled,z=[o.ay(S.center.lng),o.aH(S.center.lat)];for(let O=0;O<h.length;O++){const V=h[O];if(t.hasRenderableParent(V))continue;const N=t.getTile(V),H=N.getBucket(s);if(!H||H.projection.name!==S.projection.name)continue;const U=u.isTileAffectedByFog(V),Q=H.programConfigurations.get(s.id),ne=u.getOrCreateProgram("heatmap",{config:Q,defines:P,overrideFog:U}),{zoom:ae}=u.transform;u.terrain&&u.terrain.setupElevationDraw(N,ne),u.uploadCommonUniforms(m,ne,V.toUnwrapped());const ge=S.projection.createInversionMatrix(S,V.canonical);ne.draw(u,g.TRIANGLES,Rt.disabled,v,b,D,k_(u,V,N,ge,z,ae,s.paint.get("heatmap-intensity")),s.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,s.paint,u.transform.zoom,Q,C?[H.globeExtVertexBuffer]:null)}m.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(m,g){const v=m.context,b=v.gl,S=g.heatmapFbo;if(!S)return;v.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,S.colorAttachment.get()),v.activeTexture.set(b.TEXTURE1);let C=g.colorRampTexture;C||(C=g.colorRampTexture=new o.T(v,g.colorRamp,b.RGBA8)),C.bind(b.LINEAR,b.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,b.TRIANGLES,Rt.disabled,Qt.disabled,m.colorModeForRenderPass(),Jt.disabled,((P,D,z,O)=>({u_image:0,u_color_ramp:1,u_opacity:D.paint.get("heatmap-opacity")}))(0,g),g.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,g.paint,m.transform.zoom)}(u,s))},line:function(u,t,s,h){if(u.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),g=s.paint.get("line-width");if(m.constantOr(1)===0||g.constantOr(1)===0)return;const v=s.paint.get("line-emissive-strength"),b=s.paint.get("line-occlusion-opacity"),S=s.layout.get("line-elevation-reference"),C=s.layout.get("line-width-unit")==="meters",P=S==="sea",D=!(!u.terrain||!u.terrain.enabled),z=u.context,O=z.gl;if(s.hasElevatedBuckets&&u.transform.projection.name==="globe")return;const V=s.layout.get("line-cross-slope"),N=V!==void 0,H=V<1,U=u.colorModeForDrapableLayerRenderPass(v),Q=u.terrain&&u.terrain.renderingToTexture,ne=Q?1:o.q.devicePixelRatio,ae=s.paint.get("line-dasharray"),ge=ae.constantOr(1),de=s.layout.get("line-cap"),fe=ae.constantOr(null),le=de.constantOr(null),ye=s.paint.get("line-pattern"),be=ye.constantOr(1),Fe=s.paint.get("line-pattern-cross-fade"),Le=ye.constantOr(null),Ke=s.paint.get("line-opacity").constantOr(1);let Xe=!be&&Ke!==1||u.depthOcclusion&&b>0&&b<1;const dt=s.paint.get("line-gradient"),ke=be?"linePattern":"line",Be=o.dM(s);let ze;if(Q&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(Xe=!1),b!==0&&u.depthOcclusion){const Qe=s.paint._values["line-opacity"];Qe&&Qe.value&&Qe.value.kind==="constant"?ze=Qe.value:o.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}g.value.kind!=="constant"&&g.value.isLineProgressConstant===!1&&Be.push("VARIABLE_LINE_WIDTH");const et=(Qe,st,at,Pt,Nt,Ct)=>{for(const jt of Qe){const zt=t.getTile(jt);if(be&&!zt.patternsLoaded())continue;const Zt=zt.getBucket(s);if(!Zt||Zt.elevationType!=="none"&&!Nt||Zt.elevationType==="none"&&Nt)continue;u.prepareDrawTile();const si=[...st],Ai=u.shadowRenderer,tn=Zt.elevationType==="road"&&!!Ai&&Ai.enabled;let Yi=[0,0,0];if(tn){const mi=u.style.directionalLight,En=u.style.ambientLight;mi&&En&&(Yi=js(u.style,mi,En)),si.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Mi=Zt.programConfigurations.get(s.id);let Un=!1;if(Le&&zt.imageAtlas){const mi=o.dN.from(Le),En=mi.getPrimary().scaleSelf(ne).toString(),Bi=zt.imageAtlas.patternPositions.get(En),In=mi.getSecondary(),qi=In?zt.imageAtlas.patternPositions.get(In.scaleSelf(ne).toString()):null;Un=!!Bi&&!!qi,Bi&&Mi.setConstantPatternPositions(Bi,qi)}Fe>0&&(Un||Mi.getPatternTransitionVertexBuffer("line-pattern"))&&si.push("LINE_PATTERN_TRANSITION");const Dn=u.isTileAffectedByFog(jt),hi=u.getOrCreateProgram(ke,{config:Mi,defines:si,overrideFog:Dn,overrideRtt:!Nt&&void 0});if(!be&&fe&&le&&zt.lineAtlas){const mi=zt.lineAtlas.getDash(fe,le);mi&&Mi.setConstantPatternPositions(mi)}tn&&Ai.setupShadows(zt.tileID.toUnwrapped(),hi,"vector-tile",zt.tileID.overscaledZ);let[ki,ji]=s.paint.get("line-trim-offset");(le==="round"||le==="square")&&ki!==ji&&(ki===0&&(ki-=1),ji===1&&(ji+=1));const nn=Q?jt.projMatrix:null,nr=C?1/Zt.tileToMeter/o.aw(zt,1,u.transform.zoom):1,qn=C?1/Zt.tileToMeter/o.aw(zt,1,Math.floor(u.transform.zoom)):1,tr=be?o.dO(u,zt,s,nn,ne,nr,qn,[ki,ji],Yi,Fe):o.dP(u,zt,s,nn,Zt.lineClipsArray.length,ne,nr,qn,[ki,ji],Yi);if(dt){const mi=Zt.gradients[s.id];let En=mi.texture;if(s.gradientVersion!==mi.version){let Bi=256;if(s.stepInterpolant){const In=t.getSource().maxzoom,qi=jt.canonical.z===In?Math.ceil(1<<u.transform.maxZoom-jt.canonical.z):1;Bi=o.aD(o.dQ(Zt.maxLineLength/o.aj*1024*qi),256,z.maxTextureSize)}mi.gradient=o.dR({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Bi,image:mi.gradient||void 0,clips:Zt.lineClipsArray}),mi.texture?mi.texture.update(mi.gradient):mi.texture=new o.T(z,mi.gradient,O.RGBA8),mi.version=s.gradientVersion,En=mi.texture}z.activeTexture.set(O.TEXTURE1),En.bind(s.stepInterpolant?O.NEAREST:O.LINEAR,O.CLAMP_TO_EDGE)}ge&&(z.activeTexture.set(O.TEXTURE0),zt.lineAtlasTexture&&zt.lineAtlasTexture.bind(O.LINEAR,O.REPEAT),Mi.updatePaintBuffers()),be&&(z.activeTexture.set(O.TEXTURE0),zt.imageAtlasTexture&&zt.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Mi.updatePaintBuffers()),Nt&&!P&&u.terrain.setupElevationDraw(zt,hi),u.uploadCommonUniforms(z,hi,jt.toUnwrapped());const Pn=mi=>{ze!=null&&(ze.value=Ke*b),hi.draw(u,O.TRIANGLES,at,mi,U,Jt.disabled,tr,s.id,Zt.layoutVertexBuffer,Zt.indexBuffer,Zt.segments,s.paint,u.transform.zoom,Mi,[Zt.layoutVertexBuffer2,Zt.patternVertexBuffer,Zt.zOffsetVertexBuffer]),ze!=null&&(ze.value=Ke)};if(Xe&&!Nt){const mi=u.stencilModeForClipping(jt).ref;mi===0&&Q&&z.clear({stencil:0});const En={func:O.EQUAL,mask:255};tr.u_alpha_discard_threshold=.8,Pn(new Qt(En,mi,255,O.KEEP,O.KEEP,O.INVERT)),tr.u_alpha_discard_threshold=0,Pn(new Qt(En,mi,255,O.KEEP,O.KEEP,O.KEEP))}else tr.u_alpha_discard_threshold=Xe&&Nt&&Ct?.8:0,Pn(Nt?Pt:u.stencilModeForClipping(jt))}};let Ge=u.depthModeForSublayer(0,Rt.ReadOnly);const ot=new Rt(u.depthOcclusion?O.GREATER:O.LEQUAL,Rt.ReadOnly,u.depthRangeFor3D);if(s.hasNonElevatedBuckets){const Qe=!Q&&u.terrain;b!==0&&Qe?o.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):Qe?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):et(h,Be,Ge,Qt.disabled,!1,!0)}if(s.hasElevatedBuckets){S==="hd-road-markup"?D||(Ge=ot,Be.push("ELEVATED_ROADS")):(Be.push("ELEVATED"),Ge=ot,N&&Be.push(H?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),P&&Be.push("ELEVATION_REFERENCE_SEA"));const Qe=Xe?u.stencilModeFor3D():Qt.disabled;u.forceTerrainMode=!0,et(h,Be,Ge,Qe,!0,!0),Xe&&et(h,Be,Ge,Qe,!0,!1),u.forceTerrainMode=!1}Xe&&(u.resetStencilClippingMasks(),Q&&z.clear({stencil:0})),b===0||u.depthOcclusion||Q||u.layersWithOcclusionOpacity.push(u.currentLayer)},fill:function(u,t,s,h){const m=s.paint.get("fill-color"),g=s.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const v=s.paint.get("fill-emissive-strength"),b=u.colorModeForDrapableLayerRenderPass(v),S=s.paint.get("fill-pattern"),C=u.opaquePassEnabledForLayer()&&!S.constantOr(1)&&m.constantOr(o.am.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";let P="none";s.layout.get("fill-elevation-reference")!=="none"?P="road":s.paint.get("fill-z-offset").constantOr(1)!==0&&(P="offset");const D=!(!u.terrain||!u.terrain.enabled),z={painter:u,sourceCache:t,layer:s,coords:h,colorMode:b,elevationType:P,terrainEnabled:D,pass:C};if(u.renderPass!=="shadow")if(P!=="offset"){if(At(z,!1),P==="road"){const O=!D&&u.renderPass==="translucent";O&&Ju(u,t,s,h,"geometry"),At(z,!0,Qt.disabled),O&&function(V){const{painter:N,sourceCache:H,layer:U,coords:Q,colorMode:ne}=V,ae=N.context.gl,ge=V.painter.shadowRenderer,de=!!ge&&ge.enabled,fe=new Rt(N.context.gl.LEQUAL,Rt.ReadOnly,N.depthRangeFor3D);let le=[0,0,0];if(de){const ye=N.style.directionalLight,be=N.style.ambientLight;ye&&be&&(le=js(N.style,ye,be))}for(const ye of Q){const be=H.getTile(ye),Fe=be.getBucket(U);if(!Fe)continue;const Le=Fe.elevatedStructures;if(!Le||!Le.renderableSegments||Le.renderableSegments.segments[0].primitiveLength===0)continue;N.prepareDrawTile();const Ke=Fe.bufferData.programConfigurations.get(U.id),Xe=N.isTileAffectedByFog(ye),dt=[];de&&dt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ke=N.getOrCreateProgram("elevatedStructures",{config:Ke,overrideFog:Xe,defines:dt}),Be=N.translatePosMatrix(ye.projMatrix,be,U.paint.get("fill-translate"),U.paint.get("fill-translate-anchor"));de&&ge.setupShadows(be.tileID.toUnwrapped(),ke,"vector-tile",be.tileID.overscaledZ);const ze=Vp(Be,le);N.uploadCommonUniforms(N.context,ke,ye.toUnwrapped()),ke.draw(N,ae.TRIANGLES,fe,Qt.disabled,ne,Jt.backCCW,ze,U.id,Le.vertexBuffer,Le.indexBuffer,Le.renderableSegments,U.paint,N.transform.zoom,Ke,[Le.vertexBufferNormal])}}(z)}}else At(z,!1,u.stencilModeFor3D());else u.shadowRenderer&&P==="road"&&!D&&function(O){const{painter:V,sourceCache:N,layer:H,coords:U}=O,Q=V.context.gl,ne=O.painter.shadowRenderer;for(const ae of U){const ge=N.getTile(ae),de=ge.getBucket(H);if(!de)continue;const fe=de.elevatedStructures;if(!fe||!fe.shadowCasterSegments||fe.shadowCasterSegments.segments[0].primitiveLength===0)continue;V.prepareDrawTile();const le=de.bufferData.programConfigurations.get(H.id),ye=V.isTileAffectedByFog(ae),be=V.getOrCreateProgram("elevatedStructuresDepth",{config:le,overrideFog:ye}),Fe=ne.calculateShadowPassMatrixFromTile(ge.tileID.toUnwrapped());V.uploadCommonUniforms(V.context,be,ae.toUnwrapped());const Le={u_matrix:Fe,u_depth_bias:.001};be.draw(V,Q.TRIANGLES,ne.getShadowPassDepthMode(),Qt.disabled,ne.getShadowPassColorMode(),Jt.disabled,Le,H.id,fe.vertexBuffer,fe.indexBuffer,fe.shadowCasterSegments,H.paint,V.transform.zoom,le)}}(z)},"fill-extrusion":function(u,t,s,h){const m=s.paint.get("fill-extrusion-opacity"),g=u.context,v=g.gl,b=u.terrain,S=b&&b.renderingToTexture;if(m===0)return;const C=u.conflationActive&&u.style.isLayerClipped(s,t.getSource()),P=u.style.order.indexOf(s.fqid);if(C&&function(D,z,O,V,N){for(const H of V){const U=z.getTile(H).getBucket(O);U&&(U.updateReplacement(H,D.replacementSource,N),U.uploadCentroid(D.context))}}(u,t,s,h,P),b||C)for(const D of h){const z=t.getTile(D).getBucket(s);z&&Ua(u.context,t,D,z,s,b,C)}if(u.renderPass==="shadow"&&u.shadowRenderer){const D=u.shadowRenderer;if(b&&m<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ab)return;const z=D.getShadowPassDepthMode(),O=D.getShadowPassColorMode();eh(u,t,s,h,z,Qt.disabled,O,C)}else if(u.renderPass==="translucent"){const D=!s.paint.get("fill-extrusion-pattern").constantOr(1),z=s.paint.get("fill-extrusion-color").constantOr(o.am.white);if(!S&&z.a!==0){const O=new Rt(u.context.gl.LEQUAL,Rt.ReadWrite,u.depthRangeFor3D);m===1&&D?eh(u,t,s,h,O,Qt.disabled,bi.unblended,C):(eh(u,t,s,h,O,Qt.disabled,bi.disabled,C),eh(u,t,s,h,O,u.stencilModeFor3D(),u.colorModeForRenderPass(),C),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&D&&(!b&&u.transform.projection.name!=="globe"||S)){const O=s.paint.get("fill-extrusion-opacity"),V=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),N=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),H=s.paint.get("fill-extrusion-flood-light-intensity"),U=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Q=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(U?null:s.lut).toArray01().slice(0,3),ne=V>0&&N>0,ae=H>0,ge=(fe,le,ye)=>(1-ye)*fe+ye*le,de=fe=>{const le=u.depthModeForSublayer(1,Rt.ReadOnly,v.LEQUAL,!0),ye=s.paint.get(fe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),be=ge(.1,3,ye),Fe=u._showOverdrawInspector;if(!Fe){const Le=new Qt({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),Ke=new bi([v.ONE,v.ONE,v.ONE,v.ONE],o.am.transparent,[!1,!1,!1,!0],v.MIN);Pl(u,t,s,h,le,Le,Ke,Jt.disabled,fe,"sdf",O,V,N,H,Q,be,C,!1)}{const Le=Fe?Qt.disabled:new Qt({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),Ke=Fe?u.colorModeForRenderPass():new bi([v.ONE_MINUS_DST_ALPHA,v.DST_ALPHA,v.ONE,v.ONE],o.am.transparent,[!0,!0,!0,!0]);Pl(u,t,s,h,le,Le,Ke,Jt.disabled,fe,"color",O,V,N,H,Q,be,C,!1)}};if(S){const fe=(le,ye,be)=>{const Fe=u.depthModeForSublayer(1,Rt.ReadOnly,v.LEQUAL,!1),Le=s.paint.get(le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ke=ge(.1,3,Le);{const Xe=new bi([v.ONE,v.ONE,v.ONE,v.ONE],o.am.transparent,[!1,!1,!1,!0]);Pl(u,t,s,h,Fe,Qt.disabled,Xe,Jt.disabled,le,"clear",O,V,N,H,Q,Ke,C,ye)}{const Xe=new Qt({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),dt=new bi([v.ONE,v.ONE,v.ONE,v.ONE],o.am.transparent,[!1,!1,!1,!0],v.MIN);Pl(u,t,s,h,Fe,Xe,dt,Jt.disabled,le,"sdf",O,V,N,H,Q,Ke,C,ye)}{const Xe=le?v.ZERO:v.ONE_MINUS_DST_ALPHA,dt=new Qt({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),ke=new bi([Xe,v.DST_ALPHA,v.ONE_MINUS_DST_ALPHA,v.ZERO],o.am.transparent,[!0,!0,!0,!0]);Pl(u,t,s,h,Fe,dt,ke,Jt.disabled,le,"color",O,V,N,H,Q,Ke,C,ye)}{const Xe=new bi([v.ONE,v.ONE,v.ONE,le?v.ZERO:v.ONE],o.am.transparent,[!1,!1,!1,!0],le?v.FUNC_ADD:v.MAX);Pl(u,t,s,h,Fe,Qt.disabled,Xe,Jt.disabled,le,"clear",O,V,N,H,Q,Ke,C,ye,be)}};if(ne||ae){let le;if(u.prepareDrawTile(),b){const ye=b.drapeBufferSize[0],be=b.drapeBufferSize[1];le=b.framebufferCopyTexture,le&&(!le||le.size[0]===ye&&le.size[1]===be)||(le&&le.destroy(),le=b.framebufferCopyTexture=new o.T(g,new o.r({width:ye,height:be}),v.RGBA8)),le.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.copyTexSubImage2D(v.TEXTURE_2D,0,0,0,0,0,ye,be)}ne&&fe(!0,!1,le),ae&&fe(!1,!0,le)}}else ne&&de(!0),ae&&de(!1),(ne||ae)&&u.resetStencilClippingMasks()}}},hillshade:function(u,t,s,h){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const m=u.context,g=u.terrain&&u.terrain.renderingToTexture,[v,b]=u.renderPass!=="translucent"||g?[{},h]:u.stencilConfigForOverlap(h);for(const S of b){const C=t.getTile(S);if(C.needsHillshadePrepare&&u.renderPass==="offscreen")Ap(u,C,s);else if(u.renderPass==="translucent"){const P=u.depthModeForSublayer(0,Rt.ReadOnly),D=s.paint.get("hillshade-emissive-strength"),z=u.colorModeForDrapableLayerRenderPass(D),O=g&&u.terrain?u.terrain.stencilModeForRTTOverlap(S):v[S.overscaledZ];x_(u,S,C,s,P,O,z)}}m.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,t,s,h,m,g){if(u.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const v=u.transform.projection.name==="globe",b=s.paint.get("raster-elevation")!==0,S=b&&v;if(u.renderElevatedRasterBackface&&!S)return;const C=u.context,P=C.gl,D=t.getSource(),z=function(de,fe,le,ye){const be=fe.paint.get("raster-color"),Fe=de.type==="raster-array",Le=[],Ke=fe.paint.get("raster-resampling"),Xe=fe.paint.get("raster-color-mix");let dt=fe.paint.get("raster-color-range");const ke=[Xe[0],Xe[1],Xe[2],0],Be=Xe[3];let ze=Ke==="nearest"?ye.NEAREST:ye.LINEAR;if(Fe&&(Le.push("RASTER_ARRAY"),be||Le.push("RASTER_COLOR"),Ke==="linear"&&Le.push("RASTER_ARRAY_LINEAR"),ze=ye.NEAREST,!dt&&de.rasterLayers)){const et=de.rasterLayers.find(({id:Ge})=>Ge===fe.sourceLayer);et&&et.fields&&et.fields.range&&(dt=et.fields.range)}if(dt=dt||[0,1],be){Le.push("RASTER_COLOR"),le.activeTexture.set(ye.TEXTURE2),fe.updateColorRamp(dt);let et=fe.colorRampTexture;et||(et=fe.colorRampTexture=new o.T(le,fe.colorRamp,ye.RGBA8)),et.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}return{mix:ke,range:dt,offset:Be,defines:Le,resampling:ze}}(D,s,C,P);if(D instanceof o.aP&&!h.length&&!v)return;const O=s.paint.get("raster-emissive-strength"),V=u.colorModeForDrapableLayerRenderPass(O),N=u.terrain&&u.terrain.renderingToTexture,H=!u.options.moving,U=s.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(D instanceof o.aP&&!h.length&&(D.onNorthPole||D.onSouthPole)){const de=b?u.stencilModeFor3D():Qt.disabled;return void th(!!D.onNorthPole,null,u,t,s,O,z,Jt.disabled,de)}if(!h.length)return;const[Q,ne]=D instanceof o.aP||N?[{},h]:u.stencilConfigForOverlap(h),ae=ne[ne.length-1].overscaledZ;S&&z.defines.push("PROJECTION_GLOBE_VIEW"),b&&z.defines.push("RENDER_CUTOFF");const ge=(de,fe,le)=>{for(const ye of de){const be=ye.toUnwrapped(),Fe=t.getTile(ye);if(N&&(!Fe||!Fe.hasData()))continue;C.activeTexture.set(P.TEXTURE0);const Le=wx(Fe,D,s,z);if(!Le||!Le.texture)continue;const{texture:Ke,mix:Xe,offset:dt,tileSize:ke,buffer:Be}=Le;let ze,et;N?(ze=Rt.disabled,et=ye.projMatrix):b?(ze=new Rt(P.LEQUAL,Rt.ReadWrite,u.depthRangeFor3D),et=v?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(be,H)):(ze=u.depthModeForSublayer(ye.overscaledZ-ae,s.paint.get("raster-opacity")===1?Rt.ReadWrite:Rt.ReadOnly,P.LESS),et=u.transform.calculateProjMatrix(be,H));const Ge=u.terrain&&N?u.terrain.stencilModeForRTTOverlap(ye):Q[ye.overscaledZ],ot=g?0:s.paint.get("raster-fade-duration");Fe.registerFadeDuration(ot);const Qe=t.findLoadedParent(ye,0),st=Wu(Fe,Qe,t,u.transform,ot);let at,Pt;u.terrain&&u.terrain.prepareDrawTile(),C.activeTexture.set(P.TEXTURE0),Ke.bind(U,P.CLAMP_TO_EDGE),C.activeTexture.set(P.TEXTURE1),Qe?(Qe.texture&&Qe.texture.bind(U,P.CLAMP_TO_EDGE),at=Math.pow(2,Qe.tileID.overscaledZ-Fe.tileID.overscaledZ),Pt=[Fe.tileID.canonical.x*at%1,Fe.tileID.canonical.y*at%1]):Ke.bind(U,P.CLAMP_TO_EDGE),"useMipmap"in Ke&&C.extTextureFilterAnisotropic&&u.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const Nt=u.transform;let Ct;const jt=b?V_(Nt):[0,0,0,0];let zt,Zt,si,Ai,tn,Yi=0;if(S&&D instanceof o.aP&&D.coordinates.length>3)zt=Float32Array.from(o.bh(o.dr(new o.cp(0,0,0)))),Zt=Float32Array.from(Nt.globeMatrix),si=Float32Array.from(o.dm(Nt)),Ai=[o.ay(Nt.center.lng),o.aH(Nt.center.lat)],Ct=D.elevatedGlobePerspectiveTransform,tn=D.elevatedGlobeGridMatrix||new Float32Array(9);else if(S){const hi=o.dn(ye.canonical);Yi=o.dp(hi.getCenter().lat),zt=Float32Array.from(o.bh(o.dr(ye.canonical))),Zt=Float32Array.from(Nt.globeMatrix),si=Float32Array.from(o.dm(Nt)),Ai=[o.ay(Nt.center.lng),o.aH(Nt.center.lat)],Ct=[0,0],tn=Float32Array.from(o.dq(ye.canonical,hi,Yi,Nt.worldSize/Nt._pixelsPerMercatorPixel))}else Ct=D instanceof o.aP?D.perspectiveTransform:[0,0],zt=new Float32Array(16),Zt=new Float32Array(9),si=new Float32Array(16),Ai=[0,0],tn=new Float32Array(9);const Mi=Va(et,zt,Zt,si,tn,Pt||[0,0],o.ah(u.transform.zoom),Ai,jt,at||1,st,s,Ct,b?s.paint.get("raster-elevation"):0,2,Xe,dt,z.range,ke,Be,O),Un=u.isTileAffectedByFog(ye),Dn=u.getOrCreateProgram("raster",{defines:z.defines,overrideFog:Un});if(u.uploadCommonUniforms(C,Dn,be),D instanceof o.aP){const hi=D.elevatedGlobeVertexBuffer,ki=D.elevatedGlobeIndexBuffer;if(N||!v)D.boundsBuffer&&D.boundsSegments&&Dn.draw(u,P.TRIANGLES,ze,Qt.disabled,V,Jt.disabled,Mi,s.id,D.boundsBuffer,u.quadTriangleIndexBuffer,D.boundsSegments);else if(hi&&ki){const ji=Nt.zoom<=o.cL?D.elevatedGlobeSegments:D.getSegmentsForLongitude(Nt.center.lng);ji&&Dn.draw(u,P.TRIANGLES,ze,Qt.disabled,V,fe,Mi,s.id,hi,ki,ji)}}else if(S){ze=new Rt(P.LEQUAL,Rt.ReadOnly,u.depthRangeFor3D);const hi=u.globeSharedBuffers;if(hi){const[ki,ji,nn]=hi.getGridBuffers(Yi,!1);Dn.draw(u,P.TRIANGLES,ze,le||Ge,u.colorModeForRenderPass(),fe,Mi,s.id,ki,ji,nn)}}else{const{tileBoundsBuffer:hi,tileBoundsIndexBuffer:ki,tileBoundsSegments:ji}=u.getTileBoundsBuffers(Fe);Dn.draw(u,P.TRIANGLES,ze,Ge,V,Jt.disabled,Mi,s.id,hi,ki,ji)}}if(!(D instanceof o.aP)&&S)for(const ye of de){const be=ye.canonical.y===(1<<ye.canonical.z)-1;ye.canonical.y===0&&th(!0,ye,u,t,s,O,z,fe,le||Qt.disabled),be&&th(!1,ye,u,t,s,O,z,fe===Jt.frontCW?Jt.backCW:Jt.frontCW,le||Qt.disabled)}};S?ge(ne,u.renderElevatedRasterBackface?Jt.backCW:Jt.frontCW,u.stencilModeFor3D()):ge(ne,Jt.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,t,s,h,m,g){u.renderPass==="offscreen"&&function(v,b,S,C){if(!C.length)return;const P=v.context,D=P.gl,z=b.getSource();if(!(z instanceof fl))return;const O=Math.ceil(Math.sqrt(S.paint.get("raster-particle-count")));let V=S.particlePositionRGBAImage;if(!V||V.width!==O){const ne=function(ae){const ge=ae*ae,de=new Uint8Array(4*ge),fe=function(ye){return ye|=0,ye=Math.imul(2747636419^ye,2654435769),ye=Math.imul(ye^ye>>>16,2654435769),((ye=Math.imul(ye^ye>>>16,2654435769))>>>0)/4294967296},le=1/1.1;for(let ye=0;ye<ge;ye++){const be=le*(fe(2*ye+0)+No),Fe=le*(fe(2*ye+1)+No),Le=255*be%1,Ke=255*Fe%1,Xe=Le,dt=Fe-Ke/255,ke=Ke;de[4*ye+0]=255*(be-Le/255),de[4*ye+1]=255*Xe,de[4*ye+2]=255*dt,de[4*ye+3]=255*ke}return de}(O);V=S.particlePositionRGBAImage=new o.r({width:O,height:O},ne)}let N=S.particleFramebuffer;N?N.width!==O&&(N.destroy(),N=S.particleFramebuffer=P.createFramebuffer(O,O,!0,null)):N=S.particleFramebuffer=P.createFramebuffer(O,O,!0,null);const H=[];for(const ne of C){const ae=b.getTile(ne);if(!(ae instanceof zu))continue;const ge=Sx(ae,z,S);if(!ge)continue;const de=[ae.tileSize,ae.tileSize];let fe=S.tileFramebuffer;fe||(fe=S.tileFramebuffer=P.createFramebuffer(de[0],de[1],!0,null));let le=ae.rasterParticleState;le||(le=ae.rasterParticleState=new Tx(P,ne,de,V));const ye=le.update(S.lastInvalidatedAt);le.particleTextureDimension!==O&&le.updateParticleTexture(ne,V);const be=le.targetColorTexture;le.targetColorTexture=le.backgroundColorTexture,le.backgroundColorTexture=be;const Fe=le.particleTexture0;le.particleTexture0=le.particleTexture1,le.particleTexture1=Fe,H.push([ne,ge,le,ye])}if(H.length===0)return;const U=o.q.now(),Q=S.previousDrawTimestamp?.001*(U-S.previousDrawTimestamp):.0167;if(S.previousDrawTimestamp=U,S.hasColorMap()){P.activeTexture.set(D.TEXTURE0+2);let ne=S.colorRampTexture;ne||(ne=S.colorRampTexture=new o.T(P,S.colorRamp,D.RGBA8)),ne.bind(D.LINEAR,D.CLAMP_TO_EDGE)}P.bindFramebuffer.set(S.tileFramebuffer.framebuffer),function(ne,ae,ge){const de=ne.context,fe=de.gl,le=ae.tileFramebuffer;de.activeTexture.set(fe.TEXTURE0);const ye={u_texture:0,u_opacity:1.05*(Fe=ae.paint.get("raster-particle-fade-opacity-factor"))/(Fe+.05)},be=ne.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Fe;for(const Le of ge){const[,,Ke,Xe]=Le;le.colorAttachment.set(Ke.targetColorTexture.texture),de.viewport.set([0,0,le.width,le.height]),de.clear({color:o.am.transparent}),Xe&&(Ke.backgroundColorTexture.bind(fe.NEAREST,fe.CLAMP_TO_EDGE),be.draw(ne,fe.TRIANGLES,Rt.disabled,Qt.disabled,bi.alphaBlended,Jt.disabled,ye,ae.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments))}}(v,S,H),function(ne,ae,ge,de){const fe=ne.context,le=fe.gl,ye=ge.tileFramebuffer,be=ne.transform.projection.name==="globe",Fe=ge.paint.get("raster-particle-max-speed");for(const Le of de){const[Ke,Xe,dt]=Le;fe.activeTexture.set(le.TEXTURE0+0),Xe.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE),ye.colorAttachment.set(dt.targetColorTexture.texture);const ke=ne.getOrCreateProgram("rasterParticleDraw",{defines:Xe.defines,overrideFog:!1});fe.activeTexture.set(le.TEXTURE0+1);const Be=Xe.scalarData?[]:[0,1,2,3].map(Ge=>o.dU[Ge](Ke));Be.push(Ke);const ze=Ke.canonical.x,et=Ke.canonical.y;for(const Ge of Be){const ot=ae.getTile(be?Ge.wrapped():Ge);if(!ot)continue;const Qe=ot.rasterParticleState;if(!Qe)continue;const st=Ge.canonical.x+(1<<Ge.canonical.z)*(Ge.wrap-Ke.wrap),at=Ge.canonical.y;Qe.particleTexture0.bind(le.NEAREST,le.CLAMP_TO_EDGE);const Pt=Md(1,Qe.particleTexture0.size[0],[st-ze,at-et],0,Xe.texture.size,2,Fe,Xe.textureOffset,Xe.scale,Xe.offset);ke.draw(ne,le.POINTS,Rt.disabled,Qt.disabled,bi.alphaBlended,Jt.disabled,Pt,ge.id,Qe.particleIndexBuffer,void 0,Qe.particleSegment)}}}(v,b,S,H),P.bindFramebuffer.set(S.particleFramebuffer.framebuffer),function(ne,ae,ge,de){const fe=ne.context,le=fe.gl,ye=ae.paint.get("raster-particle-max-speed"),be=de*ae.paint.get("raster-particle-speed-factor")*.15,Fe=function(Ke){return Math.pow(Ke,6)}(.01+1*ae.paint.get("raster-particle-reset-rate-factor")),Le=ae.particleFramebuffer;fe.viewport.set([0,0,Le.width,Le.height]);for(const Ke of ge){const[,Xe,dt]=Ke;fe.activeTexture.set(le.TEXTURE0+0),Xe.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE),fe.activeTexture.set(le.TEXTURE0+1);const ke=dt.particleTexture0;ke.bind(le.NEAREST,le.CLAMP_TO_EDGE);const Be=F_(1,ke.size[0],0,Xe.texture.size,ye,be,Fe,Xe.textureOffset,Xe.scale,Xe.offset);Le.colorAttachment.set(dt.particleTexture1.texture),fe.clear({color:o.am.transparent}),ne.getOrCreateProgram("rasterParticleUpdate",{defines:Xe.defines}).draw(ne,le.TRIANGLES,Rt.disabled,Qt.disabled,bi.unblended,Jt.disabled,Be,ae.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments)}}(v,S,H,Q)}(u,t,s,h),u.renderPass==="translucent"&&(function(v,b,S,C,P){const D=v.context,z=D.gl,O=b.getSource().tileSize,V=5*(1-o.af(o.cx,o.cx+1,v.transform.zoom))*O+S.paint.get("raster-particle-elevation"),N=!v.options.moving,H=v.transform.projection.name==="globe";if(!C.length)return;const[U,Q]=v.stencilConfigForOverlap(C),ne=[];H&&ne.push("PROJECTION_GLOBE_VIEW");const ae=v.stencilModeFor3D();for(const ge of Q){const de=ge.toUnwrapped(),fe=b.getTile(ge);if(!fe.rasterParticleState)continue;const le=fe.rasterParticleState,ye=100;fe.registerFadeDuration(ye);const be=b.findLoadedParent(ge,0),Fe=Wu(fe,be,b,v.transform,ye);let Le,Ke;v.terrain&&v.terrain.prepareDrawTile(),D.activeTexture.set(z.TEXTURE0),le.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),D.activeTexture.set(z.TEXTURE1),be&&be.rasterParticleState?(be.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Le=Math.pow(2,be.tileID.overscaledZ-fe.tileID.overscaledZ),Ke=[fe.tileID.canonical.x*Le%1,fe.tileID.canonical.y*Le%1]):le.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Xe=H?Float32Array.from(v.transform.expandedFarZProjMatrix):v.transform.calculateProjMatrix(de,N),dt=v.transform,ke=Xp(dt),Be=o.dn(ge.canonical),ze=o.dp(Be.getCenter().lat);let et,Ge,ot,Qe,st;H?(et=Float32Array.from(o.bh(o.dr(ge.canonical))),Ge=Float32Array.from(dt.globeMatrix),ot=Float32Array.from(o.dm(dt)),Qe=[o.ay(dt.center.lng),o.aH(dt.center.lat)],st=Float32Array.from(o.dq(ge.canonical,Be,ze,dt.worldSize/dt._pixelsPerMercatorPixel))):(et=new Float32Array(16),Ge=new Float32Array(9),ot=new Float32Array(16),Qe=[0,0],st=new Float32Array(9));const at=Gp(Xe,et,Ge,ot,st,Ke||[0,0],o.ah(v.transform.zoom),Qe,ke,Le||1,Fe,V),Pt=v.isTileAffectedByFog(ge),Nt=v.getOrCreateProgram("rasterParticle",{defines:ne,overrideFog:Pt});if(v.uploadCommonUniforms(D,Nt,de),H){const Ct=new Rt(z.LEQUAL,Rt.ReadOnly,v.depthRangeFor3D),jt=0,zt=v.globeSharedBuffers;if(zt){const[Zt,si,Ai]=zt.getGridBuffers(ze,jt!==0);Nt.draw(v,z.TRIANGLES,Ct,ae,bi.alphaBlended,v.renderElevatedRasterBackface?Jt.frontCCW:Jt.backCCW,at,S.id,Zt,si,Ai)}}else{const Ct=v.depthModeForSublayer(0,Rt.ReadOnly),jt=U[ge.overscaledZ],{tileBoundsBuffer:zt,tileBoundsIndexBuffer:Zt,tileBoundsSegments:si}=v.getTileBoundsBuffers(fe);Nt.draw(v,z.TRIANGLES,Ct,jt,bi.alphaBlended,Jt.disabled,at,S.id,zt,Zt,si)}}v.resetStencilClippingMasks()}(u,t,s,h),u.style.map.triggerRepaint())},background:function(u,t,s,h){const m=s.paint.get("background-color"),g=s.paint.get("background-color-use-theme").constantOr("default")==="none",v=s.paint.get("background-opacity"),b=s.paint.get("background-emissive-strength"),S=s.paint.get("background-pitch-alignment")==="viewport";if(v===0)return;const C=u.context,P=C.gl,D=u.transform,z=D.tileSize,O=s.paint.get("background-pattern");let V;if(O!==void 0&&(O===null||(V=u.imageManager.getPattern(o.I.from(O.toString()),s.scope,u.style.getLut(s.scope)),!V)))return;const N=!O&&m.a===1&&v===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==N)return;const H=Qt.disabled,U=u.depthModeForSublayer(0,N==="opaque"?Rt.ReadWrite:Rt.ReadOnly),Q=u.colorModeForDrapableLayerRenderPass(b),ne=O?"backgroundPattern":"background";let ae,ge=h;if(ge||(ae=u.getBackgroundTiles(),ge=Object.values(ae).map(de=>de.tileID)),O&&(C.activeTexture.set(P.TEXTURE0),u.imageManager.bind(u.context,s.scope)),S){const de=u.getOrCreateProgram(ne,{overrideFog:!1,overrideRtt:!0}),fe=new Float32Array(o.bx([])),le=new o.aM(0,0,0,0,0),ye=O?B_(fe,b,v,u,0,s.scope,V,S,{tileID:le,tileSize:z}):Rd(fe,b,v,m.toRenderColor(g?null:s.lut));de.draw(u,P.TRIANGLES,U,H,Q,Jt.disabled,ye,s.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments)}else for(const de of ge){const fe=u.isTileAffectedByFog(de),le=u.getOrCreateProgram(ne,{overrideFog:fe}),ye=de.toUnwrapped(),be=h?de.projMatrix:u.transform.calculateProjMatrix(ye);u.prepareDrawTile();const Fe=t?t.getTile(de):ae?ae[de.key]:new la(de,z,D.zoom,u),Le=O?B_(be,b,v,u,0,s.scope,V,S,{tileID:de,tileSize:z}):Rd(be,b,v,m.toRenderColor(g?null:s.lut));u.uploadCommonUniforms(C,le,ye);const{tileBoundsBuffer:Ke,tileBoundsIndexBuffer:Xe,tileBoundsSegments:dt}=u.getTileBoundsBuffers(Fe);le.draw(u,P.TRIANGLES,U,H,Q,Jt.disabled,Le,s.id,Ke,Xe,dt)}},sky:function(u,t,s){const h=u._atmosphere?o.ah(u.transform.zoom):1,m=s.paint.get("sky-opacity")*h;if(m===0)return;const g=u.context,v=s.paint.get("sky-type"),b=new Rt(g.gl.LEQUAL,Rt.ReadOnly,[0,1]),S=u.frameCounter/1e3%1;v==="atmosphere"?u.renderPass==="offscreen"?s.needsSkyboxCapture(u)&&(function(C,P,D,z){const O=C.context,V=O.gl;let N=P.skyboxFbo;if(!N){N=P.skyboxFbo=O.createFramebuffer(32,32,!0,null),P.skyboxGeometry=new ih(O),P.skyboxTexture=O.gl.createTexture(),V.bindTexture(V.TEXTURE_CUBE_MAP,P.skyboxTexture),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MAG_FILTER,V.LINEAR);for(let ne=0;ne<6;++ne)V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,V.RGBA,32,32,0,V.RGBA,V.UNSIGNED_BYTE,null)}O.bindFramebuffer.set(N.framebuffer),O.viewport.set([0,0,32,32]);const H=P.getCenter(C,!0),U=C.getOrCreateProgram("skyboxCapture"),Q=new Float64Array(16);o.bx(Q),o.e3(Q,Q,.5*-Math.PI),Ha(C,P,U,Q,H,0),o.bx(Q),o.e3(Q,Q,.5*Math.PI),Ha(C,P,U,Q,H,1),o.bx(Q),o.cG(Q,Q,.5*-Math.PI),Ha(C,P,U,Q,H,2),o.bx(Q),o.cG(Q,Q,.5*Math.PI),Ha(C,P,U,Q,H,3),o.bx(Q),Ha(C,P,U,Q,H,4),o.bx(Q),o.e3(Q,Q,Math.PI),Ha(C,P,U,Q,H,5),O.viewport.set([0,0,C.width,C.height])}(u,s),s.markSkyboxValid(u)):u.renderPass==="sky"&&function(C,P,D,z,O){const V=C.context,N=V.gl,H=C.transform,U=C.getOrCreateProgram("skybox");V.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_CUBE_MAP,P.skyboxTexture);const Q=((ne,ae,ge,de,fe)=>({u_matrix:ne,u_sun_direction:ae,u_cubemap:0,u_opacity:de,u_temporal_offset:fe}))(H.skyboxMatrix,P.getCenter(C,!1),0,z,O);C.uploadCommonUniforms(V,U),U.draw(C,N.TRIANGLES,D,Qt.disabled,C.colorModeForRenderPass(),Jt.backCW,Q,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(u,s,b,m,S):v==="gradient"&&u.renderPass==="sky"&&function(C,P,D,z,O){const V=C.context,N=V.gl,H=C.transform,U=C.getOrCreateProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new ih(V)),V.activeTexture.set(N.TEXTURE0);let Q=P.colorRampTexture;Q||(Q=P.colorRampTexture=new o.T(V,P.colorRamp,N.RGBA8)),Q.bind(N.LINEAR,N.CLAMP_TO_EDGE);const ne=((ae,ge,de,fe,le)=>({u_matrix:ae,u_color_ramp:0,u_center_direction:ge,u_radius:o.al(de),u_opacity:fe,u_temporal_offset:le}))(H.skyboxMatrix,P.getCenter(C,!1),P.paint.get("sky-gradient-radius"),z,O);C.uploadCommonUniforms(V,U),U.draw(C,N.TRIANGLES,D,Qt.disabled,C.colorModeForRenderPass(),Jt.backCW,ne,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(u,s,b,m,S)},debug:function(u,t,s,h,m,g){for(let v=0;v<s.length;v++)if(m){const C=new o.am(h.r*.8,h.g*.8,h.b*.8,1);Rl(u,t,s[v],h,-1,-1,g),Rl(u,t,s[v],h,-1,1,g),Rl(u,t,s[v],h,1,1,g),Rl(u,t,s[v],h,1,-1,g),Rl(u,t,s[v],C,0,0,g)}else Rl(u,t,s[v],h,0,0,g)},custom:function(u,t,s,h){const m=u.context,g=s.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&s.isDraped(t)){if(u.renderPass==="offscreen"){const v=g.prerender;if(v){if(u.setCustomLayerDefaults(),m.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const b=u.transform.pointMerc;v.call(g,m.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),o.ah(u.transform.zoom),[b.x,b.y],u.transform.pixelsPerMeterRatio)}else v.call(g,m.gl,u.transform.customLayerMatrix());m.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const b=g.renderToTile;if(b){const S=h[0].canonical,C={x:S.x+h[0].wrap*(g.wrapTileId?0:1<<S.z),y:S.y,z:S.z};m.setDepthMode(Rt.disabled),m.setStencilMode(Qt.disabled),m.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),b.call(g,m.gl,C),m.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),m.setColorMode(u.colorModeForRenderPass()),m.setStencilMode(Qt.disabled);const v=g.renderingMode==="3d"?new Rt(u.context.gl.LEQUAL,Rt.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,Rt.ReadOnly);if(m.setDepthMode(v),u.transform.projection.name==="globe"){const b=u.transform.pointMerc;g.render(m.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),o.ah(u.transform.zoom),[b.x,b.y],u.transform.pixelsPerMeterRatio)}else g.render(m.gl,u.transform.customLayerMatrix());m.setDirty(),u.setBaseState(),m.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,t,s,h){if(u.renderPass==="opaque")return;const m=s.paint.get("model-opacity").constantOr(1);if(m===0)return;const g=s.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!g||u.terrain&&m<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof o.ab))return;const v=u.shadowRenderer,b=s.paint.get("model-receive-shadows");v&&(v.useNormalOffset=!0,b||(v.enabled=!1));const S=()=>{v&&(v.useNormalOffset=!0,b||(v.enabled=!0))},C=t.getSource();if(u.renderPass==="light-beam"&&C.type!=="batched-model")return;if(C.type==="vector"||C.type==="geojson")return function(U,Q,ne,ae,ge){const de=U.transform;if(de.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${de.projection.name} projection is not yet implemented`);const fe=de.getFreeCameraOptions().position;if(!U.modelManager)return;const le=U.modelManager;ne.modelManager=le;const ye=U.shadowRenderer;if(!ne._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const be=ne._unevaluatedLayout._values["model-id"],Fe=Object.assign({},ne.layout.get("model-id").parameters),Le=U.style.order.indexOf(ne.fqid);for(const Ke of ae){const Xe=Q.getTile(Ke).getBucket(ne);if(!Xe||Xe.projection.name!==de.projection.name)continue;const dt=Xe.getModelUris();dt&&!Xe.modelsRequested&&(le.addModelsFromBucket(dt,ge),Xe.modelsRequested=!0);const ke=Bd(Ke,de);Fe.zoom=ke;const Be=be.possiblyEvaluate(Fe);if(Oe(U,Xe,Ke),vs.shadowUniformsInitialized=!1,vs.useSingleShadowCascade=!!ye&&ye.getMaxCascadeForTile(Ke.toUnwrapped())===0,U.renderPass==="shadow"&&ye){if(U.currentShadowCascade===1&&Xe.isInsideFirstShadowMapFrustum)continue;const Ge=de.calculatePosMatrix(Ke.toUnwrapped(),de.worldSize);if(vs.tileMatrix.set(Ge),vs.shadowTileMatrix=Float32Array.from(ye.calculateShadowPassMatrixFromMatrix(Ge)),vs.aabb.min.fill(0),vs.aabb.max[0]=vs.aabb.max[1]=o.aj,vs.aabb.max[2]=0,W_(Xe,vs,U,ne.scope))continue}const ze=1<<Ke.canonical.z,et=[((fe.x-Ke.wrap)*ze-Ke.canonical.x)*o.aj,(fe.y*ze-Ke.canonical.y)*o.aj,fe.z*ze*o.aj];U.conflationActive&&Object.keys(Xe.instancesPerModel).length>0&&U.style.isLayerClipped(ne,Q.getSource())&&Xe.updateReplacement(Ke,U.replacementSource,Le,ge)&&(Xe.uploaded=!1,Xe.upload(U.context));for(let Ge in Xe.instancesPerModel){const ot=Xe.instancesPerModel[Ge];ot.features.length>0&&(Ge=Be.evaluate(ot.features[0].feature,{}));const Qe=le.getModel(Ge,ge);if(Qe||le.hasURLBeenRequested(Ge)||Xe.modelUris.includes(Ge)||(Xe.modelUris.push(Ge),Xe.modelsRequested=!1),Qe&&Qe.uploaded)for(const st of Qe.nodes)Nd(U,ne,st,ot,et,Ke,vs)}}}(u,t,s,h,C.type==="vector"?s.scope:""),void S();if(!C.loaded())return;if(C.type==="batched-model")return function(U,Q,ne,ae){ne.resetLayerRenderingStats(U);const ge=U.context,de=U.transform,fe=U.style.fog,le=U.shadowRenderer;if(de.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${de.projection.name} projection is not yet implemented`);const ye=U.transform.getFreeCameraOptions().position,be=o.b$([],[ye.x,ye.y,ye.z],U.transform.worldSize),Fe=o.eb([],be),Le=o.bx([]),Ke=o.ec(de.center.lat,de.zoom),Xe=o.bn([],[1,1,1/Ke]);o.bo(Le,Le,Fe);const dt=ne.paint.get("model-opacity").constantOr(1),ke=new Rt(ge.gl.LEQUAL,Rt.ReadWrite,U.depthRangeFor3D),Be=new Rt(ge.gl.LEQUAL,Rt.ReadOnly,U.depthRangeFor3D),ze=new o.cV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),et=U.renderPass==="shadow",Ge=et&&le?le.getCurrentCascadeFrustum():de.getFrustum(de.scaleZoom(de.worldSize)),ot=ne.paint.get("model-front-cutoff"),Qe=ot[2]<1,st=wl(U,ne.paint.get("model-cutoff-fade-range")),at=ne.getLayerRenderingStats();(function(Pt,Nt,Ct,jt){const zt=Pt.terrain?Pt.terrain.exaggeration():0,Zt=Pt.transform.zoom;for(const si of jt){const Ai=Nt.getTile(si).getBucket(Ct);Ai&&(Ai.setFilter(Ct.filter),Pt.conflationActive&&Ai.updateReplacement(si,Pt.replacementSource),Ai.evaluateScale(Pt,Ct),Pt.terrain&&zt>0&&Ai.elevationUpdate(Pt.terrain,zt,si,Ct.source),Ai.needsReEvaluation(Pt,Zt,Ct)&&Ai.evaluate(Ct))}})(U,Q,ne,ae),function(){let Pt,Nt,Ct;Qe?(Pt=ae.length-1,Nt=-1,Ct=-1):(Pt=0,Nt=ae.length,Ct=1);const jt=new Float64Array(16),zt=o.eg(),Zt=new o.P(0,0);for(let si=Pt;si!==Nt;si+=Ct){const Ai=ae[si],tn=Q.getTile(Ai).getBucket(ne);if(!tn||!tn.uploaded)continue;let Yi=!1;le&&(Yi=le.getMaxCascadeForTile(Ai.toUnwrapped())===0);const Mi=de.calculatePosMatrix(Ai.toUnwrapped(),de.worldSize),Un=tn.modelTraits;!et&&Qe&&(o.bi(jt,Mi),o.ad(zt,be,jt),Zt.x=zt[0],Zt.y=zt[1]);const Dn=[];tn.setFilter(ne.filter);for(const hi of tn.getNodesInfo()){if(hi.hiddenByReplacement||!hi.node.meshes)continue;const ki=hi.node;let ji=0;U.terrain&&ki.elevation&&(ji=ki.elevation*U.terrain.exaggeration());const nn=(()=>{const Rn=hi.aabb;return ze.min=[...Rn.min],ze.max=[...Rn.max],ze.min[2]+=ji,ze.max[2]+=ji,o.ad(ze.min,ze.min,Mi),o.ad(ze.max,ze.max,Mi),ze})(),nr=hi.evaluatedScale;if(nr[0]<=1&&nr[1]<=1&&nr[2]<=1&&nn.intersects(Ge)===0)continue;if(!et&&Qe){const Rn=.16666666666666666;hi.cameraCollisionOpacity=be[0]>nn.min[0]&&be[0]<nn.max[0]&&be[1]>nn.min[1]&&be[1]<nn.max[1]&&be[2]*Ke<nn.max[2]&&ki.footprint&&o.bS(Zt,ki.footprint)?Math.max(hi.cameraCollisionOpacity-Rn,0):Math.min(1,hi.cameraCollisionOpacity+Rn)}const qn=[...Mi],tr=ki.anchor?ki.anchor[0]:0,Pn=ki.anchor?ki.anchor[1]:0;o.bo(qn,qn,[tr*(nr[0]-1),Pn*(nr[1]-1),ji]),o.ci(nr,o.eh)||o.cE(qn,qn,nr);const mi=o.az([],qn,ki.matrix),En=o.az([],de.expandedFarZProjMatrix,mi),Bi=o.az([],de.expandedFarZProjMatrix,qn),In=o.aA([],[tr,Pn,ji,1],En)[2];ki.hidden=!1;let qi=dt;et||(Qe&&(qi*=hi.cameraCollisionOpacity,qi*=Ac(qn,de,hi.aabb,ot)),qi*=Z_(st,In)),qi!==0?Dn.push({nodeInfo:hi,depth:In,opacity:qi,wvpForNode:En,wvpForTile:Bi,nodeModelMatrix:mi,tileModelMatrix:qn}):ki.hidden=!0}et||Dn.sort((hi,ki)=>!Qe||hi.opacity===1&&ki.opacity===1?hi.depth<ki.depth?-1:1:hi.opacity===1?-1:ki.opacity===1?1:hi.depth>ki.depth?-1:1);for(const hi of Dn){const ki=hi.nodeInfo,ji=ki.node;let nn=o.az([],Xe,hi.tileModelMatrix);o.az(nn,Le,nn);const nr=o.bi([],nn);o.ee(nr,nr),o.cE(nr,nr,Jp),nn=o.az(nn,nn,ji.matrix);const qn=U.renderPass==="light-beam",tr=ne.paint.get("model-color-use-theme").constantOr("default")==="none",Pn=Un&o.em.HasMapboxMeshFeatures,mi=Pn?0:ki.evaluatedRMEA[0][2];for(let En=0;En<ji.meshes.length;++En){const Bi=ji.meshes[En],In=En===ji.lightMeshIndex;let qi=hi.wvpForNode;if(In){if(!qn&&!U.terrain&&U.shadowRenderer){U.currentLayer<U.firstLightBeamLayer&&(U.firstLightBeamLayer=U.currentLayer);continue}qi=hi.wvpForTile}else if(qn)continue;const Rn={defines:[]},xr=[];if(!et&&le&&(le.useNormalOffset=!!Bi.normalBuffer),pt(Rn.defines,xr,Bi,U,tr?null:ne.lut),Pn||Rn.defines.push("DIFFUSE_SHADED"),Yi&&Rn.defines.push("SHADOWS_SINGLE_CASCADE"),at&&(et?at.numRenderedVerticesInShadowPass+=Bi.vertexArray.length:at.numRenderedVerticesInTransparentPass+=Bi.vertexArray.length),et){Hn(Bi,hi.nodeModelMatrix,U,ne);continue}let mn=null;if(fe){const Ao=zl(hi.nodeModelMatrix,U.transform);if(mn=new Float32Array(Ao),de.projection.name!=="globe"){const rs=Bi.aabb.min,$s=Bi.aabb.max,[Hs,Ss]=fe.getOpacityForBounds(Ao,rs[0],rs[1],$s[0],$s[1]);Rn.overrideFog=Hs>=Et||Ss>=Et}}const Cr=Bi.material;let Yn;Cr.occlusionTexture&&Cr.occlusionTexture.offsetScale&&(Yn=Cr.occlusionTexture.offsetScale,Rn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Dr=U.getOrCreateProgram("model",Rn);!et&&le&&le.setupShadowsFromMatrix(hi.tileModelMatrix,Dr,le.useNormalOffset),U.uploadCommonUniforms(ge,Dr,null,mn);const Ts=Cr.pbrMetallicRoughness;Ts.metallicFactor=.9,Ts.roughnessFactor=.5;const ma=Cl(new Float32Array(qi),new Float32Array(nn),new Float32Array(nr),new Float32Array(ji.matrix),U,hi.opacity,Ts.baseColorFactor.toRenderColor(null),Cr.emissiveFactor,Ts.metallicFactor,Ts.roughnessFactor,Cr,mi,ne,[0,0,0],Yn);!In&&(ki.hasTranslucentParts||hi.opacity<1)&&Dr.draw(U,ge.gl.TRIANGLES,ke,Qt.disabled,bi.disabled,Jt.backCCW,ma,ne.id,Bi.vertexBuffer,Bi.indexBuffer,Bi.segments,ne.paint,U.transform.zoom,void 0,xr),Dr.draw(U,ge.gl.TRIANGLES,In?Be:ke,Qt.disabled,In||hi.opacity<1||ki.hasTranslucentParts?bi.alphaBlended:bi.unblended,Jt.backCCW,ma,ne.id,Bi.vertexBuffer,Bi.indexBuffer,Bi.segments,ne.paint,U.transform.zoom,void 0,xr)}}}}()}(u,t,s,h),void S();if(C.type!=="model")return;const P=C.getModels(),D=[],z=u.transform.getFreeCameraOptions().position,O=o.b$([],[z.x,z.y,z.z],u.transform.worldSize);o.eb(O,O);const V=[],N=[];let H=0;for(const U of P){const Q=s.paint.get("model-rotation").constantOr(null),ne=s.paint.get("model-scale").constantOr(null),ae=s.paint.get("model-translation").constantOr(null);U.computeModelMatrix(u,Q,ne,ae,!0,!0,!1);const ge=o.bx([]),de=o.ec(U.position.lat,u.transform.zoom),fe=o.bn([],[1,1,1/de]);o.bo(ge,ge,O),D.push({zScaleMatrix:fe,negCameraPosMatrix:ge});for(const le of U.nodes)Dl(u.transform,le,U.matrix,u.transform.expandedFarZProjMatrix,H,V,N);H++}if(V.sort((U,Q)=>Q.depth-U.depth),u.renderPass!=="shadow"){if(m===1)for(const U of N)It(U,u,s,D[U.modelIndex],Qt.disabled,u.colorModeForRenderPass());else{for(const U of N)It(U,u,s,D[U.modelIndex],Qt.disabled,bi.disabled);for(const U of N)It(U,u,s,D[U.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(const U of V)It(U,u,s,D[U.modelIndex],Qt.disabled,u.colorModeForRenderPass());S()}else{for(const U of N)Hn(U.mesh,U.nodeModelMatrix,u,s);for(const U of V)Hn(U.mesh,U.nodeModelMatrix,u,s);S()}}},nm={line:function(u,t,s){if(u.hasElevatedBuckets=!1,u.hasNonElevatedBuckets=!1,u._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||u._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const h=t.getVisibleCoordinates();for(const m of h){const g=t.getTile(m).getBucket(u);if(g&&(g.elevationType!=="none"?u.hasElevatedBuckets=!0:u.hasNonElevatedBuckets=!0,u.hasElevatedBuckets&&u.hasNonElevatedBuckets))break}}}else u.hasNonElevatedBuckets=!0},model:function(u,t,s){const h=t.getSource();if(!h.loaded())return;if(h.type==="vector"||h.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,h.type==="vector"?u.scope:""));if(h.type==="batched-model"||h.type!=="model")return;const m=h.getModels();for(const g of m)g.upload(s.context)},raster:function(u,t,s){const h=t.getSource();if(!(h instanceof fl&&h.loaded()))return;const m=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!m)return;const g=u.paint.get("raster-array-band")||h.getInitialBand(m);if(g==null)return;const v=t.getIds().map(b=>t.getTileByID(b));for(const b of v)b.updateNeeded(m,g)&&h.prepareTile(b,m,g)},"raster-particle":function(u,t,s){const h=t.getSource();if(!(h instanceof fl&&h.loaded()))return;const m=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!m)return;const g=u.paint.get("raster-particle-array-band")||h.getInitialBand(m);if(g==null)return;const v=t.getIds().map(b=>t.getTileByID(b));for(const b of v)b.updateNeeded(m,g)&&h.prepareTile(b,m,g)}},da={fill:Ju};class Ud{constructor(t,s,h,m,g){this.context=new wc(t,s),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const v=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const S of v)this._debugParams.enabledLayers[S]=!0;g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),g.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),g.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),g.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const S of v)g.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],S);this.occlusionParams=new X_(g),this.setup(),this.numSublayers=io.maxUnderzooming+io.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new nx(this),this._wireframeDebugCache=new Ax,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const b=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,b,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=m}updateTerrain(t,s){const h=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ed(this,t));const m=this._terrain;this.transform.elevation=h?m:null,m.update(t,this.transform,s),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(t){const s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,m]=s.getFovAdjustedRange(this.transform._fov);if(h>m)return void(this.transform.fogCullDistSq=null);const g=h+.78*(m-h);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Ed(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,s){if(this.width=t*o.q.devicePixelRatio,this.height=s*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._mergedLayers[h].resize()}setup(){const t=this.context,s=new o.ba;s.emplaceBack(0,0),s.emplaceBack(o.aj,0),s.emplaceBack(0,o.aj),s.emplaceBack(o.aj,o.aj),this.tileExtentBuffer=t.createVertexBuffer(s,o.bc.members),this.tileExtentSegments=o.bd.simpleSegment(0,0,4,2);const h=new o.ba;h.emplaceBack(0,0),h.emplaceBack(o.aj,0),h.emplaceBack(0,o.aj),h.emplaceBack(o.aj,o.aj),this.debugBuffer=t.createVertexBuffer(h,o.bc.members),this.debugSegments=o.bd.simpleSegment(0,0,4,5);const m=new o.ba;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,o.bc.members),this.viewportSegments=o.bd.simpleSegment(0,0,4,2);const g=new o.aZ;g.emplaceBack(0,0,0,0),g.emplaceBack(o.aj,0,o.aj,0),g.emplaceBack(0,o.aj,0,o.aj),g.emplaceBack(o.aj,o.aj,o.aj,o.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(g,o.bf.members),this.mercatorBoundsSegments=o.bd.simpleSegment(0,0,4,2);const v=new o.a_;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(v);const b=new o.bb;for(const C of[0,1,3,2,0])b.emplaceBack(C);this.debugIndexBuffer=t.createIndexBuffer(b),this.emptyTexture=new o.T(t,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=o.bz();const S=this.context.gl;this.stencilClearMode=new Qt({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Rt.disabled,this.stencilClearMode,bi.disabled,Jt.disabled,_o(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,h){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let b=!1;for(const S of h)if(this._tileClippingMaskIDs[S.key]===void 0){b=!0;break}if(!b)return}this.currentStencilSource=s.id;const m=this.context,g=m.gl;this.nextStencilID+h.length>256&&this.clearStencil(),m.setColorMode(bi.disabled),m.setDepthMode(Rt.disabled);const v=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of h){const S=s.getTile(b),C=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:D,tileBoundsSegments:z}=this.getTileBoundsBuffers(S);v.draw(this,g.TRIANGLES,Rt.disabled,new Qt({func:g.ALWAYS,mask:0},C,255,g.KEEP,g.KEEP,g.REPLACE),bi.disabled,Jt.disabled,_o(b.projMatrix),"$clipping",P,D,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Qt({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new Qt({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,h=t.sort((v,b)=>b.overscaledZ-v.overscaledZ),m=h[h.length-1].overscaledZ,g=h[0].overscaledZ-m+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const v={};for(let b=0;b<g;b++)v[b+m]=new Qt({func:s.GEQUAL,mask:255},b+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[v,h]}return[{[m]:Qt.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new bi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new o.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?bi.unblended:bi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new bi([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new o.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,s,h,m=!1){if(this.depthOcclusion)return new Rt(this.context.gl.GREATER,Rt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!m)return Rt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Rt(h||this.context.gl.LEQUAL,s,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,s=Math.ceil(this.width),h=Math.ceil(this.height),m=this.context.bindFramebuffer.get(),g=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===h||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&h!==0&&(this.depthFBO=new Dd(this.context,s,h,!1,"texture"),this.depthTexture=new o.T(this.context,{width:s,height:h,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(m),t.bindTexture(t.TEXTURE_2D,g),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,s,h,0,0,s,h,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,s)=>t+s/this._fpsHistory.length,0))}render(t,s){const h=o.q.now();this._dt=h-this._timeStamp,this._timeStamp=h,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=s;const m=this.style._mergedLayers,g=!(!this.terrain||!this.terrain.enabled),v=()=>this.style._getOrder(g).filter(ke=>{const Be=m[ke];return!(Be.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Be.type]});let b=v(),S=!1,C=!1;for(const ke of b){const Be=m[ke];Be.type==="circle"&&(S=!0),Be.type==="symbol"&&(Be.hasInitialOcclusionOpacityProperties?C=!0:S=!0)}let P=b.map(ke=>m[ke]);const D=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let z=0,O=!1;for(const ke in D){const Be=D[ke];Be.used&&(Be.prepare(this.context),Be.getSource().usedInConflation&&++z)}let V=!1;for(const ke of P)ke.isHidden(this.transform.zoom)||(ke.type==="clip"&&(V=!0),this.prepareLayer(ke));const N={},H={},U={},Q={},ne={};for(const ke in D){const Be=D[ke];N[ke]=Be.getVisibleCoordinates(),H[ke]=N[ke].slice().reverse(),U[ke]=Be.getVisibleCoordinates(!0).reverse(),Q[ke]=Be.getShadowCasterCoordinates(),ne[ke]=Be.sortCoordinatesByDistance(N[ke])}const ae=ke=>{const Be=this.style.getLayerSourceCache(ke);return Be&&Be.used?Be.getSource():null};if(z||V||this._clippingActiveLastFrame){const ke=[],Be=[];let ze=0;for(const et of P)this.isSourceForClippingOrConflation(et,ae(et))&&(ke.push(et),Be.push(ze)),ze++;if(ke&&(V||ke.length>1)||this._clippingActiveLastFrame){V=!1;const et=[];for(let Ge=0;Ge<ke.length;Ge++){const ot=ke[Ge],Qe=Be[Ge],st=this.style.getLayerSourceCache(ot);if(!st||!st.used||!st.getSource().usedInConflation&&ot.type!=="clip")continue;let at=o.ev,Pt=o.bQ.None;const Nt=[];let Ct=!0;if(ot.type==="clip"){at=Qe;for(const jt of ot.layout.get("clip-layer-types"))Pt|=jt==="model"?o.bQ.Model:jt==="symbol"?o.bQ.Symbol:o.bQ.FillExtrusion;for(const jt of ot.layout.get("clip-layer-scope"))Nt.push(jt);ot.isHidden(this.transform.zoom)?Ct=!1:V=!0}Ct&&et.push({layer:ot.fqid,cache:st,order:at,clipMask:Pt,clipScope:Nt})}this.replacementSource.setSources(et),O=!0}}this._clippingActiveLastFrame=V,O||this.replacementSource.clear(),this.conflationActive=O,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ke=0;ke<P.length;ke++){const Be=P[ke],ze=Be.cutoffRange();if(this.longestCutoffRange=Math.max(ze,this.longestCutoffRange),ze>0){const et=ae(Be);et&&(this.minCutoffZoom=Math.max(et.minzoom,this.minCutoffZoom)),Be.minzoom&&(this.minCutoffZoom=Math.max(Be.minzoom,this.minCutoffZoom))}Be.is3D(g)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ke),this._lastOcclusionLayer=ke)}const ge=this.style&&this.style.fog;ge?(this._fogVisible=ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(U),this.opaquePassCutoff=0,b=v(),P=b.map(ke=>m[ke]));const de=this._shadowRenderer;if(de){de.updateShadowParameters(this.transform,this.style.directionalLight);for(const ke in D)for(const Be of N[ke]){let ze={min:0,max:0};this.terrain&&(ze=this.terrain.getMinMaxForTile(Be)||ze),de.addShadowReceiver(Be.toUnwrapped(),ze.min,ze.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eu(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ic(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const fe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),le=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(fe&&!this._snow&&(this._snow=new Mn(this)),!fe&&this._snow&&(this._snow.destroy(),delete this._snow),le&&!this._rain&&(this._rain=new Cx(this)),!le&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Oo.has(this.context.gl))return;this.renderPass="offscreen";for(const ke of P){const Be=t.getLayerSourceCache(ke);if(!ke.hasOffscreenPass()||ke.isHidden(this.transform.zoom))continue;const ze=Be?H[Be.id]:void 0;(ke.type==="custom"||ke.type==="raster"||ke.type==="raster-particle"||ke.isSky()||ze&&ze.length)&&this.renderLayer(this,Be,ke,ze)}this.depthRangeFor3D=[0,1-(P.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Q)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ye=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),be=(()=>{if(s.showOverdrawInspector)return o.am.black;const ke=this.style.fog;if(ke&&this.transform.projection.supportsFog){const Be=this.style.getLut(ke.scope);if(!ye){const ze=ke.properties.get("color-use-theme")==="none",et=ke.properties.get("color").toRenderColor(ze?null:Be).toArray01();return new o.am(...et)}if(ye){const ze=ke.properties.get("space-color-use-theme")==="none",et=ke.properties.get("space-color").toRenderColor(ze?null:Be).toArray01();return new o.am(...et)}}return o.am.transparent})();if(this.context.clear({color:be,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ye&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const ke=P[this.currentLayer],Be=t.getLayerSourceCache(ke);if(ke.isSky())continue;const ze=Be?(ke.is3D(g)?ne:H)[Be.id]:void 0;this._renderTileClippingMasks(ke,Be,ze),this.renderLayer(this,Be,ke,ze)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ye&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const ke=P[this.currentLayer],Be=t.getLayerSourceCache(ke);ke.isSky()&&this.renderLayer(this,Be,ke,Be?H[Be.id]:void 0)}function Fe(ke,Be){let ze;return Be&&(ze=(ke.type==="symbol"?U:ke.is3D(g)?ne:H)[Be.id]),ze}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<b.length;){const ke=P[this.currentLayer];if(ke.type==="raster"||ke.type==="raster-particle"){const Be=t.getLayerSourceCache(ke);this.renderLayer(this,Be,ke,Fe(ke,Be))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Le=0;de&&(Le=de.getShadowCastingLayerCount());let Ke=!1,Xe=-1;for(let ke=0;ke<b.length;++ke){const Be=P[ke];Be.isHidden(this.transform.zoom)||Be.is3D(g)&&(Xe=ke)}C&&Xe===-1&&(S=!0);let dt=!1;for(;this.currentLayer<b.length;){const ke=P[this.currentLayer],Be=t.getLayerSourceCache(ke);if(ke.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ke)){if(ke.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!dt&&ke.is3D(g)&&!g){const ze=this.currentLayer,et=Ge=>{for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const ot=P[this.currentLayer];if(da[ot.type]){const Qe=this.style.getLayerSourceCache(ot);da[ot.type](this,Qe,ot,Fe(ot,Qe),Ge)}}};et("initialize"),et("reset"),this.currentLayer=ze,dt=!0}if(S&&!Ke&&this.terrain&&!this.transform.isOrthographic&&(Ke=!0,this.blitDepth()),C&&Xe!==-1&&this.currentLayer===Xe+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(ke,Be,Be?N[Be.id]:void 0),this.renderLayer(this,Be,ke,Fe(ke,Be)),!this.terrain&&de&&Le>0&&ke.hasShadowPass()&&--Le==0&&(de.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ze=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ze;this.currentLayer++){const et=P[this.currentLayer];if(!et.hasLightBeamPass())continue;const Ge=t.getLayerSourceCache(et);this.renderLayer(this,Ge,et,Ge?H[Ge.id]:void 0)}this.currentLayer=ze,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ze=this.currentLayer;this.depthOcclusion=!0;for(const et of this.layersWithOcclusionOpacity){this.currentLayer=et;const Ge=P[this.currentLayer],ot=t.getLayerSourceCache(Ge),Qe=ot?H[ot.id]:void 0;this.terrain||this._renderTileClippingMasks(Ge,ot,ot?N[ot.id]:void 0),this.renderLayer(this,ot,Ge,Qe)}this.depthOcclusion=!1,this.currentLayer=ze,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ke=null;P.forEach(Be=>{const ze=t.getLayerSourceCache(Be);ze&&!Be.isHidden(this.transform.zoom)&&ze.getVisibleCoordinates().length&&(!ke||ke.getSource().maxzoom<ze.getSource().maxzoom)&&(ke=ze)}),ke&&this.options.showTileBoundaries&&Gi.debug(this,ke,ke.getVisibleCoordinates(),o.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Gi.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ke){const Be=ke.transform.padding;Od(ke,ke.transform.height-(Be.top||0),3,Yp),Od(ke,Be.bottom||0,3,Kp),Fd(ke,Be.left||0,3,Qp),Fd(ke,ke.transform.width-(Be.right||0),3,Io);const ze=ke.transform.centerPoint;(function(et,Ge,ot,Qe){Ec(et,Ge-1,ot-10,2,20,Qe),Ec(et,Ge-10,ot-1,20,2,Qe)})(ke,ze.x,ke.transform.height-ze.y,$a)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),O||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:s}=this.transform.projection,h=!s||!s.includes(t.type);if(nm[t.type]&&(h||this.terrain&&t.type==="custom")){const m=this.style.getLayerSourceCache(t);nm[t.type](t,m,this)}this.gpuTimingEnd()}renderLayer(t,s,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||m&&m.length)&&(this.id=h.id,this.gpuTimingStart(h),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(h.type)&&(!t.terrain||h.type!=="custom")||h.type==="clip"||Gi[h.type](t,s,h,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,h=this.context.gl;let m=this.gpuTimers[t.id];m||(m=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:h.createQuery()}),m.calls++,h.beginQuery(s.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,s=this.context.gl,h=s.createQuery();this.deferredRenderGpuTimeQueries.push(h),s.beginQuery(t.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const s={};for(const h in t){const m=t[h],g=this.context.extTimerQuery,v=g.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;g.deleteQueryEXT(m.query),s[h]=v}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let h=0;for(const m of t)h+=s.getQueryParameter(m,s.QUERY_RESULT)/1e6,s.deleteQuery(m);return h}translatePosMatrix(t,s,h,m,g){if(!h[0]&&!h[1])return t;const v=g?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(v){const C=Math.sin(v),P=Math.cos(v);h=[h[0]*P-h[1]*C,h[0]*C+h[1]*P]}const b=[g?h[0]:o.aw(s,h[0],this.transform.zoom),g?h[1]:o.aw(s,h[1],this.transform.zoom),0],S=new Float32Array(16);return o.bo(S,t,b),S}saveTileTexture(t){const s=t.size[0],h=this._tileTextures[s];h?h.push(t):this._tileTextures[s]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,s,h){const m=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,g=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(g.push("LIGHTING_3D_MODE"),g.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||g.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||g.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(g.push("TERRAIN"),this.linearFloatFilteringSupported()&&g.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&g.push("GLOBE"),!this._fogVisible||m||s!==void 0&&!s||g.push("FOG","FOG_DITHERING"),m&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}getOrCreateProgram(t,s){this.cache=this.cache||{};const h=s&&s.defines||[],m=s&&s.config,g=this.currentGlobalDefines(t,s&&s.overrideFog,s&&s.overrideRtt).concat(h),v=Ad.cacheKey(Sl[t],t,g,m);return this.cache[v]||(this.cache[v]=new Ad(this.context,t,Sl[t],m,vx[t],g)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,s){if(this.style.enable3dLights()){const h=this.style.directionalLight,m=this.style.ambientLight;if(h&&m){const g=((v,b,S)=>{const C=v.properties.get("direction"),P=v.properties.get("color-use-theme")==="none",D=v.properties.get("color").toRenderColor(P?null:S.getLut(v.scope)).toArray01(),z=v.properties.get("intensity"),O=b.properties.get("color-use-theme")==="none",V=b.properties.get("color").toRenderColor(O?null:S.getLut(b.scope)).toArray01(),N=b.properties.get("intensity"),H=[C.x,C.y,C.z],U=o.dw(V,N),Q=o.dw(D,z);return{u_lighting_ambient_color:U,u_lighting_directional_dir:H,u_lighting_directional_color:Q,u_ground_radiance:Np(H,Q,U)}})(h,m,this.style);s.setLightsUniformValues(t,g)}}}uploadCommonUniforms(t,s,h,m,g){if(this.uploadCommonLightUniforms(t,s),this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),S=((C,P,D,z,O,V,N,H,U,Q,ne,ae)=>{const ge=C.transform,de=P.properties.get("color-use-theme")==="none",fe=P.properties.get("color").toRenderColor(de?null:C.style.getLut(P.scope)).toArray01();fe[3]=z;const le=C.frameCounter/1e3%1,[ye,be]=P.properties.get("vertical-range");return{u_fog_matrix:D?ge.calculateFogTileMatrix(D):ae||C.identityMat,u_fog_range:P.getFovAdjustedRange(ge._fov),u_fog_color:fe,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ye,be),be],u_fog_temporal_offset:le,u_frustum_tl:O,u_frustum_tr:V,u_frustum_br:N,u_frustum_bl:H,u_globe_pos:U,u_globe_radius:Q,u_viewport:ne,u_globe_transition:o.ah(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,v,h,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],m);s.setFogUniformValues(t,S)}g&&s.setCutoffUniformValues(t,g.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const m of h)s[m.key]=t[m.key]||new la(m,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,s){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[t.key];return s||(this._cachedTileFogOpacities[t.key]=s=this.style.fog.getOpacityForTile(t)),s[0]>=Et||s[1]>=Et}setupDepthForOcclusion(t,s,h){const m=this.context,g=m.gl,v=!!h;var b;h||(h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),m.activeTexture.set(g.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),h.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],h.u_depth_range_unpack=[2/((b=this.depthRangeFor3D)[1]-b[0]),-1-2*b[0]/(b[1]-b[0])],h.u_occluder_half_size=.5*this.occlusionParams.occluderSize,h.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE0),v||s.setTerrainUniformValues(m,h)}}function kl(u,t){let s=!1,h=null;const m=()=>{h=null,s&&(u(),h=setTimeout(m,t),s=!1)};return()=>(s=!0,h||m(),h)}class Cc{constructor(t){this._hashName=t&&encodeURIComponent(t),o.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=kl(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const s=Gd(t);if(this._hashName){const h=this._hashName;let m=!1;const g=location.hash.slice(1).split("&").map(v=>{const b=v.split("=")[0];return b===h?(m=!0,`${b}=${s}`):v}).filter(v=>v);return m||g.push(`${h}=${s}`),`#${g.join("&")}`}return`#${s}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(Number(h)))){const h=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Gd(u,t){const s=u.getCenter(),h=Math.round(100*u.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,m),v=Math.round(s.lng*g)/g,b=Math.round(s.lat*g)/g,S=u.getBearing(),C=u.getPitch();let P=t?`/${v}/${b}/${h}`:`${h}/${b}/${v}`;return(S||C)&&(P+="/"+Math.round(10*S)/10),C&&(P+=`/${Math.round(C)}`),P}const Mc={linearity:.3,easing:o.ew(0,0,.3,1)},rm=o.l({deceleration:2500,maxSpeed:1400},Mc),om=o.l({deceleration:20,maxSpeed:1400},Mc),Vs=o.l({deceleration:1e3,maxSpeed:360},Mc),fa=o.l({deceleration:1e3,maxSpeed:90},Mc);class $d{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=o.q.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const g=Pc(s.pan.mag(),h,o.l({},rm,t||{}));m.offset=s.pan.mult(g.amount/s.pan.mag()),m.center=this._map.transform.center,Ol(m,g)}if(s.zoom){const g=Pc(s.zoom,h,om);m.zoom=this._map.transform.zoom+g.amount,Ol(m,g)}if(s.bearing){const g=Pc(s.bearing,h,Vs);m.bearing=this._map.transform.bearing+o.aD(g.amount,-179,179),Ol(m,g)}if(s.pitch){const g=Pc(s.pitch,h,fa);m.pitch=this._map.transform.pitch+g.amount,Ol(m,g)}if(m.zoom||m.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;m.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function Ol(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function Pc(u,t,s){const{maxSpeed:h,linearity:m,deceleration:g}=s,v=o.aD(u*m/(t/1e3),-h,h),b=Math.abs(v)/(g*m);return{easing:s.easing,duration:1e3*b,amount:v*(b/2)}}class yo extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h,m={}){const g=xt(s.getCanvasContainer(),h),v=s.unproject(g);super(t,o.l({point:g,lngLat:v,originalEvent:h},m)),this._defaultPrevented=!1,this.target=s}}class Us extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h){const m=t==="touchend"?h.changedTouches:h.touches,g=ci(s.getCanvasContainer(),m),v=g.map(S=>s.unproject(S)),b=g.reduce((S,C,P,D)=>S.add(C.div(D.length)),new o.P(0,0));super(t,{points:g,point:b,lngLats:v,lngLat:s.unproject(b),originalEvent:h}),this._defaultPrevented=!1}}class sm extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class Wa{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new sm(this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new yo(t.type,this._map,t))}mouseup(t){this._map.fire(new yo(t.type,this._map,t))}preclick(t){const s=o.l({},t);s.type="preclick",this._map.fire(new yo(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new yo(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new yo(t.type,this._map,t))}mouseover(t){this._map.fire(new yo(t.type,this._map,t))}mouseout(t){this._map.fire(new yo(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Us(t.type,this._map,t))}touchmove(t){this._map.fire(new Us(t.type,this._map,t))}touchend(t){this._map.fire(new Us(t.type,this._map,t))}touchcancel(t){this._map.fire(new Us(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class am{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new yo(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new yo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new yo(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hd{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ue(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const h=s,m=this._startPos,g=this._lastPos;if(!m||!g||g.equals(h)||!this._box&&h.dist(m)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=me("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(m.x,h.x),b=Math.max(m.x,h.x),S=Math.min(m.y,h.y),C=Math.max(m.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${S}px)`,this._box.style.width=b-v+"px",this._box.style.height=C-S+"px")})}mouseupWindow(t,s){if(!this._active)return;const h=this._startPos,m=s;if(h&&t.button===0){if(this.reset(),wt(),h.x!==m.x||h.y!==m.y)return this._map.fire(new o.A("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(h,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),tt(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new o.A(t,{originalEvent:s}))}}function oh(u,t){const s={};for(let h=0;h<u.length;h++)s[u[h].identifier]=t[h];return s}class lm{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){const g=new o.P(0,0);for(const v of m)g._add(v);return g.div(m.length)}(s),this.touches=oh(h,s)))}touchmove(t,s,h){if(this.aborted||!this.centroid)return;const m=oh(h,s);for(const g in this.touches){const v=m[g];(!v||v.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,s,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class vr{constructor(t){this.singleTap=new lm(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,h){this.singleTap.touchstart(t,s,h)}touchmove(t,s,h){this.singleTap.touchmove(t,s,h)}touchend(t,s,h){const m=this.singleTap.touchend(t,s,h);if(m){const g=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(m)<30;if(g&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class cm{constructor(){this._zoomIn=new vr({numTouches:1,numTaps:2}),this._zoomOut=new vr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,h){this._zoomIn.touchstart(t,s,h),this._zoomOut.touchstart(t,s,h)}touchmove(t,s,h){this._zoomIn.touchmove(t,s,h),this._zoomOut.touchmove(t,s,h)}touchend(t,s,h){const m=this._zoomIn.touchend(t,s,h),g=this._zoomOut.touchend(t,s,h);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(m)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const um={0:1,2:2},Za={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class sh{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const h=ti(t);this._correctButton(t,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(t,s){const h=this._lastPoint;if(h){if(t.preventDefault(),this._eventButton!=null&&function(m,g){const v=um[g];return m.buttons===void 0||(m.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(t){this._lastPoint&&ti(t)===this._eventButton&&(this._moved&&wt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hm extends sh{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class qd extends sh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Za[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const h=.8*(s.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Fl extends sh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Za[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const h=-.5*(s.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class dm{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(t,s,h){return this._calculateTransform(t,s,h)}touchmove(t,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!o.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,s,h)}}touchend(t,s,h){this._calculateTransform(t,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,h){h.length>0&&(this._active=!0);const m=oh(h,s),g=new o.P(0,0),v=new o.P(0,0);let b=0;for(const C in m){const P=m[C],D=this._touches[C];D&&(g._add(P),v._add(P.sub(D)),b++,m[C]=P)}if(this._touches=m,b<this._minTouches||!v.mag())return;const S=v.div(b);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(b),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ah{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,h){return{}}touchstart(t,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,h){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[g,v]=m,b=Rc(h,s,g),S=Rc(h,s,v);if(!b||!S)return;const C=this._aroundCenter?null:b.add(S).div(2);return this._move([b,S],C,t)}touchend(t,s,h){if(!this._firstTwoTouches)return;const[m,g]=this._firstTwoTouches,v=Rc(h,s,m),b=Rc(h,s,g);v&&b||(this._active&&wt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Rc(u,t,s){for(let h=0;h<u.length;h++)if(u[h].identifier===s)return t[h]}function lh(u,t){return Math.log(u/t)/Math.LN2}class fm extends ah{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(lh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lh(this._distance,h),pinchAround:s}}}function Wd(u,t){return 180*u.angleWith(t)/Math.PI}class K_ extends ah{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const h=this._vector;if(this._vector=t[0].sub(t[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Wd(this._vector,h),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const m=Wd(t,h);return Math.abs(m)<s}}function Zd(u){return Math.abs(u.y)>Math.abs(u.x)}class Q_ extends ah{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Zd(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,h){const m=this._lastPoints;if(!m)return;const g=t[0].sub(m[0]),v=t[1].sub(m[1]);return this._map._cooperativeGestures&&!o.ex()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(g,v,h.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+v.y)/2*-.5})}gestureBeginsVertically(t,s,h){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,g=s.mag()>=2;if(!m&&!g)return;if(!m||!g)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const v=t.y>0==s.y>0;return Zd(t)&&Zd(s)&&v}}const J_={panStep:100,bearingStep:15,pitchStep:10};class ey{constructor(){const t=J_;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,h=0,m=0,g=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:b=>{const S=b.getZoom();b.easeTo({duration:300,easeId:"keyboardHandler",easing:ty,zoom:s?Math.round(S)+s*(t.shiftKey?2:1):S,bearing:b.getBearing()+h*this._bearingStep,pitch:b.getPitch()+m*this._pitchStep,offset:[-g*this._panStep,-v*this._panStep],center:b.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ty(u){return u*(2-u)}const pm=4.000244140625,iy=1/450;class ny{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=iy,o.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||o.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=o.q.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%pm==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=xt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>pm?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&P!==0&&(P=1/P);const D=s(),z=Math.pow(2,D),O=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(O*P))),this._type==="wheel"&&(this._startZoom=D,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,g=this._easing;let v,b=!1;if(this._type==="wheel"&&m&&g){const C=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),P=g(C);v=o.ai(m,h,P),C<1?this._frameId||(this._frameId=!0):b=!0}else v=h,b=!0;this._active=!0,b&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let S=v-s();return S*this._lastDelta<0&&(S=0),{noInertia:!0,needsRenderFrame:!b,zoomDelta:S,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=o.ey;if(this._prevEase){const h=this._prevEase,m=(o.q.now()-h.start)/h.duration,g=h.easing(m+.01)-h.easing(m),v=.27/Math.sqrt(g*g+1e-4)*.01,b=Math.sqrt(.0729-v*v);s=o.ew(v,b,.25,1)}return this._prevEase={start:o.q.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ry{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class oy{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sy{constructor(){this._tap=new vr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,s,h))}touchmove(t,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=s[0],g=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,s,h)}touchend(t,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,s,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ay{constructor(t,s,h){this._el=t,this._mousePan=s,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Mx{constructor(t,s,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Px{constructor(t,s,h,m){this._el=t,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const kn=u=>u.zoom||u.drag||u.pitch||u.rotate;class ly extends o.A{}class Rx{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const h=o.at([],s,t);this.radius=o.ae(h[2]<0?o.eA([],h,this.constants):[h[0],h[1],0])}projectRay(t){o.eA(t,t,this.constants),o.au(t,t),o.eB(t,t,this.constants);const s=o.b$([],t,this.radius);if(s[2]>0){const h=o.b$([],[0,0,1],o.bE(s,[0,0,1])),m=o.b$([],o.au([],[s[0],s[1],0]),this.radius),g=o.cU([],s,o.b$([],o.at([],o.cU([],m,h),s),2));s[0]=g[0],s[1]=g[1]}return s}}function zc(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class zx{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $d(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Rx,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.aV(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,g,v]of this._listeners){const b=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(g,b,v)}}destroy(){for(const[t,s,h]of this._listeners){const m=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(s,m,h)}}_addDefaultHandlers(t){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new Wa(s,t));const m=s.boxZoom=new Hd(s,t);this._add("boxZoom",m);const g=new cm,v=new oy;s.doubleClickZoom=new ry(v,g),this._add("tapZoom",g),this._add("clickZoom",v);const b=new sy;this._add("tapDragZoom",b);const S=s.touchPitch=new Q_(s);this._add("touchPitch",S);const C=new qd(t),P=new Fl(t);s.dragRotate=new Mx(t,C,P),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);const D=new hm(t),z=new dm(s,t);s.dragPan=new ay(h,D,z),this._add("mousePan",D),this._add("touchPan",z,["touchZoom","touchRotate"]);const O=new K_,V=new fm;s.touchZoomRotate=new Px(h,V,O,b),this._add("touchRotate",O,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),this._add("blockableMapEvent",new am(s));const N=s.scrollZoom=new ny(s,this);this._add("scrollZoom",N,["mousePan"]);const H=s.keyboard=new ey;this._add("keyboard",H);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[U]&&s[U].enable(t[U])}_add(t,s,h){this._handlers.push({handlerName:t,handler:s,allowed:h}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!kn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,s,h){for(const m in t)if(m!==h&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const h of t)this._el.contains(h.target)&&s.push(h);return s}handleEvent(t,s){this._updatingCamera=!0;const h=t.type==="renderFrame",m=h?void 0:t,g={needsRenderFrame:!1},v={},b={},S=t.touches?this._getMapTouches(t.touches):void 0,C=S?ci(this._el,S):h?void 0:xt(this._el,t);for(const{handlerName:z,handler:O,allowed:V}of this._handlers){if(!O.isEnabled())continue;let N;this._blockedByActive(b,V,z)?O.reset():O[s||t.type]&&(N=O[s||t.type](t,C,S),this.mergeHandlerResult(g,v,N,z,m),N&&N.needsRenderFrame&&this._triggerRenderFrame()),(N||O.isActive())&&(b[z]=O)}const P={};for(const z in this._previousActiveHandlers)b[z]||(P[z]=m);this._previousActiveHandlers=b,(Object.keys(P).length||zc(g))&&(this._changes.push([g,v,P]),this._triggerRenderFrame()),(Object.keys(b).length||zc(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:D}=g;D&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],D(this._map))}mergeHandlerResult(t,s,h,m,g){if(!h)return;o.l(t,h);const v={handlerName:m,originalEvent:h.originalEvent||g};h.zoomDelta!==void 0&&(s.zoom=v),h.panDelta!==void 0&&(s.drag=v),h.pitchDelta!==void 0&&(s.pitch=v),h.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const t={},s={},h={};for(const[m,g,v]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),o.l(s,g),o.l(h,v);this._updateMapTransform(t,s,h),this._changes=[]}_updateMapTransform(t,s,h){const m=this._map,g=m.transform,v=Q=>[Q.x,Q.y,Q.z];if((Q=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!zc(t)){const Q=g.zoom;g.cameraElevationReference="sea",this._originalZoom!=null&&g._orthographicProjectionAtLowPitch&&g.projection.name!=="globe"&&g.pitch===0?(g.cameraElevationReference="ground",g.zoom=this._originalZoom):(g.recenterOnTerrain(),g.cameraElevationReference="ground"),Q!==g.zoom&&this._map._update(!0)}if(g._isCameraConstrained&&m._stop(!0),!zc(t))return void this._fireEvents(s,h,!0);let{panDelta:b,zoomDelta:S,bearingDelta:C,pitchDelta:P,around:D,aroundCoord:z,pinchAround:O}=t;g._isCameraConstrained&&(S>0&&(S=0),g._isCameraConstrained=!1),O!==void 0&&(D=O),(S||(Q=>s[Q]&&!this._eventsInProgress[Q])("drag"))&&D&&(this._dragOrigin=v(g.pointCoordinate3D(D)),this._originalZoom=g.zoom,this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",m._stop(!0),D=D||m.transform.centerPoint,C&&(g.bearing+=C),P&&(g.pitch+=P),g._updateCameraState();const V=[0,0,0];if(b)if(g.projection.name==="mercator"){const Q=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(D).dir),ne=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(D.sub(b)).dir);V[0]=ne[0]-Q[0],V[1]=ne[1]-Q[1]}else{const Q=g.pointCoordinate(D);if(g.projection.name==="globe"){b=b.rotate(-g.angle);const ne=g._pixelsPerMercatorPixel/g.worldSize;V[0]=-b.x*o.ez(o.aY(Q.y))*ne,V[1]=-b.y*o.ez(g.center.lat)*ne}else{const ne=g.pointCoordinate(D.sub(b));Q&&ne&&(V[0]=ne.x-Q.x,V[1]=ne.y-Q.y)}}const N=g.zoom,H=[0,0,0];if(S){const Q=v(z||g.pointCoordinate3D(D)),ne={dir:o.au([],o.at([],Q,g._camera.position))};if(ne.dir[2]<0){const ae=g.zoomDeltaToMovement(Q,S);o.b$(H,ne.dir,ae)}}const U=o.cU(V,V,H);g._translateCameraConstrained(U),S&&Math.abs(g.zoom-N)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,h,!0)}_fireEvents(t,s,h){const m=kn(this._eventsInProgress),g=kn(t),v={};for(const P in t){const{originalEvent:D}=t[P];this._eventsInProgress[P]||(v[`${P}start`]=D),this._eventsInProgress[P]=t[P]}!m&&g&&this._fireEvent("movestart",g.originalEvent);for(const P in v)this._fireEvent(P,v[P]);g&&this._fireEvent("move",g.originalEvent);for(const P in t){const{originalEvent:D}=t[P];this._fireEvent(P,D)}const b={};let S;for(const P in this._eventsInProgress){const{handlerName:D,originalEvent:z}=this._eventsInProgress[P];this._handlersById[D].isActive()||(delete this._eventsInProgress[P],S=s[D]||z,b[`${P}end`]=S)}for(const P in b)this._fireEvent(P,b[P]);const C=kn(this._eventsInProgress);if(h&&(m||g)&&!C){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;P?(D(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:S})):(this._map.fire(new o.A("moveend",{originalEvent:S})),D(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new o.A(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new ly("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Dc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class cy extends o.E{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,o.aV(["_renderFrameCallback"],this)}getCenter(){return new o.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,h){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,o.l({offset:t},s),h)}panTo(t,s,h){return this.easeTo(o.l({center:t},s),h)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,h){return this.easeTo(o.l({zoom:t},s),h)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,h){return this.easeTo(o.l({bearing:t},s),h)}resetNorth(t,s){return this.rotateTo(0,o.l({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(o.l({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=o.aG.convert(t);const h=s&&s.bearing||0,m=s&&s.pitch||0,g=t.getNorthWest(),v=t.getSouthEast();return this._cameraForBounds(this.transform,g,v,h,m,s)}_extendPadding(t){const s={top:0,right:0,bottom:0,left:0};return t==null?o.l({},s,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:o.l({},s,t)}_extendCameraOptions(t){return(t=o.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,s){const h=s.max[0]-s.min[0],m=s.max[1]-s.min[1];return h/m>t.aspect?h/(2*Math.tan(.5*t.fovX)*t.aspect):m/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,s,h,m,g,v){const b=t.clone(),S=this._extendCameraOptions(v);b.bearing=m,b.pitch=g;const C=o.cd.convert(s),P=o.cd.convert(h),D=.5*(C.lat+P.lat),z=.5*(C.lng+P.lng),O=o.eC(D,z),V=o.au([],O),N=o.au([],o.bG([],V,[0,1,0])),H=o.bG([],N,V),U=[N[0],N[1],N[2],0,H[0],H[1],H[2],0,V[0],V[1],V[2],0,0,0,0,1],Q=[O,o.eC(C.lat,C.lng),o.eC(P.lat,C.lng),o.eC(P.lat,P.lng),o.eC(C.lat,P.lng),o.eC(D,C.lng),o.eC(D,P.lng),o.eC(C.lat,z),o.eC(P.lat,z)];let ne=o.cV.fromPoints(Q.map(Ge=>[o.bE(N,Ge),o.bE(H,Ge),o.bE(V,Ge)]));const ae=o.ad([],ne.center,U);o.eD(ae)===0&&o.eE(ae,0,0,1),o.au(ae,ae),o.b$(ae,ae,o.aE),b.center=o.eF(ae);const ge=b.getWorldToCameraMatrix(),de=o.bi(new Float64Array(16),ge);ne=o.cV.applyTransform(ne,o.az([],ge,U));const fe=this._extendAABB(ne,b,S,m);if(!fe)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=fe,o.ad(ae,ae,ge);const le=.5*(ne.max[2]-ne.min[2]),ye=this._minimumAABBFrustumDistance(b,ne),be=o.b$([],[0,0,1],le),Fe=o.cU(be,ae,be),Le=ye+(b.pitch===0?0:o.bD(ae,Fe)),Ke=b.globeCenterInViewSpace,Xe=o.at([],ae,[Ke[0],Ke[1],Ke[2]]);o.au(Xe,Xe),o.b$(Xe,Xe,Le);const dt=o.cU([],ae,Xe);o.ad(dt,dt,de);const ke=o.eq/o.aE,Be=o.ae(dt),ze=o.c6(Math.max(Be*ke-o.eq,Number.EPSILON),0),et=Math.min(b.zoomFromMercatorZAdjusted(ze),S.maxZoom);return et>.5*(o.cL+o.cx)?(b.setProjection({name:"mercator"}),b.zoom=et,this._cameraForBounds(b,s,h,m,g,v)):{center:b.center,zoom:et,bearing:m,pitch:g}}_extendAABB(t,s,h,m){const g=.5*((h.padding.left||0)+(h.padding.right||0)),v=.5*((h.padding.top||0)+(h.padding.bottom||0)),b=v,S=g,C=g,P=v,D=s.width-(S+C),z=s.height-(b+P),O=o.at([],t.max,t.min),V=Math.min(D/O[0],z/O[1]),N=Math.min(s.scaleZoom(s.scale*V),h.maxZoom);if(isNaN(N))return null;const H=s.scale/s.zoomScale(N),U=new o.cV([t.min[0]-S*H,t.min[1]-P*H,t.min[2]],[t.max[0]+C*H,t.max[1]+b*H,t.max[2]]),Q=(typeof h.offset.x=="number"&&typeof h.offset.y=="number"?new o.P(h.offset.x,h.offset.y):o.P.convert(h.offset)).rotate(-o.al(m));return U.center[0]-=Q.x*H,U.center[1]+=Q.y*H,U}queryTerrainElevation(t,s){const h=this.transform.elevation;return h?(s=o.l({},{exaggerated:!0},s),h.getAtPoint(o.ac.fromLngLat(t),null,s.exaggerated)):null}_cameraForBounds(t,s,h,m,g,v){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,s,h,m,g,v);const b=t.clone(),S=this._extendCameraOptions(v);b.bearing=m,b.pitch=g;const C=o.cd.convert(s),P=o.cd.convert(h),D=new o.cd(C.lng,P.lat),z=new o.cd(P.lng,C.lat),O=b.project(C),V=b.project(P),N=this.queryTerrainElevation(C),H=this.queryTerrainElevation(P),U=this.queryTerrainElevation(D),Q=this.queryTerrainElevation(z),ne=[[O.x,O.y,Math.min(N||0,H||0,U||0,Q||0)],[V.x,V.y,Math.max(N||0,H||0,U||0,Q||0)]];let ae=o.cV.fromPoints(ne);const ge=b.getWorldToCameraMatrix(),de=o.bi(new Float64Array(16),ge);ae=o.cV.applyTransform(ae,ge);const fe=this._extendAABB(ae,b,S,m);if(!fe)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=fe;const le=.5*o.at([],ae.max,ae.min)[2],ye=this._minimumAABBFrustumDistance(b,ae),be=[0,0,1,0];o.aA(be,be,ge),o.eG(be,be);const Fe=o.b$([],be,ye+le),Le=o.cU([],ae.center,Fe);o.ad(ae.center,ae.center,de),o.ad(Le,Le,de);const Ke=b.unproject(new o.P(ae.center[0],ae.center[1])),Xe=o.eH(b.projection,Ke),dt=Math.pow(2,Xe),ke=Math.min(b._zoomFromMercatorZ(Le[2]*b.pixelsPerMeter*dt/b.worldSize),S.maxZoom);return b.mercatorFromTransition&&ke<.5*(o.cL+o.cx)?(b.setProjection({name:"globe"}),b.zoom=ke,this._cameraForBounds(b,s,h,m,g,v)):{center:Ke,zoom:ke,bearing:m,pitch:g}}fitBounds(t,s,h){const m=this.cameraForBounds(t,s);return this._fitInternal(m,s,h)}fitScreenCoordinates(t,s,h,m,g){const v=o.P.convert(t),b=o.P.convert(s),S=new o.P(Math.min(v.x,b.x),Math.min(v.y,b.y)),C=new o.P(Math.max(v.x,b.x),Math.max(v.y,b.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(v,b))return this;const P=this.transform.pointLocation3D(S),D=this.transform.pointLocation3D(C),z=this.transform.pointLocation3D(new o.P(S.x,C.y)),O=this.transform.pointLocation3D(new o.P(C.x,S.y)),V=[Math.min(P.lng,D.lng,z.lng,O.lng),Math.min(P.lat,D.lat,z.lat,O.lat)],N=[Math.max(P.lng,D.lng,z.lng,O.lng),Math.max(P.lat,D.lat,z.lat,O.lat)],H=m&&m.pitch?m.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,V,N,h,H,m);return this._fitInternal(U,m,g)}_fitInternal(t,s,h){return t?(s=o.l(t,s)).linear?this.easeTo(s,h):this.flyTo(s,h):this}jumpTo(t,s){this.stop();const h=t.preloadOnly?this.transform.clone():this.transform;let m=!1,g=!1,v=!1;"zoom"in t&&h.zoom!==+t.zoom&&(m=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=o.cd.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(g=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(v=!0,h.pitch=+t.pitch);const b=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!h.isPaddingEqual(b))if(t.retainPadding===!1){const S=h.clone();S.padding=b,h.setLocationAtPoint(h.center,S.centerPoint)}else h.padding=b;return t.preloadOnly?(this._preloadTiles(h),this):(this.fire(new o.A("movestart",s)).fire(new o.A("move",s)),m&&this.fire(new o.A("zoomstart",s)).fire(new o.A("zoom",s)).fire(new o.A("zoomend",s)),g&&this.fire(new o.A("rotatestart",s)).fire(new o.A("rotate",s)).fire(new o.A("rotateend",s)),v&&this.fire(new o.A("pitchstart",s)).fire(new o.A("pitch",s)).fire(new o.A("pitchend",s)),this.fire(new o.A("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Dc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return o.w(Dc),this;this.stop();const m=h.zoom,g=h.pitch,v=h.bearing;h.setFreeCameraOptions(t);const b=m!==h.zoom,S=g!==h.pitch,C=v!==h.bearing;return this.fire(new o.A("movestart",s)).fire(new o.A("move",s)),b&&this.fire(new o.A("zoomstart",s)).fire(new o.A("zoom",s)).fire(new o.A("zoomend",s)),C&&this.fire(new o.A("rotatestart",s)).fire(new o.A("rotate",s)).fire(new o.A("rotateend",s)),S&&this.fire(new o.A("pitchstart",s)).fire(new o.A("pitch",s)).fire(new o.A("pitchend",s)),this.fire(new o.A("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=o.l({offset:[0,0],duration:500,easing:o.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const h=this.transform,m=this.getZoom(),g=this.getBearing(),v=this.getPitch(),b=this.getPadding(),S="zoom"in t?+t.zoom:m,C="bearing"in t?this._normalizeBearing(t.bearing,g):g,P="pitch"in t?+t.pitch:v,D=this._extendPadding(t.padding),z=o.P.convert(t.offset);let O,V,N;if(h.projection.name==="globe"){const be=o.ac.fromLngLat(h.center),Fe=z.rotate(-h.angle);be.x+=Fe.x/h.worldSize,be.y+=Fe.y/h.worldSize;const Le=be.toLngLat(),Ke=o.cd.convert(t.center||Le);this._normalizeCenter(Ke),O=h.centerPoint.add(Fe),V=new o.P(be.x,be.y).mult(h.worldSize),N=new o.P(o.ay(Ke.lng),o.aH(Ke.lat)).mult(h.worldSize).sub(V)}else{O=h.centerPoint.add(z);const be=h.pointLocation(O),Fe=o.cd.convert(t.center||be);this._normalizeCenter(Fe),V=h.project(be),N=h.project(Fe).sub(V)}const H=h.zoomScale(S-m);let U,Q;t.around&&(U=o.cd.convert(t.around),Q=h.locationPoint(U));const ne=this._zooming||S!==m,ae=this._rotating||g!==C,ge=this._pitching||P!==v,de=!h.isPaddingEqual(D),fe=t.retainPadding===!1?h.clone():h,le=be=>Fe=>{if(ne&&(be.zoom=o.ai(m,S,Fe)),ae&&(be.bearing=o.ai(g,C,Fe)),ge&&(be.pitch=o.ai(v,P,Fe)),de&&(fe.interpolatePadding(b,D,Fe),O=fe.centerPoint.add(z)),U)be.setLocationAtPoint(U,Q);else{const Le=be.zoomScale(be.zoom-m),Ke=S>m?Math.min(2,H):Math.max(.5,H),Xe=Math.pow(Ke,1-Fe),dt=be.unproject(V.add(N.mult(Fe*Xe)).mult(Le));be.setLocationAtPoint(be.renderWorldCopies?dt.wrap():dt,O)}return t.preloadOnly||this._fireMoveEvents(s),be};if(t.preloadOnly){const be=this._emulate(le,t.duration,h);return this._preloadTiles(be),this}const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=ae,this._pitching=ge,this._padding=de,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,ye),this._ease(le(h),be=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(s,be)},t),this}_prepareEase(t,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||h.moving||this.fire(new o.A("movestart",t)),this._zooming&&!h.zooming&&this.fire(new o.A("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new o.A("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new o.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.A("move",t)),this._zooming&&this.fire(new o.A("zoom",t)),this._rotating&&this.fire(new o.A("rotate",t)),this._pitching&&this.fire(new o.A("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,m=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new o.A("zoomend",t)),m&&this.fire(new o.A("rotateend",t)),g&&this.fire(new o.A("pitchend",t)),this.fire(new o.A("moveend",t))}flyTo(t,s){if(this._prefersReducedMotion(t)){const Ge=o.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ge,s)}this.stop(),t=o.l({offset:[0,0],speed:1.2,curve:1.42,easing:o.ey},t);const h=this.transform,m=this.getZoom(),g=this.getBearing(),v=this.getPitch(),b=this.getPadding(),S="zoom"in t?o.aD(+t.zoom,h.minZoom,h.maxZoom):m,C="bearing"in t?this._normalizeBearing(t.bearing,g):g,P="pitch"in t?+t.pitch:v,D=this._extendPadding(t.padding),z=h.zoomScale(S-m),O=o.P.convert(t.offset);let V=h.centerPoint.add(O);const N=h.pointLocation(V),H=o.cd.convert(t.center||N);this._normalizeCenter(H);const U=h.project(N),Q=h.project(H).sub(U);let ne=t.curve;const ae=Math.max(h.width,h.height),ge=ae/z,de=Q.mag();if("minZoom"in t){const Ge=o.aD(Math.min(t.minZoom,m,S),h.minZoom,h.maxZoom),ot=ae/h.zoomScale(Ge-m);ne=Math.sqrt(ot/de*2)}const fe=ne*ne;function le(Ge){const ot=(ge*ge-ae*ae+(Ge?-1:1)*fe*fe*de*de)/(2*(Ge?ge:ae)*fe*de);return Math.log(Math.sqrt(ot*ot+1)-ot)}function ye(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function be(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const Fe=le(0);let Le=function(Ge){return be(Fe)/be(Fe+ne*Ge)},Ke=function(Ge){return ae*((be(Fe)*(ye(ot=Fe+ne*Ge)/be(ot))-ye(Fe))/fe)/de;var ot},Xe=(le(1)-Fe)/ne;if(Math.abs(de)<1e-6||!isFinite(Xe)){if(Math.abs(ae-ge)<1e-6)return this.easeTo(t,s);const Ge=ge<ae?-1:1;Xe=Math.abs(Math.log(ge/ae))/ne,Ke=function(){return 0},Le=function(ot){return Math.exp(Ge*ne*ot)}}t.duration="duration"in t?+t.duration:1e3*Xe/("screenSpeed"in t?+t.screenSpeed/ne:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const dt=g!==C,ke=P!==v,Be=!h.isPaddingEqual(D),ze=t.retainPadding===!1?h.clone():h,et=Ge=>ot=>{const Qe=ot*Xe,st=1/Le(Qe);Ge.zoom=ot===1?S:m+Ge.scaleZoom(st),dt&&(Ge.bearing=o.ai(g,C,ot)),ke&&(Ge.pitch=o.ai(v,P,ot)),Be&&(ze.interpolatePadding(b,D,ot),V=ze.centerPoint.add(O));const at=ot===1?H:Ge.unproject(U.add(Q.mult(Ke(Qe))).mult(st));return Ge.setLocationAtPoint(Ge.renderWorldCopies?at.wrap():at,V),Ge._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),Ge};if(t.preloadOnly){const Ge=this._emulate(et,t.duration,h);return this._preloadTiles(Ge),this}return this._zooming=!0,this._rotating=dt,this._pitching=ke,this._padding=Be,this._prepareEase(s,!1),this._ease(et(h),()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,s,h){h.animate===!1||h.duration===0?(t(1),s()):(this._easeStart=o.q.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=o.bX(t,-180,180);const h=Math.abs(t-s);return Math.abs(t-360-s)<h&&(t-=360),Math.abs(t+360-s)<h&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const h=t.lng-s.center.lng;t.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,s,h){const m=Math.ceil(15*s/1e3),g=[],v=t(h.clone());for(let b=0;b<=m;b++){const S=v(b/m);g.push(S.clone())}return g}_preloadTiles(t,s){}}class Xd{constructor(t={}){this.options=t,o.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact,h=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=me("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",h);const m=me("span","mapboxgl-ctrl-icon",this._compactButton);return m.setAttribute("aria-hidden","true"),m.setAttribute("title",h),this._innerContainer=me("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(t){const h=s.reduce((m,g,v)=>(g.value&&(m+=`${g.key}=${g.value}${v<s.length-1?"&":""}`),m),"?");t.href=`${o.e.FEEDBACK_URL}/${h}#${Gd(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._mergedSourceCaches;for(const m in s){const g=s[m];if(g.used){const v=g.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t.sort((m,g)=>m.length-g.length),t=t.filter((m,g)=>{for(let v=g+1;v<t.length;v++)if(t[v].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ch{constructor(){o.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=me("div","mapboxgl-ctrl");const s=me("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const h=t[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Gs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const m of h)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Yd{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=o.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,h){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+h}}const er={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class xs extends o.A{constructor(t,s,h,m){const{point:g,lngLat:v,originalEvent:b,target:S}=t;super(t.type,{point:g,lngLat:v,originalEvent:b,target:S}),this.preventDefault=()=>{t.preventDefault()},this.id=s,this.interaction=h,this.feature=m}}class uh{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,s){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const h=s.filter;let m=s.type;h&&this.filters.set(t,o.b3(h)),m==="mouseover"&&(m="mouseenter"),m==="mouseout"&&(m="mouseleave");const g=this.interactionsByType.get(m)||new Map;m==="mouseenter"||m==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,s)):g.size===0&&this.map.on(m,this.handleType),g.size===0&&this.interactionsByType.set(m,g),g.set(t,s),this.typeById.set(t,m)}get(t){const s=this.typeById.get(t);if(!s)return;const h=this.interactionsByType.get(s);return h?h.get(t):void 0}remove(t){const s=this.typeById.get(t);if(!s)return;this.typeById.delete(t),this.filters.delete(t);const h=this.interactionsByType.get(s);h&&(h.delete(t),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):h.size===0&&this.map.off(s,this.handleType))}queryTargets(t,s){const h=[];for(const[m,g]of s)g.target&&h.push({targetId:m,target:g.target,filter:this.filters.get(m)});return this.map.style.queryRenderedTargets(t,h,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());s.length&&(t.type="mouseenter",this.handleType(t,s));const h=new Map;for(const[m,{feature:g}]of this.prevHoveredFeatures)this.hoveredFeatures.has(m)||h.set(g.id,g);h.size&&(t.type="mouseleave",this.handleType(t,Array.from(h.values())))}handleOut(t){const s=Array.from(this.hoveredFeatures.values()).map(({feature:h})=>h);s.length&&(t.type="mouseleave",this.handleType(t,s)),this.hoveredFeatures.clear()}handleType(t,s){const h=Array.from(this.interactionsByType.get(t.type)).reverse(),m=!!s;s=s||this.queryTargets(t.point,h);const g=t.type==="mouseenter";let v=!1;const b=new Set;for(const S of s){for(const[C,P]of h){if(!P.target)continue;const D=S.variants?S.variants[C]:null;if(D){for(const z of D){if(Mu(z,S,b,C))continue;const O=new o.df(S,z),V=Qh(z,S,C);m&&(O.state=this.map.getFeatureState(O));const N=g?this.prevHoveredFeatures.get(V):null,H=new xs(t,C,P,O),U=N?N.stop:P.handler(H);if(g&&this.hoveredFeatures.set(V,{feature:S,stop:U}),U!==!1){v=!0;break}}if(v)break}}if(v)break}if(!v)for(const[S,C]of h){const{handler:P,target:D}=C;if(!D&&P(new xs(t,S,C,null))!==!1)break}}}function Kd(u,t){if(Array.isArray(u)&&Array.isArray(t)){const s=new Set(u),h=new Set(t);return s.size===h.size&&u.every(m=>h.has(m))}return o.bv(u,t)}const uy={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Dx={showCompass:!0,showZoom:!0,visualizePitch:!1};class hh{constructor(t,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new qd({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new Fl({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),Ue()}move(t,s){const h=this.map,m=this.mouseRotate.mousemoveWindow(t,s),g=m&&m.bearingDelta;if(g&&h.setBearing(h.getBearing()+g),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,s),b=v&&v.pitchDelta;b&&h.setPitch(h.getPitch()+b)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){tt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(o.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),xt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,xt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ci(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=ci(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function hy(u,t,s){if(u=new o.cd(u.lng,u.lat),t){const h=new o.cd(u.lng-360,u.lat),m=new o.cd(u.lng+360,u.lat),g=360*Math.ceil(Math.abs(u.lng-s.center.lng)/360),v=s.locationPoint3D(u).distSqr(t),b=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint3D(h).distSqr(t)<v&&(b||Math.abs(h.lng-s.center.lng)<g)?u=h:s.locationPoint3D(m).distSqr(t)<v&&(b||Math.abs(m.lng-s.center.lng)<g)&&(u=m)}for(;Math.abs(u.lng-s.center.lng)>180;){const h=s.locationPoint3D(u);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;u.lng>s.center.lng?u.lng-=360:u.lng+=360}return u}const mm={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},ns={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class dh extends o.E{constructor(t,s){super(),(t instanceof HTMLElement||s)&&(t=o.l({element:t},s)),o.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:h="center",color:m="#3FB1CE",scale:g=1,draggable:v=!1,clickTolerance:b=0,rotation:S=ns.rotation,rotationAlignment:C=ns.rotationAlignment,pitchAlignment:P=ns.pitchAlignment,occludedOpacity:D=ns.occludedOpacity,altitude:z=ns.altitude}=t||{};this._anchor=h,this._color=m,this._scale=g,this._draggable=v,this._clickTolerance=b,this._rotation=S,this._rotationAlignment=C,this._pitchAlignment=P,this._occludedOpacity=D,this._altitude=z,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",N=>{N.preventDefault()}),this._element.addEventListener("mousedown",N=>{N.preventDefault()});const O=this._element.classList;for(const N in mm)O.remove(`mapboxgl-marker-anchor-${N}`);O.add(`mapboxgl-marker-anchor-${this._anchor}`);const V=t&&t.className?t.className.trim().split(/\s+/):[];O.add(...V),this._popup=null}_createDefaultMarker(){const t=me("div"),s=Pe("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const h=Pe("radialGradient",{id:"shadowGradient"},Pe("defs",{},s));Pe("stop",{offset:"10%","stop-opacity":.4},h),Pe("stop",{offset:"100%","stop-opacity":.05},h),Pe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},s)}return Pe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},s),Pe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},s),Pe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},s),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||ns.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,h=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,s=this._pos;if(!t||!s)return!1;const h=t.unproject(s,this._altitude),m=t.getFreeCameraOptions();if(!m.position)return!1;const g=m.position.toLngLat();return g.distanceTo(h)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const h=t.unproject(s,this._altitude);let m;t._showingGlobe()&&o.eK(t.transform,this._lngLat)?m=0:(m=1-t._queryFogOpacity(h),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${mm[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const t=this._pos,s=this._map,h=this.getPitchAlignment();if(!s||!t||h!=="map")return"";if(!s._showingGlobe()){const S=s.getPitch();return S?`rotateX(${S}deg)`:""}const m=o.cJ(o.eL(s.transform,this._lngLat)),g=t.sub(o.eM(s.transform)),v=Math.abs(g.x)+Math.abs(g.y);if(v===0)return"";const b=m/v;return`rotateX(${-g.y*b}deg) rotateY(${g.x*b}deg)`}_calculateZTransform(){const t=this._pos,s=this._map;if(!s||!t)return"";let h=0;const m=this.getRotationAlignment();if(m==="map")if(s._showingGlobe()){const g=s.project(new o.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),v=s.project(new o.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(g);h=o.cJ(Math.atan2(v.y,v.x))-90}else h=-s.getBearing();else if(m==="horizon"){const g=o.af(4,6,s.getZoom()),v=o.eM(s.transform);v.y+=g*s.transform.height;const b=t.sub(v),S=o.cJ(Math.atan2(b.y,b.x));h=(S>90?S-270:S+90)*(1-g)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=hy(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const s=this._map;if(!s)return;const h=this._pointerdownPos,m=this._positionDelta;if(h&&m){if(!this._isDragging){const g=this._clickTolerance||s._clickTolerance;if(t.point.dist(h)<g)return;this._isDragging=!0}this._pos=t.point.sub(m),this._lngLat=s.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.A("dragstart"))),this.fire(new o.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.A("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map,h=this._pos;s&&h&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(h),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||ns.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||ns.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||ns.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||ns.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const fh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Lc={maxWidth:100,unit:"metric"},pa={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},bs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ws=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Xa(u=new o.P(0,0),t="bottom"){if(typeof u=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(t){case"top":return new o.P(0,u);case"top-left":return new o.P(s,s);case"top-right":return new o.P(-s,s);case"bottom":return new o.P(0,-u);case"bottom-left":return new o.P(s,-s);case"bottom-right":return new o.P(-s,-s);case"left":return new o.P(u,0);case"right":return new o.P(-u,0)}return new o.P(0,0)}return u instanceof o.P||Array.isArray(u)?o.P.convert(u):o.P.convert(u[t]||[0,0])}return{version:j,supported:Ie.supported,setRTLTextPlugin:o.eN,getRTLTextPluginStatus:o.eO,Map:class extends cy{constructor(u){re.mark(W.create);const t=u;if((u=o.l({},uy,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&o.eI(window)&&(u.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new bl(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies,null,null),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new Gs,this._domRenderTaskQueue=new Gs,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.a$(),this._locale=o.l({},er,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=u.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Yd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=u.scaleFactor,this._requestManager=new Vt(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?Object.assign({},u.contextCreateOptions):{},typeof u.container=="string"){const s=document.getElementById(u.container);if(!s)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=s}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._spriteFormat=u.spriteFormat,o.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new em),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new zx(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||o.e.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this.indoor=new g_(this),u.hash&&(this._hash=new Cc(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const s=u.bounds;s&&(this.resize(),this.fitBounds(s,o.l({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new Xd({customAttribution:u.customAttribution})),this._logoControl=new ch,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new o.A(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new o.A(`${s.dataType}dataloading`,s))}),this._interactions=new uh(this)}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new o.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=u.onAdd(this);this._controls.push(u);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new o.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new o.A("movestart",u)).fire(new o.A("move",u)),this.fire(new o.A("resize",u)),t&&this.fire(new o.A("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(o.aG.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(u){return this._scaleFactor=u,this.painter.scaleFactor=u,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(t=>t==="auto"?navigator.language:t):u}setLanguage(u){const t=this._parseLanguage(u);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,t=u.projection.name;let s;t==="globe"&&u.zoom>=o.cx?(u.setMercatorFromTransition(),s=!0):t==="mercator"&&u.zoom<o.cx&&(u.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,t){return this._updateProjection(u||t||{name:"mercator"})}_updateProjection(u){let t;return t=u.name==="globe"&&this.transform.zoom>=o.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u,t){return this.transform.locationPoint3D(o.cd.convert(u),t)}unproject(u,t){return this.transform.pointLocation3D(o.P.convert(u),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,t,s){const h=m=>{let g=[];if(Array.isArray(t)){const v=t.filter(b=>this.getLayer(b));g=v.length?this.queryRenderedFeatures(m,{layers:v}):[]}else g=this.queryRenderedFeatures(m,{target:t});return g};if(u==="mouseenter"||u==="mouseover"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:v=>{const b=h(v.point);b.length?m||(m=!0,s.call(this,new yo(u,this,v.originalEvent,{features:b}))):m=!1},mouseout:()=>{m=!1}}}}if(u==="mouseleave"||u==="mouseout"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:b=>{h(b.point).length?m=!0:m&&(m=!1,s.call(this,new yo(u,this,b.originalEvent)))},mouseout:b=>{m&&(m=!1,s.call(this,new yo(u,this,b.originalEvent)))}}}}{const m=g=>{const v=h(g.point);v.length&&(g.features=v,s.call(this,g),delete g.features)};return{listener:s,targets:t,delegates:{[u]:m}}}}on(u,t,s){if(typeof t=="function"||s===void 0)return super.on(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(u,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(h);for(const m in h.delegates)this.on(m,h.delegates[m]);return this}once(u,t,s){if(typeof t=="function"||s===void 0)return super.once(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(u,t,s);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(u,t,s){if(typeof t=="function"||s===void 0)return super.off(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._delegatedListeners?this._delegatedListeners[u]:void 0;return h&&(m=>{for(let g=0;g<m.length;g++){const v=m[g];if(v.listener===s&&Kd(v.targets,t)){for(const b in v.delegates)this.off(b,v.delegates[b]);return m.splice(g,1),this}}})(h),this}queryRenderedFeatures(u,t){if(!this.style)return[];if(u===void 0||u instanceof o.P||Array.isArray(u)||t!==void 0||(t=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],!t){const g=this.style.queryRenderedFeatures(u,void 0,this.transform),v=this.style.queryRenderedFeatureset(u,void 0,this.transform);return g.concat(v)}let s=!0;if(t.target&&(s=this._isTargetValid(t.target),s&&!t.layers))return this.style.queryRenderedFeatureset(u,t,this.transform);let h=!0;if(t.layers&&Array.isArray(t.layers)){for(const g of t.layers)if(!this._isValidId(g)){h=!1;break}if(h&&!t.target)return this.style.queryRenderedFeatures(u,t,this.transform)}let m=[];return h&&(m=m.concat(this.style.queryRenderedFeatures(u,t,this.transform))),s&&(m=m.concat(this.style.queryRenderedFeatureset(u,t,this.transform))),m}querySourceFeatures(u,t){return!u||typeof u=="string"&&!this._isValidId(u)?[]:this.style.querySourceFeatures(u,t)}isPointOnSurface(u){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&o.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(u))}addInteraction(u,t){return this._interactions.add(u,t),this}removeInteraction(u){return this._interactions.remove(u),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(u){return this._cooperativeGestures=u,this}setStyle(u,t){return t=o.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&u&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(u,(s,h)=>{if(s){const m=typeof s=="string"?s:s instanceof Error?s.message:s.error;o.w(`Unable to perform style diff: ${m}. Rebuilding the style from scratch.`),this._updateStyle(u,t)}else h&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){const s=o.l({},t);t&&t.config&&(s.initialConfig=t.config,delete s.config),this.style=new es(this,s).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new es(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new o.z(new Error("IDs can't be empty."))),!1):!o.d9(u)||(this.fire(new o.z(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}_isTargetValid(u){return"featuresetId"in u?this._isValidId("importId"in u?u.importId:u.featuresetId):"layerId"in u&&this._isValidId(u.layerId)}_areTargetsValid(u){if(Array.isArray(u)){for(const t of u)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(u)}addSource(u,t){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,s)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,t,{pixelRatio:s=1,sdf:h=!1,stretchX:m,stretchY:g,content:v}={}){this._lazyInitEmptyStyle();const b=o.I.from(u);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:S,height:C,data:P}=o.q.getImageData(t);this.style.addImage(b,{data:new o.r({width:S,height:C},P),pixelRatio:s,stretchX:m,stretchY:g,content:v,sdf:h,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new o.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:C}=t,P=t;this.style.addImage(b,{data:new o.r({width:S,height:C},new Uint8Array(P.data)),pixelRatio:s,stretchX:m,stretchY:g,content:v,sdf:h,usvg:!1,version:0,userImage:P}),P.onAdd&&P.onAdd(this,u)}}updateImage(u,t){this._lazyInitEmptyStyle();const s=o.I.from(u),h=this.style.getImage(s);if(!h)return void this.fire(new o.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?o.q.getImageData(t):t,{width:g,height:v,data:b}=m;if(g===void 0||v===void 0)return void this.fire(new o.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(h.usvg?h.icon.usvg_tree.width:h.data.width)||v!==(h.usvg?h.icon.usvg_tree.height:h.data.height))return void this.fire(new o.z(new Error(`The width and height of the updated image (${g}, ${v})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));const S=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let C=!1;h.usvg?(h.data=new o.r({width:g,height:v},new Uint8Array(b)),h.usvg=!1,h.icon=void 0,C=!0):h.data.replace(b,S),this.style.updateImage(s,h,C)}hasImage(u){return u?!!this.style&&!!this.style.getImage(o.I.from(u)):(this.fire(new o.z(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(o.I.from(u))}loadImage(u,t){o.o(this._requestManager.transformRequest(u,o.R.Image),(s,h)=>{t(s,h instanceof HTMLImageElement?o.q.getImageData(h):h)})}listImages(){return this.style.listImages().map(u=>u.name)}addModel(u,t){this._lazyInitEmptyStyle(),this.style.addModel(u,t)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new o.z(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,t){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)):this}getSlot(u){const t=this.getLayer(u);return t&&t.slot||null}setSlot(u,t){return this.style.setSlot(u,t),this.style.mergeLayers(),this._update(!0)}addImport(u,t){return this.style.addImport(u,t).catch(s=>this.fire(new o.z(new Error("Failed to add import",s)))),this}updateImport(u,t){return typeof t!="string"&&t.id!==u?(this.removeImport(u),this.addImport(t)):(this.style.updateImport(u,t),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,t){return this.style.moveImport(u,t),this._update(!0)}moveLayer(u,t){return this._isValidId(u)?(this.style.moveLayer(u,t),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;const t=this.style.getOwnLayer(u);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,t,s){return this._isValidId(u)?(this.style.setLayerZoomRange(u,t,s),this._update(!0)):this}setFilter(u,t,s={}){return this._isValidId(u)?(this.style.setFilter(u,t,s),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,t,s,h={}){return this._isValidId(u)?(this.style.setPaintProperty(u,t,s,h),this._update(!0)):this}getPaintProperty(u,t){return this._isValidId(u)?this.style.getPaintProperty(u,t):null}setLayoutProperty(u,t,s,h={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,t,s,h),this._update(!0)):this}getLayoutProperty(u,t){return this._isValidId(u)?this.style.getLayoutProperty(u,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(u){return this.style.setGlyphsUrl(u),this._update(!0)}getSchema(u){return this.style.getSchema(u)}setSchema(u,t){return this.style.setSchema(u,t),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,t){return this.style.setConfig(u,t),this._update(!0)}getConfigProperty(u,t){return this.style.getConfigProperty(u,t)}setConfigProperty(u,t,s){return this.style.setConfigProperty(u,t,s),this._update(!0)}getFeaturesetDescriptors(u){return this.style.getFeaturesetDescriptors(u)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const t=u[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(u){return this._lazyInitEmptyStyle(),this.style.setSnow(u),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(u){return this._lazyInitEmptyStyle(),this.style.setRain(u),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setImportColorTheme(u,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(u,t),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.cd.convert(u),this.transform):0}setFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.setFeatureState(u,t),this._update())}removeFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.removeFeatureState(u,t),this._update())}getFeatureState(u){return u.source&&!this._isValidId(u.source)?null:this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,h,m,g=this._container;for(;g&&(!h||!m);){const v=window.getComputedStyle(g).transform;v&&v!=="none"&&(s=v.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),g=g.parentElement}this._containerWidth=h?Math.abs(u/h):u,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=me("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=me("div","mapboxgl-canvas-container",u);this._canvas=me("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=me("div","mapboxgl-control-container",u),h=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(m=>{h[m]=me("div",`mapboxgl-ctrl-${m}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const s=o.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(u),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const t=this._popups.indexOf(u);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const u=o.l({},Ie.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",u);t?(Ir(t,!0),this.painter=new Ud(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.m.testSupport(t)):this.fire(new o.z(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.A("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.A("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;this.fire(new o.A("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,h=o.q.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=m.createQuery(),m.beginQuery(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,P=this.transform.pitch,D=o.q.now(),z=new o.aa(C,{now:D,fadeDuration:g,pitch:P,transition:this.style.transition});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(h),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(h);const b=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),b&&(this._placementDirty=b.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,re.mark(W.load),this.fire(new o.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const C=o.q.now()-h;m.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const P=m.getQueryParameter(t,m.QUERY_RESULT)/1e6;m.deleteQuery(t),this.fire(new o.A("gpu-timing-frame",{cpuTime:C,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(C);this.fire(new o.A("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(C);this.fire(new o.A("gpu-timing-deferred-render",{gpuTime:P}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(S||this._repaint)this.triggerRepaint();else{const C=this.idle();if(C&&(v=this._updateAverageElevation(h,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new o.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new o.A("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,re.mark(W.fullLoad),this._performanceMetricsCollection&&fo(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const t of this._markers)u&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!u||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(u,t=!1){const s=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const m=this.transform.averageElevation;let g=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=u;const v=Math.abs(m-g);if(v>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(g),s(g);this._averageElevation.easeTo(g,u,300)}else if(v>1e-4)return this._averageElevation.jumpTo(g),s(g)}return!!this._averageElevation.isEasing(u)&&s(this._averageElevation.getValue(u))}_authenticate(){po(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===Pi||u.status===401)){const t=this.painter.context.gl;Ir(t,!1),this._logoControl instanceof ch&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Vn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ei(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function m(g){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,g,0);const v=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,v),v}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(m(u),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(u,t,s){let h=s[1]-s[0];const m=u.length/4;for(let g=0;g<t.length;g++){const v=t[g];let b=0;for(let S=0;S<v.length;S+=4)v[S]===u[S]&&v[S+1]===u[S+1]&&v[S+2]===u[S+2]&&v[S+3]===u[S+3]&&(b+=1);h+=(s[g+2]-s[g+1])*(1-b/m)}return h}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Oo.delete(this.painter.context.gl),fn.remove(),Ji.remove(),this._removed=!0,this.fire(new o.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=o.q.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_preloadTiles(u){const t=this.style?this.style.getSourceCaches():[];return o.bt(t,(s,h)=>s._preloadTiles(u,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this._tp.refreshUI(),u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,this._tp.refreshUI(),u&&this._update())}_setCacheLimits(u,t){o.eJ(u,t)}get version(){return j}},NavigationControl:class{constructor(u={}){this.options=o.l({},Dx,u),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),me("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),me("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))}),this._compassIcon=me("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const t=u.getZoom(),s=t===u.getMaxZoom(),h=t===u.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new hh(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,t){const s=me("button",u,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(u,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",s),u.firstElementChild&&u.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.E{constructor(u={}){super();const t=navigator.geolocation;this.options=o.l({geolocation:t},fh,u),o.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=kl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const t=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,u(s)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>t(s.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),s=u.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new o.A("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("geolocate",u)),this._finish()}}_updateCamera(u){const t=new o.cd(u.coords.longitude,u.coords.latitude),s=u.coords.accuracy,h=this._map.getBearing(),m=o.l({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new o.cd(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,t=o.c6(1,u._center.lat)*u.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=me("button","mapboxgl-ctrl-geolocate",this._container),me("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=me("div","mapboxgl-user-location"),this._dotElement.appendChild(me("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(me("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new dh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=me("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.A("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Xd,ScaleControl:class{constructor(u={}){this.options=o.l({},Lc,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,h=t._containerWidth/2-u/2,m=t.unproject([h,s]),g=t.unproject([h+u,s]),v=m.distanceTo(g);if(this.options.unit==="imperial"){const b=3.2808*v;b>5280?this._setScale(u,b/5280,"mile"):this._setScale(u,b,"foot")}else this.options.unit==="nautical"?this._setScale(u,v/1852,"nautical-mile"):v>=1e3?this._setScale(u,v/1e3,"kilometer"):this._setScale(u,v,"meter")}_setScale(u,t,s){this._map._requestDomTask(()=>{const h=function(g){const v=Math.pow(10,`${Math.floor(g)}`.length-1);let b=g/v;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(S){const C=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*C)/C}(b),v*b}(t),m=h/t;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(h):`${h}&nbsp;${pa[s]}`,this._container.style.width=u*m+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:o.w("Full screen control 'container' must be a DOM element.")),o.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=me("button","mapboxgl-ctrl-fullscreen",this._controlContainer);me("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(u){super(),this.options=o.l(Object.create(bs),u),this._altitude=this.options.altitude,o.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new o.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new o.A("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=o.cd.convert(u),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(u){return this._altitude=u,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),s=document.createElement("body");let h;for(s.innerHTML=u;h=s.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=me("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(u),this.options.closeButton){const s=this._closeButton=me("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._updateClassList(),t}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,h=this._pos;if(!t||!s||!h)return"bottom";const m=s.offsetWidth,g=s.offsetHeight,v=h.x<m/2,b=h.x>t.transform.width-m/2;if(h.y+u<g)return v?"top-left":b?"top-right":"top";if(h.y>t.transform.height-g){if(v)return"bottom-left";if(b)return"bottom-right"}return v?"left":b?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),u.className=t.join(" ")}_update(u){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=me("div","mapboxgl-popup",t.getContainer()),this._tip=me("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hy(this._lngLat,this._pos,t.transform)),!this._trackPointer||u){const m=this._pos=this._trackPointer&&u instanceof o.P?u:t.project(this._lngLat,this._altitude),g=Xa(this.options.offset),v=this._anchor=this._getAnchor(g.y),b=Xa(this.options.offset,v),S=m.add(b).round();t._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${mm[v]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&t._showingGlobe()){const m=o.eK(t.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(ws);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:dh,Style:es,LngLat:o.cd,LngLatBounds:o.aG,Point:o.P,MercatorCoordinate:o.ac,FreeCameraOptions:cd,Evented:o.E,config:o.e,prewarm:o.eP,clearPrewarmedResources:o.eQ,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(u){o.e.ACCESS_TOKEN=u},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(u){o.e.API_URL=u},get workerCount(){return o.eR.workerCount},set workerCount(u){o.eR.workerCount=u},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){o.e.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){o.eS(u)},get workerUrl(){return o.eT.workerUrl},set workerUrl(u){o.eT.workerUrl=u},get workerClass(){return o.eT.workerClass},set workerClass(u){o.eT.workerClass=u},get workerParams(){return o.eT.workerParams},set workerParams(u){o.eT.workerParams=u},get dracoUrl(){return o.eU()},set dracoUrl(u){o.eV(u)},get meshoptUrl(){return o.eW()},set meshoptUrl(u){o.eX(u)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var R=T;return R})})(Kz);var AV=Kz.exports;const C0=Zw(AV);function CV(r){const l=xe.useRef({value:r,previous:r});return xe.useMemo(()=>(l.current.value!==r&&(l.current.previous=l.current.value,l.current.value=r),l.current.previous),[r])}var a2="Switch",[MV,TU]=Nv(a2),[PV,RV]=MV(a2),Jz=xe.forwardRef((r,l)=>{const{__scopeSwitch:p,name:y,checked:T,defaultChecked:I,required:R,disabled:o,value:j="on",onCheckedChange:W,form:re,...te}=r,[Y,Ee]=xe.useState(null),Ie=Ls(l,we=>Ee(we)),me=xe.useRef(!1),Pe=Y?re||!!Y.closest("form"):!0,[he=!1,pe]=Vv({prop:T,defaultProp:I,onChange:W});return ce.jsxs(PV,{scope:p,checked:he,disabled:o,children:[ce.jsx(Er.button,{type:"button",role:"switch","aria-checked":he,"aria-required":R,"data-state":iD(he),"data-disabled":o?"":void 0,disabled:o,value:j,...te,ref:Ie,onClick:Kn(r.onClick,we=>{pe(Ue=>!Ue),Pe&&(me.current=we.isPropagationStopped(),me.current||we.stopPropagation())})}),Pe&&ce.jsx(zV,{control:Y,bubbles:!me.current,name:y,value:j,checked:he,required:R,disabled:o,form:re,style:{transform:"translateX(-100%)"}})]})});Jz.displayName=a2;var eD="SwitchThumb",tD=xe.forwardRef((r,l)=>{const{__scopeSwitch:p,...y}=r,T=RV(eD,p);return ce.jsx(Er.span,{"data-state":iD(T.checked),"data-disabled":T.disabled?"":void 0,...y,ref:l})});tD.displayName=eD;var zV=r=>{const{control:l,checked:p,bubbles:y=!0,...T}=r,I=xe.useRef(null),R=CV(p),o=dz(l);return xe.useEffect(()=>{const j=I.current,W=window.HTMLInputElement.prototype,te=Object.getOwnPropertyDescriptor(W,"checked").set;if(R!==p&&te){const Y=new Event("click",{bubbles:y});te.call(j,p),j.dispatchEvent(Y)}},[R,p,y]),ce.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:p,...T,tabIndex:-1,ref:I,style:{...r.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function iD(r){return r?"checked":"unchecked"}var nD=Jz,DV=tD;const rD=xe.forwardRef(({className:r,...l},p)=>ce.jsx(nD,{className:Jn("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...l,ref:p,children:ce.jsx(DV,{className:Jn("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));rD.displayName=nD.displayName;var LV="Label",oD=xe.forwardRef((r,l)=>ce.jsx(Er.label,{...r,ref:l,onMouseDown:p=>{var T;p.target.closest("button, input, select, textarea")||((T=r.onMouseDown)==null||T.call(r,p),!p.defaultPrevented&&p.detail>1&&p.preventDefault())}}));oD.displayName=LV;var sD=oD;const kV=Hv("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),aD=xe.forwardRef(({className:r,...l},p)=>ce.jsx(sD,{ref:p,className:Jn(kV(),r),...l}));aD.displayName=sD.displayName;const OV=({activeDay:r,mapboxToken:l})=>{const p=xe.useRef(null),y=xe.useRef(null),T=xe.useRef([]),[I,R]=xe.useState(!1),[o,j]=xe.useState(!1),[W,re]=xe.useState(null);return xe.useEffect(()=>{if(!(!p.current||I))return C0.accessToken=l,y.current=new C0.Map({container:p.current,style:"mapbox://styles/mapbox/outdoors-v12",center:[14.2,37.6],zoom:7,pitch:30,bearing:0}),y.current.addControl(new C0.NavigationControl({visualizePitch:!0}),"bottom-right"),y.current.on("load",()=>R(!0)),()=>{y.current&&(y.current.remove(),y.current=null),T.current.forEach(te=>te.remove()),T.current=[]}},[l]),xe.useEffect(()=>{if(!I||!y.current||!r)return;const te=()=>{var Pe;(Pe=y.current)!=null&&Pe.getSource("route")&&(y.current.removeLayer("route"),y.current.removeSource("route")),re(null)};if(!o||!r.travelFrom){te();return}const Y=Vr.find(Pe=>Pe.location===r.travelFrom&&Pe.id<r.id);if(!Y)return;const Ee=Y.coordinates,Ie=r.coordinates;(async()=>{var Pe,he,pe;try{const Ue=await(await fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${Ee.join(",")};${Ie.join(",")}?geometries=geojson&access_token=${l}`)).json();if(Ue.routes&&Ue.routes.length>0){const tt=Ue.routes[0].geometry,_t=(Ue.routes[0].distance/1e3).toFixed(2);re(`${_t} km`),(Pe=y.current)!=null&&Pe.getSource("route")?y.current.getSource("route").setData(tt):((he=y.current)==null||he.addSource("route",{type:"geojson",data:tt}),(pe=y.current)==null||pe.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3887be","line-width":5,"line-opacity":.75}}))}else te()}catch(we){console.error("Error fetching route:",we),te()}})()},[r,I,o,l]),xe.useEffect(()=>{if(!I||!y.current||!r)return;T.current.forEach(Y=>Y.remove()),T.current=[];const te=new C0.Marker({color:"#D27D2D"}).setLngLat(r.coordinates).addTo(y.current);T.current.push(te),y.current.flyTo({center:r.coordinates,zoom:r.zoomLevel,essential:!0,duration:2e3,bearing:Math.random()*60-30})},[r,I]),ce.jsxs("div",{className:"relative w-full h-full",children:[ce.jsx("div",{ref:p,className:"w-full h-full"}),ce.jsx("div",{className:"absolute bottom-12 left-4 z-[9999]",style:{pointerEvents:"auto",isolation:"isolate"},children:ce.jsxs("div",{className:"bg-white/90 backdrop-blur-sm p-3 rounded-lg shadow-lg border border-gray-200",children:[ce.jsxs("div",{className:"flex items-center space-x-3",children:[ce.jsx("div",{className:"cursor-pointer select-none",onClick:te=>{te.stopPropagation(),te.preventDefault(),te.nativeEvent.stopImmediatePropagation();const Y=!o;console.log("Switch clicked, new value:",Y),j(Y)},children:ce.jsx(rD,{id:"route-toggle",checked:o,onCheckedChange:te=>{console.log("Switch onCheckedChange, new value:",te),j(te)}})}),ce.jsx(aD,{htmlFor:"route-toggle",className:"cursor-pointer select-none text-sm font-medium text-gray-700",onClick:te=>{te.stopPropagation(),te.preventDefault(),te.nativeEvent.stopImmediatePropagation();const Y=!o;console.log("Label clicked, new value:",Y),j(Y)},children:"Show Route"})]}),W&&ce.jsx("div",{className:"text-xs text-center mt-2 text-gray-600 bg-gray-100 px-2 py-1 rounded",children:W})]})})]})},FV=({day:r,isActive:l})=>ce.jsxs("div",{className:`bg-white/90 backdrop-blur-sm rounded-lg shadow-lg p-6 md:p-8 max-w-lg mx-auto 
                  transition-all duration-500 ${l?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[ce.jsxs("div",{className:"border-l-4 border-sicily-terracotta pl-4 mb-4",children:[ce.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-sicily-deep-blue",children:["Day ",r.id]}),ce.jsx("p",{className:"text-lg text-gray-600 font-medium",children:r.date})]}),ce.jsx("h3",{className:"text-xl md:text-2xl font-semibold text-sicily-terracotta mb-2",children:r.location}),r.travelDistance&&ce.jsxs("div",{className:"mb-4 flex items-center text-gray-700",children:[ce.jsx("span",{className:"material-icons-outlined text-sicily-blue mr-1",children:ce.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[ce.jsx("path",{d:"M12 22s-8-4.5-8-11.8A8 8 0 0 1 12 2a8 8 0 0 1 8 8.2c0 7.3-8 11.8-8 11.8z"}),ce.jsx("circle",{cx:"12",cy:"10",r:"3"})]})}),ce.jsxs("span",{className:"text-sm md:text-base",children:[r.travelDistance," from ",r.travelFrom]})]}),ce.jsxs("div",{className:"mb-4",children:[ce.jsxs("h4",{className:"text-md font-semibold text-gray-700 flex items-center",children:[ce.jsx("span",{className:"material-icons-outlined text-sicily-blue mr-1",children:ce.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[ce.jsx("path",{d:"M19 9V6a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v3"}),ce.jsx("path",{d:"M12 13V7"}),ce.jsx("path",{d:"M3 13h18"}),ce.jsx("path",{d:"M19 13v5a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-5"})]})}),r.accommodation.name]}),ce.jsxs("div",{className:"text-sm text-gray-600 ml-6",children:[r.accommodation.checkIn&&ce.jsxs("p",{children:["Check-in: ",r.accommodation.checkIn]}),r.accommodation.checkOut&&ce.jsxs("p",{children:["Check-out: ",r.accommodation.checkOut]})]})]}),ce.jsxs("div",{children:[ce.jsxs("h4",{className:"text-md font-semibold text-gray-700 mb-2 flex items-center",children:[ce.jsx("span",{className:"material-icons-outlined text-sicily-blue mr-1",children:ce.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[ce.jsx("path",{d:"M12 5v9"}),ce.jsx("path",{d:"m16 8-4-3-4 3"}),ce.jsx("path",{d:"M20 22h-2"}),ce.jsx("path",{d:"M4 22h2"}),ce.jsx("path",{d:"M18 11v11"}),ce.jsx("path",{d:"M6 11v11"})]})}),"Today's Activities"]}),ce.jsx("ul",{className:"space-y-2 ml-2",children:r.activities.map((p,y)=>ce.jsxs("li",{className:"flex items-start text-gray-600",children:[ce.jsx("span",{className:"inline-block w-1 h-1 rounded-full bg-sicily-coral mt-2 mr-2"}),p]},y))})]})]}),Oh=xe.forwardRef(({className:r,...l},p)=>ce.jsx("div",{ref:p,className:Jn("rounded-lg border bg-card text-card-foreground shadow-sm",r),...l}));Oh.displayName="Card";const Fh=xe.forwardRef(({className:r,...l},p)=>ce.jsx("div",{ref:p,className:Jn("flex flex-col space-y-1.5 p-6",r),...l}));Fh.displayName="CardHeader";const Bh=xe.forwardRef(({className:r,...l},p)=>ce.jsx("h3",{ref:p,className:Jn("text-2xl font-semibold leading-none tracking-tight",r),...l}));Bh.displayName="CardTitle";const lD=xe.forwardRef(({className:r,...l},p)=>ce.jsx("p",{ref:p,className:Jn("text-sm text-muted-foreground",r),...l}));lD.displayName="CardDescription";const Nh=xe.forwardRef(({className:r,...l},p)=>ce.jsx("div",{ref:p,className:Jn("p-6 pt-0",r),...l}));Nh.displayName="CardContent";const BV=xe.forwardRef(({className:r,...l},p)=>ce.jsx("div",{ref:p,className:Jn("flex items-center p-6 pt-0",r),...l}));BV.displayName="CardFooter";const NV=({activeDay:r})=>ce.jsx("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 z-30 w-[90%] max-w-4xl bg-white/90 backdrop-blur-sm rounded-lg shadow-lg",children:ce.jsxs(Oh,{className:"border-none bg-transparent shadow-none",children:[ce.jsx(Fh,{className:"p-4",children:ce.jsxs(Bh,{className:"text-lg flex items-center",children:[ce.jsx(WT,{className:"w-5 h-5 mr-2 text-sicily-terracotta"}),"Trip Timeline"]})}),ce.jsxs(Nh,{className:"p-4 pt-0",children:[ce.jsx("div",{className:"flex justify-between items-center",children:Vr.map(l=>ce.jsxs("div",{className:`relative flex flex-col items-center ${r===l.id?"scale-110":""}`,children:[ce.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center mb-1 
                             ${r===l.id?"bg-sicily-terracotta text-white":"bg-gray-200 text-gray-600"} 
                             transition-all duration-300`,children:l.id}),ce.jsx("div",{className:"text-xs font-medium",children:l.location.split(" ")[0]}),r===l.id&&ce.jsx("div",{className:"absolute -top-8 whitespace-nowrap text-xs font-semibold bg-sicily-terracotta text-white px-2 py-1 rounded",children:l.date}),r===l.id&&ce.jsx("div",{className:"absolute -bottom-1 w-2 h-2 bg-sicily-terracotta rotate-45"})]},l.id))}),ce.jsx("div",{className:"relative h-1 bg-gray-200 mt-2 mb-1 rounded-full",children:ce.jsx("div",{className:"absolute top-0 left-0 h-full bg-sicily-terracotta rounded-full transition-all duration-300",style:{width:`${r/Vr.length*100}%`}})}),ce.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[ce.jsx("div",{children:"Start: June 1"}),ce.jsx("div",{children:"End: June 16"})]})]})]})}),jV=()=>{const r=Vr.reduce((T,I)=>{if(I.travelDistance){const R=I.travelDistance.match(/(\d+)/);if(R&&R[1])return T+parseInt(R[1],10)}return T},0),l=new Set(Vr.map(T=>T.location)).size,p=new Set(Vr.map(T=>T.accommodation.name)).size,y=[{title:"Total Days",value:Vr.length,icon:WT,color:"text-blue-500"},{title:"Locations",value:l,icon:Ug,color:"text-red-500"},{title:"Accommodations",value:p,icon:Lw,color:"text-green-500"},{title:"Total Distance",value:`${r} km`,icon:HR,color:"text-purple-500"}];return ce.jsxs(Oh,{className:"border-sicily-terracotta/20",children:[ce.jsx(Fh,{children:ce.jsx(Bh,{className:"text-2xl text-sicily-deep-blue",children:"Trip Overview"})}),ce.jsx(Nh,{children:ce.jsx("div",{className:"grid grid-cols-2 gap-4",children:y.map((T,I)=>ce.jsxs("div",{className:"flex items-center p-3 border rounded-md border-gray-200",children:[ce.jsx("div",{className:`p-2 rounded-full ${T.color} bg-gray-100 mr-3`,children:ce.jsx(T.icon,{className:"w-5 h-5"})}),ce.jsxs("div",{children:[ce.jsx("p",{className:"text-sm text-gray-500",children:T.title}),ce.jsx("p",{className:"font-semibold text-lg",children:T.value})]})]},I))})})]})},VV=Hv("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),jh=xe.forwardRef(({className:r,variant:l,size:p,asChild:y=!1,...T},I)=>{const R=y?Vg:"button";return ce.jsx(R,{className:Jn(VV({variant:l,size:p,className:r})),ref:I,...T})});jh.displayName="Button";const UV=()=>{const[r,l]=xe.useState(null),p=xe.useRef([]),y=xe.useRef(null),T="pk.eyJ1Ijoic3Rpbm8zMDIwIiwiYSI6ImNtYXUwa2ZvZTBvNTEybXM0M2dkdnd6b24ifQ.vNx7DSk2gW9Am-We2xrqeg",I=Vr.reduce((R,o)=>{if(o.travelDistance){const j=o.travelDistance.match(/(\d+)/);if(j&&j[1])return R+parseInt(j[1],10)}return R},0);return xe.useEffect(()=>{const R=new IntersectionObserver(o=>{o.forEach(j=>{if(j.isIntersecting){const W=Number(j.target.getAttribute("data-day-id")),re=Vr.find(te=>te.id===W);re&&l(re)}})},{threshold:.6,root:y.current});return p.current.forEach(o=>{o&&R.observe(o)}),()=>{p.current.forEach(o=>{o&&R.unobserve(o)})}},[]),xe.useEffect(()=>{l(Vr[0])},[]),ce.jsxs("div",{className:"relative min-h-screen bg-gray-100 overflow-hidden",children:[ce.jsx("div",{className:"map-container",children:ce.jsx(OV,{activeDay:r,mapboxToken:T})}),ce.jsx(Yz,{}),r&&ce.jsx(NV,{activeDay:r.id}),ce.jsx("div",{className:"fixed top-20 right-4 z-[9999]",style:{pointerEvents:"auto",isolation:"isolate"},children:ce.jsxs("div",{className:"space-y-2",children:[ce.jsx(Xg,{to:"/overview",className:"cursor-pointer",children:ce.jsx(jh,{className:"bg-white border border-sicily-terracotta text-sicily-terracotta hover:bg-sicily-terracotta/10 w-full",children:"View Detailed Overview"})}),ce.jsx(Xg,{to:"/restaurants",className:"cursor-pointer",children:ce.jsx(jh,{className:"bg-white border border-sicily-terracotta text-sicily-terracotta hover:bg-sicily-terracotta/10 w-full",children:"Restaurants to Visit"})})]})}),ce.jsxs("div",{ref:y,className:"scroll-container relative z-20",children:[ce.jsx("section",{className:"scroll-section flex items-center",children:ce.jsx("div",{className:"content-container md:px-12 py-8 ml-auto mr-4 px-0",children:ce.jsxs("div",{className:"bg-white/90 backdrop-blur-sm shadow-lg p-6 md:p-8 max-w-lg mx-0 my-0 px-[32px] py-[32px] rounded-lg",children:[ce.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-6 text-sicily-deep-blue",children:"Sicily Journey"}),ce.jsx("p",{className:"text-xl mb-6 text-gray-700",children:"Explore our 16-day adventure around the beautiful island of Sicily. Scroll to follow our journey day by day."}),ce.jsx("div",{className:"mt-8",children:ce.jsx(jV,{})})]})})}),Vr.map((R,o)=>ce.jsx("section",{ref:j=>{p.current[o]=j},"data-day-id":R.id,className:"scroll-section flex items-center",children:ce.jsx("div",{className:"content-container px-6 md:px-12 py-8 ml-auto mr-4",children:ce.jsx(FV,{day:R,isActive:(r==null?void 0:r.id)===R.id})})},R.id)),ce.jsx("section",{className:"scroll-section flex items-center",children:ce.jsx("div",{className:"content-container px-6 md:px-12 py-8 ml-auto mr-4",children:ce.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-lg shadow-lg p-6 md:p-8 max-w-lg",children:[ce.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4 text-sicily-deep-blue",children:"Trip Summary"}),ce.jsx("p",{className:"text-lg mb-4 text-gray-700",children:"16 days, 6 cities, and countless memories across Sicily's most beautiful locations."}),ce.jsxs("ul",{className:"space-y-2 mb-6",children:[ce.jsxs("li",{className:"flex items-start",children:[ce.jsx("span",{className:"text-sicily-terracotta mr-2",children:""}),ce.jsxs("span",{children:["Total distance: ~",I," km"]})]}),ce.jsxs("li",{className:"flex items-start",children:[ce.jsx("span",{className:"text-sicily-terracotta mr-2",children:""}),ce.jsx("span",{children:"4 different accommodations"})]}),ce.jsxs("li",{className:"flex items-start",children:[ce.jsx("span",{className:"text-sicily-terracotta mr-2",children:""}),ce.jsx("span",{children:"From ancient ruins to volcanic landscapes"})]})]}),ce.jsx("p",{className:"text-gray-600 italic",children:"Planning by Sicily Journey Team"})]})})})]})]})},GV=()=>{const r=s_(),l=qz();return xe.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),ce.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:ce.jsxs("div",{className:"text-center",children:[ce.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),ce.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),ce.jsx("button",{onClick:()=>l("/"),className:"text-blue-500 hover:text-blue-700 underline bg-transparent border-none cursor-pointer",children:"Return to Home"})]})})},cD=xe.forwardRef(({className:r,...l},p)=>ce.jsx("div",{className:"relative w-full overflow-auto",children:ce.jsx("table",{ref:p,className:Jn("w-full caption-bottom text-sm",r),...l})}));cD.displayName="Table";const uD=xe.forwardRef(({className:r,...l},p)=>ce.jsx("thead",{ref:p,className:Jn("[&_tr]:border-b",r),...l}));uD.displayName="TableHeader";const hD=xe.forwardRef(({className:r,...l},p)=>ce.jsx("tbody",{ref:p,className:Jn("[&_tr:last-child]:border-0",r),...l}));hD.displayName="TableBody";const $V=xe.forwardRef(({className:r,...l},p)=>ce.jsx("tfoot",{ref:p,className:Jn("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...l}));$V.displayName="TableFooter";const qw=xe.forwardRef(({className:r,...l},p)=>ce.jsx("tr",{ref:p,className:Jn("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...l}));qw.displayName="TableRow";const gf=xe.forwardRef(({className:r,...l},p)=>ce.jsx("th",{ref:p,className:Jn("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...l}));gf.displayName="TableHead";const _f=xe.forwardRef(({className:r,...l},p)=>ce.jsx("td",{ref:p,className:Jn("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...l}));_f.displayName="TableCell";const HV=xe.forwardRef(({className:r,...l},p)=>ce.jsx("caption",{ref:p,className:Jn("mt-4 text-sm text-muted-foreground",r),...l}));HV.displayName="TableCaption";function qV(r,l=[]){let p=[];function y(I,R){const o=xe.createContext(R),j=p.length;p=[...p,R];function W(te){const{scope:Y,children:Ee,...Ie}=te,me=(Y==null?void 0:Y[r][j])||o,Pe=xe.useMemo(()=>Ie,Object.values(Ie));return ce.jsx(me.Provider,{value:Pe,children:Ee})}function re(te,Y){const Ee=(Y==null?void 0:Y[r][j])||o,Ie=xe.useContext(Ee);if(Ie)return Ie;if(R!==void 0)return R;throw new Error(`\`${te}\` must be used within \`${I}\``)}return W.displayName=I+"Provider",[W,re]}const T=()=>{const I=p.map(R=>xe.createContext(R));return function(o){const j=(o==null?void 0:o[r])||I;return xe.useMemo(()=>({[`__scope${r}`]:{...o,[r]:j}}),[o,j])}};return T.scopeName=r,[y,WV(T,...l)]}function WV(...r){const l=r[0];if(r.length===1)return l;const p=()=>{const y=r.map(T=>({useScope:T(),scopeName:T.scopeName}));return function(I){const R=y.reduce((o,{useScope:j,scopeName:W})=>{const te=j(I)[`__scope${W}`];return{...o,...te}},{});return xe.useMemo(()=>({[`__scope${l.scopeName}`]:R}),[R])}};return p.scopeName=l.scopeName,p}var ZV=xe.createContext(void 0);function dD(r){const l=xe.useContext(ZV);return r||l||"ltr"}var Lb="rovingFocusGroup.onEntryFocus",XV={bubbles:!1,cancelable:!0},ex="RovingFocusGroup",[Ww,fD,YV]=_R(ex),[KV,pD]=qV(ex,[YV]),[QV,JV]=KV(ex),mD=xe.forwardRef((r,l)=>ce.jsx(Ww.Provider,{scope:r.__scopeRovingFocusGroup,children:ce.jsx(Ww.Slot,{scope:r.__scopeRovingFocusGroup,children:ce.jsx(eU,{...r,ref:l})})}));mD.displayName=ex;var eU=xe.forwardRef((r,l)=>{const{__scopeRovingFocusGroup:p,orientation:y,loop:T=!1,dir:I,currentTabStopId:R,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:j,onEntryFocus:W,preventScrollOnEntryFocus:re=!1,...te}=r,Y=xe.useRef(null),Ee=Ls(l,Y),Ie=dD(I),[me=null,Pe]=Vv({prop:R,defaultProp:o,onChange:j}),[he,pe]=xe.useState(!1),we=Ma(W),Ue=fD(p),tt=xe.useRef(!1),[_t,wt]=xe.useState(0);return xe.useEffect(()=>{const xt=Y.current;if(xt)return xt.addEventListener(Lb,we),()=>xt.removeEventListener(Lb,we)},[we]),ce.jsx(QV,{scope:p,orientation:y,dir:Ie,loop:T,currentTabStopId:me,onItemFocus:xe.useCallback(xt=>Pe(xt),[Pe]),onItemShiftTab:xe.useCallback(()=>pe(!0),[]),onFocusableItemAdd:xe.useCallback(()=>wt(xt=>xt+1),[]),onFocusableItemRemove:xe.useCallback(()=>wt(xt=>xt-1),[]),children:ce.jsx(Er.div,{tabIndex:he||_t===0?-1:0,"data-orientation":y,...te,ref:Ee,style:{outline:"none",...r.style},onMouseDown:Kn(r.onMouseDown,()=>{tt.current=!0}),onFocus:Kn(r.onFocus,xt=>{const ci=!tt.current;if(xt.target===xt.currentTarget&&ci&&!he){const ti=new CustomEvent(Lb,XV);if(xt.currentTarget.dispatchEvent(ti),!ti.defaultPrevented){const ni=Ue().filter(ai=>ai.focusable),ui=ni.find(ai=>ai.active),Pi=ni.find(ai=>ai.id===me),vi=[ui,Pi,...ni].filter(Boolean).map(ai=>ai.ref.current);yD(vi,re)}}tt.current=!1}),onBlur:Kn(r.onBlur,()=>pe(!1))})})}),gD="RovingFocusGroupItem",_D=xe.forwardRef((r,l)=>{const{__scopeRovingFocusGroup:p,focusable:y=!0,active:T=!1,tabStopId:I,...R}=r,o=iz(),j=I||o,W=JV(gD,p),re=W.currentTabStopId===j,te=fD(p),{onFocusableItemAdd:Y,onFocusableItemRemove:Ee}=W;return xe.useEffect(()=>{if(y)return Y(),()=>Ee()},[y,Y,Ee]),ce.jsx(Ww.ItemSlot,{scope:p,id:j,focusable:y,active:T,children:ce.jsx(Er.span,{tabIndex:re?0:-1,"data-orientation":W.orientation,...R,ref:l,onMouseDown:Kn(r.onMouseDown,Ie=>{y?W.onItemFocus(j):Ie.preventDefault()}),onFocus:Kn(r.onFocus,()=>W.onItemFocus(j)),onKeyDown:Kn(r.onKeyDown,Ie=>{if(Ie.key==="Tab"&&Ie.shiftKey){W.onItemShiftTab();return}if(Ie.target!==Ie.currentTarget)return;const me=nU(Ie,W.orientation,W.dir);if(me!==void 0){if(Ie.metaKey||Ie.ctrlKey||Ie.altKey||Ie.shiftKey)return;Ie.preventDefault();let he=te().filter(pe=>pe.focusable).map(pe=>pe.ref.current);if(me==="last")he.reverse();else if(me==="prev"||me==="next"){me==="prev"&&he.reverse();const pe=he.indexOf(Ie.currentTarget);he=W.loop?rU(he,pe+1):he.slice(pe+1)}setTimeout(()=>yD(he))}})})})});_D.displayName=gD;var tU={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function iU(r,l){return l!=="rtl"?r:r==="ArrowLeft"?"ArrowRight":r==="ArrowRight"?"ArrowLeft":r}function nU(r,l,p){const y=iU(r.key,p);if(!(l==="vertical"&&["ArrowLeft","ArrowRight"].includes(y))&&!(l==="horizontal"&&["ArrowUp","ArrowDown"].includes(y)))return tU[y]}function yD(r,l=!1){const p=document.activeElement;for(const y of r)if(y===p||(y.focus({preventScroll:l}),document.activeElement!==p))return}function rU(r,l){return r.map((p,y)=>r[(l+y)%r.length])}var oU=mD,sU=_D,l2="Tabs",[aU,SU]=Nv(l2,[pD]),vD=pD(),[lU,c2]=aU(l2),xD=xe.forwardRef((r,l)=>{const{__scopeTabs:p,value:y,onValueChange:T,defaultValue:I,orientation:R="horizontal",dir:o,activationMode:j="automatic",...W}=r,re=dD(o),[te,Y]=Vv({prop:y,onChange:T,defaultProp:I});return ce.jsx(lU,{scope:p,baseId:iz(),value:te,onValueChange:Y,orientation:R,dir:re,activationMode:j,children:ce.jsx(Er.div,{dir:re,"data-orientation":R,...W,ref:l})})});xD.displayName=l2;var bD="TabsList",wD=xe.forwardRef((r,l)=>{const{__scopeTabs:p,loop:y=!0,...T}=r,I=c2(bD,p),R=vD(p);return ce.jsx(oU,{asChild:!0,...R,orientation:I.orientation,dir:I.dir,loop:y,children:ce.jsx(Er.div,{role:"tablist","aria-orientation":I.orientation,...T,ref:l})})});wD.displayName=bD;var TD="TabsTrigger",SD=xe.forwardRef((r,l)=>{const{__scopeTabs:p,value:y,disabled:T=!1,...I}=r,R=c2(TD,p),o=vD(p),j=AD(R.baseId,y),W=CD(R.baseId,y),re=y===R.value;return ce.jsx(sU,{asChild:!0,...o,focusable:!T,active:re,children:ce.jsx(Er.button,{type:"button",role:"tab","aria-selected":re,"aria-controls":W,"data-state":re?"active":"inactive","data-disabled":T?"":void 0,disabled:T,id:j,...I,ref:l,onMouseDown:Kn(r.onMouseDown,te=>{!T&&te.button===0&&te.ctrlKey===!1?R.onValueChange(y):te.preventDefault()}),onKeyDown:Kn(r.onKeyDown,te=>{[" ","Enter"].includes(te.key)&&R.onValueChange(y)}),onFocus:Kn(r.onFocus,()=>{const te=R.activationMode!=="manual";!re&&!T&&te&&R.onValueChange(y)})})})});SD.displayName=TD;var ED="TabsContent",ID=xe.forwardRef((r,l)=>{const{__scopeTabs:p,value:y,forceMount:T,children:I,...R}=r,o=c2(ED,p),j=AD(o.baseId,y),W=CD(o.baseId,y),re=y===o.value,te=xe.useRef(re);return xe.useEffect(()=>{const Y=requestAnimationFrame(()=>te.current=!1);return()=>cancelAnimationFrame(Y)},[]),ce.jsx(jv,{present:T||re,children:({present:Y})=>ce.jsx(Er.div,{"data-state":re?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":j,hidden:!Y,id:W,tabIndex:0,...R,ref:l,style:{...r.style,animationDuration:te.current?"0s":void 0},children:Y&&I})})});ID.displayName=ED;function AD(r,l){return`${r}-trigger-${l}`}function CD(r,l){return`${r}-content-${l}`}var cU=xD,MD=wD,PD=SD,RD=ID;const uU=cU,zD=xe.forwardRef(({className:r,...l},p)=>ce.jsx(MD,{ref:p,className:Jn("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...l}));zD.displayName=MD.displayName;const $0=xe.forwardRef(({className:r,...l},p)=>ce.jsx(PD,{ref:p,className:Jn("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...l}));$0.displayName=PD.displayName;const H0=xe.forwardRef(({className:r,...l},p)=>ce.jsx(RD,{ref:p,className:Jn("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...l}));H0.displayName=RD.displayName;const hU=()=>{const r=Vr.reduce((T,I)=>{if(I.travelDistance){const R=I.travelDistance.match(/(\d+)/);if(R&&R[1])return T+parseInt(R[1],10)}return T},0),l=new Set(Vr.map(T=>T.location)).size,p=new Set(Vr.map(T=>T.accommodation.name)).size,y=[{title:"Total Days",value:Vr.length,icon:WT,color:"text-blue-500"},{title:"Locations",value:l,icon:Ug,color:"text-red-500"},{title:"Accommodations",value:p,icon:Lw,color:"text-green-500"},{title:"Total Distance",value:`${r} km`,icon:HR,color:"text-purple-500"}];return ce.jsxs("div",{className:"min-h-screen bg-gray-100",children:[ce.jsx(Yz,{}),ce.jsxs("div",{className:"container mx-auto py-16 px-4",children:[ce.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[ce.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-sicily-deep-blue",children:"Trip Overview"}),ce.jsx(Xg,{to:"/",children:ce.jsx(jh,{variant:"outline",className:"border-sicily-terracotta text-sicily-terracotta hover:bg-sicily-terracotta/10",children:"Back to Map View"})})]}),ce.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:y.map((T,I)=>ce.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-md flex items-center",children:[ce.jsx("div",{className:`p-3 rounded-full ${T.color} bg-gray-100 mr-3`,children:ce.jsx(T.icon,{className:"w-5 h-5"})}),ce.jsxs("div",{children:[ce.jsx("p",{className:"text-sm text-gray-500",children:T.title}),ce.jsx("p",{className:"font-semibold text-xl",children:T.value})]})]},I))}),ce.jsxs(uU,{defaultValue:"itinerary",className:"mb-8",children:[ce.jsxs(zD,{className:"border-b mb-8 w-full bg-transparent justify-start",children:[ce.jsx($0,{value:"itinerary",className:"data-[state=active]:border-sicily-terracotta data-[state=active]:border-b-2 rounded-none",children:"Day by Day Itinerary"}),ce.jsx($0,{value:"accommodations",className:"data-[state=active]:border-sicily-terracotta data-[state=active]:border-b-2 rounded-none",children:"Accommodations"}),ce.jsx($0,{value:"activities",className:"data-[state=active]:border-sicily-terracotta data-[state=active]:border-b-2 rounded-none",children:"Activities"})]}),ce.jsx(H0,{value:"itinerary",children:ce.jsxs(Oh,{children:[ce.jsx(Fh,{children:ce.jsx(Bh,{children:"Complete Itinerary"})}),ce.jsx(Nh,{children:ce.jsxs(cD,{children:[ce.jsx(uD,{children:ce.jsxs(qw,{children:[ce.jsx(gf,{children:"Day"}),ce.jsx(gf,{children:"Date"}),ce.jsx(gf,{children:"Location"}),ce.jsx(gf,{children:"Travel"}),ce.jsx(gf,{children:"Accommodation"})]})}),ce.jsx(hD,{children:Vr.map(T=>ce.jsxs(qw,{children:[ce.jsxs(_f,{className:"font-medium",children:["Day ",T.id]}),ce.jsx(_f,{children:T.date}),ce.jsx(_f,{children:T.location}),ce.jsx(_f,{children:T.travelDistance?ce.jsxs("span",{className:"flex items-center",children:[ce.jsx(Ug,{className:"h-4 w-4 mr-1 text-sicily-terracotta"}),T.travelDistance," from ",T.travelFrom]}):""}),ce.jsx(_f,{children:T.accommodation.name})]},T.id))})]})})]})}),ce.jsx(H0,{value:"accommodations",children:ce.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Array.from(new Set(Vr.map(T=>T.accommodation.name))).map((T,I)=>{const R=Vr.filter(W=>W.accommodation.name===T),o=R[0],j=R[R.length-1];return ce.jsxs(Oh,{children:[ce.jsx(Fh,{children:ce.jsxs(Bh,{className:"flex items-center",children:[ce.jsx(Lw,{className:"h-5 w-5 mr-2 text-sicily-terracotta"}),T]})}),ce.jsx(Nh,{children:ce.jsxs("div",{className:"space-y-2",children:[ce.jsxs("p",{children:[ce.jsx("span",{className:"font-medium",children:"Location:"})," ",o.location]}),ce.jsxs("p",{children:[ce.jsx("span",{className:"font-medium",children:"Check-in:"})," ",o.accommodation.checkIn||""]}),ce.jsxs("p",{children:[ce.jsx("span",{className:"font-medium",children:"Check-out:"})," ",j.accommodation.checkOut||""]}),ce.jsxs("p",{children:[ce.jsx("span",{className:"font-medium",children:"Length of stay:"})," ",R.length," ",R.length===1?"day":"days"]}),ce.jsxs("p",{children:[ce.jsx("span",{className:"font-medium",children:"Dates:"})," ",o.date," ",R.length>1?`- ${j.date}`:""]})]})})]},I)})})}),ce.jsx(H0,{value:"activities",children:ce.jsxs(Oh,{children:[ce.jsx(Fh,{children:ce.jsx(Bh,{children:"All Activities"})}),ce.jsx(Nh,{children:ce.jsx("div",{className:"space-y-6",children:Vr.map(T=>ce.jsxs("div",{className:"border-l-4 border-sicily-terracotta pl-4",children:[ce.jsxs("h3",{className:"text-xl font-semibold mb-2",children:["Day ",T.id," - ",T.location]}),ce.jsx("p",{className:"text-sm text-gray-500 mb-3",children:T.date}),ce.jsx("ul",{className:"space-y-2",children:T.activities.map((I,R)=>ce.jsxs("li",{className:"flex items-start text-gray-700",children:[ce.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-sicily-coral mt-2 mr-2"}),I]},R))})]},T.id))})})]})})]})]})]})},kb=[{id:1,name:"Antica Dolceria Bonajuto",location:"Modica",coordinates:[0,0],cuisine:"Chocolate Shop, Confectionery",priceRange:"",rating:4.8,description:"Historic confectionery in Modica, renowned for its traditional chocolate and sweets, especially the Modica chocolate.",specialties:["Modica Chocolate","Traditional Sicilian sweets","Cannoli","Nougat"],address:"Corso Umberto I, 159 - 97015 Modica (RG), Italy",phone:"+39 0932 941225",website:"https://www.bonajuto.it/en/",openingHours:"",recommendedDishes:["Chocolate bars (various flavors)","Traditional biscuits","Artisanal nougats"]},{id:2,name:"Nunziatina",location:"Taormina",coordinates:[0,0],cuisine:"Sicilian, Local Ingredients",priceRange:"",rating:4.7,description:"A restaurant in the heart of Taormina, inspired by the warmth and fun-filled clamour of the typical Sicilian home, sincere, welcoming and generous. A dining proposal that is based on the utmost attention to raw materials; a cuisine that focuses on local ingredients, refined and enhanced to satisfy every palate, rich in flavours and aromas, evocative and ancestral, perpetually sincere with respect to an idea of cuisine that is both basic and baroque at the same time.",specialties:["Seasonal local dishes","Fresh seafood","Baroque-inspired cuisine"],address:"Via Roma 12, Taormina (ME), Italy",phone:"+39 0942 573 105",website:"https://www.nunziatinataormina.it/en/",openingHours:"Dinner: Wed-Sun 7:30 PM - 11:00 PM; Lunch: Sun 12:30 PM - 3:00 PM",recommendedDishes:["Menu based on seasonal availability","Local seafood specialties","Reimagined classic Sicilian dishes"]}],dU=Hv("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ob({className:r,variant:l,...p}){return ce.jsx("div",{className:Jn(dU({variant:l}),r),...p})}const fU=()=>{const[r,l]=xe.useState("All"),p=["All",...new Set(kb.map(R=>R.location))],y=r==="All"?kb:kb.filter(R=>R.location===r),T=R=>{switch(R){case"":return"Budget-friendly";case"":return"Moderate";case"":return"Upscale";case"":return"Fine dining";default:return"Price varies"}},I=R=>Array.from({length:5},(o,j)=>ce.jsx(_N,{className:`w-4 h-4 ${j<Math.floor(R)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},j));return ce.jsxs("div",{className:"min-h-screen bg-gray-50",children:[ce.jsx("header",{className:"bg-white shadow-sm border-b",children:ce.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:ce.jsxs("div",{className:"flex items-center justify-between",children:[ce.jsxs("div",{className:"flex items-center space-x-4",children:[ce.jsx(Xg,{to:"/",children:ce.jsxs(jh,{variant:"outline",size:"sm",children:[ce.jsx(fN,{className:"w-4 h-4 mr-2"}),"Back to Journey"]})}),ce.jsx("h1",{className:"text-2xl font-bold text-sicily-deep-blue",children:"Restaurants to Visit in Sicily"})]}),ce.jsx(Xg,{to:"/overview",children:ce.jsx(jh,{variant:"outline",className:"text-sicily-terracotta border-sicily-terracotta hover:bg-sicily-terracotta/10",children:"View Trip Overview"})})]})})}),ce.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[ce.jsxs("div",{className:"mb-8",children:[ce.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Filter by Location"}),ce.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(R=>ce.jsx(jh,{variant:r===R?"default":"outline",size:"sm",onClick:()=>l(R),className:r===R?"bg-sicily-terracotta hover:bg-sicily-deep-blue":"",children:R},R))})]}),ce.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(R=>ce.jsxs(Oh,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[ce.jsx(Fh,{className:"pb-3",children:ce.jsxs("div",{className:"flex items-start justify-between",children:[ce.jsxs("div",{className:"flex-1",children:[ce.jsx(Bh,{className:"text-xl mb-1",children:R.name}),ce.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-2",children:[ce.jsx(Ug,{className:"w-4 h-4 mr-1"}),R.location]}),ce.jsxs("div",{className:"flex items-center space-x-2",children:[ce.jsx("div",{className:"flex",children:I(R.rating)}),ce.jsxs("span",{className:"text-sm text-gray-600",children:["(",R.rating,")"]})]})]}),ce.jsxs("div",{className:"text-right",children:[ce.jsx(Ob,{variant:"secondary",className:"mb-1",children:R.priceRange}),ce.jsx("div",{className:"text-xs text-gray-500",children:T(R.priceRange)})]})]})}),ce.jsxs(Nh,{className:"space-y-4",children:[ce.jsx("div",{children:ce.jsx(Ob,{variant:"outline",className:"text-xs",children:R.cuisine})}),ce.jsx(lD,{className:"text-sm leading-relaxed",children:R.description}),ce.jsxs("div",{children:[ce.jsx("h4",{className:"font-medium text-sm mb-2",children:"Specialties:"}),ce.jsx("div",{className:"flex flex-wrap gap-1",children:R.specialties.map((o,j)=>ce.jsx(Ob,{variant:"outline",className:"text-xs",children:o},j))})]}),ce.jsxs("div",{children:[ce.jsx("h4",{className:"font-medium text-sm mb-2",children:"Must-try dishes:"}),ce.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:R.recommendedDishes.map((o,j)=>ce.jsxs("li",{children:[" ",o]},j))})]}),ce.jsxs("div",{className:"pt-3 border-t space-y-2 text-xs text-gray-600",children:[ce.jsxs("div",{className:"flex items-center",children:[ce.jsx(Ug,{className:"w-3 h-3 mr-2"}),R.address]}),R.phone&&ce.jsxs("div",{className:"flex items-center",children:[ce.jsx(gN,{className:"w-3 h-3 mr-2"}),R.phone]}),R.openingHours&&ce.jsxs("div",{className:"flex items-center",children:[ce.jsx(pN,{className:"w-3 h-3 mr-2"}),R.openingHours]}),R.website&&ce.jsxs("div",{className:"flex items-center",children:[ce.jsx(mN,{className:"w-3 h-3 mr-2"}),ce.jsx("a",{href:R.website,target:"_blank",rel:"noopener noreferrer",className:"text-sicily-terracotta hover:underline",children:"Visit website"})]})]})]})]},R.id))}),y.length===0&&ce.jsx("div",{className:"text-center py-12",children:ce.jsx("p",{className:"text-gray-500",children:"No restaurants found for the selected location."})})]})]})},pU=new Ij,mU=()=>ce.jsx(Cj,{client:pU,children:ce.jsxs(nj,{children:[ce.jsx(e5,{}),ce.jsx(M5,{}),ce.jsx(TV,{children:ce.jsxs(gV,{children:[ce.jsx(fg,{path:"/",element:ce.jsx(UV,{})}),ce.jsx(fg,{path:"/overview",element:ce.jsx(hU,{})}),ce.jsx(fg,{path:"/restaurants",element:ce.jsx(fU,{})}),ce.jsx(fg,{path:"*",element:ce.jsx(GV,{})})]})})]})});pR(document.getElementById("root")).render(ce.jsx(mU,{}));
